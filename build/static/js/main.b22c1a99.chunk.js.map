{"version":3,"sources":["serviceWorker.ts","redux/reducers/currentProjectReducer.ts","redux/reducers/index.ts","redux/reducers/applicationReducer.ts","redux/reducers/connectionsReducer.ts","redux/reducers/recentProjectsReducer.ts","redux/reducers/appErrorReducer.ts","redux/reducers/appTitleReducer.ts","redux/store/initialState.ts","react/components/toolbar/toolbarItem.tsx","providers/toolbar/toolbarItemFactory.ts","registerToolbar.ts","common/extensions/array.ts","common/extensions/map.ts","registerIcons.ts","registerMixins.ts","registerProviders.ts","index.tsx","redux/store/store.ts","react/components/common/alert/alert.tsx","react/components/common/keyboardManager/keyboardManager.tsx","react/components/common/keyboardManager/keyboardRegistrationManager.ts","common/hostProcess.ts","common/crypto.ts","redux/middleware/localStorage.ts","common/htmlFileReader.ts","providers/storage/assetProviderFactory.ts","services/assetService.ts","common/constants.ts","common/appInfo.ts","common/guard.ts","react/components/common/keyboardBinding/keyboardBinding.tsx","../node_modules/pdfjs-dist/build sync","redux/actions/actionTypes.ts","react/components/common/errorHandler/errorHandler.tsx","common/environment.ts","common/themes.ts","providers/storage/azureBlobStorage.ts","common/strings.ts","common/localization/en-us.ts","common/localization/es-cl.ts","App.tsx","redux/actions/appErrorActions.ts","react/components/shell/helpMenu.tsx","react/components/shell/statusBar.tsx","react/components/shell/statusBarMetrics.tsx","react/components/shell/titleBar.tsx","providers/storage/azureBlobStorageError.ts","services/projectService.ts","redux/actions/projectActions.ts","redux/actions/applicationActions.ts","redux/actions/appTitleActions.ts","react/components/common/condensedList/condensedList.tsx","react/components/common/cloudFilePicker/cloudFilePicker.tsx","react/components/common/confirm/confirm.tsx","react/components/pages/homepage/recentProjectItem.tsx","react/components/pages/homepage/homePage.tsx","react/components/common/objectField/objectFieldTemplate.tsx","react/components/common/jsonSchemaFormHelper.ts","react/components/common/customField/customFieldTemplate.tsx","react/components/common/arrayField/arrayFieldTemplate.tsx","react/components/common/protectedInput/protectedInput.tsx","react/components/common/customField/customField.tsx","react/components/pages/appSettings/appSettingsForm.tsx","react/components/pages/appSettings/appSettingsPage.tsx","react/components/pages/train/trainChart.tsx","react/components/pages/train/trainRecord.tsx","react/components/pages/train/trainPanel.tsx","react/components/pages/train/trainTable.tsx","react/components/common/preventLeaving/preventLeaving.tsx","services/serviceHelper.ts","react/components/pages/train/trainPage.tsx","services/connectionService.ts","redux/actions/connectionActions.ts","react/components/common/connectionProviderPicker/connectionProviderPicker.tsx","react/components/pages/connections/connectionForm.tsx","react/components/pages/connections/connectionItem.tsx","react/components/pages/connections/connectionsPage.tsx","react/components/common/assetPreview/imageAsset.tsx","react/components/common/assetPreview/pdfAsset.tsx","react/components/common/assetPreview/tiffAsset.tsx","react/components/common/assetPreview/assetPreview.tsx","react/components/common/align/align.tsx","react/components/common/align/alignPortal.tsx","react/components/common/tagInput/tagInputToolbar.tsx","react/components/common/colorPicker.tsx","react/components/common/tagInput/tagInputItemLabel.tsx","react/components/common/tagInput/tagIndexKeys.ts","react/components/common/tagInput/tagInputItem.tsx","react/components/common/tagInput/tagInput.tsx","services/ocrService.ts","react/components/pages/editorPage/canvasHelpers.ts","react/components/common/imageMap/utils.ts","react/components/common/imageMap/imageMap.tsx","react/components/pages/editorPage/CanvasCommandBar.tsx","react/components/pages/editorPage/canvas.tsx","react/components/pages/editorPage/editorSideBar.tsx","react/components/pages/editorPage/editorPage.tsx","react/components/pages/predict/predictResult.tsx","react/components/pages/predict/predictPage.tsx","react/components/pages/projectSettings/projectSettingAction.tsx","react/components/common/connectionPicker/connectionPicker.tsx","react/components/common/securityTokenPicker/securityTokenPicker.tsx","react/components/pages/projectSettings/projectForm.tsx","react/components/pages/projectSettings/projectSettingsPage.tsx","react/components/shell/mainContentRouter.tsx","common/utils.ts","react/components/common/conditionalNavLink/conditionalNavLink.tsx","react/components/shell/sidebar.tsx","models/applicationState.ts","redux/actions/actionCreators.ts","providers/storage/storageProviderFactory.ts","providers/storage sync /^/.*/.json$","providers/storage sync /^/.*/.ui/.json$","react/components/shell/skipButton.tsx"],"names":["Boolean","window","location","hostname","match","tagColors","require","combineReducers","appSettings","state","action","type","ActionTypes","SAVE_APP_SETTINGS_SUCCESS","ENSURE_SECURITY_TOKEN_SUCCESS","payload","connections","SAVE_CONNECTION_SUCCESS","projectJson","getStorageItem","constants","projectFormTempKey","project","JSON","parse","sourceConnection","setStorageItem","stringify","filter","connection","id","DELETE_CONNECTION_SUCCESS","LOAD_PROJECT_SUCCESS","recentProjects","SAVE_PROJECT_SUCCESS","DELETE_PROJECT_SUCCESS","map","updatedProject","currentProject","CLOSE_PROJECT_SUCCESS","LOAD_ASSET_METADATA_SUCCESS","lastVisitedAssetId","asset","LOAD_PROJECT_ASSETS_SUCCESS","assets","forEach","SAVE_ASSET_METADATA_SUCCESS","updatedAssets","assetTags","Set","regions","region","tags","tag","add","newTags","updateTags","length","find","projectTag","name","push","color","appError","SHOW_ERROR","CLEAR_ERROR","appTitle","SET_TITLE","initialState","securityTokens","ToolbarItemType","ToolbarItem","context","unregisterKeyboardHandler","getTitle","props","tooltip","getShortcut","consolidateKeyCasings","accelerators","join","consolidated","a","item","toLowerCase","onClick","e","stopPropagation","onItemClick","this","className","active","displayName","handler","icon","keyEventType","KeyEventType","KeyDown","IconButton","title","iconProps","iconName","React","Component","contextType","KeyboardContext","ToolbarItemFactory","config","component","Guard","null","componentRegistry","ToolbarItemName","ToolbarItemGroup","forEachAsync","async","batchSize","expression","value","all","batch","pop","tasks","Promise","mapAsync","results","batchResults","concat","containsDuplicates","keySelectorFn","keyNormalizerFn","s","trim","set","key","has","entries","registerIcons_","fontFace","fontFamily","icons","Insights","MachineLearning","TagGroup","ChevronDown","ChevronUp","Edit","Add","Settings","Link","Search","CheckMark","Up","Down","Delete","Cloud","ChevronLeft","ChevronRight","Home","View","Download","Help","Rename","Copy","Tag","Info","AddTo","OpenFolderHorizontal","DocumentManagement","TextDocument","BranchMerge","Plug","PlugConnected","Hide3","WarningSolid","ZoomIn","ZoomOut","TextField","Filter","Table","MapLayers","Array","prototype","arrayForEachAsync","Map","mapForEachAsync","StorageProviderFactory","register","strings","providers","azureBlob","factory","options","AzureBlobStorage","AssetProviderFactory","SelectCanvas","editorPage","toolbar","select","group","Canvas","State","DrawRectangle","drawRectangle","PreviousAsset","previousAsset","Navigation","Action","NextAsset","nextAsset","store","useLocalStorage","paths","middlewares","thunk","storage","createLocalStorage","Env","get","logger","reduxImmutableStateInvariant","default","createLogger","createStore","rootReducer","mergeInitialState","applyMiddleware","createReduxStore","noFocusOutline","document","body","classList","addEventListener","event","keyCode","remove","ReactDOM","render","App","getElementById","navigator","serviceWorker","ready","then","registration","unregister","Alert","getMessage","message","apply","params","onCloseClick","bind","dark","settings","theme","getDarkTheme","scopedSettings","confirmButtonTheme","show","onDismiss","hidden","dialogContentProps","DialogType","normal","subText","modalProps","isBlocking","getPrimaryBlueTheme","text","closeButtonText","onClose","KeyboardRegistrationManager","registrations","registerBinding","binding","keyCodes","eventTypeRegistrations","currentBinding","error","AppError","ErrorCode","OverloadedKeyBinding","getRegistrations","keyEventTypeRegs","evt","getHandler","createContext","KeyboardManager","keyboard","nonSupportedKeys","undefined","inputElementTypes","onKeyboardEvent","isDisabled","invokeHandler","getKeyParts","KeyUp","KeyPress","removeEventListener","Provider","children","keyParts","ctrlKey","metaKey","altKey","activeElement","tagName","HostProcessType","PlatformType","getHostProcess","hostProcessType","osRelease","os","release","indexOf","process","HOST_TYPE","Electron","Browser","isBrowser","ALGO","generateKey","encodeBase64","crypto","getRandomValues","Uint8Array","buffer","encrypt","secret","empty","secretBytes","decodeBase64","iv","importKey","data","encodeUtf8","subtle","encrypted","json","ciphertext","encodeHex","bytes","Error","encryptObject","decrypt","encodedMessage","decodeUtf8","decodeHex","slice","decrypted","decryptObject","sha256Hash","digest","base64","len","byteLength","i","String","fromCharCode","btoa","codes","atob","charCodeAt","hex","code","toString","parseInt","substr","utf8","TextEncoder","encode","pos","point","nextcode","subarray","TextDecoder","decode","b","fromCodePoint","next","result","getState","path","localStorage","setItem","version","getItem","removeStorageItem","removeItem","HtmlFileReader","file","fileInfo","resolve","reject","reader","FileReader","onerror","onload","content","readAsText","err","AssetType","Image","readImageAttributes","responseType","axios","response","status","getAssetBlob","blob","Response","arrayBuffer","refresh","video","videoAssetFiles","parent","endsWith","createElement","onloadedmetadata","currentTime","timestamp","onseeked","canvas","height","videoHeight","width","videoWidth","getContext","drawImage","toBlob","src","url","image","naturalWidth","naturalHeight","fileReader","readAsArrayBuffer","EXIF","orientationTag","isNumber","nameOrOptions","platformSupport","All","providerRegistry","create","providerType","providerOptions","registrationOptions","AssetService","assetProviderInstance","storageProviderInstance","isInExactFolderPath","assetName","normalizedPath","lastIndexOf","filePath","fileName","startsWith","encodeFileURI","hash","pathParts","split","fileNameParts","extensionParts","assetFormat","assetType","getAssetType","format","AssetState","NotVisited","size","TIFF","PDF","Unknown","assetProvider","getAssets","returnedAssets","decodeURIComponent","folderPath","metadata","labelFileName","labelFileExtension","labelData","storageProvider","writeText","Tagged","deleteFile","readText","labels","reason","interpolate","errors","missingRequiredFieldInLabelFile","toast","autoClose","noLabelInLabelFile","info","f","label","warnings","emptyName","duplicateFieldKeyInLabelsFile","labelHash","pageSet","valueObj","page","sameLabelInDifferentPageError","boundingBoxes","box","duplicateBoxInLabelFile","dismiss","appInfo","SyntaxError","invalidJSONFormat","transformer","tagNames","t","labelTransformer","getUpdatedAssets","newTagName","field","_","values","getAssetMetadata","assetMetadata","isUpdated","updateTagInAssetMetadata","updates","foundTag","Visited","projectFileExtensionOld","projectFileExtension","ocrFileExtension","fieldsFileName","maxConcurrentServiceRequests","statusCodeSucceeded","statusCodeFailed","apiKeyHeader","maxRetry","initialRetryInterval","convertedImageFormat","convertedImageQuality","convertedThumbnailQuality","apiModelsPath","pdfjsWorkerSrc","pdfjsCMapUrl","paramName","predicate","KeyboardBinding","deregisterBinding","console","warn","webpackEmptyContext","req","keys","module","exports","throwUnhandledRejectionForEdge","ignoreNotFound","ignoreForbidden","errorCode","BlobContainerIONotFound","BlobContainerIOForbidden","dispatchEvent","CustomEvent","detail","ErrorHandler","onWindowError","preventDefault","handleError","onUnhandledRejection","onEdgeUnhandledRejection","registerUnhandledRejectionHandler","unregisterUnhandledRejectionHandler","showError","localizedError","getLocalizedError","onClearError","isReactDnDError","getUnknownErrorMessage","unknown","onError","whiteTheme","createTheme","palette","themePrimary","themeLighterAlt","themeLighter","themeLight","themeTertiary","themeSecondary","themeDarkAlt","themeDark","themeDarker","neutralLighterAlt","neutralLighter","neutralLight","neutralQuaternaryAlt","neutralQuaternary","neutralTertiaryAlt","neutralTertiary","neutralSecondary","neutralPrimaryAlt","neutralPrimary","neutralDark","black","white","redTheme","greenTheme","greyTheme","blueTheme","darkTheme","accent","darkGreyTheme","getPrimaryWhiteTheme","getDarkGreyTheme","getPrimaryRedTheme","getPrimaryGreenTheme","getPrimaryGreyTheme","storageType","StorageType","azureBlobStorageErrorHandler","exception","toAppError","blobName","blockBlobURL","getBlockBlobURL","download","Aborter","none","downloadResponse","bodyToString","Buffer","from","containerURL","ContainerURL","sas","StorageURL","newPipeline","getCredential","BlockBlobURL","fromContainerURL","upload","delete","ext","listBlobFlatSegment","marker","listBlobsResponse","segment","containerName","AzureBlobStorageError","nextMarker","blobItems","statusCode","listFiles","files","getUrl","createAssetFromFilePath","getFileName","isSupportedAssetType","ocrFileName","str","oauthToken","TokenCredential","AnonymousCredential","_length","blobBody","blobToString","onloadend","ev","target","blobContainerIONotFound","blobContainerIOForbidden","LocalizedStrings","en","appName","common","description","submit","cancel","save","provider","homePage","reload","skipToMainContent","skipToSidebar","projectService","existingLabelFiles","titleBar","help","minimize","maximize","restore","close","newProject","openLocalProject","openCloudProject","selectConnection","deleteProject","confirmation","importProject","messages","deleteSuccess","storageTitle","uiHelp","securityToken","commit","devTools","button","saveSuccess","projectSettings","targetConnection","videoSettings","frameExtractionRate","addConnection","projectExisted","train","training","pleaseWait","notTrainedYet","predict","uploadFile","inProgress","projectMetrics","assetsSectionTitle","totalAssetCount","visitedAssets","taggedAssets","nonTaggedAssets","nonVisitedAssets","tagsSectionTitle","totalRegionCount","totalTagCount","avgTagCountPerAsset","placeholder","editor","modal","colors","gray","red","maroon","yellow","olive","lime","green","aqua","teal","blue","navy","fuschia","purple","existingName","unknownTagName","contextualMenu","edit","moveDown","moveUp","lock","rename","search","vertiline","details","instructions","new","imageCorsWarning","blobCorsWarning","azDocLinkText","accountName","createContainer","bing","apiKey","query","aspectRatio","square","wide","tall","local","selectFolder","chooseFolder","tagged","visited","pan","drawPolygon","copyRectangle","copy","cut","paste","removeAllRegions","saveProject","exportProject","activeLearning","videoPlayer","previousTaggedFrame","nextTaggedFrame","previousExpectedFrame","nextExpectedFrame","escape","assetError","hotKey","enforceTaggedRegions","profile","projectUploadError","genericRenderError","projectInvalidSecurityToken","projectInvalidJson","projectDeleteError","projectNotFound","securityTokenNotFound","canvasError","importError","pasteRegionTooBigError","exportFormatNotFound","activeLearningPredictionError","projectDeleteForbidden","projectDeleteNotFound","predictWithoutTrainForbidden","endpointConnectionError","tooManyRequests","modelCountLimitExceeded","es","addLocValues","outputJson","interpolateJson","template","names","Object","vals","Function","connect","dispatch","actions","bindActionCreators","appErrorActions","GenericRenderError","platform","global","clearError","role","skipTo","showErrorAction","clearErrorAction","createPayloadAction","createAction","HelpMenu","akaMsLink","href","rel","StatusBar","StatusBarMetrics","projectAssets","count","TitleBar","Web","maximized","fullscreen","ProjectService","decryptProject","loadedProject","ProjectInvalidSecurityToken","packageJson","shortid","generate","createFromConnection","getTagsFromPreExistingLabelFiles","getTagsFromPreExistingFieldFile","saveFieldsFile","encryptProject","projectList","p","fileList","tagNameSet","blobs","tagNameArray","index","FieldType","FieldFormat","NotSpecified","patch","fieldFilePath","joinPath","fieldInfo","fields","fieldKey","fieldType","fieldFormat","loadProject","appState","projectToken","SecurityTokenNotFound","load","loadProjectAction","isDuplicate","ProjectDuplicateName","savedProject","saveProjectAction","decryptedProject","deleteProjectAction","closeProject","loadAssets","assetService","loadProjectAssetsAction","loadAssetMetadata","loadAssetMetadataAction","saveAssetMetadata","newAssetMetadata","savedMetadata","saveAssetMetadataAction","updateProjectTag","oldTag","newTag","assetUpdates","renameTag","updateProjectTagAction","deleteProjectTag","deleteTag","deleteProjectTagAction","closeProjectAction","UPDATE_PROJECT_TAG_SUCCESS","DELETE_PROJECT_TAG_SUCCESS","saveAppSettings","saveAppSettingsAction","ensureSecurityToken","st","tokenPrefix","tokenCountWithTheSamePrefix","tokenSuffix","updatedAppSettings","ensureSecurityTokenAction","setTitle","setTitleAction","CondensedList","onItemDelete","onDelete","items","newLinkTo","newLinkToTitle","to","FontIcon","Spinner","SpinnerSize","small","ListItem","CloudFilePicker","open","getInitialState","ok","back","connectionList","onClickConnection","onClickFile","closeBtn","Modal","isOpen","centered","ModalHeader","toggle","modalHeader","ModalBody","condensedList","ModalFooter","selectedFile","Button","disabled","okDisabled","backDisabled","setState","onCancel","selectedConnection","onSubmit","isCloudConnection","getCloudConnections","getCondensedList","args","fileExtension","fileItems","Confirm","hideDialog","onConfirmClick","onCancelClick","Customizer","Dialog","DialogFooter","PrimaryButton","confirmButtonText","DefaultButton","cancelButtonText","onConfirm","RecentProjectItem","aria-label","style","HomePage","projectActions","applicationActions","appTitleActions","cloudPickerOpen","newProjectRef","createRef","deleteConfirmRef","cloudFilePickerRef","createNewProject","history","handleOpenCloudProjectClick","current","loadSelectedProject","freshLoadSelectedProject","projectStr","selectedProject","container","focus","ref","ObjectFieldTemplate","properties","backFillAriaLabelledBy","element","hasAttribute","errorId","ariaAttrNode","createAttribute","setAttributeNode","CustomFieldTemplate","required","rawErrors","schema","uiSchema","useEffect","classNames","htmlFor","errorMessage","idx","ArrayFieldTemplate","useState","focusFlag","setFocusFlag","canAdd","autoFocus","onAddClick","hasRemove","onDropIndexClick","onClickCapture","ProtectedInput","showKey","toggleKeyVisibility","copyKey","onChange","prevProps","readOnly","autoComplete","clipboard","CustomField","Widget","mapProps","widgetProps","formSchema","AppSettingsForm","idSchema","$id","formData","onFormValidate","onFormCancel","showErrorList","liveValidate","noHtml5Validate","FieldTemplate","validate","form","AppSettingsPage","onFormSubmit","success","goBack","TrainChart","chartRef","chart","componentDidMount","newChart","componentDidUpdate","Chart","chartData","chartOptions","getLabels","datasets","getData","backgroundColor","getColor","accuracies","entry","toPercent","val","toFixed","projectTags","maintainAspectRatio","legend","display","scales","xAxes","ticks","beginAtZero","yAxes","barThickness","animation","easing","layout","padding","num","PureComponent","TrainRecord","modelInfo","modelId","Date","createdDateTime","toLocaleString","averageAccuracy","TrainPanel","renderButton","vt","faClass","viewType","aria-pressed","updateViewTypeCallback","currTrainRecord","TrainTable","trainMessage","PreventLeaving","onBeforeUnload","when","msg","returnValue","ServiceHelper","handleServiceError","HttpStatusUnauthorized","HttpStatusNotFound","errorTitle","ModelCountLimitExceeded","HttpStatusTooManyRequests","ModelNotFound","postWithAutoRetry","sendRequestWithAutoRetry","post","applyApiKey","getWithAutoRetry","headers","request","currentRetry","isTransient","delay","Math","pow","includes","TrainPage","handleTrainClick","isTraining","trainProcess","trainResult","prevState","getTrainMessage","getProjectTrainRecord","catch","handleViewTypeClick","buildUpdatedProject","newTrainRecord","trainRecord","trainingResult","updateCurrTrainRecord","curr","parseTrainResult","buildAccuracies","poll","func","timeout","interval","endTime","Number","checkSucceeded","setTimeout","showTrainingFailedWarning","trainingFailedMessage","projectId","ariaLive","labelPosition","large","trainRes","getTrainStatus","trainStatusRes","baseURL","apiUriBase","trainSourceURL","source","sourceFilter","prefix","includeSubFolders","useLabelFile","operationLocation","extendedTimeoutInMs","res","max","ConnectionService","initialize","loadConnection","loadConnectionAction","saveConnection","connectionService","saveConnectionAction","deleteConnection","deleteConnectionAction","LOAD_CONNECTION_SUCCESS","ConnectionProviderPicker","storageProviders","assetProviders","allProviders","uniqBy","orderBy","ConnectionForm","widgets","connectionProviderPicker","protectedInput","checkbox","Checkbox","checked","onFormChange","providerName","bindForm","Ids","getPropertiesIds","formatString","addError","resetProviderOptions","newFormSchema","newUiSchema","providerSchema","providerUiSchema","ConnectionItem","ConnectionPage","connectionActions","confirmDelete","prevConnectionId","newConnectionId","onConnectionDelete","alert","connectionId","exact","ImageAsset","onLoad","onLoaded","onActivated","onDeactivated","imageUri","loadImageToCanvas","toDataURL","alt","crossOrigin","pdfjsLib","workerSrc","PDFAsset","loadPdfFile","promise","pdf","loadPdfPage","pageNumber","getPage","viewport","getViewport","scale","renderContext","canvasContext","TiffAsset","loadTiffFile","getAssetArray","assetArrayBuffer","tiffImages","parseTiffData","loadTiffPage","tiffImage","renderTiffToCanvas","AssetPreview","renderAsset","rootAsset","onAssetLoad","contentSource","loaded","hasError","onAssetChanged","isRunningOCR","Label","defaultProps","controlsEnabled","Align","Categories","AlignPortal","portalElement","appendChild","removeChild","createPortal","ColorPicker","pickerBackground","onEditColor","GithubPicker","onChangeComplete","styles","card","background","triangle","TagInputItemLabel","handleMouseEnter","onLabelEnter","handleMouseLeave","onLabelLeave","onMouseEnter","onMouseLeave","formRegion","tagIndexKeys","TagInputItem","isRenaming","isLocked","itemRef","inputElement","onDropdownClick","clickedDropDown","onColorClick","clickedColor","onNameClick","getItemClassName","isSelected","appliedToSelectedRegions","getTagContent","displayIndex","getDisplayIndex","isTypeOrFormatSpecified","onInputRef","getContentClassName","defaultValue","onKeyDown","onInputKeyDown","onBlur","onInputBlur","ariaLabel","renderTagDetail","onRenameTag","blur","onRename","TagMenuItem","TagOperationMode","TagInputToolbar","getToolbarItems","category","General","handleAdd","handleSearch","Separator","Modifier","handleRename","handleMoveUp","handleMoveDown","handleDelete","renderItems","modifierDisabled","selectedTag","modifierClassNames","modifierClassName","itemConfig","onToolbarItemClick","onAddTags","onSearchTags","onReorder","isNameEqual","x","y","toLocaleLowerCase","OcrStatus","TagInput","tagOperation","None","addTags","showTagInputBox","searchTags","showSearchBox","searchQuery","tagItemRefs","headerRef","inputRef","onLockTag","lockedTags","onLockedTagsChange","onReOrder","displacement","currentIndex","newIndex","splice","handleColorChange","addTag","validateTagLength","validateTagUniqness","onTagRename","cancelCallback","cancelRename","tagsWithoutOldTag","elem","onDeleteTag","onTagDeleted","getColorPickerPortal","showColorPicker","align","points","renderTagItems","createTagItemProps","clear","prop","setTagLabels","setTagItemRef","onTagChanged","selectedRegionTagSet","getSelectedRegionTagSet","findIndex","onTagItemClick","selectedRegions","onCtrlTagClick","ContextualMenu","newTagOperation","oldTagOperation","selected","deselect","onTagClick","onSearchKeyDown","onAddTagKeyDown","creatTagInput","onAddTagWithBlur","getNextColor","vacancy","randomIntInRange","some","onHideContextualMenu","getContextualMenuItems","subMenuProps","getTypeSubMenuItems","getFormatSubMenuItems","itemType","ContextualMenuItemType","Divider","onMenuItemClick","MoveUp","MoveDown","canCheck","isChecked","onTypeSelect","Alphanumeric","NoWhiteSpaces","Currency","Integer","DMY","MDY","YMD","Time","filterFormat","onFormatSelect","selectedTagRef","getTagNameRef","CanvasHelpers","existingTag","Utils","degree","PI","ImageMap","imageLayer","textVectorLayer","tableBorderVectorLayer","tableIconVectorLayer","tableIconBorderVectorLayer","mapElement","imageExtent","countPointerDown","isSwiping","TEXT_VECTOR_LAYER_NAME","TABLE_BORDER_VECTOR_LAYER_NAME","TABLE_ICON_VECTOR_LAYER_NAME","TABLE_ICON_BORDER_VECTOR_LAYER_NAME","ignorePointerMoveEventCount","pointerMoveEventCount","textVectorLayerFilter","layerFilter","layer","tableIconBorderVectorLayerFilter","toggleTableFeatureVisibility","setVisible","getVisible","getResolutionForZoom","zoom","getView","toggleTextFeatureVisibility","addFeature","feature","getSource","addTableBorderFeature","addTableIconFeature","addTableIconBorderFeature","addFeatures","features","addTableBorderFeatures","addTableIconFeatures","addTableIconBorderFeatures","addInteraction","interaction","getAllFeatures","getFeatures","getFeatureByID","featureID","getFeatureById","getTableBorderFeatureByID","getTableIconFeatureByID","getTableIconBorderFeatureByID","removeFeature","removeAllFeatures","handleTableToolTipChange","removeInteraction","getImageExtent","getFeaturesInExtent","extent","forEachFeatureInExtent","zoomIn","setZoom","getZoom","zoomOut","resetZoom","initMap","projection","createProjection","ImageLayer","createImageSource","textOptions","featureStyler","VectorSource","VectorLayer","tableBorderOptions","tableBorderFeatureStyler","tableIconOptions","tableIconFeatureStyler","updateWhileAnimating","updateWhileInteracting","tableIconBorderOptions","tableIconBorderFeatureStyler","controls","interactions","defaultInteractions","doubleClickZoom","pinchRotate","layers","view","createMapView","on","handlePointerDown","handlePointerMove","handlePointerMoveOnTableIcon","handlePointerUp","setImage","setSource","mapView","setView","imageExtend","Projection","units","minZoom","getMinimumZoom","rotation","imageAngle","degreeToRadians","center","getCenter","Static","containerAspectRatio","clientHeight","clientWidth","imageHeight","imageWidth","LOG2E","log","enableFeatureSelection","setDragPanInteraction","eventPixel","getEventPixel","originalEvent","isPointerOnTextFeature","hasFeatureAtPixel","handleTextFeatureSelect","forEachFeatureAtPixel","getFeaturesAtPixel","hoveringFeature","coordinates","getGeometry","getCoordinates","pixels","getPixelFromCoordinate","flattenedLines","xAxisValues","yAxisValues","left","min","top","shouldIgnorePointerMove","dragPanEnabled","getInteractions","DragPan","setActive","el","OCRService","readOcrFile","fetchOcrUriResult","isValidOcrFormat","ocr","analyzeResult","readResults","onStatusChanged","notifyStatusChanged","ocrStatus","loadingFromAzureBlob","ocrJson","runningOCR","done","CanvasCommandBar","commandBarItems","handleLayerChange","commandBarFarItems","iconOnly","handleZoomOut","handleZoomIn","CommandBar","farItems","cMapUrl","currentAsset","selectedAsset","numPages","currentPage","ocrForCurrentPage","pdfFile","isError","tables","tableIconTooltip","imageMap","ocrService","selectedRegionIds","regionOrders","regionOrderById","lastKeyBoardRegionId","applyTagFlag","pendingFlag","loadImage","loadOcr","loadLabelData","isLabelDataChanged","redrawFeatures","newRegions","convertLabelDataToRegions","updateAssetRegions","hoveredLabel","updateHighlightStatus","hostStyles","root","position","handleKeyDown","handleCanvasZoomIn","handleCanvasZoomOut","onMapReady","noOp","TooltipHost","rows","columns","aria-describedby","handleTableIconFeatureSelect","shouldShowPreviousPageButton","prevPage","shouldShowNextPageButton","nextPage","shouldShowMultiPageIndicator","applyTag","getSelectedRegions","regionsEmpty","showMultiPageFieldWarningIfNecessary","setSingleTag","selectedRegion","updateRegions","onSelectedRegionsChanged","r","addRegions","addRegionsToAsset","addRegionsToImageMap","regionsToBeKept","assetRegion","allFeatures","regionsNotInFeatures","featuresToAdd","convertRegionToFeature","isOcrProposal","boundingBox","parseFloat","round","Feature","geometry","Polygon","setProperties","highlighted","setId","deleteRegions","deleteRegionsFromSelectedRegionIds","deleteRegionsFromAsset","deleteRegionsFromImageMap","regionIndex","getIndexOfSelectedRegionIndex","filteredRegions","convertRegionsToLabelData","onAssetMetadataChanged","onRegionDelete","currentRegions","deletedRegionIndex","onRegionSelected","multiSelect","updatedRegions","update","sort","compareRegionOrder","createBoundingBoxVectorFeature","ocrExtent","polygonPoints","ocrWidth","ocrHeight","featureId","createRegionIdFromBoundingBox","boundingbox","createBoundingBoxVectorTable","tableID","tableFeatures","Point","iconTR","iconTL","iconBL","iconBR","Style","stroke","Stroke","fill","Fill","resolution","Icon","opacity","anchor","anchorXUnits","anchorYUnits","lineDash","regionId","getTagFromRegionId","isRegionSelected","replace","g","repeat","hexToRgba","setFeatureProperty","propertyName","propertyValue","forced","isToggle","removeFromSelectedRegions","polygon","addToSelectedRegions","iRegionId","getIndexOfCurrentRegions","regionBoundingBox","convertToRegionBoundingBox","regionPoints","convertToRegionPoints","RegionType","iRegion","setOCRStatus","onRunningOCRStatusChanged","getRecognizedText","getOcrResultForCurrentPage","buildRegionOrders","drawOcr","assetId","cMapPacked","goToPage","targetPage","selectedRegionsWithoutTag","switchToTargetPage","boundingBoxIndex","getBoundingBoxTextFromRegion","createRegion","fieldName","right","getTableBoundingBox","lines","bottom","keyEvent","getRegionWithKey","handleZoomReset","keyFlag","lastSelectedId","nextRegionId","getNextIdByOrder","getPrevIdByOrder","removeList","nextFeature","ocrResultsForCurrentPage","pageResults","newProps","newLabels","prevLabels","newFieldNames","prevFieldNames","isEqual","regionValues","regionsFromLabelData","regionsWithSameTag","pageCount","getRegionOrder","orderInfo","order","currentIdList","r1","r2","order1","order2","ocrs","ocrReadResults","recognitionResults","line","words","word","shouldDisplayOcrWord","getId","textFeatures","tableBorderFeatures","tableIconFeatures","tableIconBorderFeatures","ocrPageResults","table","cells","tableBoundingBox","cell","createdTableFeatures","regex","RegExp","changed","newLayers","assign","newTableIconTooltip","pangeNumber","editorMode","EditorMode","Select","EditorSideBar","scrollToIndex","listRef","getRowHeight","selectAsset","forceUpdateGrid","onAssetClicked","onBeforeAssetSelected","onAssetSelected","rowRenderer","getAssetCssClassNames","renderBadges","cssClasses","rowCount","rowHeight","overscanRowCount","thumbnailSize","recomputeRowHeights","EditorPage","isValid","showInvalidRegionWarning","tagInputRef","loadingProjectAssets","renameTagConfirm","renameCanceled","deleteTagConfirm","isUnmount","onPageContainerClick","triggerNewTagBlur","onPageClick","onSideBarResize","newWidth","onSideBarResizeComplete","onTagClicked","confirmTagRename","onTagRenamed","am","onTagRenameCanceled","confirmTagDeleted","onCtrlTagClicked","locked","toggleTag","getTagFromKeyboardEvent","handleTagHotKey","isTaggableAssetType","rootAssetMetadata","assetIndex","onCanvasRendered","onTagsChanged","onLockedTagsChanged","readAssetAttributes","assetProps","loadProjectAssets","rootAssets","lastVisited","loadAllOCRs","isRunningOCRs","throttle","updateAssetState","assetState","updatedAsset","updateRootAssets","projectAsset","onCanvasRunningOCRStatusChanged","isCanvasRunningOCR","onFocused","needRunOCRButton","defaultSize","minSize","maxSize","paneStyle","onDragFinished","onBeforeAssetChanged","PredictResult","renderItem","getTagColor","onPredictionClick","onPredictionMouseEnter","onPredictionMouseLeave","getPredictionTagContent","toPercentage","confidence","triggerDownload","fileURL","URL","createObjectURL","Blob","fileLink","downloadFileName","downloadResultLabel","setAttribute","click","prediction","predictions","tagsDisplayOrder","displayOrder","p1","p2","ProjectSettingAction","PredictPage","fileLabel","predictionLoaded","currPage","shouldShowAlert","alertTitle","alertMessage","fileChanged","predictRun","isPredicting","highlightedField","fileInput","currPdf","handleDummyInputClick","renderPrevPageButton","renderNextPageButton","getPageCount","renderImageMap","handleFileChange","handleClick","getPrediction","drawPredictionResult","PredictWithoutTrainForbidden","endpoint","loadFile","loadImageFile","readFileAsArrayBuffer","fileArrayBuffer","typedArray","getDocument","renderTask","isHighlighted","getOcrFromAnalyzeResult","getPredictionsFromAnalyzeResult","object","predictedItem","isInteger","setPredictedFieldHighlightStatus","browseFileDisabled","predictDisabled","marginBottom","aria-hidden","accept","cursor","allowDisabledFocus","modelID","endpointURL","ConnectionPicker","createConnection","selectedValue","ConnectionPickerWithRouter","withRouter","SecurityTokenPicker","editFormSchema","ProjectForm","changeEvent","Create","Update","targetConnections","isRegistered","normalizeFolderPath","normalizePath","ProjectSettingsPage","getProjectSettingAction","Other","newProjectSetting","loadProjectSetting","projectToLoad","isPartialProject","isNew","isValidProjectName","deleteOldProjectWhenRenamed","isProjectRenamed","isProjectNameAlreadyUsed","MainContentRouter","ceil","floor","random","additionalEncodings","encodings","encodedURI","encodeURI","normalizeSlashes","encryptProviderOptions","encryptString","decryptProviderOptions","decryptString","secureString","arr","worker","allPromises","runningPromises","race","ms","tiffData","UTIF","decodeImage","rgbData","Uint8ClampedArray","toRGBA8","imageData","ImageData","putImageData","imageUrl","img","readImageOrientation","orientation","rotatedImage","renderRotatedImageToCanvas","ctx","translate","rotate","seperator","diff","change","ConditionalNavLink","Sidebar","ANY_OTHER_ACTION","webpackContext","webpackContextResolve","__webpack_require__","o","SkipButton","skipToId","querySelectorAll"],"mappings":"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","file":"static/js/main.b22c1a99.chunk.js","sourcesContent":["// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n    window.location.hostname === \"localhost\" ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === \"[::1]\" ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));\r\n\r\ninterface IConfig {\r\n    onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n    onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n}\r\n\r\nexport function register(config?: IConfig) {\r\n    if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\r\n        // The URL constructor is available in all browsers that support SW.\r\n        const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n        if (publicUrl.origin !== window.location.origin) {\r\n            // Our service worker won't work if PUBLIC_URL is on a different origin\r\n            // from what our page is served on. This might happen if a CDN is used to\r\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n            return;\r\n        }\r\n\r\n        window.addEventListener(\"load\", () => {\r\n            const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n            if (isLocalhost) {\r\n                // This is running on localhost. Let's check if a service worker still exists or not.\r\n                checkValidServiceWorker(swUrl, config);\r\n\r\n                // Add some additional logging to localhost, pointing developers to the\r\n                // service worker/PWA documentation.\r\n                navigator.serviceWorker.ready.then(() => {\r\n                  console.log(\"This web app is being served cache-first by a service \" +\r\n                    \"worker. To learn more, visit https://bit.ly/CRA-PWA\");\r\n                });\r\n            } else {\r\n                // Is not localhost. Just register service worker\r\n                registerValidSW(swUrl, config);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: IConfig) {\r\n    navigator.serviceWorker\r\n        .register(swUrl)\r\n        .then((registration) => {\r\n            registration.onupdatefound = () => {\r\n                const installingWorker = registration.installing;\r\n                if (installingWorker == null) {\r\n                    return;\r\n                }\r\n                installingWorker.onstatechange = () => {\r\n                    if (installingWorker.state === \"installed\") {\r\n                        if (navigator.serviceWorker.controller) {\r\n                            // At this point, the updated precached content has been fetched,\r\n                            // but the previous service worker will still serve the older\r\n                            // content until all client tabs are closed.\r\n                            console.log( \"New content is available and will be used when all \" +\r\n                                \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\");\r\n\r\n                            // Execute callback\r\n                            if (config && config.onUpdate) {\r\n                                config.onUpdate(registration);\r\n                            }\r\n                        } else {\r\n                            // At this point, everything has been precached.\r\n                            // It's the perfect time to display a\r\n                            // \"Content is cached for offline use.\" message.\r\n                            console.log(\"Content is cached for offline use.\");\r\n\r\n                            // Execute callback\r\n                            if (config && config.onSuccess) {\r\n                                config.onSuccess(registration);\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error during service worker registration:\", error);\r\n        });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: IConfig) {\r\n    // Check if the service worker can be found. If it can't reload the page.\r\n    fetch(swUrl, {\r\n        headers: { \"Service-Worker\": \"script\" },\r\n    })\r\n    .then((response) => {\r\n        // Ensure service worker exists, and that we really are getting a JS file.\r\n        const contentType = response.headers.get(\"content-type\");\r\n        if (\r\n            response.status === 404 ||\r\n            (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\r\n            // No service worker found. Probably a different app. Reload the page.\r\n            navigator.serviceWorker.ready.then((registration) => {\r\n                registration.unregister().then(() => {\r\n                    window.location.reload();\r\n                });\r\n            });\r\n        } else {\r\n            // Service worker found. Proceed as normal.\r\n            registerValidSW(swUrl, config);\r\n        }\r\n    })\r\n    .catch(() => {\r\n        console.log(\"No internet connection found. App is running in offline mode.\");\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n    if (\"serviceWorker\" in navigator) {\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n            registration.unregister();\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { IProject, ITag } from \"../../models/applicationState\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\n// tslint:disable-next-line:no-var-requires\r\nconst tagColors = require(\"../../react/components/common/tagColors.json\");\r\n\r\n/**\r\n * Reducer for project. Actions handled:\r\n * DELETE_PROJECT_SUCCESS\r\n * CLOSE_PROJECT_SUCCESS\r\n * LOAD_PROJECT_SUCCESS\r\n * SAVE_PROJECT_SUCCESS\r\n * LOAD_PROJECT_ASSETS_SUCCESS\r\n * SAVE_ASSET_METADATA_SUCCESS\r\n * @param state - Current project\r\n * @param action - Action that was dispatched\r\n */\r\nexport const reducer = (state: IProject = null, action: AnyAction): IProject => {\r\n    switch (action.type) {\r\n        case ActionTypes.DELETE_PROJECT_SUCCESS:\r\n        case ActionTypes.CLOSE_PROJECT_SUCCESS:\r\n            return null;\r\n        case ActionTypes.LOAD_PROJECT_SUCCESS:\r\n            return { ...action.payload };\r\n        case ActionTypes.LOAD_ASSET_METADATA_SUCCESS:\r\n            if (!state) {\r\n                return state;\r\n            }\r\n\r\n            return {\r\n                ...state,\r\n                lastVisitedAssetId: action.payload.asset.id,\r\n            };\r\n        case ActionTypes.LOAD_PROJECT_ASSETS_SUCCESS:\r\n            const assets = {};\r\n            action.payload.forEach((asset) => {\r\n                assets[asset.id] = asset;\r\n            });\r\n\r\n            return {\r\n                ...state,\r\n                assets,\r\n            };\r\n        case ActionTypes.SAVE_ASSET_METADATA_SUCCESS:\r\n            if (!state) {\r\n                return state;\r\n            }\r\n\r\n            const updatedAssets = { ...state.assets } || {};\r\n            updatedAssets[action.payload.asset.id] = { ...action.payload.asset };\r\n\r\n            const assetTags = new Set();\r\n            action.payload.regions.forEach((region) => region.tags.forEach((tag) => assetTags.add(tag)));\r\n\r\n            const newTags: ITag[] = state.tags ? [...state.tags] : [];\r\n            let updateTags = false;\r\n\r\n            assetTags.forEach((tag) => {\r\n                if (!state.tags || state.tags.length === 0 ||\r\n                    !state.tags.find((projectTag) => tag === projectTag.name)) {\r\n                    newTags.push({\r\n                        name: tag,\r\n                        color: tagColors[newTags.length % tagColors.length],\r\n                    } as ITag);\r\n                    updateTags = true;\r\n                }\r\n            });\r\n\r\n            if (updateTags) {\r\n                return {\r\n                    ...state,\r\n                    tags: newTags,\r\n                    assets: updatedAssets,\r\n                };\r\n            }\r\n\r\n            return {\r\n                ...state,\r\n                assets: updatedAssets,\r\n            };\r\n        case ActionTypes.SAVE_CONNECTION_SUCCESS:\r\n            if (!state) {\r\n                return state;\r\n            }\r\n\r\n            return {\r\n                ...state,\r\n                sourceConnection: state.sourceConnection.id === action.payload.id\r\n                    ? { ...action.payload }\r\n                    : state.sourceConnection,\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { combineReducers } from \"redux\";\r\nimport * as appSettings from \"./applicationReducer\";\r\nimport * as connections from \"./connectionsReducer\";\r\nimport * as currentProject from \"./currentProjectReducer\";\r\nimport * as recentProjects from \"./recentProjectsReducer\";\r\nimport * as appError from \"./appErrorReducer\";\r\nimport * as appTitle from \"./appTitleReducer\";\r\n\r\n/**\r\n * All application reducers\r\n * @member appSettings - Application Settings reducer\r\n * @member connections - Connections reducer\r\n * @member recentProjects - Recent Projects reducer\r\n * @member currentProject - Current Project reducer\r\n * @member appError = Application error\r\n */\r\nexport default combineReducers({\r\n    appSettings: appSettings.reducer,\r\n    connections: connections.reducer,\r\n    recentProjects: recentProjects.reducer,\r\n    currentProject: currentProject.reducer,\r\n    appError: appError.reducer,\r\n    appTitle: appTitle.reducer,\r\n});\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { IAppSettings } from \"../../models/applicationState\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\n\r\n/**\r\n * Reducer for application settings. Actions handled:\r\n * TOGGLE_DEV_TOOLS_SUCCESS\r\n * REFRESH_APP_SUCCESS\r\n * @param state - Current app settings\r\n * @param action - Action that was dispatched\r\n */\r\nexport const reducer = (state: IAppSettings = null, action: AnyAction): IAppSettings => {\r\n    switch (action.type) {\r\n        case ActionTypes.SAVE_APP_SETTINGS_SUCCESS:\r\n            return { ...action.payload };\r\n        case ActionTypes.ENSURE_SECURITY_TOKEN_SUCCESS:\r\n            return { ...action.payload };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { constants } from \"../../common/constants\";\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { IConnection } from \"../../models/applicationState\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\nimport { getStorageItem, setStorageItem } from \"../middleware/localStorage\";\r\n\r\n/**\r\n * Reducer for application connections. Actions handled:\r\n * SAVE_CONNECTION_SUCCESS\r\n * DELETE_CONNECTION_SUCCESS\r\n * LOAD_PROJECT_SUCCESS\r\n * @param state - Current array of connections\r\n * @param action - Action that was dispatched\r\n */\r\nexport const reducer = (state: IConnection[] = [], action: AnyAction): IConnection[] => {\r\n    if (!state) {\r\n        state = [];\r\n    }\r\n\r\n    switch (action.type) {\r\n        case ActionTypes.SAVE_CONNECTION_SUCCESS:\r\n            const projectJson = getStorageItem(constants.projectFormTempKey);\r\n            if (projectJson) {\r\n                const project = JSON.parse(projectJson);\r\n                project.sourceConnection = action.payload;\r\n                setStorageItem(constants.projectFormTempKey, JSON.stringify(project));\r\n            }\r\n            return [\r\n                { ...action.payload },\r\n                ...state.filter((connection) => connection.id !== action.payload.id),\r\n            ];\r\n        case ActionTypes.DELETE_CONNECTION_SUCCESS:\r\n            return [...state.filter((connection) => connection.id !== action.payload.id)];\r\n        case ActionTypes.LOAD_PROJECT_SUCCESS:\r\n            return [\r\n                { ...action.payload.sourceConnection },\r\n                ...state.filter((connection) => connection.id !== action.payload.sourceConnection.id),\r\n            ];\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { IProject } from \"../../models/applicationState\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\n\r\n/**\r\n * Reducer for recent projects. Actions handled:\r\n * LOAD_PROJECT_SUCCESS\r\n * SAVE_PROJECT_SUCCESS\r\n * DELETE_PROJECT_SUCCESS\r\n * SAVE_CONNECTION_SUCCESS\r\n * @param state - Array of recent projects\r\n * @param action - Action that was dispatched\r\n */\r\nexport const reducer = (state: IProject[] = [], action: AnyAction): IProject[] => {\r\n    if (!state) {\r\n        state = [];\r\n    }\r\n\r\n    let newState: IProject[] = null;\r\n\r\n    switch (action.type) {\r\n        case ActionTypes.SAVE_PROJECT_SUCCESS:\r\n            return [\r\n                { ...action.payload },\r\n                ...state.filter((project) => project.id !== action.payload.id),\r\n            ];\r\n        case ActionTypes.DELETE_PROJECT_SUCCESS:\r\n            return [...state.filter((project) => project.id !== action.payload.id)];\r\n        case ActionTypes.SAVE_CONNECTION_SUCCESS:\r\n            newState = state.map((project) => {\r\n                const updatedProject = { ...project };\r\n                if (project.sourceConnection.id === action.payload.id) {\r\n                    updatedProject.sourceConnection = { ...action.payload };\r\n                }\r\n                return updatedProject;\r\n            });\r\n            return newState;\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\nimport { IAppError } from \"../../models/applicationState\";\r\n\r\n/**\r\n * App Error Reducer\r\n * Actions handled:\r\n *  SHOW_ERROR\r\n *  CLEAR_ERROR\r\n * @param {IAppError} state\r\n * @param {AnyAction} action\r\n * @returns {any}\r\n */\r\nexport const reducer = (state: IAppError = null, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionTypes.SHOW_ERROR:\r\n            return {...action.payload};\r\n        case ActionTypes.CLEAR_ERROR:\r\n            return null;\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ActionTypes } from \"../actions/actionTypes\";\r\nimport { AnyAction } from \"../actions/actionCreators\";\r\n\r\n/**\r\n * App Title Reducer\r\n * Actions handled:\r\n *  SET_TITLE\r\n * @param {string} state\r\n * @param {AnyAction} action\r\n * @returns {any}\r\n */\r\nexport const reducer = (state: string = null, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionTypes.SET_TITLE:\r\n            return action.payload;\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IApplicationState } from \"../../models/applicationState\";\r\n\r\n/**\r\n * Initial state of application\r\n * @member appSettings - Application settings\r\n * @member connections - Connections\r\n * @member recentProjects - Recent projects\r\n * @member currentProject - Current project\r\n */\r\nconst initialState: IApplicationState = {\r\n    appSettings: {\r\n        securityTokens: [],\r\n    },\r\n    connections: [],\r\n    recentProjects: [],\r\n    currentProject: null,\r\n    appError: null,\r\n};\r\n\r\n/**\r\n * Instance of initial application state\r\n */\r\nexport default initialState;\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { Fragment } from \"react\";\r\nimport { IProject } from \"../../../models/applicationState\";\r\nimport IProjectActions from \"../../../redux/actions/projectActions\";\r\nimport { IKeyboardContext, KeyboardContext, KeyEventType } from \"../common/keyboardManager/keyboardManager\";\r\nimport { KeyboardBinding } from \"../common/keyboardBinding/keyboardBinding\";\r\nimport { ToolbarItemName, ToolbarItemGroup } from \"../../../registerToolbar\";\r\nimport { IconButton } from \"office-ui-fabric-react\";\r\n\r\n/**\r\n * Toolbar Item Metadata\r\n * @member name - Name of Toolbar Item\r\n * @member icon - Icon for toolbar item\r\n * @member tooltip - Tooltip to apply upon selection\r\n * @member group - Name of item group in which to include item\r\n * @member type - Type of toolbar item (Action or State)\r\n * @member accelerators - collection of accelerator that map to same action\r\n */\r\nexport interface IToolbarItemMetadata {\r\n    name: ToolbarItemName;\r\n    icon: string;\r\n    tooltip: string;\r\n    group: ToolbarItemGroup;\r\n    type: ToolbarItemType;\r\n    accelerators?: string[];\r\n}\r\n\r\n/**\r\n * Types of Toolbar items\r\n * @member Action - Toolbar item executes an action (export)\r\n * @member State - Toolbar item changes something about the state of the component (Draw Polygon)\r\n */\r\nexport enum ToolbarItemType {\r\n    Action = 0,\r\n    State = 1,\r\n}\r\n\r\n/**\r\n * Properties for Toolbar Item\r\n * @member actions - Project actions\r\n * @member project - Current project being edited\r\n * @member active - Toolbar is active\r\n * @member onClick - Function to be called on click of Toolbar Item\r\n */\r\nexport interface IToolbarItemProps extends IToolbarItemMetadata {\r\n    actions: IProjectActions;\r\n    project: IProject;\r\n    active: boolean;\r\n    onClick: (item: ToolbarItem) => void;\r\n}\r\n\r\n/**\r\n * @name - Toolbar Item\r\n * @description - Controls for Editor Page Toolbar\r\n */\r\nexport abstract class ToolbarItem extends React.Component<IToolbarItemProps> {\r\n    public static contextType = KeyboardContext;\r\n    public context!: IKeyboardContext;\r\n    private unregisterKeyboardHandler: () => void;\r\n\r\n    public componentWillUnmount() {\r\n        if (this.unregisterKeyboardHandler) {\r\n            this.unregisterKeyboardHandler();\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const className = [`toolbar-btn ${this.props.name}`];\r\n        if (this.props.active) {\r\n            className.push(\"active\");\r\n        }\r\n\r\n        const accelerators = this.props.accelerators;\r\n        return (\r\n            <Fragment>\r\n                {\r\n                    accelerators &&\r\n                    <KeyboardBinding\r\n                        displayName={this.props.tooltip}\r\n                        accelerators={accelerators}\r\n                        handler={this.onClick}\r\n                        icon={this.props.icon}\r\n                        keyEventType={KeyEventType.KeyDown}\r\n                    />\r\n                }\r\n                <IconButton\r\n                    className={className.join(\" \")}\r\n                    title={this.getTitle()}\r\n                    iconProps={{iconName: this.props.icon}}\r\n                    onClick={this.onClick}\r\n                />\r\n            </Fragment>\r\n        );\r\n    }\r\n\r\n    protected abstract onItemClick();\r\n\r\n    private getTitle = () => {\r\n        return `${this.props.tooltip}${this.getShortcut()}`;\r\n    }\r\n\r\n    private getShortcut = () => {\r\n        return ` (${this.consolidateKeyCasings(this.props.accelerators).join(\", \")})`;\r\n    }\r\n\r\n    private consolidateKeyCasings = (accelerators: string[]): string[] => {\r\n        const consolidated: string[] = [];\r\n        if (accelerators) {\r\n            for (const a of accelerators) {\r\n                if (!consolidated.find((item) => item.toLowerCase() === a.toLowerCase())) {\r\n                    consolidated.push(a);\r\n                }\r\n            }\r\n        }\r\n        return consolidated;\r\n    }\r\n\r\n    private onClick = (e) => {\r\n        e.stopPropagation();\r\n\r\n        if (this.onItemClick) {\r\n            this.onItemClick();\r\n        }\r\n        this.props.onClick(this);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IToolbarItemMetadata, ToolbarItem } from \"../../react/components/toolbar/toolbarItem\";\r\nimport Guard from \"../../common/guard\";\r\n\r\n/**\r\n * Interface for registering toolbar items\r\n */\r\nexport interface IToolbarItemRegistration {\r\n    component: typeof ToolbarItem;\r\n    config: IToolbarItemMetadata;\r\n}\r\n\r\n/**\r\n * @name - Toolbar Item Factory\r\n * @description - Creates instance of Toolbar Items based on specified options\r\n */\r\nexport class ToolbarItemFactory {\r\n    /**\r\n     * Register Toolbar Item for use in editor page\r\n     * @param component - React component ToolbarItem\r\n     * @param config - Configuration of ToolbarItem\r\n     */\r\n    public static register(config: IToolbarItemMetadata, component: typeof ToolbarItem = ToolbarItem) {\r\n        Guard.null(component);\r\n        Guard.null(config);\r\n\r\n        ToolbarItemFactory.componentRegistry.push({ component, config });\r\n    }\r\n\r\n    /**\r\n     * Get all registered Toolbar Items\r\n     */\r\n    public static getToolbarItems() {\r\n        return [...ToolbarItemFactory.componentRegistry];\r\n    }\r\n\r\n    /**\r\n     * Clear ToolbarItem Registry\r\n     */\r\n    public static reset(): void {\r\n        ToolbarItemFactory.componentRegistry = [];\r\n    }\r\n\r\n    private static componentRegistry: IToolbarItemRegistration[] = [];\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ToolbarItemFactory } from \"./providers/toolbar/toolbarItemFactory\";\r\nimport { ToolbarItemType } from \"./react/components/toolbar/toolbarItem\";\r\nimport { strings } from \"./common/strings\";\r\n\r\nexport enum ToolbarItemName {\r\n    SelectCanvas = \"selectCanvas\",\r\n    DrawRectangle = \"drawRectangle\",\r\n    PreviousAsset = \"navigatePreviousAsset\",\r\n    NextAsset = \"navigateNextAsset\",\r\n}\r\n\r\nexport enum ToolbarItemGroup {\r\n    Canvas = \"canvas\",\r\n    Regions = \"regions\",\r\n    Navigation = \"navigation\",\r\n    Project = \"project\",\r\n}\r\n\r\n/**\r\n * Registers items for toolbar\r\n */\r\nexport default function registerToolbar() {\r\n    ToolbarItemFactory.register({\r\n        name: ToolbarItemName.SelectCanvas,\r\n        tooltip: strings.editorPage.toolbar.select,\r\n        icon: \"fa-mouse-pointer\",\r\n        group: ToolbarItemGroup.Canvas,\r\n        type: ToolbarItemType.State,\r\n        accelerators: [\"V\", \"v\"],\r\n    });\r\n\r\n    ToolbarItemFactory.register({\r\n        name: ToolbarItemName.DrawRectangle,\r\n        tooltip: strings.editorPage.toolbar.drawRectangle,\r\n        icon: \"fa-vector-square\",\r\n        group: ToolbarItemGroup.Canvas,\r\n        type: ToolbarItemType.State,\r\n        accelerators: [\"R\", \"r\"],\r\n    });\r\n\r\n    ToolbarItemFactory.register({\r\n        name: ToolbarItemName.PreviousAsset,\r\n        tooltip: strings.editorPage.toolbar.previousAsset,\r\n        icon: \"fas fa-arrow-circle-up\",\r\n        group: ToolbarItemGroup.Navigation,\r\n        type: ToolbarItemType.Action,\r\n        accelerators: [\"ArrowUp\", \"W\", \"w\"],\r\n    });\r\n\r\n    ToolbarItemFactory.register({\r\n        name: ToolbarItemName.NextAsset,\r\n        tooltip: strings.editorPage.toolbar.nextAsset,\r\n        icon: \"fas fa-arrow-circle-down\",\r\n        group: ToolbarItemGroup.Navigation,\r\n        type: ToolbarItemType.Action,\r\n        accelerators: [\"ArrowDown\", \"S\", \"s\"],\r\n    });\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"../guard\";\r\n\r\n/**\r\n * Processes items in the array within the specified batch size (default: 5)\r\n * @param this The array to process\r\n * @param action The action to perform on each item in the array\r\n * @param batchSize The batch size for actions to perform in parallel (default: 5)\r\n */\r\nexport async function forEachAsync<T>(\r\n    this: T[],\r\n    action: (item: T) => Promise<void>,\r\n    batchSize: number = 5): Promise<void> {\r\n    Guard.null(this);\r\n    Guard.null(action);\r\n    Guard.expression(batchSize, (value) => value > 0);\r\n\r\n    const all: T[] = [...this];\r\n\r\n    while (all.length > 0) {\r\n        const batch: T[] = [];\r\n\r\n        while (all.length > 0 && batch.length < batchSize) {\r\n            batch.push(all.pop());\r\n        }\r\n\r\n        const tasks = batch.map((item) => action(item));\r\n        await Promise.all(tasks);\r\n    }\r\n}\r\n\r\n/**\r\n * Maps items in the array in async batches with the specified action\r\n * @param this The array to process\r\n * @param action The transformer action to perform on each item in the array\r\n * @param batchSize The batch size for actions to perform in parallel (default: 5);\r\n */\r\nexport async function mapAsync<T, R>(\r\n    this: T[],\r\n    action: (item: T) => Promise<R>,\r\n    batchSize: number = 5): Promise<R[]> {\r\n    Guard.null(this);\r\n    Guard.null(action);\r\n    Guard.expression(batchSize, (value) => value > 0);\r\n\r\n    let results: R[] = [];\r\n    const all: T[] = [...this];\r\n\r\n    while (all.length > 0) {\r\n        const batch: T[] = [];\r\n\r\n        while (all.length > 0 && batch.length < batchSize) {\r\n            batch.push(all.pop());\r\n        }\r\n\r\n        const tasks = batch.map((item) => action(item));\r\n        const batchResults = await Promise.all(tasks);\r\n        results = results.concat(batchResults);\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Checks for duplicates in an array using a key selector function for each item.\r\n * @param this The array of items to process\r\n * @param keySelectorFn The selector function that returns the appropriate key for each item in the array\r\n * @param keyNormalizerFn An optional normalization function to apply to each item's key before checking for uniqueness.\r\n *                        If none is provided, the default normalization function will be used (trim + lower case)\r\n */\r\nexport function containsDuplicates<T>(\r\n    this: T[],\r\n    keySelectorFn: (t: T) => string,\r\n    keyNormalizerFn?: (s: string) => string) {\r\n    Guard.null(this);\r\n    Guard.null(keySelectorFn);\r\n    keyNormalizerFn = keyNormalizerFn || ((s: string) => s.trim().toLowerCase());\r\n    const set = new Set<string>();\r\n    for (const t of this) {\r\n        const originalStr = keySelectorFn(t);\r\n        const key = keyNormalizerFn(originalStr);\r\n        if (set.has(key)) {\r\n            return true;\r\n        } else {\r\n            set.add(key);\r\n        }\r\n    }\r\n    return false;\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"../guard\";\r\n\r\n/**\r\n * Processes items in the map within the specified batch size (default: 5)\r\n * @param this The map to process\r\n * @param action The action to perform on each item in the map\r\n * @param batchSize The batch size for actions to perform in parallel (default: 5)\r\n */\r\nexport async function forEachAsync<K, V>(\r\n    this: Map<K, V>,\r\n    action: (value: V, key: K) => Promise<void>,\r\n    batchSize: number = 5): Promise<void> {\r\n    Guard.null(this);\r\n    Guard.null(action);\r\n    Guard.expression(batchSize, (value) => value > 0);\r\n\r\n    const all: Array<[K, V]> = [...this.entries()];\r\n\r\n    while (all.length > 0) {\r\n        const batch: Array<[K, V]> = [];\r\n\r\n        while (all.length > 0 && batch.length < batchSize) {\r\n            batch.push(all.pop());\r\n        }\r\n\r\n        const tasks = batch.map((item) => action(item[1], item[0]));\r\n        await Promise.all(tasks);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license\r\n\r\nimport { registerIcons as registerIcons_ } from \"office-ui-fabric-react\";\r\n\r\nexport function registerIcons() {\r\n    registerIcons_({\r\n        fontFace: {\r\n            fontFamily: \"FabricMDL2Icons\",\r\n        },\r\n        icons: {\r\n            Insights: \"\\uE3AF\",\r\n            MachineLearning: \"\\uE3B8\",\r\n            TagGroup: \"\\uE3F6\",\r\n            ChevronDown: \"\\uE70D\",\r\n            ChevronUp: \"\\uE70E\",\r\n            Edit: \"\\uE70F\",\r\n            Add: \"\\uE710\",\r\n            Settings: \"\\uE713\",\r\n            Link: \"\\uE71B\",\r\n            Search: \"\\uE721\",\r\n            CheckMark: \"\\uE73E\",\r\n            Up: \"\\uE74A\",\r\n            Down: \"\\uE74B\",\r\n            Delete: \"\\uE74D\",\r\n            Cloud: \"\\uE753\",\r\n            ChevronLeft: \"\\uE76B\",\r\n            ChevronRight: \"\\uE76C\",\r\n            Home: \"\\uE80F\",\r\n            View: \"\\uE890\",\r\n            Download: \"\\uE896\",\r\n            Help: \"\\uE897\",\r\n            Rename: \"\\uE8AC\",\r\n            Copy: \"\\uE8C8\",\r\n            Tag: \"\\uE8EC\",\r\n            Info: \"\\uE946\",\r\n            AddTo: \"\\uECC8\",\r\n            OpenFolderHorizontal: \"\\uED25\",\r\n            DocumentManagement: \"\\uEFFC\",\r\n            TextDocument: \"\\uF029\",\r\n            BranchMerge: \"\\uF295\",\r\n            Plug: \"\\uF300\",\r\n            PlugConnected: \"\\uF302\",\r\n            Hide3: \"\\uF6AC\",\r\n            WarningSolid: \"\\uF736\",\r\n            ZoomIn: \"\\uE8A3\",\r\n            ZoomOut: \"\\uE71F\",\r\n            TextField: \"\\uEDC3\",\r\n            Filter: \"\\uE71C\",\r\n            Table: \"\\uED86\",\r\n            MapLayers: \"\\uE81E\",\r\n        },\r\n    });\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { forEachAsync as arrayForEachAsync, mapAsync, containsDuplicates } from \"./common/extensions/array\";\r\nimport { forEachAsync as mapForEachAsync } from \"./common/extensions/map\";\r\n\r\ndeclare global {\r\n    // tslint:disable-next-line:interface-name\r\n    interface Array<T> {\r\n        /**\r\n         * Processes items in the array within the specified batch size (default: 5)\r\n         * @param this The array to process\r\n         * @param action The action to perform on each item in the array\r\n         * @param batchSize The batch size for actions to perform in parallel (default: 5)\r\n         */\r\n        forEachAsync(action: (item: T) => Promise<void>, batchSize?: number): Promise<void>;\r\n\r\n        /**\r\n         * Maps items in the array in async batches with the specified action\r\n         * @param this The array to process\r\n         * @param action The transformer action to perform on each item in the array\r\n         * @param batchSize The batch size for actions to perform in parallel (default: 5);\r\n         */\r\n        mapAsync<R>(action: (item: T) => Promise<R>, batchSize?: number): Promise<R[]>;\r\n\r\n        /**\r\n         * Checks for duplicates in an array using a key selector function for each item.\r\n         * @param this The array of items to process\r\n         * @param keySelectorFn The selector function that returns the appropriate key for each item in the array\r\n         * @param keyNormalizerFn An optional normalization function to apply to each item's key before checking\r\n         *                        for uniqueness. If none is provided, the default normalization function will be\r\n         *                        used (trim + lower case).\r\n         */\r\n        containsDuplicates<T>(\r\n            this: T[],\r\n            keySelectorFn: (t: T) => string,\r\n            keyNormalizerFn?: (s: string) => string): boolean;\r\n    }\r\n\r\n    // tslint:disable-next-line:interface-name\r\n    interface Map<K, V> {\r\n        /**\r\n         * Processes items in the map within the specified batch size (default: 5)\r\n         * @param this The map to process\r\n         * @param action The action to perform on each item in the map\r\n         * @param batchSize The batch size for actions to perform in parallel (default: 5)\r\n         */\r\n        forEachAsync(action: (value: V, key: K) => Promise<void>, batchSize?: number): Promise<void>;\r\n    }\r\n}\r\n\r\nexport default function registerMixins() {\r\n    /*eslint-disable no-extend-native*/\r\n    if (!Array.prototype.forEachAsync) {\r\n        Array.prototype.forEachAsync = arrayForEachAsync;\r\n    }\r\n\r\n    if (!Array.prototype.mapAsync) {\r\n        Array.prototype.mapAsync = mapAsync;\r\n    }\r\n\r\n    if (!Array.prototype.containsDuplicates) {\r\n        Array.prototype.containsDuplicates = containsDuplicates;\r\n    }\r\n\r\n    if (!Map.prototype.forEachAsync) {\r\n        Map.prototype.forEachAsync = mapForEachAsync;\r\n    }\r\n    /*eslint-enable no-extend-native*/\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { AssetProviderFactory } from \"./providers/storage/assetProviderFactory\";\r\nimport { AzureBlobStorage } from \"./providers/storage/azureBlobStorage\";\r\nimport { StorageProviderFactory } from \"./providers/storage/storageProviderFactory\";\r\nimport registerToolbar from \"./registerToolbar\";\r\nimport { strings } from \"./common/strings\";\r\n\r\n/**\r\n * Registers storage, asset and export providers, as well as all toolbar items\r\n */\r\nexport default function registerProviders() {\r\n    // Storage Providers\r\n    StorageProviderFactory.register({\r\n        name: \"azureBlobStorage\",\r\n        displayName: strings.connections.providers.azureBlob.title,\r\n        factory: (options) => new AzureBlobStorage(options),\r\n    });\r\n\r\n    // Asset Providers\r\n    AssetProviderFactory.register({\r\n        name: \"azureBlobStorage\",\r\n        displayName: strings.connections.providers.azureBlob.title,\r\n        factory: (options) => new AzureBlobStorage(options),\r\n    });\r\n\r\n    registerToolbar();\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport \"../node_modules/bootstrap/dist/css/bootstrap.min.css\";\r\nimport \"../node_modules/@fortawesome/fontawesome-free/css/all.css\";\r\nimport \"./assets/css/bootstrap-theme-slate.css\";\r\nimport \"./index.scss\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport createReduxStore from \"./redux/store/store\";\r\nimport initialState from \"./redux/store/initialState\";\r\nimport { IApplicationState } from \"./models/applicationState\";\r\nimport { registerIcons } from \"./registerIcons\";\r\nimport registerProviders from \"./registerProviders\";\r\nimport registerMixins from \"./registerMixins\";\r\n\r\nregisterIcons();\r\nregisterMixins();\r\nregisterProviders();\r\nconst defaultState: IApplicationState = initialState;\r\nconst store = createReduxStore(defaultState, true);\r\n\r\nlet noFocusOutline = true;\r\ndocument.body.classList.add(\"no-focus-outline\");\r\n\r\ndocument.body.addEventListener(\"mousedown\", () => {\r\n    if (!noFocusOutline) {\r\n        noFocusOutline = true;\r\n        document.body.classList.add(\"no-focus-outline\");\r\n    }\r\n});\r\n\r\ndocument.body.addEventListener(\"keydown\", (event) => {\r\n    if (event.keyCode === 9 && noFocusOutline) {\r\n        noFocusOutline = false;\r\n        document.body.classList.remove(\"no-focus-outline\");\r\n    }\r\n});\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <App/>\r\n    </Provider>\r\n    , document.getElementById(\"rootdiv\"));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { applyMiddleware, createStore, Store } from \"redux\";\r\nimport thunk from \"redux-thunk\";\r\nimport rootReducer from \"../reducers\";\r\nimport { IApplicationState } from \"../../models/applicationState\";\r\nimport { mergeInitialState } from \"../middleware/localStorage\";\r\nimport { Env } from \"../../common/environment\";\r\n\r\n/**\r\n * Creates initial redux store from initial application state\r\n * @param initialState - Initial state of application\r\n * @param useLocalStorage - Whether or not to use localStorage middleware\r\n */\r\nexport default function createReduxStore(\r\n    initialState?: IApplicationState,\r\n    useLocalStorage: boolean = false): Store {\r\n    const paths: string[] = [\"appSettings\", \"connections\", \"recentProjects\"];\r\n\r\n    let middlewares = [thunk];\r\n\r\n    if (useLocalStorage) {\r\n        const localStorage = require(\"../middleware/localStorage\");\r\n        const storage = localStorage.createLocalStorage({paths});\r\n        middlewares = [\r\n            ...middlewares,\r\n            storage,\r\n        ];\r\n    }\r\n\r\n    if (Env.get() === \"development\") {\r\n        const logger = require(\"redux-logger\");\r\n        const reduxImmutableStateInvariant = require(\"redux-immutable-state-invariant\");\r\n        middlewares = [\r\n            ...middlewares,\r\n            reduxImmutableStateInvariant.default(),\r\n            logger.createLogger(),\r\n        ];\r\n    }\r\n\r\n    return createStore(\r\n        rootReducer,\r\n        useLocalStorage ? mergeInitialState(initialState, paths) : initialState,\r\n        applyMiddleware(...middlewares),\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { ReactElement } from \"react\";\r\nimport { MessageFormatHandler } from \"../messageBox/messageBox\";\r\nimport { getDarkTheme, getPrimaryBlueTheme } from \"../../../../common/themes\";\r\nimport {\r\n    Customizer,\r\n    Dialog,\r\n    DialogFooter,\r\n    DialogType,\r\n    ICustomizations,\r\n    ITheme,\r\n    PrimaryButton,\r\n} from \"office-ui-fabric-react\";\r\n/**\r\n * Properties for Alert Component\r\n * @member closeButtonText - Text displayed on 'Close' button. Default 'OK'\r\n * @member onClose - Function to execute on alert close\r\n * @member confirmButtonTheme - Theme of 'Confirm' button\r\n */\r\nexport interface IAlertProps {\r\n    title?: string;\r\n    message: string | ReactElement<any> | MessageFormatHandler;\r\n    closeButtonText?: string;\r\n    confirmButtonTheme?: ITheme;\r\n    show?: boolean;\r\n    onClose?: () => void;\r\n}\r\n\r\n/**\r\n * State for Alert Component\r\n * @member params - Arguments passed in the open command\r\n */\r\nexport interface IAlertState {\r\n    params: any[];\r\n}\r\n\r\n/**\r\n * @name - Alert\r\n * @description - Generic Alert dialog\r\n */\r\nexport default class Alert extends React.Component<IAlertProps, IAlertState> {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            params: null,\r\n        };\r\n        this.onCloseClick = this.onCloseClick.bind(this);\r\n    }\r\n\r\n    public render() {\r\n        const dark: ICustomizations = {\r\n            settings: {\r\n              theme: getDarkTheme(),\r\n            },\r\n            scopedSettings: {},\r\n        };\r\n        const confirmButtonTheme = this.props.confirmButtonTheme;\r\n\r\n        return (\r\n            <Customizer {...dark}>\r\n                {this.props.show &&\r\n                    <Dialog\r\n                        onDismiss={this.onCloseClick}\r\n                        hidden={!this.props.show}\r\n                        dialogContentProps={{\r\n                            type: DialogType.normal,\r\n                            title: this.props.title,\r\n                            subText: this.getMessage(this.props.message),\r\n                        }}\r\n                        modalProps={{\r\n                            isBlocking: false,\r\n                        }}\r\n                        >\r\n                        <DialogFooter>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryBlueTheme()}\r\n                                onClick={this.onCloseClick}\r\n                                text={this.props.closeButtonText || \"OK\"}/>\r\n                        </DialogFooter>\r\n                    </Dialog>\r\n                }\r\n            </Customizer>\r\n        );\r\n    }\r\n\r\n    private onCloseClick() {\r\n        if (this.props.onClose) {\r\n            this.props.onClose.apply(null, this.state.params);\r\n        }\r\n    }\r\n\r\n    private getMessage = (message: string | MessageFormatHandler | ReactElement<any>) => {\r\n        if (typeof message === \"function\") {\r\n            return message.apply(this, this.state.params);\r\n        } else {\r\n            return message;\r\n        }\r\n    }\r\n\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { KeyboardRegistrationManager } from \"./keyboardRegistrationManager\";\r\n\r\n/**\r\n * Types of Key events supported by registration manager\r\n */\r\nexport enum KeyEventType {\r\n    KeyDown = \"keydown\",\r\n    KeyUp = \"keyup\",\r\n    KeyPress = \"keypress\",\r\n}\r\n\r\nexport const KeyboardContext = React.createContext<IKeyboardContext>(null);\r\n\r\nexport interface IKeyboardContext {\r\n    keyboard: KeyboardRegistrationManager;\r\n}\r\n\r\nexport class KeyboardManager extends React.Component<any, IKeyboardContext> {\r\n    public static contextType = KeyboardContext;\r\n\r\n    public state: IKeyboardContext = {\r\n        keyboard: new KeyboardRegistrationManager(),\r\n    };\r\n\r\n    private nonSupportedKeys = new Set([\"Meta\", \"Ctrl\", \" Control\", \"Alt\", undefined]);\r\n    private inputElementTypes = new Set([\"input\", \"select\", \"textarea\"]);\r\n\r\n    public componentDidMount() {\r\n        window.addEventListener(KeyEventType.KeyDown, this.onKeyboardEvent);\r\n        window.addEventListener(KeyEventType.KeyUp, this.onKeyboardEvent);\r\n        window.addEventListener(KeyEventType.KeyPress, this.onKeyboardEvent);\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        window.removeEventListener(KeyEventType.KeyDown, this.onKeyboardEvent);\r\n        window.removeEventListener(KeyEventType.KeyUp, this.onKeyboardEvent);\r\n        window.removeEventListener(KeyEventType.KeyPress, this.onKeyboardEvent);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <KeyboardContext.Provider value={this.state}>\r\n                {this.props.children}\r\n            </KeyboardContext.Provider>\r\n        );\r\n    }\r\n\r\n    private getKeyParts(evt: KeyboardEvent) {\r\n        const keyParts = [];\r\n        if (evt.ctrlKey || evt.metaKey) {\r\n            keyParts.push(\"CmdOrCtrl+\");\r\n        }\r\n        if (evt.altKey) {\r\n            keyParts.push(\"Alt+\");\r\n        }\r\n        keyParts.push(evt.key);\r\n        return keyParts.join(\"\");\r\n    }\r\n\r\n    private onKeyboardEvent = (evt: KeyboardEvent) => {\r\n        if (this.isDisabled() || this.nonSupportedKeys.has(evt.key)) {\r\n            return;\r\n        }\r\n        this.state.keyboard.invokeHandler(evt.type as KeyEventType, this.getKeyParts(evt), evt);\r\n    }\r\n\r\n    private isDisabled(): boolean {\r\n        return document.activeElement && this.inputElementTypes.has(document.activeElement.tagName.toLowerCase());\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"../../../../common/guard\";\r\nimport { KeyEventType } from \"./keyboardManager\";\r\nimport { IKeyboardBindingProps } from \"../keyboardBinding/keyboardBinding\";\r\nimport { AppError, ErrorCode } from \"../../../../models/applicationState\";\r\n\r\n/**\r\n * A map of keyboard event registrations\r\n */\r\nexport interface IKeyboardRegistrations {\r\n    [keyEventType: string]: {\r\n        [key: string]: IKeyboardBindingProps,\r\n    };\r\n}\r\n\r\n/**\r\n * An event handler that responds to keyboard events\r\n */\r\nexport type KeyboardEventHandler = (evt?: KeyboardEvent) => void;\r\n\r\n/**\r\n * Managers keyboard event registrations\r\n */\r\nexport class KeyboardRegistrationManager {\r\n    private registrations: IKeyboardRegistrations = {};\r\n\r\n    /**\r\n     * Registers a keyboard binding and returns a function to deregister that binding\r\n     * @param binding Properties for keyboard binding (type of key event, keyCodes, handler, etc.)\r\n     * @returns a function for deregistering the keyboard binding\r\n     */\r\n    public registerBinding = (binding: IKeyboardBindingProps) => {\r\n        const {keyEventType, accelerators, handler, displayName} = binding;\r\n        Guard.null(keyEventType);\r\n        Guard.expression(accelerators, (keyCodes) => keyCodes.length > 0);\r\n        Guard.null(handler);\r\n\r\n        let eventTypeRegistrations = this.registrations[keyEventType];\r\n        if (!eventTypeRegistrations) {\r\n            eventTypeRegistrations = {};\r\n            this.registrations[keyEventType] = eventTypeRegistrations;\r\n        }\r\n\r\n        accelerators.forEach((keyCode) => {\r\n            const currentBinding = this.registrations[keyEventType][keyCode];\r\n            if (currentBinding) {\r\n                let error = `Key code ${keyCode} on key event \"${keyEventType}\" `;\r\n                error += `already has binding registered: \"${currentBinding.displayName}.\" `;\r\n                error += `Cannot register binding \"${displayName}\" with the same key code and key event type`;\r\n                throw new AppError(ErrorCode.OverloadedKeyBinding, error);\r\n            }\r\n            this.registrations[keyEventType][keyCode] = binding;\r\n        });\r\n\r\n        return () => {\r\n            binding.accelerators.forEach((keyCode) => {\r\n                delete this.registrations[binding.keyEventType][keyCode];\r\n            });\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets a list of registered event handlers for the specified key code\r\n     * @param keyEventType Type of key event (keydown, keyup, keypress)\r\n     * @param keyCode The key code combination, ex) CmdOrCtrl+1\r\n     */\r\n    public getHandler(keyEventType: KeyEventType, keyCode: string): (evt?: KeyboardEvent) => void {\r\n        Guard.null(keyEventType);\r\n        Guard.null(keyCode);\r\n\r\n        const keyEventTypeRegs = this.registrations[keyEventType];\r\n        return (keyEventTypeRegs && keyEventTypeRegs[keyCode])\r\n            ?\r\n            keyEventTypeRegs[keyCode].handler\r\n            :\r\n            null;\r\n    }\r\n\r\n    /**\r\n     * Invokes all registered event handlers for the specified key code\\\r\n     * @param keyEventType Type of key event (keydown, keyup, keypress)\r\n     * @param keyCode The key code combination, ex) CmdOrCtrl+1\r\n     * @param evt The keyboard event that was raised\r\n     */\r\n    public invokeHandler(keyEventType: KeyEventType, keyCode: string, evt: KeyboardEvent) {\r\n        Guard.null(keyCode);\r\n        Guard.null(evt);\r\n\r\n        const handler = this.getHandler(keyEventType, keyCode);\r\n        if (handler !== null) {\r\n            handler(evt);\r\n        }\r\n    }\r\n\r\n    public getRegistrations = () => {\r\n        return this.registrations;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport os from \"os\";\r\n\r\n/**\r\n * @name - Host Process\r\n * @description - Describes the host process\r\n * @member type - The type of the host process (electron, browser, etc)\r\n * @member release - The release string of the host process\r\n */\r\nexport interface IHostProcess {\r\n    type: HostProcessType;\r\n    release: string;\r\n}\r\n\r\n/**\r\n * @enum ELECTRON - Electron Host Process Type\r\n * @enum BROWSER - Browser Host Process Type\r\n */\r\nexport enum HostProcessType {\r\n    Electron = 1, // bits: 01\r\n    Browser = 2,  // bits: 10\r\n    All = 3,      // bits: 11\r\n}\r\n\r\nexport enum PlatformType {\r\n    Web = \"web\",\r\n    Windows = \"win32\",\r\n    Linux = \"linux\",\r\n    MacOS = \"darwin\",\r\n}\r\n\r\nfunction getHostProcess(): IHostProcess {\r\n    const osRelease = os.release().toLowerCase();\r\n    let hostProcessType: HostProcessType;\r\n    if (osRelease.indexOf(\"electron\") > -1 || process.env.HOST_TYPE === \"electron\") {\r\n        hostProcessType = HostProcessType.Electron;\r\n    } else {\r\n        hostProcessType = HostProcessType.Browser;\r\n    }\r\n\r\n    return {\r\n        release: osRelease,\r\n        type: hostProcessType,\r\n    };\r\n}\r\n\r\nexport function isElectron(): boolean {\r\n    return getHostProcess().type === HostProcessType.Electron;\r\n}\r\n\r\nexport function isBrowser(): boolean {\r\n    return getHostProcess().type === HostProcessType.Browser;\r\n}\r\n\r\nexport default getHostProcess;\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"./guard\";\r\n\r\nconst ALGO = \"AES-CBC\";\r\n\r\n/**\r\n * Generates a random base64 encoded key to be used for encryption\r\n * @param keySize The key size to use, defaults to 32bit\r\n */\r\nexport function generateKey(): string {\r\n    const random = crypto.getRandomValues(new Uint8Array(32));\r\n    return encodeBase64(random.buffer);\r\n}\r\n\r\n/**\r\n * Encrypts the specified message with the provided key\r\n * @param message The message to encrypt\r\n * @param secret The base64 encoded secret\r\n */\r\nexport async function encrypt(message: string, secret: string): Promise<string> {\r\n    Guard.empty(message);\r\n    Guard.empty(secret);\r\n\r\n    try {\r\n        const secretBytes = decodeBase64(secret);\r\n        const iv = crypto.getRandomValues(new Uint8Array(16));\r\n        const key = await importKey(secretBytes);\r\n        const data = encodeUtf8(message);\r\n        const encrypted = await crypto.subtle.encrypt(\r\n            {\r\n                name: ALGO,\r\n                iv,\r\n            },\r\n            key,\r\n            data);\r\n        const json = {\r\n            ciphertext: encodeHex(encrypted),\r\n            iv: encodeHex(iv.buffer),\r\n        };\r\n        const bytes = encodeUtf8(JSON.stringify(json));\r\n        return encodeBase64(bytes);\r\n    } catch (e) {\r\n        throw new Error(`Error encrypting data - ${e.message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Encryptes a javascript object with the specified key\r\n * @param message - The javascript object to encrypt\r\n * @param secret - The secret to encrypt the message\r\n */\r\nexport async function encryptObject(message: any, secret: string) {\r\n    Guard.null(message);\r\n\r\n    return await encrypt(JSON.stringify(message), secret);\r\n}\r\n\r\n/**\r\n * Decrypts the specified message with the provided key\r\n * @param encodedMessage The base64 encoded encrypted data\r\n * @param secret The base64 encoded secret\r\n */\r\nexport async function decrypt(encodedMessage: string, secret: string) {\r\n    Guard.empty(encodedMessage);\r\n    Guard.empty(secret);\r\n\r\n    try {\r\n        const secretBytes = decodeBase64(secret);\r\n        const json = decodeUtf8(decodeBase64(encodedMessage));\r\n        const params = JSON.parse(json);\r\n        const iv = decodeHex(params.iv);\r\n        const data = decodeHex(params.ciphertext);\r\n        const key = await importKey(secretBytes);\r\n        const decrypted = await crypto.subtle.decrypt(\r\n            {\r\n                name: ALGO,\r\n                iv: iv.slice(0, 16),\r\n            },\r\n            key,\r\n            data);\r\n\r\n        return decodeUtf8(decrypted);\r\n    } catch (e) {\r\n        throw new Error(`Error decrypting data - ${e.message}`);\r\n    }\r\n}\r\n/**\r\n * Decryptes a javascript object with the specified key\r\n * @param message - The encrypted base64 encded message\r\n * @param secret - The secret to decrypt the message\r\n */\r\nexport async function decryptObject<T = any>(encodedMessage: string, secret: string) {\r\n    const json = await decrypt(encodedMessage, secret);\r\n    return JSON.parse(json) as T;\r\n}\r\n\r\nexport async function sha256Hash(message: string) {\r\n    const buffer = await crypto.subtle.digest(\"SHA-256\", encodeUtf8(message));\r\n    return encodeHex(buffer);\r\n}\r\n\r\nasync function importKey(secretBytes: ArrayBuffer) {\r\n    return await crypto.subtle.importKey(\r\n        \"raw\",\r\n        secretBytes,\r\n        ALGO,\r\n        false,\r\n        [\"encrypt\", \"decrypt\"]);\r\n}\r\n\r\nfunction encodeBase64(buffer: ArrayBuffer) {\r\n    const base64 = [];\r\n    const bytes = new Uint8Array(buffer);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) {\r\n        base64.push(String.fromCharCode(bytes[i]));\r\n    }\r\n    return window.btoa(base64.join(\"\"));\r\n}\r\n\r\nfunction decodeBase64(base64: string) {\r\n    const codes = window.atob(base64);\r\n    const bytes = new Uint8Array(codes.length);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) {\r\n        bytes[i] = codes.charCodeAt(i);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\nfunction encodeHex(buffer: ArrayBuffer) {\r\n    const hex  = [];\r\n    const bytes = new Uint8Array(buffer);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) {\r\n        const code = bytes[i].toString(16);\r\n        if (code.length === 1) {\r\n            hex.push(`0${code}`);\r\n        } else {\r\n            hex.push(code);\r\n        }\r\n    }\r\n    return hex.join(\"\");\r\n}\r\n\r\nfunction decodeHex(hex: string) {\r\n    const len = hex.length / 2;\r\n    const bytes = new Uint8Array(len);\r\n    for (let i = 0; i < len; i++) {\r\n        bytes[i] = parseInt(hex.substr(i * 2, 2), 16);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\nfunction encodeUtf8(utf8: string) {\r\n    if (typeof TextEncoder !== \"undefined\") {\r\n        const encoder = new TextEncoder();\r\n        return encoder.encode(utf8).buffer;\r\n    }\r\n\r\n    // Edge has no TextEncoder\r\n    const len = utf8.length;\r\n    let pos = -1;\r\n    const bytes = new Uint8Array(len * 3);\r\n    for (let point = 0, nextcode = 0, i = 0; i !== len; ) {\r\n        point = utf8.charCodeAt(i++);\r\n        if (point >= 0xd800 && point <= 0xdbff) {\r\n            if (i === len) {\r\n                bytes[++pos] = 0xef;\r\n                bytes[++pos] = 0xbf;\r\n                bytes[++pos] = 0xbd;\r\n                break;\r\n            }\r\n            nextcode = utf8.charCodeAt(i);\r\n            if (nextcode >= 0xdc00 && nextcode <= 0xdfff) {\r\n                point = (point - 0xd800) * 0x400 + nextcode - 0xdc00 + 0x10000;\r\n                i += 1;\r\n                if (point > 0xffff) {\r\n                    bytes[++pos] = (0x1e << 3) | (point >>> 18);\r\n                    bytes[++pos] = (0x2 << 6) | ((point >>> 12) & 0x3f);\r\n                    bytes[++pos] = (0x2 << 6) | ((point >>> 6) & 0x3f);\r\n                    bytes[++pos] = (0x2 << 6) | (point & 0x3f);\r\n                    continue;\r\n                }\r\n            } else {\r\n                bytes[++pos] = 0xef;\r\n                bytes[++pos] = 0xbf;\r\n                bytes[++pos] = 0xbd;\r\n                continue;\r\n            }\r\n        }\r\n        if (point <= 0x007f) {\r\n            bytes[++pos] = (0x0 << 7) | point;\r\n        } else if (point <= 0x07ff) {\r\n            bytes[++pos] = (0x6 << 5) | (point >>> 6);\r\n            bytes[++pos] = (0x2 << 6)  | (point & 0x3f);\r\n        } else {\r\n            bytes[++pos] = (0xe << 4) | (point >>> 12);\r\n            bytes[++pos] = (0x2 << 6) | ((point >>> 6) & 0x3f);\r\n            bytes[++pos] = (0x2 << 6) | (point & 0x3f);\r\n        }\r\n    }\r\n    return bytes.subarray(0, pos + 1);\r\n}\r\n\r\nfunction decodeUtf8(buffer: ArrayBuffer) {\r\n    if (typeof TextDecoder !== \"undefined\") {\r\n        const decoder = new TextDecoder();\r\n        return decoder.decode(buffer);\r\n    }\r\n\r\n    // Edge has no TextDecoder\r\n    const utf8 = [];\r\n    const bytes = new Uint8Array(buffer);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len;) {\r\n        const b = bytes[i++];\r\n\r\n        if (b < 0x7f) {\r\n            utf8.push(String.fromCharCode(b));\r\n        } else if (b <= 0xdf) {\r\n            utf8.push(String.fromCharCode(\r\n                ((b & 0x1f) << 6) | (bytes[i++] & 0x3f)));\r\n        } else if (b <= 0xef) {\r\n            utf8.push(String.fromCharCode(\r\n                ((b & 0x0f) << 12) | ((bytes[i++] & 0x3f) << 6) | (bytes[i++] & 0x3f)));\r\n        } else if (String.fromCodePoint) {\r\n            utf8.push(String.fromCodePoint(\r\n                ((b & 0x07) << 18) | ((bytes[i++] & 0x3f) << 12) | ((bytes[i++] & 0x3f) << 6) | (bytes[i++] & 0x3f)));\r\n        } else {\r\n            utf8.push(\"?\");\r\n            i += 3;\r\n        }\r\n    }\r\n    return utf8.join(\"\");\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Middleware, Dispatch, AnyAction, MiddlewareAPI } from \"redux\";\r\nimport { constants } from \"../../common/constants\";\r\n\r\nexport interface ILocalStorageMiddlewareOptions {\r\n    paths: string[];\r\n}\r\n\r\nexport function createLocalStorage(config: ILocalStorageMiddlewareOptions): Middleware {\r\n    return (store: MiddlewareAPI<Dispatch<AnyAction>>) => (next: Dispatch<AnyAction>) => (action: any) => {\r\n        const result = next(action);\r\n        const state = store.getState();\r\n\r\n        config.paths.forEach((path) => {\r\n            if (state[path]) {\r\n                const json = JSON.stringify(state[path]);\r\n                setStorageItem(path, json);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n}\r\n\r\nexport function mergeInitialState(state: any, paths: string[]) {\r\n    const initialState = { ...state };\r\n    paths.forEach((path) => {\r\n        const json = getStorageItem(path);\r\n        if (json) {\r\n            initialState[path] = JSON.parse(json);\r\n        }\r\n    });\r\n\r\n    return initialState;\r\n}\r\n\r\nexport function setStorageItem(key: string, value: string) {\r\n    localStorage.setItem(`${constants.version}_${key}`, value);\r\n}\r\n\r\nexport function getStorageItem(key: string) {\r\n    return localStorage.getItem(`${constants.version}_${key}`);\r\n}\r\n\r\nexport function removeStorageItem(key: string) {\r\n    return localStorage.removeItem(`${constants.version}_${key}`);\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport axios, { AxiosRequestConfig } from \"axios\";\r\nimport { IAsset, AssetType, IFileInfo } from \"../models/applicationState\";\r\nimport Guard from \"./guard\";\r\nimport * as EXIF from \"exif-js\";\r\nimport { isNumber } from \"util\";\r\n\r\n/**\r\n * Helper class for reading HTML files\r\n */\r\nexport default class HtmlFileReader {\r\n\r\n    public static videoAssetFiles = {};\r\n\r\n    /**\r\n     * Reads the file and returns the string value contained\r\n     * @param file HTML file to read\r\n     */\r\n    public static readAsText(file: File): Promise<IFileInfo> {\r\n        Guard.null(file);\r\n        let fileInfo: IFileInfo;\r\n\r\n        return new Promise<IFileInfo>((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.onerror = reject;\r\n            reader.onload = () => {\r\n                if (reader.result) {\r\n                    fileInfo = {\r\n                        content: reader.result,\r\n                        file,\r\n                    };\r\n                    resolve(fileInfo);\r\n                } else {\r\n                    reject();\r\n                }\r\n            };\r\n\r\n            try {\r\n                reader.readAsText(file);\r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reads attributes from asset depending on type (video or image)\r\n     * @param asset Asset to read from\r\n     */\r\n    public static async readAssetAttributes(asset: IAsset)\r\n        : Promise<{ width: number, height: number, duration?: number }> {\r\n        Guard.null(asset);\r\n\r\n        switch (asset.type) {\r\n            case AssetType.Image:\r\n                return await this.readImageAttributes(asset.path);\r\n            default:\r\n                throw new Error(\"Asset not supported\");\r\n        }\r\n    }\r\n\r\n    public static async readAssetAttributesWithBuffer(base64: string)\r\n        : Promise<{ width: number, height: number, duration?: number }> {\r\n        Guard.null(base64);\r\n\r\n        return await this.readImageAttributes(\"data:image;base64,\" + base64);\r\n    }\r\n\r\n    /**\r\n     * Downloads the binary blob from the asset path\r\n     * @param asset The asset to download\r\n     */\r\n    public static async getAssetBlob(asset: IAsset): Promise<Blob> {\r\n        Guard.null(asset);\r\n\r\n        const config: AxiosRequestConfig = {\r\n            responseType: \"blob\",\r\n        };\r\n\r\n        // Download the asset binary from the storage provider\r\n        const response = await axios.get<Blob>(asset.path, config);\r\n        if (response.status !== 200) {\r\n            throw new Error(\"Error downloading asset binary\");\r\n        }\r\n        const data = await response.data;\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Downloads the binary array from the asset path\r\n     * @param asset The asset to download\r\n     */\r\n    public static async getAssetArray(asset: IAsset): Promise<ArrayBuffer> {\r\n        const blob = await this.getAssetBlob(asset);\r\n        return await new Response(blob).arrayBuffer();\r\n    }\r\n\r\n    /**\r\n     * Extracts the specified image frame from a video asset\r\n     * @param asset The asset video frame to retrieve from the parent video\r\n     */\r\n    public static async getAssetFrameImage(asset: IAsset): Promise<Blob> {\r\n        return new Promise<Blob>((resolve, reject) => {\r\n            const cachingEnabled = false;\r\n            let refresh = !cachingEnabled;\r\n            let video: HTMLVideoElement = this.videoAssetFiles[asset.parent.name];\r\n\r\n            // Ensure the asset name includes jpg file extension\r\n            if (!asset.name.toLowerCase().endsWith(\".jpg\")) {\r\n                asset.name += \".jpg\";\r\n            }\r\n\r\n            if (!video) {\r\n                video = document.createElement(\"video\");\r\n                if (cachingEnabled) {\r\n                    this.videoAssetFiles[asset.parent.name] = video;\r\n                    refresh = true;\r\n                }\r\n            }\r\n\r\n            video.onloadedmetadata = () => {\r\n                video.currentTime = asset.timestamp;\r\n            };\r\n            video.onseeked = () => {\r\n                const canvas = document.createElement(\"canvas\");\r\n                canvas.height = video.videoHeight;\r\n                canvas.width = video.videoWidth;\r\n                const ctx = canvas.getContext(\"2d\");\r\n                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n                canvas.toBlob(resolve);\r\n            };\r\n            video.onerror = reject;\r\n            if (refresh) {\r\n                video.src = asset.parent.path;\r\n            } else {\r\n                video.currentTime = asset.timestamp;\r\n            }\r\n        });\r\n    }\r\n\r\n    public static readImageAttributes(url: string): Promise<{ width: number, height: number }> {\r\n        return new Promise((resolve, reject) => {\r\n            const image = document.createElement(\"img\") as HTMLImageElement;\r\n            image.onload = () => {\r\n                resolve({\r\n                    width: image.naturalWidth,\r\n                    height: image.naturalHeight,\r\n                });\r\n            };\r\n            image.onerror = reject;\r\n            image.src = url;\r\n        });\r\n    }\r\n\r\n    public static readFileAsArrayBuffer(file: File): Promise<ArrayBuffer> {\r\n        return new Promise((resolve, reject) => {\r\n            const fileReader: FileReader = new FileReader();\r\n\r\n            try {\r\n                fileReader.onload = () => {\r\n                    resolve(fileReader.result as ArrayBuffer);\r\n                };\r\n                fileReader.readAsArrayBuffer(file);\r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static async readImageOrientation(image: HTMLImageElement): Promise<number> {\r\n        return new Promise((resolve, reject) => {\r\n            try {\r\n                EXIF.getData(image as any, () => {\r\n                    const orientationTag = EXIF.getTag(image, \"Orientation\");\r\n                    resolve(isNumber(orientationTag) ? orientationTag : 1);\r\n                });\r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IAsset, IConnection } from \"../../models/applicationState\";\r\nimport Guard from \"../../common/guard\";\r\nimport getHostProcess, { HostProcessType } from \"../../common/hostProcess\";\r\n\r\n/**\r\n * Interface for VoTT Asset Providers\r\n * @member initialize - Initializes or validates provider based on options\r\n * @member getAssets - Retrieves assets from provider\r\n */\r\nexport interface IAssetProvider {\r\n    initialize?(): Promise<void>;\r\n    getAssets(containerName?: string): Promise<IAsset[]>;\r\n}\r\n\r\n/**\r\n * Options for Asset Providers\r\n * @member name - Name of Asset Provider\r\n * @member displayName - Display Name of Asset Provider\r\n * @member description - Description of Asset Provider\r\n * @member platformSupport - Platform(s) supported by asset provider (electron, browser)\r\n * @member factory - Function that instantiates provider\r\n */\r\nexport interface IAssetProviderRegistrationOptions {\r\n    name: string;\r\n    displayName: string;\r\n    description?: string;\r\n    platformSupport?: HostProcessType;\r\n    factory: (options?: any) => IAssetProvider;\r\n}\r\n\r\n/**\r\n * @name - Asset Provider Factory\r\n * @description - Creates instance of Asset Providers based on request provider type\r\n */\r\nexport class AssetProviderFactory {\r\n\r\n    /**\r\n     * @returns - Dictionary of registered Asset Providers\r\n     */\r\n    public static get providers() {\r\n        return { ...AssetProviderFactory.providerRegistry };\r\n    }\r\n\r\n    /**\r\n     * Register an Asset Provider based on options\r\n     * @param options - Asset Provider options\r\n     */\r\n    public static register(options: IAssetProviderRegistrationOptions);\r\n    /**\r\n     * Register Asset provider based on name and a factory\r\n     * @param name - Name of Asset Provider\r\n     * @param factory - Function that instantiates Asset Provider\r\n     */\r\n    public static register(name: string, factory: (options?: any) => IAssetProvider);\r\n\r\n    /**\r\n     * Register Asset provider based on name and a factory\r\n     * @param name - Name of Asset Provider\r\n     * @param factory - Function that instantiates Asset Provider\r\n     */\r\n    public static register(nameOrOptions: any, factory?: (options?: any) => IAssetProvider) {\r\n        Guard.null(nameOrOptions);\r\n\r\n        let options: IAssetProviderRegistrationOptions = nameOrOptions as IAssetProviderRegistrationOptions;\r\n\r\n        if (typeof (nameOrOptions) === \"string\") {\r\n            Guard.null(factory);\r\n\r\n            options = {\r\n                name: nameOrOptions,\r\n                displayName: nameOrOptions,\r\n                factory,\r\n            };\r\n        }\r\n\r\n        if (!options.platformSupport) {\r\n            options.platformSupport = HostProcessType.All;\r\n        }\r\n\r\n        if ((options.platformSupport & getHostProcess().type) === 0) {\r\n            return;\r\n        }\r\n\r\n        AssetProviderFactory.providerRegistry[options.name] = options;\r\n    }\r\n\r\n    /**\r\n     * Create Asset Provider from provider type and options specified in connection\r\n     * @param connection - Connection for an Asset Provider\r\n     */\r\n    public static createFromConnection(connection: IConnection): IAssetProvider {\r\n        return this.create(connection.providerType, connection.providerOptions);\r\n    }\r\n\r\n    /**\r\n     * Create Asset Provider from registered Asset Provider name and options\r\n     * @param name - Name of Asset Provider\r\n     * @param options - Options for Asset Provider\r\n     */\r\n    public static create(name: string, options?: any): IAssetProvider {\r\n        Guard.empty(name);\r\n\r\n        const registrationOptions = AssetProviderFactory.providerRegistry[name];\r\n        if (!registrationOptions) {\r\n            throw new Error(`No asset provider has been registered with name '${name}'`);\r\n        }\r\n\r\n        return registrationOptions.factory(options);\r\n    }\r\n\r\n    private static providerRegistry: { [id: string]: IAssetProviderRegistrationOptions } = {};\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport _ from \"lodash\";\r\nimport Guard from \"../common/guard\";\r\nimport {\r\n    IAsset, AssetType, IProject, IAssetMetadata, AssetState,\r\n    ILabelData, ILabel,\r\n} from \"../models/applicationState\";\r\nimport { AssetProviderFactory, IAssetProvider } from \"../providers/storage/assetProviderFactory\";\r\nimport { StorageProviderFactory, IStorageProvider } from \"../providers/storage/storageProviderFactory\";\r\nimport { constants } from \"../common/constants\";\r\nimport { appInfo } from \"../common/appInfo\";\r\nimport { encodeFileURI } from \"../common/utils\";\r\nimport { strings, interpolate } from \"../common/strings\";\r\nimport { sha256Hash } from \"../common/crypto\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n/**\r\n * @name - Asset Service\r\n * @description - Functions for dealing with project assets\r\n */\r\nexport class AssetService {\r\n    /**\r\n     * Create IAsset from filePath\r\n     * @param filePath - filepath of asset\r\n     * @param fileName - name of asset\r\n     */\r\n    public static async createAssetFromFilePath(filePath: string, fileName?: string): Promise<IAsset> {\r\n        Guard.empty(filePath);\r\n\r\n        const normalizedPath = filePath.toLowerCase();\r\n\r\n        // If the path is not already prefixed with a protocol\r\n        // then assume it comes from the local file system\r\n        if (!normalizedPath.startsWith(\"http://\") &&\r\n            !normalizedPath.startsWith(\"https://\") &&\r\n            !normalizedPath.startsWith(\"file:\")) {\r\n            // First replace \\ character with / the do the standard url encoding then encode unsupported characters\r\n            filePath = encodeFileURI(filePath, true);\r\n        }\r\n\r\n        const hash = await sha256Hash(filePath);\r\n        // eslint-disable-next-line\r\n        const pathParts = filePath.split(/[\\\\\\/]/);\r\n        fileName = fileName || pathParts[pathParts.length - 1];\r\n        const fileNameParts = fileName.split(\".\");\r\n\r\n        // eslint-disable-next-line\r\n        const extensionParts = fileNameParts[fileNameParts.length - 1].split(/[\\?#]/);\r\n        const assetFormat = extensionParts[0];\r\n\r\n        const assetType = this.getAssetType(assetFormat);\r\n\r\n        return {\r\n            id: hash,\r\n            format: assetFormat,\r\n            state: AssetState.NotVisited,\r\n            type: assetType,\r\n            name: fileName,\r\n            path: filePath,\r\n            size: null,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get Asset Type from format (file extension)\r\n     * @param format - File extension of asset\r\n     */\r\n    public static getAssetType(format: string): AssetType {\r\n        switch (format.toLowerCase()) {\r\n            case \"jpg\":\r\n            case \"jpeg\":\r\n            case \"png\":\r\n            case \"bmp\":\r\n                return AssetType.Image;\r\n            case \"tif\":\r\n            case \"tiff\":\r\n                return AssetType.TIFF;\r\n            case \"pdf\":\r\n                return AssetType.PDF;\r\n            default:\r\n                return AssetType.Unknown;\r\n        }\r\n    }\r\n\r\n    private assetProviderInstance: IAssetProvider;\r\n    private storageProviderInstance: IStorageProvider;\r\n\r\n    constructor(private project: IProject) {\r\n        Guard.null(project);\r\n    }\r\n\r\n    /**\r\n     * Get Asset Provider from project's source connction\r\n     */\r\n    protected get assetProvider(): IAssetProvider {\r\n        if (!this.assetProviderInstance) {\r\n            this.assetProviderInstance = AssetProviderFactory.create(\r\n                this.project.sourceConnection.providerType,\r\n                this.project.sourceConnection.providerOptions,\r\n            );\r\n        }\r\n\r\n        return this.assetProviderInstance;\r\n    }\r\n\r\n    /**\r\n     * Get Storage Provider from project's target connection\r\n     */\r\n    protected get storageProvider(): IStorageProvider {\r\n        if (!this.storageProviderInstance) {\r\n            this.storageProviderInstance = StorageProviderFactory.create(\r\n                this.project.sourceConnection.providerType,\r\n                this.project.sourceConnection.providerOptions,\r\n            );\r\n        }\r\n\r\n        return this.storageProviderInstance;\r\n    }\r\n\r\n    /**\r\n     * Get assets from provider\r\n     */\r\n    public async getAssets(): Promise<IAsset[]> {\r\n        const project = this.project;\r\n        const assets = await this.assetProvider.getAssets();\r\n        const returnedAssets = assets.map((asset) => {\r\n            asset.name = decodeURIComponent(asset.name);\r\n            return asset;\r\n        }).filter((asset) => this.isInExactFolderPath(asset.name, project.folderPath));\r\n\r\n        return returnedAssets;\r\n    }\r\n\r\n    /**\r\n     * Save metadata for asset\r\n     * @param metadata - Metadata for asset\r\n     */\r\n    public async save(metadata: IAssetMetadata): Promise<IAssetMetadata> {\r\n        Guard.null(metadata);\r\n\r\n        const labelFileName = decodeURIComponent(`${metadata.asset.name}${constants.labelFileExtension}`);\r\n        if (metadata.labelData) {\r\n            await this.storageProvider.writeText(labelFileName, JSON.stringify(metadata.labelData, null, 4));\r\n        }\r\n\r\n        if (metadata.asset.state !== AssetState.Tagged) {\r\n            // If the asset is no longer tagged, then it doesn't contain any regions\r\n            // and the file is not required.\r\n            try {\r\n                await this.storageProvider.deleteFile(labelFileName, true, true);\r\n            } catch (err) {\r\n                // The file may not exist - that's OK.\r\n            }\r\n        }\r\n        return metadata;\r\n    }\r\n\r\n    /**\r\n     * Get metadata for asset\r\n     * @param asset - Asset for which to retrieve metadata\r\n     */\r\n    public async getAssetMetadata(asset: IAsset): Promise<IAssetMetadata> {\r\n        Guard.null(asset);\r\n\r\n        const labelFileName = decodeURIComponent(`${asset.name}${constants.labelFileExtension}`);\r\n        try {\r\n            const json = await this.storageProvider.readText(labelFileName, true);\r\n            const labelData = JSON.parse(json) as ILabelData;\r\n            if (!labelData.document || !labelData.labels) {\r\n                const reason = interpolate(strings.errors.missingRequiredFieldInLabelFile.message, { labelFileName });\r\n                toast.error(reason, { autoClose: false });\r\n                throw new Error(\"Invalid label file\");\r\n            }\r\n            if (labelData.labels.length === 0) {\r\n                const reason = interpolate(strings.errors.noLabelInLabelFile.message, { labelFileName });\r\n                toast.info(reason);\r\n                throw new Error(\"Empty label file\");\r\n            }\r\n            if (labelData.labels.find((f) => f.label.trim().length === 0)) {\r\n                toast.error(strings.tags.warnings.emptyName, { autoClose: false });\r\n                throw new Error(\"Invalid label file\");\r\n            }\r\n            if (labelData.labels.containsDuplicates<ILabel>((f) => f.label)) {\r\n                const reason = interpolate(strings.errors.duplicateFieldKeyInLabelsFile.message, { labelFileName });\r\n                toast.error(reason, { autoClose: false });\r\n                throw new Error(\"Invalid label file\");\r\n            }\r\n            const labelHash = new Set<string>();\r\n            for (const label of labelData.labels) {\r\n                const pageSet = new Set<number>();\r\n                for (const valueObj of label.value) {\r\n                    if (pageSet.size !== 0 && !pageSet.has(valueObj.page)) {\r\n                        const reason = interpolate(\r\n                            strings.errors.sameLabelInDifferentPageError.message, { tagName: label.label });\r\n                        toast.error(reason, { autoClose: false });\r\n                        throw new Error(\"Invalid label file\");\r\n                    }\r\n                    pageSet.add(valueObj.page);\r\n                    for (const box of valueObj.boundingBoxes) {\r\n                        const hash = [valueObj.page, ...box].join();\r\n                        if (labelHash.has(hash)) {\r\n                            const reason = interpolate(\r\n                                strings.errors.duplicateBoxInLabelFile.message, { page: valueObj.page });\r\n                            toast.error(reason, { autoClose: false });\r\n                            throw new Error(\"Invalid label file\");\r\n                        }\r\n                        labelHash.add(hash);\r\n                    }\r\n                }\r\n            }\r\n            toast.dismiss();\r\n            return {\r\n                asset: { ...asset },\r\n                regions: [],\r\n                version: appInfo.version,\r\n                labelData,\r\n            };\r\n        } catch (err) {\r\n            if (err instanceof SyntaxError) {\r\n                const reason = interpolate(strings.errors.invalidJSONFormat.message, { labelFileName });\r\n                toast.error(reason, { autoClose: false });\r\n            }\r\n            return {\r\n                asset: { ...asset },\r\n                regions: [],\r\n                version: appInfo.version,\r\n                labelData: null,\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete a tag from asset metadata files\r\n     * @param tagName Name of tag to delete\r\n     */\r\n    public async deleteTag(tagName: string): Promise<IAssetMetadata[]> {\r\n        const transformer = (tagNames) => tagNames.filter((t) => t !== tagName);\r\n        const labelTransformer = (labelData: ILabelData) => {\r\n            labelData.labels = labelData.labels.filter((label) => label.label !== tagName);\r\n            return labelData;\r\n        };\r\n        return await this.getUpdatedAssets(tagName, transformer, labelTransformer);\r\n    }\r\n\r\n    /**\r\n     * Rename a tag within asset metadata files\r\n     * @param tagName Name of tag to rename\r\n     */\r\n    public async renameTag(tagName: string, newTagName: string): Promise<IAssetMetadata[]> {\r\n        const transformer = (tags) => tags.map((t) => (t === tagName) ? newTagName : t);\r\n        const labelTransformer = (labelData: ILabelData) => {\r\n            const field = labelData.labels.find((label) => label.label === tagName);\r\n            if (field) {\r\n                field.label = newTagName;\r\n            }\r\n            return labelData;\r\n        };\r\n        return await this.getUpdatedAssets(tagName, transformer, labelTransformer);\r\n    }\r\n\r\n    /**\r\n     * Update tags within asset metadata files\r\n     * @param tagName Name of tag to update within project\r\n     * @param transformer Function that accepts array of tags from a region and returns a modified array of tags\r\n     */\r\n    private async getUpdatedAssets(\r\n        tagName: string,\r\n        transformer: (tags: string[]) => string[],\r\n        labelTransformer: (label: ILabelData) => ILabelData)\r\n        : Promise<IAssetMetadata[]> {\r\n        // Loop over assets and update if necessary\r\n        const updates = await _.values(this.project.assets).mapAsync(async (asset) => {\r\n            const assetMetadata = await this.getAssetMetadata(asset);\r\n            const isUpdated = this.updateTagInAssetMetadata(assetMetadata, tagName, transformer, labelTransformer);\r\n\r\n            return isUpdated ? assetMetadata : null;\r\n        });\r\n\r\n        return updates.filter((assetMetadata) => !!assetMetadata);\r\n    }\r\n\r\n    /**\r\n     * Update tag within asset metadata object\r\n     * @param assetMetadata Asset metadata to update\r\n     * @param tagName Name of tag being updated\r\n     * @param transformer Function that accepts array of tags from a region and returns a modified array of tags\r\n     * @returns Modified asset metadata object or null if object does not need to be modified\r\n     */\r\n    private updateTagInAssetMetadata(\r\n        assetMetadata: IAssetMetadata,\r\n        tagName: string,\r\n        transformer: (tags: string[]) => string[],\r\n        labelTransformer: (labelData: ILabelData) => ILabelData): boolean {\r\n        let foundTag = false;\r\n\r\n        for (const region of assetMetadata.regions) {\r\n            if (region.tags.find((t) => t === tagName)) {\r\n                foundTag = true;\r\n                region.tags = transformer(region.tags);\r\n            }\r\n        }\r\n\r\n        if (assetMetadata.labelData && assetMetadata.labelData.labels) {\r\n            const field = assetMetadata.labelData.labels.find((field) => field.label === tagName);\r\n            if (field) {\r\n                foundTag = true;\r\n                assetMetadata.labelData = labelTransformer(assetMetadata.labelData);\r\n            }\r\n        }\r\n\r\n        if (foundTag) {\r\n            assetMetadata.regions = assetMetadata.regions.filter((region) => region.tags.length > 0);\r\n            assetMetadata.asset.state = _.get(assetMetadata, \"labelData.labels.length\")\r\n                ? AssetState.Tagged : AssetState.Visited;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private isInExactFolderPath = (assetName: string, normalizedPath: string): boolean => {\r\n        if (normalizedPath === \"\") {\r\n            return assetName.lastIndexOf(\"/\") === -1;\r\n        }\r\n\r\n        const startsWithFolderPath = assetName.indexOf(`${normalizedPath}/`) === 0;\r\n        return startsWithFolderPath && assetName.lastIndexOf(\"/\") === normalizedPath.length;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Constants used throughout application\r\n */\r\nexport const constants = {\r\n    version: \"pubpreview_1.0\",\r\n    projectFormTempKey: \"projectForm\",\r\n    projectFileExtensionOld: \".vott\",\r\n    projectFileExtension: \".fott\",\r\n    labelFileExtension: \".labels.json\",\r\n    ocrFileExtension: \".ocr.json\",\r\n    fieldsFileName: \"fields.json\",\r\n    maxConcurrentServiceRequests: 3,\r\n    statusCodeSucceeded: \"succeeded\",\r\n    statusCodeFailed: \"failed\",\r\n    apiKeyHeader: \"Ocp-Apim-Subscription-Key\",\r\n    maxRetry: 8,\r\n    initialRetryInterval: 500, // ms\r\n    convertedImageFormat: \"image/jpeg\",\r\n    convertedImageQuality: 0.7,\r\n    convertedThumbnailQuality: 0.2,\r\n\r\n    apiModelsPath: \"/formrecognizer/v2.0-preview/custom/models\",\r\n\r\n    pdfjsWorkerSrc(version: string) {\r\n        return `//fotts.azureedge.net/npm/pdfjs-dist/${version}/pdf.worker.js`;\r\n    },\r\n\r\n    pdfjsCMapUrl(version: string) {\r\n        return `//fotts.azureedge.net/npm/pdfjs-dist/${version}/cmaps/`;\r\n    },\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable-next-line:no-var-requires\r\nconst packageJson = require(\"../../package.json\");\r\n\r\n/**\r\n * Defines the application information\r\n */\r\nexport interface IAppInfo {\r\n    /** The app name */\r\n    name: string;\r\n    /** The app version */\r\n    version: string;\r\n    /** The app description */\r\n    description: string;\r\n}\r\n\r\n/**\r\n * Gets current application info\r\n */\r\nexport const appInfo = packageJson as IAppInfo;\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport default class Guard {\r\n    /**\r\n     * Validates the string express is not null or empty, otherwise throws an exception\r\n     * @param value - The value to validate\r\n     * @param paramName - The name of the parameter to validate\r\n     * @param message - The error message to return on invalid value\r\n     */\r\n    public static empty(value: string, paramName?: string, message?: string) {\r\n        if ((!!value === false || value.trim().length === 0)) {\r\n            message = message || (`'${paramName || \"value\"}' cannot be null or empty`);\r\n            throw new Error(message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validates the value is not null, otherwise throw an exception\r\n     * @param value - The value to validate\r\n     * @param paramName - The name of the parameter to validate\r\n     * @param message - The error message to return on invalid value\r\n     */\r\n    public static null(value: any, paramName?: string, message?: string) {\r\n        if ((!!value === false)) {\r\n            message = message || (`'${paramName || \"value\"}' cannot be null or undefined`);\r\n            throw new Error(message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validates the value meets the specified expectation, otherwise throws an exception\r\n     * @param value - The value to validate\r\n     * @param predicate - The predicate used for validation\r\n     * @param paramName - The name of the parameter to validate\r\n     * @param message - The error message to return on invalid value\r\n     */\r\n    public static expression<T>(value: T, predicate: (value: T) => boolean, paramName?: string, message?: string) {\r\n        if (!!value === false || !predicate(value)) {\r\n            message = message || (`'${paramName || \"value\"}' is not a valid value`);\r\n            throw new Error(message);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { KeyboardContext, IKeyboardContext, KeyEventType } from \"../keyboardManager/keyboardManager\";\r\nimport React from \"react\";\r\n\r\n/**\r\n * Properties needed for a keyboard binding\r\n */\r\nexport interface IKeyboardBindingProps {\r\n    /** Keys that the action is bound to */\r\n    accelerators: string[];\r\n    /** Friendly name for keyboard binding for display in help menu */\r\n    displayName: string;\r\n    /** Action to trigger upon key event */\r\n    handler: (evt?: KeyboardEvent) => void;\r\n    /** Type of key event (keypress, keyup, keydown) */\r\n    keyEventType?: KeyEventType;\r\n    /** Icon to display in help menu */\r\n    icon?: string;\r\n}\r\n\r\nexport class KeyboardBinding extends React.Component<IKeyboardBindingProps> {\r\n    public static contextType = KeyboardContext;\r\n    public context!: IKeyboardContext;\r\n    private deregisterBinding: () => void;\r\n\r\n    public componentDidMount() {\r\n        if (this.context && this.context.keyboard) {\r\n            this.deregisterBinding = this.context.keyboard.registerBinding(this.props);\r\n        } else {\r\n            console.warn(\"Keyboard Mananger context cannot be found - Keyboard binding has NOT been set.\");\r\n        }\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        if (this.deregisterBinding) {\r\n            this.deregisterBinding();\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return null;\r\n    }\r\n}\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 294;","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Redux Action types\r\n */\r\nexport enum ActionTypes {\r\n    // App\r\n    SAVE_APP_SETTINGS_SUCCESS = \"SAVE_APP_SETTINGS_SUCCESS\",\r\n    ENSURE_SECURITY_TOKEN_SUCCESS = \"ENSURE_SECURITY_TOKEN_SUCCESS\",\r\n\r\n    // Projects\r\n    LOAD_PROJECT_SUCCESS = \"LOAD_PROJECT_SUCCESS\",\r\n    SAVE_PROJECT_SUCCESS = \"SAVE_PROJECT_SUCCESS\",\r\n    DELETE_PROJECT_SUCCESS = \"DELETE_PROJECT_SUCCESS\",\r\n    CLOSE_PROJECT_SUCCESS = \"CLOSE_PROJECT_SUCCESS\",\r\n    LOAD_PROJECT_ASSETS_SUCCESS = \"LOAD_PROJECT_ASSETS_SUCCESS\",\r\n    UPDATE_PROJECT_TAG_SUCCESS = \"UPDATE_PROJECT_TAG_SUCCESS\",\r\n    DELETE_PROJECT_TAG_SUCCESS = \"DELETE_PROJECT_TAG_SUCCESS\",\r\n\r\n    // Connections\r\n    LOAD_CONNECTION_SUCCESS = \"LOAD_CONNECTION_SUCCESS\",\r\n    SAVE_CONNECTION_SUCCESS = \"SAVE_CONNECTION_SUCCESS\",\r\n    DELETE_CONNECTION_SUCCESS = \"DELETE_CONNECTION_SUCCESS\",\r\n\r\n    // Assets\r\n    SAVE_ASSET_METADATA_SUCCESS = \"SAVE_ASSET_METADATA_SUCCESS\",\r\n    LOAD_ASSET_METADATA_SUCCESS = \"LOAD_ASSET_METADATA_SUCCESS\",\r\n\r\n    ANY_OTHER_ACTION = \"ANY_OTHER_ACTION_SUCCESS\",\r\n\r\n    SHOW_ERROR = \"SHOW_ERROR\",\r\n    CLEAR_ERROR = \"CLEAR_ERROR\",\r\n\r\n    SET_TITLE = \"SET_TITLE\",\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IAppError, ErrorCode, AppError } from \"../../../../models/applicationState\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport Alert from \"../alert/alert\";\r\nimport { Env } from \"../../../../common/environment\";\r\n\r\n/**\r\n * Component properties for ErrorHandler component\r\n */\r\nexport interface IErrorHandlerProps extends React.Props<ErrorHandler> {\r\n    error: IAppError;\r\n    onError: (error: IAppError) => void;\r\n    onClearError: () => void;\r\n}\r\n\r\nexport function throwUnhandledRejectionForEdge(error: any, ignoreNotFound?: boolean, ignoreForbidden?: boolean) {\r\n    const isEdge = !(\"onunhandledrejection\" in window);\r\n    if (isEdge) {\r\n        if (error instanceof AppError && error.errorCode === ErrorCode.BlobContainerIONotFound && ignoreNotFound) {\r\n            return;\r\n        }\r\n        if (error instanceof AppError && error.errorCode === ErrorCode.BlobContainerIOForbidden && ignoreForbidden) {\r\n            return;\r\n        }\r\n        window.dispatchEvent(new CustomEvent(\"unhandledrejectionForEdge\", { detail: error }));\r\n    }\r\n}\r\n\r\n/**\r\n * Component for catching and handling global application errors\r\n */\r\nexport class ErrorHandler extends React.Component<IErrorHandlerProps> {\r\n    public componentDidMount() {\r\n        window.addEventListener(\"error\", this.onWindowError);\r\n        this.registerUnhandledRejectionHandler();\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        window.removeEventListener(\"error\", this.onWindowError);\r\n        this.unregisterUnhandledRejectionHandler();\r\n    }\r\n\r\n    public render() {\r\n        const showError = !!this.props.error;\r\n        let localizedError: IAppError = null;\r\n        if (showError) {\r\n            localizedError = this.getLocalizedError(this.props.error);\r\n        }\r\n\r\n        if (!showError) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <Alert\r\n                title={localizedError ? localizedError.title : \"\"}\r\n                message={localizedError ? localizedError.message : \"\"}\r\n                show={showError}\r\n                onClose={this.props.onClearError}\r\n            />\r\n        );\r\n    }\r\n\r\n    private registerUnhandledRejectionHandler() {\r\n        const exist = \"onunhandledrejection\" in window;\r\n        if (exist) {\r\n            window.addEventListener(\"unhandledrejection\", this.onUnhandledRejection);\r\n        } else {\r\n            window.addEventListener(\"unhandledrejectionForEdge\", this.onEdgeUnhandledRejection);\r\n        }\r\n    }\r\n\r\n    private unregisterUnhandledRejectionHandler() {\r\n        const exist = \"onunhandledrejection\" in window;\r\n        if (exist) {\r\n            window.removeEventListener(\"unhandledrejection\", this.onUnhandledRejection);\r\n        } else {\r\n            window.removeEventListener(\"unhandledrejectionForEdge\", this.onEdgeUnhandledRejection);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Unhandled errors that bubbled up to top of stack\r\n     * @param evt Error Event\r\n     */\r\n    private onWindowError = (evt: ErrorEvent) => {\r\n        evt.preventDefault();\r\n        this.handleError(evt.error || evt.message);\r\n    }\r\n\r\n    /**\r\n     * Handles async / promise based errors\r\n     * @param evt Unhandled Rejection Event\r\n     */\r\n    private onUnhandledRejection = (evt: PromiseRejectionEvent) => {\r\n        evt.preventDefault();\r\n        this.handleError(evt.reason);\r\n    }\r\n\r\n    private onEdgeUnhandledRejection = (event: CustomEvent) => {\r\n        event.preventDefault();\r\n        this.handleError(event.detail);\r\n    }\r\n\r\n    /**\r\n     * Handles various error format scenarios\r\n     * @param error The error to handle\r\n     */\r\n    private handleError(error: string | Error | AppError) {\r\n        if (!error) {\r\n            return;\r\n        }\r\n\r\n        // This is a special case where we don't need to throw an\r\n        // exception. The error is thrown from within a few layers\r\n        // of components, so we don't have access to ReactDnD (drag and drop)\r\n        // directly. The action is performed correctly, so we\r\n        // don't need to display the error here\r\n        if (this.isReactDnDError(error)) {\r\n            return;\r\n        }\r\n        let appError: IAppError = null;\r\n        // Promise rejection with reason\r\n        if (typeof (error) === \"string\") {\r\n            // Promise rejection with string base reason\r\n            appError = {\r\n                errorCode: ErrorCode.Unknown,\r\n                message: error || this.getUnknownErrorMessage(error),\r\n            };\r\n        } else if (error instanceof AppError) {\r\n            // Promise rejection with AppError\r\n            const reason = error as IAppError;\r\n            appError = {\r\n                title: reason.title || strings.errors.unknown.title,\r\n                errorCode: reason.errorCode,\r\n                message: reason.message || this.getUnknownErrorMessage(error),\r\n            };\r\n        } else if (error instanceof Error) {\r\n            // Promise rejection with other error like object\r\n            const reason = error as Error;\r\n            appError = {\r\n                title: reason.name || strings.errors.unknown.title,\r\n                errorCode: ErrorCode.Unknown,\r\n                message: reason.message || this.getUnknownErrorMessage(error),\r\n            };\r\n        } else {\r\n            appError = {\r\n                title: strings.errors.unknown.title,\r\n                errorCode: ErrorCode.Unknown,\r\n                message: this.getUnknownErrorMessage(error),\r\n            };\r\n        }\r\n\r\n        this.props.onError(appError);\r\n    }\r\n\r\n    private getUnknownErrorMessage(e) {\r\n        if (Env.get() !== \"production\") {\r\n            return (<pre>{JSON.stringify(e, null, 2)}</pre>);\r\n        } else {\r\n            return strings.errors.unknown.message;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a localized version of the error\r\n     * @param appError The error thrown by the application\r\n     */\r\n    private getLocalizedError(appError: IAppError): IAppError {\r\n        if (appError.errorCode === ErrorCode.Unknown) {\r\n            return appError;\r\n        }\r\n        const localizedError = strings.errors[appError.errorCode];\r\n        if (!localizedError) {\r\n            return appError;\r\n        }\r\n        return {\r\n            errorCode: appError.errorCode,\r\n            message: localizedError.message,\r\n            title: localizedError.title,\r\n        };\r\n    }\r\n\r\n    private isReactDnDError(e) {\r\n        return e && e.name === \"Invariant Violation\" && e.message === \"Expected to find a valid target.\";\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport class Env {\r\n    public static get() {\r\n        return process.env.NODE_ENV;\r\n    }\r\n}\r\n","import {createTheme} from \"office-ui-fabric-react\";\r\n\r\nconst greenButtonPalette = {\r\n    themePrimary: \"#78ad0e\",\r\n    themeLighterAlt: \"#050701\",\r\n    themeLighter: \"#131c02\",\r\n    themeLight: \"#243404\",\r\n    themeTertiary: \"#486808\",\r\n    themeSecondary: \"#6a990c\",\r\n    themeDarkAlt: \"#83b61f\",\r\n    themeDark: \"#94c13a\",\r\n    themeDarker: \"#add165\",\r\n    neutralLighterAlt: \"#393e43\",\r\n    neutralLighter: \"#40454b\",\r\n    neutralLight: \"#4c5157\",\r\n    neutralQuaternaryAlt: \"#53585f\",\r\n    neutralQuaternary: \"#595f65\",\r\n    neutralTertiaryAlt: \"#73787f\",\r\n    neutralTertiary: \"#dfdfdf\",\r\n    neutralSecondary: \"#e4e4e4\",\r\n    neutralPrimaryAlt: \"#e9e9e9\",\r\n    neutralPrimary: \"#cfcfcf\",\r\n    neutralDark: \"#f4f4f4\",\r\n    black: \"#f9f9f9\",\r\n    white: \"#32363B\",\r\n};\r\n\r\nconst darkGreyPalette = {\r\n    themePrimary: \"#E5E6E6\",\r\n    themeLighterAlt: \"#e8e8e8\",\r\n    themeLighter: \"#ebebeb\",\r\n    themeLight: \"#eeeeee\",\r\n    themeTertiary: \"#f1f1f1\",\r\n    themeSecondary: \"#f4f4f4\",\r\n    themeDarkAlt: \"#f6f6f6\",\r\n    themeDark: \"#f9f9f9\",\r\n    themeDarker: \"#fcfcfc\",\r\n    neutralLighterAlt: \"#26282d\",\r\n    neutralLighter: \"#2d3036\",\r\n    neutralLight: \"#3a3d43\",\r\n    neutralQuaternaryAlt: \"#42454c\",\r\n    neutralQuaternary: \"#484c53\",\r\n    neutralTertiaryAlt: \"#646870\",\r\n    neutralTertiary: \"#eeeeee\",\r\n    neutralSecondary: \"#f1f1f1\",\r\n    neutralPrimaryAlt: \"#f4f4f4\",\r\n    neutralPrimary: \"#E5E6E6\",\r\n    neutralDark: \"#f9f9f9\",\r\n    black: \"#fcfcfc\",\r\n    white: \"#1E2024\",\r\n  };\r\n\r\nconst whiteButtonPalette = {\r\n    themePrimary: \"white\",\r\n    themeLighterAlt: \"#767676\",\r\n    themeLighter: \"#a6a6a6\",\r\n    themeLight: \"#c8c8c8\",\r\n    themeTertiary: \"#d0d0d0\",\r\n    themeSecondary: \"#dadada\",\r\n    themeDarkAlt: \"#eaeaea\",\r\n    themeDark: \"#f4f4f4\",\r\n    themeDarker: \"#f8f8f8\",\r\n    neutralLighterAlt: \"#393e43\",\r\n    neutralLighter: \"#40454b\",\r\n    neutralLight: \"#4c5157\",\r\n    neutralQuaternaryAlt: \"#53585f\",\r\n    neutralQuaternary: \"#595f65\",\r\n    neutralTertiaryAlt: \"#73787f\",\r\n    neutralTertiary: \"#dfdfdf\",\r\n    neutralSecondary: \"#e4e4e4\",\r\n    neutralPrimaryAlt: \"#e9e9e9\",\r\n    neutralPrimary: \"#cfcfcf\",\r\n    neutralDark: \"#f4f4f4\",\r\n    black: \"#f9f9f9\",\r\n    white: \"#32363B\",\r\n};\r\n\r\nconst redButtonPalette = {\r\n    themePrimary: \"#f2635e\",\r\n    themeLighterAlt: \"#0a0404\",\r\n    themeLighter: \"#27100f\",\r\n    themeLight: \"#491e1c\",\r\n    themeTertiary: \"#913c39\",\r\n    themeSecondary: \"#d55753\",\r\n    themeDarkAlt: \"#f4726e\",\r\n    themeDark: \"#f58784\",\r\n    themeDarker: \"#f8a6a3\",\r\n    neutralLighterAlt: \"#262a2f\",\r\n    neutralLighter: \"#262a2e\",\r\n    neutralLight: \"#24282c\",\r\n    neutralQuaternaryAlt: \"#222529\",\r\n    neutralQuaternary: \"#202328\",\r\n    neutralTertiaryAlt: \"#1f2226\",\r\n    neutralTertiary: \"#f0f2f5\",\r\n    neutralSecondary: \"#f2f4f6\",\r\n    neutralPrimaryAlt: \"#f5f6f8\",\r\n    neutralPrimary: \"#e9ecef \",\r\n    neutralDark: \"#fafbfb\",\r\n    black: \"#fcfdfd\",\r\n    white: \"#272B30\",\r\n};\r\n\r\nconst greyButtonPalette = {\r\n    themePrimary: \"#949799\",\r\n    themeLighterAlt: \"#060606\",\r\n    themeLighter: \"#181818\",\r\n    themeLight: \"#2d2d2e\",\r\n    themeTertiary: \"#595b5c\",\r\n    themeSecondary: \"#838587\",\r\n    themeDarkAlt: \"#9fa1a3\",\r\n    themeDark: \"#adb0b1\",\r\n    themeDarker: \"#c3c4c6\",\r\n    neutralLighterAlt: \"#262a2f\",\r\n    neutralLighter: \"#262a2e\",\r\n    neutralLight: \"#24282c\",\r\n    neutralQuaternaryAlt: \"#222529\",\r\n    neutralQuaternary: \"#202328\",\r\n    neutralTertiaryAlt: \"#1f2226\",\r\n    neutralTertiary: \"#f0f2f5\",\r\n    neutralSecondary: \"#f2f4f6\",\r\n    neutralPrimaryAlt: \"#f5f6f8\",\r\n    neutralPrimary: \"#e9ecef\",\r\n    neutralDark: \"#fafbfb\",\r\n    black: \"#fcfdfd\",\r\n    white: \"#272B30\",\r\n};\r\n\r\nconst blueButtonPalette = {\r\n    themePrimary: \"#5bc0de\",\r\n    themeLighterAlt: \"#040809\",\r\n    themeLighter: \"#0f1f23\",\r\n    themeLight: \"#1b3943\",\r\n    themeTertiary: \"#377385\",\r\n    themeSecondary: \"#50a8c3\",\r\n    themeDarkAlt: \"#6ac5e1\",\r\n    themeDark: \"#7fcee6\",\r\n    themeDarker: \"#9edaec\",\r\n    neutralLighterAlt: \"#262a2f\",\r\n    neutralLighter: \"#262a2e\",\r\n    neutralLight: \"#24282c\",\r\n    neutralQuaternaryAlt: \"#222529\",\r\n    neutralQuaternary: \"#202328\",\r\n    neutralTertiaryAlt: \"#1f2226\",\r\n    neutralTertiary: \"#f0f2f5\",\r\n    neutralSecondary: \"#f2f4f6\",\r\n    neutralPrimaryAlt: \"#f5f6f8\",\r\n    neutralPrimary: \"#e9ecef\",\r\n    neutralDark: \"#fafbfb\",\r\n    black: \"#fcfdfd\",\r\n    white: \"#272b30\",\r\n};\r\n\r\nconst darkThemePalette  = {\r\n    neutralLighterAlt: \"#282828\",\r\n    neutralLighter: \"#313131\",\r\n    neutralLight: \"#3f3f3f\",\r\n    neutralQuaternaryAlt: \"#484848\",\r\n    neutralQuaternary: \"#4f4f4f\",\r\n    neutralTertiaryAlt: \"#6d6d6d\",\r\n    neutralTertiary: \"#c8c8c8\",\r\n    neutralSecondary: \"#d0d0d0\",\r\n    neutralPrimaryAlt: \"#dadada\",\r\n    neutralPrimary: \"#ffffff\",\r\n    neutralDark: \"#f4f4f4\",\r\n    black: \"#f8f8f8\",\r\n    white: \"#1f1f1f\",\r\n    themePrimary: \"#ffffff\",\r\n    themeLighterAlt: \"#020609\",\r\n    themeLighter: \"#091823\",\r\n    themeLight: \"#112d43\",\r\n    themeTertiary: \"#235a85\",\r\n    themeSecondary: \"#3385c3\",\r\n    themeDarkAlt: \"#4ba0e1\",\r\n    themeDark: \"#65aee6\",\r\n    themeDarker: \"#8ac2ec\",\r\n    accent: \"#3a96dd\",\r\n};\r\n\r\nconst whiteTheme = createTheme({palette: whiteButtonPalette});\r\nconst redTheme = createTheme({palette: redButtonPalette});\r\nconst greenTheme = createTheme({palette: greenButtonPalette});\r\nconst greyTheme = createTheme({palette: greyButtonPalette});\r\nconst blueTheme = createTheme({palette: blueButtonPalette});\r\nconst darkTheme = createTheme({palette: darkThemePalette});\r\nconst darkGreyTheme = createTheme({palette: darkGreyPalette});\r\n\r\nexport function getPrimaryWhiteTheme() {\r\n    return whiteTheme;\r\n}\r\n\r\nexport function getDarkGreyTheme() {\r\n    return darkGreyTheme;\r\n}\r\n\r\nexport function getPrimaryRedTheme() {\r\n    return redTheme;\r\n}\r\n\r\nexport function getPrimaryGreenTheme() {\r\n    return greenTheme;\r\n}\r\n\r\nexport function getPrimaryGreyTheme() {\r\n    return greyTheme;\r\n}\r\n\r\nexport function getPrimaryBlueTheme() {\r\n    return blueTheme;\r\n}\r\n\r\nexport function getDarkTheme() {\r\n    return darkTheme;\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { AzureBlobStorageError } from \"./azureBlobStorageError\";\r\nimport { IStorageProvider } from \"./storageProviderFactory\";\r\nimport { IAsset, AssetType, StorageType, AssetState, AppError } from \"../../models/applicationState\";\r\nimport { AssetService } from \"../../services/assetService\";\r\nimport {\r\n    TokenCredential, AnonymousCredential, ContainerURL,\r\n    StorageURL, Credential, Aborter, BlockBlobURL,\r\n} from \"@azure/storage-blob\";\r\nimport { constants } from \"../../common/constants\";\r\nimport { ErrorCode } from \"../../models/applicationState\";\r\nimport { strings } from \"../../common/strings\";\r\nimport { throwUnhandledRejectionForEdge } from \"../../react/components/common/errorHandler/errorHandler\";\r\n\r\n/**\r\n * Options for Azure Cloud Storage\r\n * @member sas - Shared Access Signature (SAS) token for accessing Azure Blob Storage\r\n * @member oauthToken - Not yet implemented. Optional token for accessing Azure Blob Storage\r\n */\r\nexport interface IAzureCloudStorageOptions {\r\n    sas?: string;\r\n    oauthToken?: string;\r\n}\r\n\r\n/**\r\n * Storage Provider for Azure Blob Storage\r\n */\r\nexport class AzureBlobStorage implements IStorageProvider {\r\n    /**\r\n     * Storage type\r\n     * @returns - StorageType.Cloud\r\n     */\r\n    public storageType: StorageType = StorageType.Cloud;\r\n\r\n    constructor(private options?: IAzureCloudStorageOptions) { }\r\n\r\n    /**\r\n     * Initialize connection to Blob Storage account & container\r\n     * If `createContainer` was specified in options, this function\r\n     * creates the container. Otherwise, validates that container\r\n     * is contained in list of containers\r\n     * @throws - Error if container does not exist or not able to\r\n     * connect to Azure Blob Storage\r\n     */\r\n    // tslint:disable-next-line:no-empty\r\n    public async initialize(): Promise<void> {}\r\n\r\n    /**\r\n     * Reads text from specified blob\r\n     * @param blobName - Name of blob in container\r\n     */\r\n    public async readText(blobName: string, ignoreNotFound?: boolean): Promise<string> {\r\n        try {\r\n            const blockBlobURL = this.getBlockBlobURL(blobName);\r\n            const downloadResponse = await blockBlobURL.download(Aborter.none, 0);\r\n            return await this.bodyToString(downloadResponse);\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception, ignoreNotFound);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads Buffer from specified blob\r\n     * @param blobName - Name of blob in container\r\n     */\r\n    public async readBinary(blobName: string) {\r\n        try {\r\n            const text = await this.readText(blobName);\r\n            return Buffer.from(text);\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Writes text to blob in container\r\n     * @param blobName - Name of blob in container\r\n     * @param content - Content to write to blob (string or Buffer)\r\n     */\r\n    public async writeText(blobName: string, content: string | Buffer) {\r\n        try {\r\n            const containerURL = new ContainerURL(this.options.sas, StorageURL.newPipeline(this.getCredential()));\r\n            const blockBlobURL = BlockBlobURL.fromContainerURL(containerURL, blobName);\r\n            await blockBlobURL.upload(\r\n                Aborter.none,\r\n                content,\r\n                content.length,\r\n            );\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Writes buffer to blob in container\r\n     * @param blobName - Name of blob in container\r\n     * @param content - Buffer to write to blob\r\n     */\r\n    public writeBinary(blobName: string, content: Buffer) {\r\n        try {\r\n            return this.writeText(blobName, content);\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deletes file from container\r\n     * @param blobName - Name of blob in container\r\n     */\r\n    public async deleteFile(blobName: string, ignoreNotFound?: boolean, ignoreForbidden?: boolean): Promise<void> {\r\n        try {\r\n            await this.getBlockBlobURL(blobName).delete(Aborter.none);\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception, ignoreNotFound, ignoreForbidden);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lists files in container\r\n     * @param path - NOT USED IN CURRENT IMPLEMENTATION. Only uses container\r\n     * as specified in Azure Cloud Storage Options. Included to satisfy\r\n     * Storage Provider interface\r\n     * @param ext - Extension of files to filter on when retrieving files\r\n     * from container\r\n     */\r\n    public async listFiles(path: string, ext?: string): Promise<string[]> {\r\n        try {\r\n            const result: string[] = [];\r\n            let marker;\r\n            const containerURL = new ContainerURL(this.options.sas, StorageURL.newPipeline(this.getCredential()));\r\n            do {\r\n                const listBlobsResponse = await containerURL.listBlobFlatSegment(\r\n                    Aborter.none,\r\n                    marker,\r\n                );\r\n                if (!listBlobsResponse.segment || !listBlobsResponse.containerName) {\r\n                    throw new AzureBlobStorageError(404);\r\n                }\r\n                marker = listBlobsResponse.nextMarker;\r\n                for (const blob of listBlobsResponse.segment.blobItems) {\r\n                    if ((ext && blob.name.endsWith(ext)) || !ext) {\r\n                        result.push(blob.name);\r\n                    }\r\n                }\r\n            } while (marker);\r\n\r\n            return result;\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lists the containers with in the Azure Blob Storage account\r\n     * @param path - NOT USED IN CURRENT IMPLEMENTATION. Lists containers in storage account.\r\n     * Path does not really make sense in this scenario. Included to satisfy interface\r\n     */\r\n    public async listContainers(path: string) {\r\n        return Promise.reject(\"Not implemented\");\r\n    }\r\n\r\n    /**\r\n     * Creates container specified in Azure Cloud Storage options\r\n     * @param containerName - NOT USED IN CURRENT IMPLEMENTATION. Because `containerName`\r\n     * is a required attribute of the Azure Cloud Storage options used to instantiate the\r\n     * provider, this function creates that container. Included to satisfy interface\r\n     */\r\n    public async createContainer(containerName: string): Promise<void> {\r\n        const containerURL = new ContainerURL(this.options.sas, StorageURL.newPipeline(this.getCredential()));\r\n        try {\r\n            await containerURL.create(Aborter.none);\r\n        } catch (e) {\r\n            if (e.statusCode === 409) {\r\n                return;\r\n            }\r\n\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deletes container specified in Azure Cloud Storage options\r\n     * @param containerName - NOT USED IN CURRENT IMPLEMENTATION. Because `containerName`\r\n     * is a required attribute of the Azure Cloud Storage options used to instantiate the\r\n     * provider, this function creates that container. Included to satisfy interface\r\n     */\r\n    public async deleteContainer(containerName: string): Promise<void> {\r\n        try {\r\n            const containerURL = new ContainerURL(this.options.sas, StorageURL.newPipeline(this.getCredential()));\r\n            await containerURL.delete(Aborter.none);\r\n        } catch (exception) {\r\n            this.azureBlobStorageErrorHandler(exception);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieves assets from Azure Blob Storage container\r\n     */\r\n    public async getAssets(): Promise<IAsset[]> {\r\n        const files: string[] = await this.listFiles(null/*folderPath*/);\r\n        const result: IAsset[] = [];\r\n        for (const file of files) {\r\n            const url = this.getUrl(file);\r\n            const asset = await AssetService.createAssetFromFilePath(url, this.getFileName(url));\r\n            if (this.isSupportedAssetType(asset.type)) {\r\n                const labelFileName = decodeURIComponent(`${asset.name}${constants.labelFileExtension}`);\r\n                const ocrFileName = decodeURIComponent(`${asset.name}${constants.ocrFileExtension}`);\r\n\r\n                if (files.find((str) => str === labelFileName)) {\r\n                    asset.state = AssetState.Tagged;\r\n                } else if (files.find((str) => str === ocrFileName)) {\r\n                    asset.state = AssetState.Visited;\r\n                } else {\r\n                    asset.state = AssetState.NotVisited;\r\n                }\r\n\r\n                result.push(asset);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param url - URL for Azure Blob\r\n     */\r\n    public getFileName(url: string) {\r\n        const pathParts = url.split(\"/\");\r\n        return pathParts[pathParts.length - 1].split(\"?\")[0];\r\n    }\r\n\r\n    private isSupportedAssetType(assetType: AssetType) {\r\n        return assetType === AssetType.Image || assetType === AssetType.TIFF || assetType === AssetType.PDF;\r\n    }\r\n\r\n    /**\r\n     * Gets a Credential object. OAuthToken if specified in options, anonymous\r\n     * credential otherwise (uses the SAS token)\r\n     * @returns - Credential object from Azure Storage SDK\r\n     */\r\n    private getCredential(): Credential {\r\n        if (this.options.oauthToken) {\r\n            return new TokenCredential(this.options.oauthToken);\r\n        } else {\r\n            return new AnonymousCredential();\r\n        }\r\n    }\r\n\r\n    private getBlockBlobURL(blobName: string): BlockBlobURL {\r\n        const containerURL = new ContainerURL(this.options.sas, StorageURL.newPipeline(this.getCredential()));\r\n        return BlockBlobURL.fromContainerURL(containerURL, blobName);\r\n    }\r\n\r\n    private getUrl(blobName: string): string {\r\n        return this.getBlockBlobURL(blobName).url;\r\n    }\r\n\r\n    private async bodyToString(\r\n        response: {\r\n            readableStreamBody?: NodeJS.ReadableStream;\r\n            blobBody?: Promise<Blob>;\r\n        },\r\n        // tslint:disable-next-line:variable-name\r\n        _length?: number,\r\n    ): Promise<string> {\r\n        const blob = await response.blobBody!;\r\n        return this.blobToString(blob);\r\n    }\r\n\r\n    private async blobToString(blob: Blob): Promise<string> {\r\n        const fileReader = new FileReader();\r\n\r\n        return new Promise<string>((resolve, reject) => {\r\n            fileReader.onloadend = (ev: any) => {\r\n                resolve(ev.target!.result);\r\n            };\r\n            fileReader.onerror = reject;\r\n            fileReader.readAsText(blob);\r\n        });\r\n    }\r\n\r\n    private azureBlobStorageErrorHandler = (exception, ignoreNotFound?: boolean, ignoreForbidden?: boolean) => {\r\n        const appError = this.toAppError(exception);\r\n        throwUnhandledRejectionForEdge(appError, ignoreNotFound, ignoreForbidden);\r\n        throw appError;\r\n    }\r\n\r\n    private toAppError(exception) {\r\n        if (exception.statusCode === 404) {\r\n            return new AppError(\r\n                ErrorCode.BlobContainerIONotFound,\r\n                strings.errors.blobContainerIONotFound.message,\r\n                strings.errors.blobContainerIONotFound.title);\r\n        } else if (exception.statusCode === 403) {\r\n            return new AppError(\r\n                ErrorCode.BlobContainerIOForbidden,\r\n                strings.errors.blobContainerIOForbidden.message,\r\n                strings.errors.blobContainerIOForbidden.title);\r\n        }\r\n        return exception;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport LocalizedStrings, { LocalizedStringsMethods } from \"react-localization\";\r\nimport { english } from \"./localization/en-us\";\r\nimport { spanish } from \"./localization/es-cl\";\r\n\r\n/**\r\n * Interface for all required strings in application\r\n * Language must add all strings to be compliant for localization\r\n */\r\nexport interface IAppStrings {\r\n    appName: string;\r\n    common: {\r\n        displayName: string;\r\n        description: string;\r\n        submit: string;\r\n        cancel: string;\r\n        save: string;\r\n        delete: string;\r\n        provider: string;\r\n        homePage: string;\r\n        reload: string;\r\n        skipToMainContent: string;\r\n        skipToSidebar: string;\r\n    };\r\n    projectService: {\r\n        existingLabelFiles: string;\r\n    };\r\n    titleBar: {\r\n        help: string;\r\n        minimize: string;\r\n        maximize: string;\r\n        restore: string;\r\n        close: string;\r\n    };\r\n    homePage: {\r\n        title: string;\r\n        newProject: string;\r\n        openLocalProject: {\r\n            title: string;\r\n        },\r\n        openCloudProject: {\r\n            title: string;\r\n            selectConnection: string;\r\n        },\r\n        deleteProject: {\r\n            title: string;\r\n            confirmation: string;\r\n        },\r\n        importProject: {\r\n            title: string;\r\n            confirmation: string;\r\n        },\r\n        recentProjects: string,\r\n        messages: {\r\n            deleteSuccess: string,\r\n        },\r\n    };\r\n    appSettings: {\r\n        title: string;\r\n        storageTitle: string;\r\n        uiHelp: string;\r\n        save: string;\r\n        securityToken: {\r\n            name: {\r\n                title: string;\r\n            },\r\n            key: {\r\n                title: string;\r\n            },\r\n        },\r\n        securityTokens: {\r\n            title: string;\r\n            description: string;\r\n        },\r\n        version: {\r\n            description: string;\r\n        },\r\n        commit: string,\r\n        devTools: {\r\n            description: string;\r\n            button: string;\r\n        },\r\n        reload: {\r\n            description: string;\r\n            button: string;\r\n        },\r\n        messages: {\r\n            saveSuccess: string;\r\n        },\r\n    };\r\n    projectSettings: {\r\n        title: string;\r\n        securityToken: {\r\n            title: string;\r\n            description: string;\r\n        },\r\n        save: string;\r\n        sourceConnection: {\r\n            title: string;\r\n            description: string;\r\n        },\r\n        targetConnection: {\r\n            title: string;\r\n            description: string;\r\n        },\r\n        videoSettings: {\r\n            title: string;\r\n            description: string;\r\n            frameExtractionRate: string;\r\n        },\r\n        addConnection: string,\r\n        messages: {\r\n            saveSuccess: string;\r\n            projectExisted: string;\r\n        },\r\n    };\r\n    train: {\r\n        title: string;\r\n        training: string;\r\n        pleaseWait: string;\r\n        notTrainedYet: string;\r\n    };\r\n    predict: {\r\n        title: string;\r\n        uploadFile: string;\r\n        inProgress: string;\r\n    };\r\n    projectMetrics: {\r\n        title: string;\r\n        assetsSectionTitle: string\r\n        totalAssetCount: string;\r\n        visitedAssets: string;\r\n        taggedAssets: string;\r\n        nonVisitedAssets: string;\r\n        nonTaggedAssets: string;\r\n        tagsSectionTitle: string;\r\n        totalRegionCount: string;\r\n        totalTagCount: string;\r\n        avgTagCountPerAsset: string;\r\n    };\r\n    tags: {\r\n        title: string;\r\n        placeholder: string;\r\n        editor: string;\r\n        modal: {\r\n            name: string;\r\n            color: string;\r\n        }\r\n        toolbar: {\r\n            add: string;\r\n            contextualMenu: string;\r\n            delete: string;\r\n            edit: string;\r\n            format: string;\r\n            lock: string;\r\n            moveDown: string;\r\n            moveUp: string;\r\n            rename: string;\r\n            search: string;\r\n            type: string;\r\n            vertiline: string;\r\n        }\r\n        colors: {\r\n            white: string;\r\n            gray: string;\r\n            red: string;\r\n            maroon: string;\r\n            yellow: string;\r\n            olive: string;\r\n            lime: string;\r\n            green: string;\r\n            aqua: string;\r\n            teal: string;\r\n            blue: string;\r\n            navy: string;\r\n            fuschia: string;\r\n            purple: string;\r\n        }\r\n        warnings: {\r\n            existingName: string;\r\n            emptyName: string;\r\n            unknownTagName: string;\r\n        }\r\n    };\r\n    connections: {\r\n        title: string;\r\n        details: string;\r\n        settings: string;\r\n        instructions: string;\r\n        new: string;\r\n        save: string;\r\n        messages: {\r\n            saveSuccess: string;\r\n            deleteSuccess: string;\r\n        },\r\n        imageCorsWarning: string;\r\n        blobCorsWarning: string;\r\n        azDocLinkText: string;\r\n        providers: {\r\n            azureBlob: {\r\n                title: string;\r\n                description: string,\r\n                accountName: {\r\n                    title: string,\r\n                    description: string,\r\n                },\r\n                containerName: {\r\n                    title: string,\r\n                    description: string,\r\n                },\r\n                sas: {\r\n                    title: string,\r\n                    description: string,\r\n                },\r\n                createContainer: {\r\n                    title: string,\r\n                    description: string,\r\n                }\r\n            },\r\n            bing: {\r\n                title: string;\r\n                options: string;\r\n                apiKey: string;\r\n                query: string;\r\n                aspectRatio: {\r\n                    title: string;\r\n                    all: string;\r\n                    square: string;\r\n                    wide: string;\r\n                    tall: string;\r\n                }\r\n            },\r\n            local: {\r\n                title: string;\r\n                folderPath: string;\r\n                selectFolder: string;\r\n                chooseFolder: string;\r\n            },\r\n        }\r\n    };\r\n    editorPage: {\r\n        title: string;\r\n        width: string;\r\n        height: string;\r\n        tagged: string;\r\n        visited: string;\r\n        toolbar: {\r\n            select: string;\r\n            pan: string;\r\n            drawRectangle: string;\r\n            drawPolygon: string;\r\n            copyRectangle: string;\r\n            copy: string;\r\n            cut: string;\r\n            paste: string;\r\n            removeAllRegions: string;\r\n            previousAsset: string;\r\n            nextAsset: string;\r\n            saveProject: string;\r\n            exportProject: string;\r\n            activeLearning: string;\r\n        }\r\n        videoPlayer: {\r\n            nextTaggedFrame: {\r\n                tooltip: string,\r\n            },\r\n            previousTaggedFrame: {\r\n                tooltip: string,\r\n            },\r\n            nextExpectedFrame: {\r\n                tooltip: string,\r\n            },\r\n            previousExpectedFrame: {\r\n                tooltip: string,\r\n            },\r\n        }\r\n        help: {\r\n            title: string;\r\n            escape: string;\r\n        }\r\n        assetError: string;\r\n        tags: {\r\n            hotKey: {\r\n                apply: string;\r\n                lock: string;\r\n            },\r\n            rename: {\r\n                title: string;\r\n                confirmation: string;\r\n            },\r\n            delete: {\r\n                title: string;\r\n                confirmation: string;\r\n            },\r\n        }\r\n        canvas: {\r\n            removeAllRegions: {\r\n                title: string;\r\n                confirmation: string;\r\n            },\r\n        },\r\n        messages: {\r\n            enforceTaggedRegions: {\r\n                title: string,\r\n                description: string,\r\n            },\r\n        }\r\n    };\r\n    profile: {\r\n        settings: string;\r\n    };\r\n    errors: {\r\n        unknown: IErrorMetadata,\r\n        projectInvalidJson: IErrorMetadata,\r\n        projectInvalidSecurityToken: IErrorMetadata,\r\n        projectUploadError: IErrorMetadata,\r\n        projectDeleteError: IErrorMetadata,\r\n        projectNotFound: IErrorMetadata,\r\n        genericRenderError: IErrorMetadata,\r\n        securityTokenNotFound: IErrorMetadata,\r\n        canvasError: IErrorMetadata,\r\n        importError: IErrorMetadata,\r\n        pasteRegionTooBigError: IErrorMetadata,\r\n        exportFormatNotFound: IErrorMetadata,\r\n        activeLearningPredictionError: IErrorMetadata,\r\n        blobContainerIONotFound: IErrorMetadata,\r\n        blobContainerIOForbidden: IErrorMetadata,\r\n        projectDeleteForbidden: IErrorMetadata,\r\n        projectDeleteNotFound: IErrorMetadata,\r\n        predictWithoutTrainForbidden: IErrorMetadata,\r\n        missingRequiredFieldInLabelFile: IErrorMetadata,\r\n        noLabelInLabelFile: IErrorMetadata,\r\n        duplicateFieldKeyInLabelsFile: IErrorMetadata,\r\n        invalidJSONFormat: IErrorMetadata,\r\n        sameLabelInDifferentPageError: IErrorMetadata,\r\n        duplicateBoxInLabelFile: IErrorMetadata,\r\n        endpointConnectionError: IErrorMetadata,\r\n        tooManyRequests: IErrorMetadata,\r\n        modelCountLimitExceeded: IErrorMetadata,\r\n    };\r\n}\r\n\r\ninterface IErrorMetadata {\r\n    title: string;\r\n    message: string;\r\n}\r\n\r\ninterface IStrings extends LocalizedStringsMethods, IAppStrings { }\r\n\r\nexport const strings: IStrings = new LocalizedStrings({\r\n    en: english,\r\n    es: spanish,\r\n});\r\n\r\n/**\r\n * Add localization values to JSON object. Substitutes value\r\n * of variable placeholders with value of currently set language\r\n * Example variable: ${strings.profile.settings}\r\n * @param json JSON object containing variable placeholders\r\n */\r\nexport function addLocValues(json: any) {\r\n    return interpolateJson(json, { strings });\r\n}\r\n\r\n/**\r\n * Stringifies the JSON and substitutes values from params\r\n * @param json JSON object\r\n * @param params Parameters for substitution\r\n */\r\nexport function interpolateJson(json: any, params: any) {\r\n    const template = JSON.stringify(json);\r\n    const outputJson = interpolate(template, params);\r\n    return JSON.parse(outputJson);\r\n}\r\n\r\n/**\r\n * Makes substitution of values in string\r\n * @param template String containing variables\r\n * @param params Params containing substitution values\r\n */\r\nexport function interpolate(template: string, params: any) {\r\n    const names = Object.keys(params);\r\n    const vals = Object[\"values\"](params);\r\n\r\n    // eslint-disable-next-line\r\n    return new Function(...names, `return \\`${template}\\`;`)(...vals);\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IAppStrings } from \"../strings\";\r\n\r\n/*eslint-disable no-template-curly-in-string, no-multi-str*/\r\n\r\n/**\r\n * App Strings for English language\r\n */\r\nexport const english: IAppStrings = {\r\n    appName: \"OCR Form Labeling Tool\",\r\n    common: {\r\n        displayName: \"Display name\",\r\n        description: \"Description\",\r\n        submit: \"Submit\",\r\n        cancel: \"Cancel\",\r\n        save: \"Save\",\r\n        delete: \"Delete\",\r\n        provider: \"Provider\",\r\n        homePage: \"Home Page\",\r\n        reload: \"Reload\",\r\n        skipToMainContent: \"Skip to main content\",\r\n        skipToSidebar: \"Skip to sidebar\",\r\n    },\r\n    projectService: {\r\n        existingLabelFiles: \"existing label files\",\r\n    },\r\n    titleBar: {\r\n        help: \"Help\",\r\n        minimize: \"Minimize\",\r\n        maximize: \"Maximize\",\r\n        restore: \"Restore\",\r\n        close: \"Close\",\r\n    },\r\n    homePage: {\r\n        title: \"Home\",\r\n        newProject: \"New Project\",\r\n        openLocalProject: {\r\n            title: \"Open Local Project\",\r\n        },\r\n        openCloudProject: {\r\n            title: \"Open Cloud Project\",\r\n            selectConnection: \"Select a Connection\",\r\n        },\r\n        recentProjects: \"Recent Projects\",\r\n        deleteProject: {\r\n            title: \"Delete Project\",\r\n            confirmation: \"Are you sure you want to delete project\",\r\n        },\r\n        importProject: {\r\n            title: \"Import Project\",\r\n            confirmation: \"Are you sure you want to convert project ${project.file.name} project settings \" +\r\n                \"to v2 format? We recommend you backup the project file first.\",\r\n        },\r\n        messages: {\r\n            deleteSuccess: \"Successfully deleted ${project.name}\",\r\n        },\r\n    },\r\n    appSettings: {\r\n        title: \"Application Settings\",\r\n        storageTitle: \"Storage Settings\",\r\n        uiHelp: \"Where your settings are stored\",\r\n        save: \"Save Settings\",\r\n        securityToken: {\r\n            name: {\r\n                title: \"Name\",\r\n            },\r\n            key: {\r\n                title: \"Key\",\r\n            },\r\n        },\r\n        securityTokens: {\r\n            title: \"Security Tokens\",\r\n            description: \"Security tokens are used to encrypt sensitive data within your project configuration\",\r\n        },\r\n        version: {\r\n            description: \"Version:\",\r\n        },\r\n        commit: \"Commit SHA\",\r\n        devTools: {\r\n            description: \"Open application developer tools to help diagnose issues\",\r\n            button: \"Toggle Developer Tools\",\r\n        },\r\n        reload: {\r\n            description: \"Reload the app discarding all current changes\",\r\n            button: \"Refresh Application\",\r\n        },\r\n        messages: {\r\n            saveSuccess: \"Successfully saved application settings\",\r\n        },\r\n    },\r\n    projectSettings: {\r\n        title: \"Project Settings\",\r\n        securityToken: {\r\n            title: \"Security token\",\r\n            description: \"Used to encrypt sensitive data within project files\",\r\n        },\r\n        save: \"Save Project\",\r\n        sourceConnection: {\r\n            title: \"Source connection\",\r\n            description: \"Where to load assets from\",\r\n        },\r\n        targetConnection: {\r\n            title: \"Target Connection\",\r\n            description: \"Where to save the project and exported data\",\r\n        },\r\n        videoSettings: {\r\n            title: \"Video Settings\",\r\n            description: \"The rate at which frames are extracted for tagging.\",\r\n            frameExtractionRate: \"Frame Extraction Rate (frames per a video second)\",\r\n        },\r\n        addConnection: \"Add Connection\",\r\n        messages: {\r\n            saveSuccess: \"Successfully saved ${project.name} project settings\",\r\n            projectExisted: \"A project with name ${project.name} already exists, please use another name.\",\r\n        },\r\n    },\r\n    train: {\r\n        title: \"Train\",\r\n        training: \"Training\",\r\n        pleaseWait: \"Please wait\",\r\n        notTrainedYet: \"Not trained yet\",\r\n    },\r\n    predict: {\r\n        title: \"Predict\",\r\n        uploadFile: \"Upload file\",\r\n        inProgress: \"Prediction in progress...\",\r\n    },\r\n    projectMetrics: {\r\n        title: \"Project Metrics\",\r\n        assetsSectionTitle: \"Assets\",\r\n        totalAssetCount: \"Total Assets\",\r\n        visitedAssets: \"Visited Assets (${count})\",\r\n        taggedAssets: \"Tagged Assets (${count})\",\r\n        nonTaggedAssets: \"Not Tagged Assets (${count})\",\r\n        nonVisitedAssets: \"Not Visited Assets (${count})\",\r\n        tagsSectionTitle: \"Tags & Labels\",\r\n        totalRegionCount: \"Total Tagged Regions\",\r\n        totalTagCount: \"Total Tags\",\r\n        avgTagCountPerAsset: \"Average tags per asset\",\r\n    },\r\n    tags: {\r\n        title: \"Tags\",\r\n        placeholder: \"Add new tag\",\r\n        editor: \"Tags Editor\",\r\n        modal: {\r\n            name: \"Tag Name\",\r\n            color: \"Tag Color\",\r\n        },\r\n        colors: {\r\n            white: \"White\",\r\n            gray: \"Gray\",\r\n            red: \"Red\",\r\n            maroon: \"Maroon\",\r\n            yellow: \"Yellow\",\r\n            olive: \"Olive\",\r\n            lime: \"Lime\",\r\n            green: \"Green\",\r\n            aqua: \"Aqua\",\r\n            teal: \"Teal\",\r\n            blue: \"Blue\",\r\n            navy: \"Navy\",\r\n            fuschia: \"Fuschia\",\r\n            purple: \"Purple\",\r\n        },\r\n        warnings: {\r\n            existingName: \"Tag name already exists. Choose another name\",\r\n            emptyName: \"Cannot have an empty tag name\",\r\n            unknownTagName: \"Unknown\",\r\n        },\r\n        toolbar: {\r\n            add: \"Add new tag\",\r\n            contextualMenu: \"Contextual Menu\",\r\n            delete: \"Delete tag\",\r\n            edit: \"Edit tag\",\r\n            format: \"Select format\",\r\n            moveDown: \"Move tag down\",\r\n            moveUp: \"Move tag up\",\r\n            lock: \"Lock tag\",\r\n            rename: \"Rename tag\",\r\n            search: \"Search tags\",\r\n            type: \"Select type\",\r\n            vertiline: \"Vertical line\",\r\n        },\r\n    },\r\n    connections: {\r\n        title: \"Connections\",\r\n        details: \"Connection Details\",\r\n        settings: \"Connection Settings\",\r\n        instructions: \"Please select a connection to edit\",\r\n        new: \"New Connection\",\r\n        save: \"Save Connection\",\r\n        messages: {\r\n            saveSuccess: \"Successfully saved ${connection.name}\",\r\n            deleteSuccess: \"Successfully deleted ${connection.name}\",\r\n        },\r\n        imageCorsWarning: \"Warning: When using VoTT in a Web browser, some assets from Bing Image \\\r\n                          Search may not export correctly due to CORS (Cross Origin Resource Sharing) restrictions.\",\r\n        blobCorsWarning: \"Warning: CORS (Cross Domain Resource Sharing) must be enabled on the Azure Blob Storage \\\r\n                          account, in order to use it as a source or target connection. More information on \\\r\n                          enabling CORS can be found in the {0}\",\r\n        azDocLinkText: \"Azure Documentation.\",\r\n        providers: {\r\n            azureBlob: {\r\n                title: \"Azure blob container\",\r\n                description: \"\",\r\n                accountName: {\r\n                    title: \"Account Name\",\r\n                    description: \"\",\r\n                },\r\n                containerName: {\r\n                    title: \"Container Name\",\r\n                    description: \"\",\r\n                },\r\n                sas: {\r\n                    title: \"SAS URI\",\r\n                    description: \"Shared access signature URI to the blob container\",\r\n                },\r\n                createContainer: {\r\n                    title: \"Create Container\",\r\n                    description: \"Creates the blob container if it does not already exist\",\r\n                },\r\n            },\r\n            bing: {\r\n                title: \"Bing Image Search\",\r\n                options: \"Bing Image Search Options\",\r\n                apiKey: \"API Key\",\r\n                query: \"Query\",\r\n                aspectRatio: {\r\n                    title: \"Aspect Ratio\",\r\n                    all: \"All\",\r\n                    square: \"Square\",\r\n                    wide: \"Wide\",\r\n                    tall: \"Tall\",\r\n                },\r\n            },\r\n            local: {\r\n                title: \"Local File System\",\r\n                folderPath: \"Folder Path\",\r\n                selectFolder: \"Select Folder\",\r\n                chooseFolder: \"Choose Folder\",\r\n            },\r\n        },\r\n    },\r\n    editorPage: {\r\n        title: \"Editor\",\r\n        width: \"Width\",\r\n        height: \"Height\",\r\n        tagged: \"Tagged\",\r\n        visited: \"Visited\",\r\n        toolbar: {\r\n            select: \"Select (V)\",\r\n            pan: \"Pan\",\r\n            drawRectangle: \"Draw Rectangle\",\r\n            drawPolygon: \"Draw Polygon\",\r\n            copyRectangle: \"Copy Rectangle\",\r\n            copy: \"Copy Regions\",\r\n            cut: \"Cut Regions\",\r\n            paste: \"Paste Regions\",\r\n            removeAllRegions: \"Remove All Regions\",\r\n            previousAsset: \"Previous Asset\",\r\n            nextAsset: \"Next Asset\",\r\n            saveProject: \"Save Project\",\r\n            exportProject: \"Export Project\",\r\n            activeLearning: \"Active Learning\",\r\n        },\r\n        videoPlayer: {\r\n            previousTaggedFrame: {\r\n                tooltip: \"Previous Tagged Frame\",\r\n            },\r\n            nextTaggedFrame: {\r\n                tooltip: \"Next Tagged Frame\",\r\n            },\r\n            previousExpectedFrame: {\r\n                tooltip: \"Previous Frame\",\r\n            },\r\n            nextExpectedFrame: {\r\n                tooltip: \"Next Frame\",\r\n            },\r\n        },\r\n        help: {\r\n            title: \"Toggle Help Menu\",\r\n            escape: \"Escape Help Menu\",\r\n        },\r\n        assetError: \"Unable to load asset\",\r\n        tags: {\r\n            hotKey: {\r\n                apply: \"Apply Tag with Hot Key\",\r\n                lock: \"Lock Tag with Hot Key\",\r\n            },\r\n            rename: {\r\n                title: \"Rename Tag\",\r\n                confirmation: \"Are you sure you want to rename this tag? It will be renamed throughout all assets\",\r\n            },\r\n            delete: {\r\n                title: \"Delete Tag\",\r\n                confirmation: \"Are you sure you want to delete this tag? It will be deleted throughout all assets \\\r\n                and any regions where this is the only tag will also be deleted\",\r\n            },\r\n        },\r\n        canvas: {\r\n            removeAllRegions: {\r\n                title: \"Remove All Regions\",\r\n                confirmation: \"Are you sure you want to remove all regions?\",\r\n            },\r\n        },\r\n        messages: {\r\n            enforceTaggedRegions: {\r\n                title: \"Invalid region(s) detected\",\r\n                description: \"1 or more regions have not been tagged.  Ensure all regions are tagged before \\\r\n                    continuing to next asset.\",\r\n            },\r\n        },\r\n    },\r\n    profile: {\r\n        settings: \"Profile Settings\",\r\n    },\r\n    errors: {\r\n        unknown: {\r\n            title: \"Unknown Error\",\r\n            message: \"The app encountered an unknown error. Please try again.\",\r\n        },\r\n        projectUploadError: {\r\n            title: \"Error Uploading File\",\r\n            message: `There was an error uploading the file.\r\n                Please verify the file is of the correct format and try again.`,\r\n        },\r\n        genericRenderError: {\r\n            title: \"Error Loading Application\",\r\n            message: \"An error occured while rendering the application. Please try again\",\r\n        },\r\n        projectInvalidSecurityToken: {\r\n            title: \"Error loading project file\",\r\n            message: `The security token referenced by the project is invalid.\r\n                Verify that the security token for the project has been set correctly within your application settings`,\r\n        },\r\n        projectInvalidJson: {\r\n            title: \"Error parsing project file\",\r\n            message: \"The selected project files does not contain valid JSON. Please check the file any try again.\",\r\n        },\r\n        projectDeleteError: {\r\n            title: \"Error deleting project\",\r\n            message: `An error occured while deleting the project.\r\n                Validate the project file and security token exist and try again`,\r\n        },\r\n        projectNotFound: {\r\n            title: \"Error loading project\",\r\n            message: \"We couldn't find the project file ${file} at the target blob container ${container}.\\\r\n             The project file might have been removed from the container, \\\r\n             or the connection settings associated with this project might have changed to a new container where this project doesn't exist.\",\r\n        },\r\n        securityTokenNotFound: {\r\n            title: \"Error loading project file\",\r\n            message: `The security token referenced by the project cannot be found in your current application settings.\r\n                Verify the security token exists and try to reload the project.`,\r\n        },\r\n        canvasError: {\r\n            title: \"Error loading canvas\",\r\n            message: \"There was an error loading the canvas, check the project's assets and try again.\",\r\n        },\r\n        importError: {\r\n            title: \"Error importing V1 project\",\r\n            message: \"There was an error importing the V1 project. Check the project file and try again\",\r\n        },\r\n        pasteRegionTooBigError: {\r\n            title: \"Error pasting region\",\r\n            message: \"Region too big for this asset. Try copying another region\",\r\n        },\r\n        exportFormatNotFound: {\r\n            title: \"Error exporting project\",\r\n            message: \"Project is missing export format.  Please select an export format in the export setting page.\",\r\n        },\r\n        activeLearningPredictionError: {\r\n            title: \"Active Learning Error\",\r\n            message: \"An error occurred while predicting regions in the current asset. \\\r\n                Please verify your active learning configuration and try again\",\r\n        },\r\n        blobContainerIONotFound: {\r\n            title: \"Cannot find blob container/blob\",\r\n            message: \"Check if blob container/blob exists in storage account.\",\r\n        },\r\n        blobContainerIOForbidden: {\r\n            title: \"Cannot access blob container/blob\",\r\n            message: \"Check if you have unexpired read/write/list/delete permission to blob container/blob.\",\r\n        },\r\n        projectDeleteForbidden: {\r\n            title: \"Error deleting project\",\r\n            message: \"Cannot remove ${file} from your Azure storage blob container due to missing delete permission in SAS URI.\",\r\n        },\r\n        projectDeleteNotFound: {\r\n            title: \"Error deleting project\",\r\n            message: \"Cannot find ${file} in your Azure storage blob container. Please check if it's already removed.\",\r\n        },\r\n        predictWithoutTrainForbidden: {\r\n            title: \"Prediction Error\",\r\n            message: \"We couldn't find a trained model. Please go to the \\\"Train\\\" tab and ensure a model is trained.\",\r\n        },\r\n        missingRequiredFieldInLabelFile: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. Please ensure that both 'document' and 'labels' fields exist and are not empty in label file ${labelFileName}.\",\r\n        },\r\n        noLabelInLabelFile: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. There are no labels in label file ${labelFileName}. This label file cannot be used for training. Consider adding labels for this document.\",\r\n        },\r\n        duplicateFieldKeyInLabelsFile: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. There are duplicate label names in ${labelFileName}. Please correct your label file in Azure storage and ensure all names are unique when trimmed and converted to lower case.\",\r\n        },\r\n        invalidJSONFormat: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. Invalid JSON format in ${labelFileName}. Please correct your label file in Azure storage.\",\r\n        },\r\n        sameLabelInDifferentPageError: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. There are cross-page regions with the same tag ${tagName}. Please correct your label file in Azure storage.\",\r\n        },\r\n        duplicateBoxInLabelFile: {\r\n            title: \"Error loading label file\",\r\n            message: \"Label visualization disabled. There are duplicate bounding boxes on page ${page}. Please correct your label file in Azure storage.\",\r\n        },\r\n        endpointConnectionError: {\r\n            title: \"Error connecting to endpoint\",\r\n            message: \"Cannot connect to ${endpoint}. Please make sure the network connection is good and specified endpoint is correct.\",\r\n        },\r\n        tooManyRequests: {\r\n            title: \"Too many requests\",\r\n            message: \"We've got too many requests in a short period of time. Please try again later.\",\r\n        },\r\n        modelCountLimitExceeded: {\r\n            title: \"Too many models\",\r\n            message: \"The number of models associated with the given API key has exceeded the maximum allowed value.\",\r\n        },\r\n    },\r\n};\r\n\r\n/*eslint-enable no-template-curly-in-string, no-multi-str*/\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IAppStrings } from \"../strings\";\r\n\r\n/*eslint-disable no-template-curly-in-string, no-multi-str*/\r\n\r\n/**\r\n * App Strings for Spanish language\r\n */\r\nexport const spanish: IAppStrings = {\r\n    appName: \"Herramienta de etiquetado de formularios OCR\",\r\n    projectService: {\r\n        existingLabelFiles: \"\",\r\n    },\r\n    common: {\r\n        displayName: \"Nombre para Mostrar\",\r\n        description: \"Descripción\",\r\n        submit: \"Enviar\",\r\n        cancel: \"Cancelar\",\r\n        save: \"Guardar\",\r\n        delete: \"Borrar\",\r\n        provider: \"Proveedor\",\r\n        homePage: \"Página de Inicio\",\r\n        reload: \"Recargar\",\r\n        skipToMainContent: \"Saltar al contenido principal\",\r\n        skipToSidebar: \"Saltar a la barra lateral\",\r\n    },\r\n    titleBar: {\r\n        help: \"Ayuda\",\r\n        minimize: \"Minimizar\",\r\n        maximize: \"Maximizar\",\r\n        restore: \"Restaurar\",\r\n        close: \"Cerrar\",\r\n    },\r\n    homePage: {\r\n        title: \"Página de Inicio\",\r\n        newProject: \"Nuevo Proyecto\",\r\n        recentProjects: \"Proyectos Recientes\",\r\n        openLocalProject: {\r\n            title: \"Abrir Proyecto Local\",\r\n        },\r\n        openCloudProject: {\r\n            title: \"Abrir Proyecto de la Nube\",\r\n            selectConnection: \"Select a Connection\",\r\n        },\r\n        deleteProject: {\r\n            title: \"Borrar Proyecto\",\r\n            confirmation: \"¿Está seguro que quiere borrar el proyecto\",\r\n        },\r\n        importProject: {\r\n            title: \"Importar Proyecto\",\r\n            confirmation: \"¿Está seguro que quiere convertir el proyecto ${project.file.name} \" +\r\n                \"a formato v2? Le recomendamos que haga una copia de seguridad de su archivo de proyecto.\",\r\n        },\r\n        messages: {\r\n            deleteSuccess: \"${project.name} eliminado correctamente\",\r\n        },\r\n    },\r\n    appSettings: {\r\n        title: \"Configuración de Aplicación\",\r\n        storageTitle: \"Configuración de Almacenamiento\",\r\n        uiHelp: \"Donde se guardan sus configuraciones\",\r\n        save: \"Guardar configuración\",\r\n        securityToken: {\r\n            name: {\r\n                title: \"Nombre\",\r\n            },\r\n            key: {\r\n                title: \"Clave\",\r\n            },\r\n        },\r\n        securityTokens: {\r\n            title: \"Tokens de seguridad\",\r\n            description: \"Los tokens de seguridad se utilizan para cifrar datos confidenciales \\\r\n                dentro de la configuración del proyecto\",\r\n        },\r\n        version: {\r\n            description: \"Versión:\",\r\n        },\r\n        commit: \"Cometer SHA\",\r\n        devTools: {\r\n            description: \"Abrir herramientas de desarrollo de aplicaciones para ayudar a diagnosticar problemas.\",\r\n            button: \"Alternar Herramientas de Desarrollo\",\r\n        },\r\n        reload: {\r\n            description: \"Recargar la aplicación descartando todos los cambios actuales\",\r\n            button: \"Recargar la aplicación\",\r\n        },\r\n        messages: {\r\n            saveSuccess: \"Configuración de la aplicación guardada correctamente\",\r\n        },\r\n    },\r\n    projectSettings: {\r\n        title: \"Configuración de Proyecto\",\r\n        securityToken: {\r\n            title: \"Token de seguridad\",\r\n            description: \"Se utiliza para cifrar datos confidenciales dentro de archivos de proyecto\",\r\n        },\r\n        save: \"Guardar el Proyecto\",\r\n        sourceConnection: {\r\n            title: \"Conexión de Origen\",\r\n            description: \"De donde se gargan sus activos\",\r\n        },\r\n        targetConnection: {\r\n            title: \"Conexión de Destino\",\r\n            description: \"Donde se guarda su proyecto y sus datos exportados\",\r\n        },\r\n        videoSettings: {\r\n            title: \"Ajustes de video\",\r\n            description: \"La velocidad a la que se extraen los marcos para el etiquetado.\",\r\n            frameExtractionRate: \"Tasa de extracción de cuadros (cuadros por segundo de video)\",\r\n        },\r\n        addConnection: \"Agregar Conexión\",\r\n        messages: {\r\n            saveSuccess: \"Guardado correctamente ${project.name} configuración del proyecto\",\r\n            projectExisted: \"Un proyecto con el nombre ${project.name} ya existe, por favor utilice otro nombre.\",\r\n        },\r\n    },\r\n    train: {\r\n        title: \"Entrenar\",\r\n        training: \"Entrenamiento\",\r\n        pleaseWait: \"Por favor espera\",\r\n        notTrainedYet: \"Aún no entrenado\",\r\n    },\r\n    predict: {\r\n        title: \"Predecir\",\r\n        uploadFile: \"Subir archivo\",\r\n        inProgress: \"Predicción en progreso ...\",\r\n    },\r\n    projectMetrics: {\r\n        title: \"Métricas del proyecto\",\r\n        assetsSectionTitle: \"Activos\",\r\n        totalAssetCount: \"Total de activos\",\r\n        visitedAssets: \"Activos visitados (${count})\",\r\n        taggedAssets: \"Activos etiquetados (${count})\",\r\n        nonTaggedAssets: \"Activos no etiquetados (${count})\",\r\n        nonVisitedAssets: \"Activos no visitados (${count})\",\r\n        tagsSectionTitle: \"Etiquetas & etiquetas\",\r\n        totalRegionCount: \"Total de regiones\",\r\n        totalTagCount: \"Total de etiquetas\",\r\n        avgTagCountPerAsset: \"Recuento promedio de etiquetas por activo\",\r\n    },\r\n    tags: {\r\n        title: \"Etiquetas\",\r\n        placeholder: \"Agregar nuevo etiqueta\",\r\n        editor: \"Editor de Etiquetas\",\r\n        modal: {\r\n            name: \"Nombre de Etiqueta\",\r\n            color: \"Color de Etiqueta\",\r\n        },\r\n        colors: {\r\n            white: \"Blanco\",\r\n            gray: \"Gris\",\r\n            red: \"Rojo\",\r\n            maroon: \"Granate\",\r\n            yellow: \"Amarillo\",\r\n            olive: \"Olivo\",\r\n            lime: \"Lima\",\r\n            green: \"Verde\",\r\n            aqua: \"Aqua\",\r\n            teal: \"Trullo\",\r\n            blue: \"Azul\",\r\n            navy: \"Azul Marino\",\r\n            fuschia: \"Fuschia\",\r\n            purple: \"Púrpura\",\r\n        },\r\n        warnings: {\r\n            existingName: \"Nombre de etiqueta ya existe. Elige otro nombre\",\r\n            emptyName: \"El nombre de etiqueta no puede ser vacío\",\r\n            unknownTagName: \"Desconocido\",\r\n        },\r\n        toolbar: {\r\n            add: \"Agregar nueva etiqueta\",\r\n            contextualMenu: \"Menú contextual\",\r\n            delete: \"Borrar etiqueta\",\r\n            edit: \"Editar etiqueta\",\r\n            format: \"Seleccionar formato\",\r\n            lock: \"Bloquear etiqueta\",\r\n            moveDown: \"Mover etiqueta hacia abajo\",\r\n            moveUp: \"Mover etiqueta hacia arriba\",\r\n            rename: \"Renombrar etiqueta\",\r\n            search: \"Buscar entre etiquetas\",\r\n            type: \"Seleccione tipo\",\r\n            vertiline: \"Linea vertical\",\r\n        },\r\n    },\r\n    connections: {\r\n        title: \"Conexiones\",\r\n        new: \"Nueva conexión\",\r\n        save: \"Guardar Conexión\",\r\n        details: \"Detalles de Conexión\",\r\n        settings: \"Configuración de Conexión\",\r\n        instructions: \"Por favor seleccione una conexión para editar\",\r\n        messages: {\r\n            saveSuccess: \"${connection.name} guardado correctamente\",\r\n            deleteSuccess: \"${connection.name} eliminado correctamente\",\r\n        },\r\n        imageCorsWarning: \"Advertencia: Cuando se usa VoTT en un navegador web, es posible que algunos activos de este \\\r\n                          Búsqueda de Imágenes Bing no se exporten correctamente debido a las restricciones de CORS \\\r\n                          (Recursos de Origen Cruzado).\",\r\n        blobCorsWarning: \"Advertencia: CORS (Recursos de Origen Cruzado) debe estar habilitado en la \\\r\n                          cuenta de Azure Blob Storage para poder usarlo como una conexión de origen o destino. Puede \\\r\n                          encontrar más información sobre cómo habilitar CORS en la {0}.\",\r\n        azDocLinkText: \"documentación de Azure.\",\r\n        providers: {\r\n            azureBlob: {\r\n                title: \"Azure blob container\",\r\n                description: \"\",\r\n                accountName: {\r\n                    title: \"Nombre de cuenta\",\r\n                    description: \"\",\r\n                },\r\n                containerName: {\r\n                    title: \"Nombre del contenedor\",\r\n                    description: \"\",\r\n                },\r\n                sas: {\r\n                    title: \"SAS\",\r\n                    description: \"Firma de acceso compartido utilizada para autenticarse en la cuenta de BLOB Storage\",\r\n                },\r\n                createContainer: {\r\n                    title: \"Crear contenedor\",\r\n                    description: \"Crea el contenedor de blobs si aún no existe\",\r\n                },\r\n            },\r\n            bing: {\r\n                title: \"Búsqueda de Imágenes Bing\",\r\n                options: \"Opciones de Búsqueda de Imágenes Bing\",\r\n                apiKey: \"Clave API\",\r\n                query: \"Consulta\",\r\n                aspectRatio: {\r\n                    title: \"Relación de Aspecto\",\r\n                    all: \"Todos\",\r\n                    square: \"Cuadrado\",\r\n                    wide: \"Ancho\",\r\n                    tall: \"Alto\",\r\n                },\r\n            },\r\n            local: {\r\n                title: \"Sistema de Archivos Local\",\r\n                folderPath: \"Ruta de la carpeta\",\r\n                selectFolder: \"Seleccionar la carpeta\",\r\n                chooseFolder: \"Elijir la carpeta\",\r\n            },\r\n        },\r\n    },\r\n    editorPage: {\r\n        title: \"Editora\",\r\n        width: \"Anchura\",\r\n        height: \"Altura\",\r\n        tagged: \"Etiquetado\",\r\n        visited: \"Visitado\",\r\n        toolbar: {\r\n            select: \"Seleccionar\",\r\n            pan: \"Pan\",\r\n            drawRectangle: \"Dibujar Rectángulo\",\r\n            drawPolygon: \"Dibujar Polígono\",\r\n            copyRectangle: \"Copia rectángulo\",\r\n            copy: \"Copiar regiones\",\r\n            cut: \"Cortar regiones\",\r\n            paste: \"Pegar regiones\",\r\n            removeAllRegions: \"Eliminar Todas Las Regiones\",\r\n            previousAsset: \"Activo anterior\",\r\n            nextAsset: \"Siguiente activo\",\r\n            saveProject: \"Guardar Proyecto\",\r\n            exportProject: \"Exprtar Proyecto\",\r\n            activeLearning: \"Aprendizaje Activo\",\r\n        },\r\n        videoPlayer: {\r\n            previousTaggedFrame: {\r\n                tooltip: \"Fotograma etiquetado anterior\",\r\n            },\r\n            nextTaggedFrame: {\r\n                tooltip: \"Siguiente marco etiquetado\",\r\n            },\r\n            previousExpectedFrame: {\r\n                tooltip: \"Fotograma anterior\",\r\n            },\r\n            nextExpectedFrame: {\r\n                tooltip: \"Siguiente marco\",\r\n            },\r\n        },\r\n        help: {\r\n            title: \"Abrir/cerrar el menú de ayuda\",\r\n            escape: \"Escapar el menú de ayuda\",\r\n        },\r\n        assetError: \"No se puede mostrar el activo\",\r\n        tags: {\r\n            hotKey: {\r\n                apply: \"Aplicar etiqueta con tecla de acceso rápido\",\r\n                lock: \"Bloquear etiqueta con tecla de acceso rápido\",\r\n            },\r\n            rename: {\r\n                title: \"Cambiar el nombre de la etiqueta\",\r\n                confirmation: \"¿Está seguro que quiere cambiar el nombre de esta etiqueta? \\\r\n                Será cambiada en todos los activos\",\r\n            },\r\n            delete: {\r\n                title: \"Delete Tag\",\r\n                confirmation: \"¿Está seguro que quiere borrar esta etiqueta? Será borrada en todos \\\r\n                los activos y en las regiones donde esta etiqueta sea la única, la region también será borrada\",\r\n            },\r\n        },\r\n        canvas: {\r\n            removeAllRegions: {\r\n                title: \"Borrar Regiones\",\r\n                confirmation: \"¿Está seguro que quiere borrar todas las regiones?\",\r\n            },\r\n        },\r\n        messages: {\r\n            enforceTaggedRegions: {\r\n                title: \"Las regiones no válidas detectadas\",\r\n                description: \"1 o más regiones no se han etiquetado.  \\\r\n                    Por favor, etiquete todas las regiones antes de continuar con el siguiente activo.\",\r\n            },\r\n        },\r\n    },\r\n    profile: {\r\n        settings: \"Configuración de Perfíl\",\r\n    },\r\n    errors: {\r\n        unknown: {\r\n            title: \"Error desconocido\",\r\n            message: \"La aplicación contó un error desconocido.  Por favor inténtalo de nuevo.\",\r\n        },\r\n        projectUploadError: {\r\n            title: \"Error al cargar el archivo\",\r\n            message: `Se ha cargado un error al cargar el archivo.\r\n                Compruebe que el archivo es del tipo correcto e inténtelo de nuevo.`,\r\n        },\r\n        genericRenderError: {\r\n            title: \"Error desconocido\",\r\n            message: \"La aplicación contó un error desconocido.  Por favor inténtalo de nuevo.\",\r\n        },\r\n        projectInvalidSecurityToken: {\r\n            title: \"Error al cargar el archivo de proyecto\",\r\n            message: \"Asegúrese de que el token de seguridad del proyecto existe\",\r\n        },\r\n        projectInvalidJson: {\r\n            title: \"Error al analizar el archivo de proyecto\",\r\n            message: \"El archivo de proyecto no es válido JSON\",\r\n        },\r\n        projectDeleteError: {\r\n            title: \"Error al eliminar el proyecto\",\r\n            message: `Se ha producido un error al eliminar el proyecto.\r\n                Validar el archivo de proyecto y el token de seguridad existen e inténtelo de nuevo`,\r\n        },\r\n        projectNotFound: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        securityTokenNotFound: {\r\n            title: \"Error al cargar el archivo del proyecto\",\r\n            message: `El token de seguridad al que hace referencia el proyecto no se encuentra en la\r\n                configuración de la aplicación actual. Compruebe que existe el token de seguridad e intente\r\n                volver a cargar el proyecto.`,\r\n        },\r\n        canvasError: {\r\n            title: \"Error al cargar el lienzo\",\r\n            message: `Se produjo un error al cargar el lienzo, verifique los activos del\r\n                proyecto y vuelva a intentarlo.`,\r\n        },\r\n        importError: {\r\n            title: \"Error al importar el proyecto V1\",\r\n            message: \"Hubo un error al importar el proyecto V1. Revisa el archivo del proyecto y vuelve a intentarlo\",\r\n        },\r\n        pasteRegionTooBigError: {\r\n            title: \"Error al pegar region al activo\",\r\n            message: \"Hubo un error al pagar el region al activo. Intenta copiar otra region\",\r\n        },\r\n        exportFormatNotFound: {\r\n            title: \"Error exportando proyecto\",\r\n            message: `Proyecto falta el formato de exportación. Seleccione un formato de exportación en la página\r\n            de configuración de exportación.`,\r\n        },\r\n        activeLearningPredictionError: {\r\n            title: \"Error de aprendizaje\",\r\n            message: \"Se ha producido un error al predecir regiones en el activo actual. \\\r\n                Compruebe la configuración de aprendizaje activa y vuelva a intentarlo\",\r\n        },\r\n        blobContainerIONotFound: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        blobContainerIOForbidden: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        projectDeleteForbidden: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        projectDeleteNotFound: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        predictWithoutTrainForbidden: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        missingRequiredFieldInLabelFile: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        noLabelInLabelFile: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        duplicateFieldKeyInLabelsFile: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        invalidJSONFormat: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        sameLabelInDifferentPageError: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        duplicateBoxInLabelFile: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        endpointConnectionError: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        tooManyRequests: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n        modelCountLimitExceeded: {\r\n            title: \"\",\r\n            message: \"\",\r\n        },\r\n    },\r\n};\r\n\r\n/*eslint-enable no-template-curly-in-string, no-multi-str*/\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { Fragment } from \"react\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport { ToastContainer } from \"react-toastify\";\r\nimport { IAppError, IApplicationState, IProject, ErrorCode } from \"./models/applicationState\";\r\nimport { strings } from \"./common/strings\";\r\nimport IAppErrorActions, * as appErrorActions from \"./redux/actions/appErrorActions\";\r\nimport { ErrorHandler } from \"./react/components/common/errorHandler/errorHandler\";\r\nimport { KeyboardManager } from \"./react/components/common/keyboardManager/keyboardManager\";\r\nimport { HelpMenu } from \"./react/components/shell/helpMenu\";\r\nimport { MainContentRouter } from \"./react/components/shell/mainContentRouter\";\r\nimport { Sidebar } from \"./react/components/shell/sidebar\";\r\nimport { StatusBar } from \"./react/components/shell/statusBar\";\r\nimport { StatusBarMetrics } from \"./react/components/shell/statusBarMetrics\";\r\nimport { TitleBar } from \"./react/components/shell/titleBar\";\r\nimport { SkipButton } from \"./react/components/shell/skipButton\";\r\nimport \"./App.scss\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\n\r\ninterface IAppProps {\r\n    currentProject?: IProject;\r\n    appError?: IAppError;\r\n    actions?: IAppErrorActions;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        currentProject: state.currentProject,\r\n        appError: state.appError,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(appErrorActions, dispatch),\r\n    };\r\n}\r\n\r\n/**\r\n * @name - App\r\n * @description - Root level component for VoTT Application\r\n */\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class App extends React.Component<IAppProps> {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n          currentProject: this.props.currentProject,\r\n        };\r\n    }\r\n\r\n    public componentDidCatch(error: Error) {\r\n        this.props.actions.showError({\r\n            errorCode: ErrorCode.GenericRenderError,\r\n            title: error.name,\r\n            message: error.message,\r\n        });\r\n    }\r\n\r\n    public render() {\r\n        const platform = global && global.process ? global.process.platform : \"web\";\r\n\r\n        return (\r\n            <Fragment>\r\n                <ErrorHandler\r\n                    error={this.props.appError}\r\n                    onError={this.props.actions.showError}\r\n                    onClearError={this.props.actions.clearError} />\r\n                {/* Don't render app contents during a render error */}\r\n                {(!this.props.appError || this.props.appError.errorCode !== ErrorCode.GenericRenderError) &&\r\n                    <KeyboardManager>\r\n                        <BrowserRouter>\r\n                            <div className={`app-shell platform-${platform}`}>\r\n                                <TitleBar icon=\"TagGroup\">\r\n                                    <div className=\"app-help-menu-icon\"><HelpMenu/></div>\r\n                                </TitleBar>\r\n                                <div className=\"app-main\">\r\n                                    <Sidebar project={this.props.currentProject} />\r\n                                    <MainContentRouter />\r\n                                </div>\r\n                                <StatusBar>\r\n                                    <StatusBarMetrics project={this.props.currentProject} />\r\n                                </StatusBar>\r\n                                <ToastContainer className=\"frtt-toast-container\" role=\"alert\"/>\r\n                            </div>\r\n                        </BrowserRouter>\r\n                        <SkipButton skipTo=\"appSidebar\">{strings.common.skipToSidebar}</SkipButton>\r\n                    </KeyboardManager>\r\n                }\r\n            </Fragment>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Dispatch, Action } from \"redux\";\r\nimport { IAppError } from \"../../models/applicationState\";\r\nimport { createPayloadAction, IPayloadAction, createAction } from \"./actionCreators\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\n\r\n/**\r\n * Action to display alert when there's an error in the app\r\n * @member showError\r\n * @member clearError\r\n * @interface\r\n */\r\nexport default interface IAppErrorActions {\r\n    showError(appError: IAppError): void;\r\n    clearError(): void;\r\n}\r\n\r\n/**\r\n * show alert popup to indicate error\r\n * @param appError {IAppError} the error to display in alert\r\n * @returns {(dispatch: Dispatch) => void}\r\n */\r\nexport function showError(appError: IAppError): (dispatch: Dispatch) => void {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(showErrorAction(appError));\r\n    };\r\n}\r\n\r\n/**\r\n * clear alert popup\r\n * @returns {(dispatch: Dispatch) => void}\r\n */\r\nexport function clearError(): (dispatch: Dispatch) => void {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(clearErrorAction());\r\n    };\r\n}\r\n\r\n/**\r\n * Show error action type\r\n */\r\nexport interface IShowAppErrorAction extends IPayloadAction<string, IAppError> {\r\n    type: ActionTypes.SHOW_ERROR;\r\n}\r\n\r\n/**\r\n * Clear error action type\r\n */\r\nexport interface IClearErrorAction extends Action<string> {\r\n    type: ActionTypes.CLEAR_ERROR;\r\n}\r\n\r\n/**\r\n * Instance of show error action\r\n */\r\nexport const showErrorAction = createPayloadAction<IShowAppErrorAction>(ActionTypes.SHOW_ERROR);\r\n\r\n/**\r\n * Instance of clear error action\r\n * @type {() => Action<IClearErrorAction[\"type\"]>}\r\n */\r\nexport const clearErrorAction = createAction<IClearErrorAction>(ActionTypes.CLEAR_ERROR);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../common/strings\";\r\nimport \"./helpMenu.scss\";\r\n\r\nexport interface IHelpMenuProps {}\r\nexport interface IHelpMenuState {}\r\n\r\nexport class HelpMenu extends React.Component<IHelpMenuProps, IHelpMenuState> {\r\n\r\n    private akaMsLink = \"https://aka.ms/form-recognizer/docs/label\";\r\n\r\n    public render() {\r\n        return (\r\n            <a\r\n                className={\"help-menu-button\"}\r\n                title={strings.titleBar.help}\r\n                href={this.akaMsLink}\r\n                role=\"button\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\">\r\n                <FontIcon iconName=\"Help\" />\r\n            </a>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { appInfo } from \"../../../common/appInfo\";\r\nimport \"./statusBar.scss\";\r\n\r\nexport class StatusBar extends React.Component {\r\n    public render() {\r\n        return (\r\n            <div className=\"status-bar\">\r\n                <div className=\"status-bar-main\">{this.props.children}</div>\r\n                <div className=\"status-bar-version\">\r\n                    <ul>\r\n                        <li>\r\n                            <FontIcon iconName=\"BranchMerge\" />\r\n                            <span>{appInfo.version}</span>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport _ from \"lodash\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { IProject, AssetState } from \"../../../models/applicationState\";\r\nimport { strings, interpolate } from \"../../../common/strings\";\r\n\r\nexport interface IStatusBarMetricsProps {\r\n    project: IProject;\r\n}\r\n\r\nexport class StatusBarMetrics extends React.Component<IStatusBarMetricsProps> {\r\n    public render() {\r\n        const { project } = this.props;\r\n\r\n        if (!project) {\r\n            return null;\r\n        }\r\n\r\n        const projectAssets = _.values(project.assets);\r\n        const visitedAssets = projectAssets\r\n            .filter((asset) => asset.state === AssetState.Visited || asset.state === AssetState.Tagged);\r\n        const taggedAssets = projectAssets\r\n            .filter((asset) => asset.state === AssetState.Tagged);\r\n\r\n        return (\r\n            <ul>\r\n                <li title={strings.projectSettings.sourceConnection.title}>\r\n                    <FontIcon iconName=\"PlugConnected\" />\r\n                    <span className=\"metric-source-connection-name\">{project.sourceConnection.name}</span>\r\n                </li>\r\n                <li title={interpolate(strings.projectMetrics.taggedAssets, { count: taggedAssets.length })}>\r\n                    <FontIcon iconName=\"Tag\" />\r\n                    <span className=\"metric-tagged-asset-count\">{taggedAssets.length}</span>\r\n                </li>\r\n                <li title={interpolate(strings.projectMetrics.visitedAssets, { count: visitedAssets.length })}>\r\n                    <FontIcon iconName=\"View\" />\r\n                    <span className=\"metric-visited-asset-count\">{visitedAssets.length}</span>\r\n                </li>\r\n                <li title={`Total Assets (${projectAssets.length})`}>\r\n                    <FontIcon iconName=\"TextDocument\" />\r\n                    <span className=\"metric-asset-count\">{projectAssets.length}</span>\r\n                </li>\r\n            </ul>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { IApplicationState } from \"../../../models/applicationState\";\r\nimport { PlatformType } from \"../../../common/hostProcess\";\r\nimport \"./titleBar.scss\";\r\n\r\nexport interface ITitleBarProps extends React.Props<TitleBar> {\r\n    icon?: string | JSX.Element;\r\n    title?: string;\r\n}\r\n\r\nexport interface ITitleBarState {\r\n    platform: string;\r\n    maximized: boolean;\r\n    fullscreen: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        title: state.appTitle,\r\n    };\r\n}\r\n\r\n@connect(mapStateToProps, null)\r\nexport class TitleBar extends React.Component<ITitleBarProps, ITitleBarState> {\r\n    public state: ITitleBarState = {\r\n        platform: global && global.process && global.process.platform ? global.process.platform : PlatformType.Web,\r\n        maximized: false,\r\n        fullscreen: false,\r\n    };\r\n\r\n    public render() {\r\n        if (this.state.fullscreen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <div className=\"title-bar bg-lighter-3\">\r\n                {(this.state.platform === PlatformType.Web) &&\r\n                    <div className=\"title-bar-icon\">\r\n                        {typeof (this.props.icon) === \"string\" && <FontIcon iconName={this.props.icon} />}\r\n                        {typeof (this.props.icon) !== \"string\" && this.props.icon}\r\n                    </div>\r\n                }\r\n                <div className=\"title-bar-main\">{this.props.title || \"Welcome\"}</div>\r\n                <div className=\"title-bar-controls\">\r\n                    {this.props.children}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport class AzureBlobStorageError extends Error {\r\n    public statusCode: number;\r\n\r\n    constructor(statusCode: number) {\r\n        super();\r\n        this.statusCode = statusCode;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport shortid from \"shortid\";\r\nimport { StorageProviderFactory, IStorageProvider } from \"../providers/storage/storageProviderFactory\";\r\nimport {\r\n    IProject, ITag, ISecurityToken, AppError,\r\n    ErrorCode,\r\n    FieldType,\r\n    FieldFormat,\r\n    IField,\r\n    IFieldInfo,\r\n} from \"../models/applicationState\";\r\nimport Guard from \"../common/guard\";\r\nimport { constants } from \"../common/constants\";\r\nimport { decryptProject, encryptProject, joinPath, patch } from \"../common/utils\";\r\nimport packageJson from \"../../package.json\";\r\nimport { strings, interpolate } from \"../common/strings\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n// tslint:disable-next-line:no-var-requires\r\nconst tagColors = require(\"../react/components/common/tagColors.json\");\r\n\r\n/**\r\n * Functions required for a project service\r\n * @member save - Save a project\r\n * @member delete - Delete a project\r\n */\r\nexport interface IProjectService {\r\n    load(project: IProject, securityToken: ISecurityToken): Promise<IProject>;\r\n    save(project: IProject, securityToken: ISecurityToken): Promise<IProject>;\r\n    delete(project: IProject): Promise<void>;\r\n    isDuplicate(project: IProject, projectList: IProject[]): boolean;\r\n}\r\n\r\n/**\r\n * @name - Project Service\r\n * @description - Functions for dealing with projects\r\n */\r\nexport default class ProjectService implements IProjectService {\r\n    /**\r\n     * Loads a project\r\n     * @param project The project JSON to load\r\n     * @param securityToken The security token used to decrypt sensitive project settings\r\n     */\r\n    public async load(project: IProject, securityToken: ISecurityToken): Promise<IProject> {\r\n        Guard.null(project);\r\n\r\n        try {\r\n            const loadedProject = await decryptProject(project, securityToken);\r\n\r\n            // Ensure tags is always initialized to an array\r\n            if (!loadedProject.tags) {\r\n                loadedProject.tags = [];\r\n            }\r\n\r\n            return Promise.resolve({ ...loadedProject });\r\n        } catch (e) {\r\n            const error = new AppError(ErrorCode.ProjectInvalidSecurityToken, \"Error decrypting project settings\");\r\n            return Promise.reject(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save a project\r\n     * @param project - Project to save\r\n     * @param securityToken - Security Token to encrypt\r\n     */\r\n    public async save(project: IProject, securityToken: ISecurityToken): Promise<IProject> {\r\n        Guard.null(project);\r\n\r\n        project.version = packageJson.version;\r\n\r\n        if (!project.id) {\r\n            project.id = shortid.generate();\r\n        }\r\n\r\n        const storageProvider = StorageProviderFactory.createFromConnection(project.sourceConnection);\r\n\r\n        if (!project.tags) {\r\n            await this.getTagsFromPreExistingLabelFiles(project, storageProvider);\r\n            await this.getTagsFromPreExistingFieldFile(project, storageProvider);\r\n        }\r\n\r\n        if (project.tags) {\r\n            await this.saveFieldsFile(project, storageProvider);\r\n        }\r\n\r\n        // Ensure tags is always initialized to an array\r\n        if (!project.tags) {\r\n            project.tags = [];\r\n        }\r\n\r\n        project = await encryptProject(project, securityToken);\r\n\r\n        await storageProvider.writeText(\r\n            `${project.name}${constants.projectFileExtension}`,\r\n            JSON.stringify(project, null, 4),\r\n        );\r\n\r\n        return project;\r\n    }\r\n\r\n    /**\r\n     * Delete a project\r\n     * @param project - Project to delete\r\n     */\r\n    public async delete(project: IProject): Promise<void> {\r\n        Guard.null(project);\r\n\r\n        const storageProvider = StorageProviderFactory.createFromConnection(project.sourceConnection);\r\n\r\n        try {\r\n            // try deleting project file\r\n            await storageProvider.deleteFile(`${project.name}${constants.projectFileExtension}`);\r\n            toast.info(interpolate(strings.homePage.messages.deleteSuccess, { project }));\r\n        } catch (error) {\r\n            let reason = \"\";\r\n            if (error.errorCode === ErrorCode.BlobContainerIOForbidden) {\r\n                reason = interpolate(strings.errors.projectDeleteForbidden.message, { file: `${project.name}${constants.projectFileExtension}` });\r\n            } else if (error.errorCode === ErrorCode.BlobContainerIONotFound) {\r\n                reason = interpolate(strings.errors.projectDeleteNotFound.message, { file: `${project.name}${constants.projectFileExtension}` });\r\n            } else {\r\n                reason = strings.errors.projectDeleteError.message;\r\n            }\r\n            toast.error(reason, { autoClose: false });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks whether or not the project would cause a duplicate at the target connection\r\n     * @param project The project to validate\r\n     * @param projectList The list of known projects\r\n     */\r\n    public isDuplicate(project: IProject, projectList: IProject[]): boolean {\r\n        const duplicateProjects = projectList.find((p) =>\r\n            p.id !== project.id &&\r\n            p.name === project.name &&\r\n            JSON.stringify(p.sourceConnection.providerOptions) ===\r\n            JSON.stringify(project.sourceConnection.providerOptions),\r\n        );\r\n        return (duplicateProjects !== undefined);\r\n    }\r\n\r\n    public async isProjectNameAlreadyUsed(project: IProject): Promise<boolean> {\r\n        const storageProvider = StorageProviderFactory.createFromConnection(project.sourceConnection);\r\n        const fileList = await storageProvider.listFiles(null/*folderPath*/, constants.projectFileExtension/*ext*/);\r\n        for (const fileName of fileList) {\r\n            if (fileName === `${project.name}${constants.projectFileExtension}`) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Assign project tags.\r\n     * A new project doesn't have any tags at the beginning. But it could connect to a blob container\r\n     * which contains existing label files. In this case, we'll populate project tags based on these files.\r\n     * @param project the project we're trying to create\r\n     * @param storageProvider the storage we're trying to save the project to\r\n     */\r\n    private async getTagsFromPreExistingLabelFiles(project: IProject, storageProvider: IStorageProvider) {\r\n        const tags: ITag[] = [];\r\n        const tagNameSet = new Set<string>();\r\n        try {\r\n            const blobs = new Set<string>(await storageProvider.listFiles());\r\n            for (const blob of blobs) {\r\n                const blobFolderPath = blob.substr(0, blob.lastIndexOf(\"/\"));\r\n                if (blobFolderPath === project.folderPath\r\n                    && blob.endsWith(constants.labelFileExtension)\r\n                    && blobs.has(blob.substr(0, blob.length - constants.labelFileExtension.length))) {\r\n                    try {\r\n                        const content = JSON.parse(await storageProvider.readText(blob));\r\n                        content.labels.forEach((label) => tagNameSet.add(label.label));\r\n                    } catch (err) {\r\n                        // ignore err\r\n                    }\r\n                }\r\n            }\r\n            const tagNameArray = Array.from(tagNameSet);\r\n            if (tagNameArray.containsDuplicates((name) => name)) {\r\n                const reason = interpolate(\r\n                    strings.errors.duplicateFieldKeyInLabelsFile.message,\r\n                    { labelFileName: strings.projectService.existingLabelFiles });\r\n                toast.error(reason, { autoClose: false });\r\n                throw new Error(\"Invalid label file\");\r\n            }\r\n            tagNameArray.forEach((name, index) => {\r\n                tags.push({\r\n                    name,\r\n                    color: tagColors[index],\r\n                    // use default type\r\n                    type: FieldType.String,\r\n                    format: FieldFormat.NotSpecified,\r\n                } as ITag);\r\n            });\r\n            if (project.tags) {\r\n                project.tags = patch(tags, project.tags, \"name\", [\"color\"]);\r\n            } else {\r\n                project.tags = tags;\r\n            }\r\n        } catch (err) {\r\n            // ignore err\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Assign project tags\r\n     * A new project does not have any tags at the beginning. But it could connect to a blob container\r\n     * Which contains existing fields .json file. In this case, we'll populate project tags base on this file.\r\n     * @param project the project we're trying to create\r\n     * @param storageProvider the storage we're trying to save the project to\r\n     */\r\n\r\n    private async getTagsFromPreExistingFieldFile(project: IProject, storageProvider: IStorageProvider) {\r\n        const fieldFilePath = joinPath(\"/\", project.folderPath, constants.fieldsFileName);\r\n        try {\r\n            const json = await storageProvider.readText(fieldFilePath, true);\r\n            const fieldInfo = JSON.parse(json) as IFieldInfo;\r\n            const tags: ITag[] = [];\r\n            fieldInfo.fields.forEach((field, index) => {\r\n                tags.push({\r\n                    name: field.fieldKey,\r\n                    color: tagColors[index],\r\n                    type: field.fieldType,\r\n                    format: field.fieldFormat,\r\n                } as ITag);\r\n            });\r\n            if (project.tags) {\r\n                project.tags = patch(project.tags, tags, \"name\", [\"type\", \"format\"]);\r\n            } else {\r\n                project.tags = tags;\r\n            }\r\n            toast.dismiss();\r\n        } catch (err) {\r\n            if (err instanceof SyntaxError) {\r\n                const reason = interpolate(strings.errors.invalidJSONFormat.message, {fieldFilePath});\r\n                toast.error(reason, {autoClose: false});\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save fields.json\r\n     * @param project the project we're trying to create\r\n     * @param storageProvider the storage we're trying to save the project\r\n     */\r\n    private async saveFieldsFile(project: IProject, storageProvider: IStorageProvider) {\r\n        Guard.null(project);\r\n        Guard.null(project.tags);\r\n\r\n        const fieldInfo = {\r\n            fields: project.tags.map((tag) => ({\r\n                fieldKey: tag.name,\r\n                fieldType: tag.type ? tag.type : FieldType.String,\r\n                fieldFormat: tag.format ? tag.format : FieldFormat.NotSpecified,\r\n            } as IField)),\r\n        };\r\n\r\n        const fieldFilePath = joinPath(\"/\", project.folderPath, constants.fieldsFileName);\r\n        await storageProvider.writeText(fieldFilePath, JSON.stringify(fieldInfo, null, 4));\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Action, Dispatch } from \"redux\";\r\nimport ProjectService from \"../../services/projectService\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\nimport { AssetService } from \"../../services/assetService\";\r\nimport {\r\n    AppError,\r\n    ErrorCode,\r\n    IApplicationState,\r\n    IAsset,\r\n    IAssetMetadata,\r\n    IProject,\r\n    ITag,\r\n} from \"../../models/applicationState\";\r\nimport { createAction, createPayloadAction, IPayloadAction } from \"./actionCreators\";\r\nimport { appInfo } from \"../../common/appInfo\";\r\n\r\n/**\r\n * Actions to be performed in relation to projects\r\n */\r\nexport default interface IProjectActions {\r\n    loadProject(project: IProject): Promise<IProject>;\r\n    saveProject(project: IProject): Promise<IProject>;\r\n    deleteProject(project: IProject): Promise<void>;\r\n    closeProject(): void;\r\n    loadAssets(project: IProject): Promise<IAsset[]>;\r\n    loadAssetMetadata(project: IProject, asset: IAsset): Promise<IAssetMetadata>;\r\n    saveAssetMetadata(project: IProject, assetMetadata: IAssetMetadata): Promise<IAssetMetadata>;\r\n    updateProjectTag(project: IProject, oldTag: ITag, newTag: ITag): Promise<IAssetMetadata[]>;\r\n    deleteProjectTag(project: IProject, tagName): Promise<IAssetMetadata[]>;\r\n}\r\n\r\n/**\r\n * Dispatches Load Project action and resolves with IProject\r\n * @param project - Project to load\r\n */\r\nexport function loadProject(project: IProject):\r\n    (dispatch: Dispatch, getState: () => IApplicationState) => Promise<IProject> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        const appState = getState();\r\n        const projectService = new ProjectService();\r\n\r\n        // Lookup security token used to decrypt project settings\r\n        const projectToken = appState.appSettings.securityTokens\r\n            .find((securityToken) => securityToken.name === project.securityToken);\r\n\r\n        if (!projectToken) {\r\n            throw new AppError(ErrorCode.SecurityTokenNotFound, \"Security Token Not Found\");\r\n        }\r\n        const loadedProject = await projectService.load(project, projectToken);\r\n\r\n        dispatch(loadProjectAction(loadedProject));\r\n        return loadedProject;\r\n    };\r\n}\r\n\r\n/**\r\n * Dispatches Save Project action and resolves with IProject\r\n * @param project - Project to save\r\n */\r\nexport function saveProject(project: IProject)\r\n    : (dispatch: Dispatch, getState: () => IApplicationState) => Promise<IProject> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        const appState = getState();\r\n        const projectService = new ProjectService();\r\n\r\n        if (projectService.isDuplicate(project, appState.recentProjects)) {\r\n            throw new AppError(ErrorCode.ProjectDuplicateName, `Project with name '${project.name}\r\n                already exists with the same target connection '${project.sourceConnection.name}'`);\r\n        }\r\n\r\n        const projectToken = appState.appSettings.securityTokens\r\n            .find((securityToken) => securityToken.name === project.securityToken);\r\n\r\n        if (!projectToken) {\r\n            throw new AppError(ErrorCode.SecurityTokenNotFound, \"Security Token Not Found\");\r\n        }\r\n\r\n        const savedProject = await projectService.save(project, projectToken);\r\n        dispatch(saveProjectAction(savedProject));\r\n\r\n        // Reload project after save actions\r\n        await loadProject(savedProject)(dispatch, getState);\r\n\r\n        return savedProject;\r\n    };\r\n}\r\n\r\n/**\r\n * Dispatches Delete Project action and resolves with project\r\n * @param project - Project to delete\r\n */\r\nexport function deleteProject(project: IProject)\r\n    : (dispatch: Dispatch, getState: () => IApplicationState) => Promise<void> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        const appState = getState();\r\n        const projectService = new ProjectService();\r\n\r\n        // Lookup security token used to decrypt project settings\r\n        const projectToken = appState.appSettings.securityTokens\r\n            .find((securityToken) => securityToken.name === project.securityToken);\r\n\r\n        if (!projectToken) {\r\n            throw new AppError(ErrorCode.SecurityTokenNotFound, \"Security Token Not Found\");\r\n        }\r\n\r\n        const decryptedProject = await projectService.load(project, projectToken);\r\n\r\n        await projectService.delete(decryptedProject);\r\n        dispatch(deleteProjectAction(decryptedProject));\r\n    };\r\n}\r\n\r\n/**\r\n * Dispatches Close Project action\r\n */\r\nexport function closeProject(): (dispatch: Dispatch) => void {\r\n    return (dispatch: Dispatch): void => {\r\n        dispatch({ type: ActionTypes.CLOSE_PROJECT_SUCCESS });\r\n    };\r\n}\r\n\r\n/**\r\n * Gets assets from project, dispatches load assets action and returns assets\r\n * @param project - Project from which to load assets\r\n */\r\nexport function loadAssets(project: IProject): (dispatch: Dispatch) => Promise<IAsset[]> {\r\n    return async (dispatch: Dispatch) => {\r\n        const assetService = new AssetService(project);\r\n        const assets = await assetService.getAssets();\r\n        dispatch(loadProjectAssetsAction(assets));\r\n\r\n        return assets;\r\n    };\r\n}\r\n\r\n/**\r\n * Load metadata from asset within project\r\n * @param project - Project from which to load asset metadata\r\n * @param asset - Asset from which to load metadata\r\n */\r\nexport function loadAssetMetadata(project: IProject, asset: IAsset): (dispatch: Dispatch) => Promise<IAssetMetadata> {\r\n    return async (dispatch: Dispatch) => {\r\n        const assetService = new AssetService(project);\r\n        const assetMetadata = await assetService.getAssetMetadata(asset);\r\n        dispatch(loadAssetMetadataAction(assetMetadata));\r\n\r\n        return { ...assetMetadata };\r\n    };\r\n}\r\n\r\n/**\r\n * Save metadata from asset within project\r\n * @param project - Project from which to save asset metadata\r\n * @param assetMetadata - Metadata for asset within project\r\n */\r\nexport function saveAssetMetadata(\r\n    project: IProject,\r\n    assetMetadata: IAssetMetadata): (dispatch: Dispatch) => Promise<IAssetMetadata> {\r\n    const newAssetMetadata = { ...assetMetadata, version: appInfo.version };\r\n\r\n    return async (dispatch: Dispatch) => {\r\n        const assetService = new AssetService(project);\r\n        const savedMetadata = await assetService.save(newAssetMetadata);\r\n        dispatch(saveAssetMetadataAction(savedMetadata));\r\n\r\n        return { ...savedMetadata };\r\n    };\r\n}\r\n\r\n/**\r\n * Updates a project and all asset references from oldTagName to newTagName\r\n * @param project The project to update tags\r\n * @param oldTag The old tag\r\n * @param newTag The new tag\r\n */\r\nexport function updateProjectTag(project: IProject, oldTag: ITag, newTag: ITag)\r\n    : (dispatch: Dispatch, getState: () => IApplicationState) => Promise<IAssetMetadata[]> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        let assetUpdates: IAssetMetadata[] = [];\r\n\r\n        if (oldTag.name !== newTag.name) {\r\n            // Find tags to rename\r\n            const assetService = new AssetService(project);\r\n            assetUpdates = await assetService.renameTag(oldTag.name, newTag.name);\r\n\r\n            // Save updated assets\r\n            await assetUpdates.forEachAsync(async (assetMetadata) => {\r\n                await saveAssetMetadata(project, assetMetadata)(dispatch);\r\n            });\r\n    }\r\n\r\n        const currentProject = getState().currentProject;\r\n        const updatedProject = {\r\n            ...currentProject,\r\n            tags: project.tags.map((t) => (t.name === oldTag.name) ? { ...newTag } : t),\r\n        };\r\n\r\n        // Save updated project tags\r\n        await saveProject(updatedProject)(dispatch, getState);\r\n        dispatch(updateProjectTagAction(updatedProject));\r\n\r\n        return assetUpdates;\r\n    };\r\n}\r\n\r\n/**\r\n * Updates a project and all asset references from oldTagName to newTagName\r\n * @param project The project to delete tags\r\n * @param tagName The tag to delete\r\n */\r\nexport function deleteProjectTag(project: IProject, tagName)\r\n    : (dispatch: Dispatch, getState: () => IApplicationState) => Promise<IAssetMetadata[]> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        // Find tags to rename\r\n        const assetService = new AssetService(project);\r\n        const assetUpdates = await assetService.deleteTag(tagName);\r\n\r\n        // Save updated assets\r\n        await assetUpdates.forEachAsync(async (assetMetadata) => {\r\n            await saveAssetMetadata(project, assetMetadata)(dispatch);\r\n        });\r\n\r\n        const currentProject = getState().currentProject;\r\n        const updatedProject = {\r\n            ...currentProject,\r\n            tags: project.tags.filter((t) => t.name !== tagName),\r\n        };\r\n\r\n        // Save updated project tags\r\n        await saveProject(updatedProject)(dispatch, getState);\r\n        dispatch(deleteProjectTagAction(updatedProject));\r\n\r\n        return assetUpdates;\r\n    };\r\n}\r\n\r\n/**\r\n * Load project action type\r\n */\r\nexport interface ILoadProjectAction extends IPayloadAction<string, IProject> {\r\n    type: ActionTypes.LOAD_PROJECT_SUCCESS;\r\n}\r\n\r\n/**\r\n * Close project action type\r\n */\r\nexport interface ICloseProjectAction extends Action<string> {\r\n    type: ActionTypes.CLOSE_PROJECT_SUCCESS;\r\n}\r\n\r\n/**\r\n * Save project action type\r\n */\r\nexport interface ISaveProjectAction extends IPayloadAction<string, IProject> {\r\n    type: ActionTypes.SAVE_PROJECT_SUCCESS;\r\n}\r\n\r\n/**\r\n * Delete project action type\r\n */\r\nexport interface IDeleteProjectAction extends IPayloadAction<string, IProject> {\r\n    type: ActionTypes.DELETE_PROJECT_SUCCESS;\r\n}\r\n\r\n/**\r\n * Load project assets action type\r\n */\r\nexport interface ILoadProjectAssetsAction extends IPayloadAction<string, IAsset[]> {\r\n    type: ActionTypes.LOAD_PROJECT_ASSETS_SUCCESS;\r\n}\r\n\r\n/**\r\n * Load asset metadata action type\r\n */\r\nexport interface ILoadAssetMetadataAction extends IPayloadAction<string, IAssetMetadata> {\r\n    type: ActionTypes.LOAD_ASSET_METADATA_SUCCESS;\r\n}\r\n\r\n/**\r\n * Save asset metadata action type\r\n */\r\nexport interface ISaveAssetMetadataAction extends IPayloadAction<string, IAssetMetadata> {\r\n    type: ActionTypes.SAVE_ASSET_METADATA_SUCCESS;\r\n}\r\n\r\n/**\r\n * Update Project Tag action type\r\n */\r\nexport interface IUpdateProjectTagAction extends IPayloadAction<string, IProject> {\r\n    type: ActionTypes.UPDATE_PROJECT_TAG_SUCCESS;\r\n}\r\n\r\n/**\r\n * Delete project tag action type\r\n */\r\nexport interface IDeleteProjectTagAction extends IPayloadAction<string, IProject> {\r\n    type: ActionTypes.DELETE_PROJECT_TAG_SUCCESS;\r\n}\r\n\r\n/**\r\n * Instance of Load Project action\r\n */\r\nexport const loadProjectAction = createPayloadAction<ILoadProjectAction>(ActionTypes.LOAD_PROJECT_SUCCESS);\r\n/**\r\n * Instance of Close Project action\r\n */\r\nexport const closeProjectAction = createAction<ICloseProjectAction>(ActionTypes.CLOSE_PROJECT_SUCCESS);\r\n/**\r\n * Instance of Save Project action\r\n */\r\nexport const saveProjectAction = createPayloadAction<ISaveProjectAction>(ActionTypes.SAVE_PROJECT_SUCCESS);\r\n/**\r\n * Instance of Delete Project action\r\n */\r\nexport const deleteProjectAction = createPayloadAction<IDeleteProjectAction>(ActionTypes.DELETE_PROJECT_SUCCESS);\r\n/**\r\n * Instance of Load Project Assets action\r\n */\r\nexport const loadProjectAssetsAction =\r\n    createPayloadAction<ILoadProjectAssetsAction>(ActionTypes.LOAD_PROJECT_ASSETS_SUCCESS);\r\n/**\r\n * Instance of Load Asset Metadata action\r\n */\r\nexport const loadAssetMetadataAction =\r\n    createPayloadAction<ILoadAssetMetadataAction>(ActionTypes.LOAD_ASSET_METADATA_SUCCESS);\r\n/**\r\n * Instance of Save Asset Metadata action\r\n */\r\nexport const saveAssetMetadataAction =\r\n    createPayloadAction<ISaveAssetMetadataAction>(ActionTypes.SAVE_ASSET_METADATA_SUCCESS);\r\n/**\r\n * Instance of Update project tag action\r\n */\r\nexport const updateProjectTagAction =\r\n    createPayloadAction<IUpdateProjectTagAction>(ActionTypes.UPDATE_PROJECT_TAG_SUCCESS);\r\n/**\r\n * Instance of Delete project tag action\r\n */\r\nexport const deleteProjectTagAction =\r\n    createPayloadAction<IDeleteProjectTagAction>(ActionTypes.DELETE_PROJECT_TAG_SUCCESS);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Dispatch } from \"redux\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\nimport { createPayloadAction, IPayloadAction } from \"./actionCreators\";\r\nimport { IAppSettings } from \"../../models/applicationState\";\r\nimport { IProject, IApplicationState } from \"../../models/applicationState\";\r\nimport { generateKey } from \"../../common/crypto\";\r\n\r\n/**\r\n * Actions to make changes to application settings\r\n * @member toggleDevTools - Open or close dev tools\r\n * @member reloadApplication - Reload application\r\n */\r\nexport default interface IApplicationActions {\r\n    saveAppSettings(appSettings: IAppSettings): IAppSettings;\r\n    ensureSecurityToken(project: IProject): IAppSettings;\r\n}\r\n\r\n/**\r\n * Save app settings\r\n */\r\nexport function saveAppSettings(appSettings: IAppSettings): (dispatch: Dispatch) => Promise<IAppSettings> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(saveAppSettingsAction(appSettings));\r\n        return Promise.resolve(appSettings);\r\n    };\r\n}\r\n\r\n/**\r\n * Ensures that a valid security token is associated with the project, otherwise creates one\r\n * @param project The project to validate\r\n */\r\nexport function ensureSecurityToken(project: IProject):\r\n    (dispatch: Dispatch, getState: () => IApplicationState) => Promise<IAppSettings> {\r\n    return async (dispatch: Dispatch, getState: () => IApplicationState) => {\r\n        const appState = getState();\r\n        let securityToken = appState.appSettings.securityTokens\r\n            .find((st) => st.name === project.securityToken);\r\n\r\n        if (securityToken) {\r\n            return appState.appSettings;\r\n        }\r\n\r\n        // check if there's token with the same prefix\r\n        const tokenPrefix = `${project.name} Token`;\r\n        const tokenCountWithTheSamePrefix = appState.appSettings.securityTokens\r\n            .filter((st) => st.name.startsWith(tokenPrefix))\r\n            .length;\r\n\r\n        const tokenSuffix = tokenCountWithTheSamePrefix === 0 ? `` : ` [${tokenCountWithTheSamePrefix}]`;\r\n        securityToken = {\r\n            name: `${tokenPrefix}${tokenSuffix}`,\r\n            key: generateKey(),\r\n        };\r\n\r\n        const updatedAppSettings: IAppSettings = {\r\n            securityTokens: [...appState.appSettings.securityTokens, securityToken],\r\n        };\r\n\r\n        await this.saveAppSettings(updatedAppSettings);\r\n\r\n        project.securityToken = securityToken.name;\r\n        dispatch(ensureSecurityTokenAction(updatedAppSettings));\r\n        return updatedAppSettings;\r\n    };\r\n}\r\n\r\n/**\r\n * Save app settings action type\r\n */\r\nexport interface ISaveAppSettingsAction extends IPayloadAction<string, IAppSettings> {\r\n    type: ActionTypes.SAVE_APP_SETTINGS_SUCCESS;\r\n}\r\n\r\n/**\r\n * Ensure project security token action type\r\n */\r\nexport interface IEnsureSecurityTokenAction extends IPayloadAction<string, IAppSettings> {\r\n    type: ActionTypes.ENSURE_SECURITY_TOKEN_SUCCESS;\r\n}\r\n\r\n/**\r\n * Instance of save app settings action\r\n */\r\nexport const saveAppSettingsAction = createPayloadAction<ISaveAppSettingsAction>(ActionTypes.SAVE_APP_SETTINGS_SUCCESS);\r\n/**\r\n * Instance of Export Project action\r\n */\r\nexport const ensureSecurityTokenAction =\r\n    createPayloadAction<IEnsureSecurityTokenAction>(ActionTypes.ENSURE_SECURITY_TOKEN_SUCCESS);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Dispatch } from \"redux\";\r\nimport { createPayloadAction, IPayloadAction } from \"./actionCreators\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\n\r\n/**\r\n * Action to set app title\r\n * @member setTitle\r\n * @interface\r\n */\r\nexport default interface IAppTitleActions {\r\n    setTitle(title: string): void;\r\n}\r\n\r\n/**\r\n * set app title\r\n * @param title {string} the title of app\r\n * @returns {(dispatch: Dispatch) => void}\r\n */\r\nexport function setTitle(title: string): (dispatch: Dispatch) => void {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(setTitleAction(title));\r\n    };\r\n}\r\n\r\n/**\r\n * Set app title\r\n */\r\nexport interface ISetTitleAction extends IPayloadAction<string, string> {\r\n    type: ActionTypes.SET_TITLE;\r\n}\r\n\r\n/**\r\n * Instance of set title action\r\n */\r\nexport const setTitleAction = createPayloadAction<ISetTitleAction>(ActionTypes.SET_TITLE);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { SyntheticEvent } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { Spinner, SpinnerSize } from \"office-ui-fabric-react/lib/Spinner\";\r\nimport \"./condensedList.scss\";\r\n\r\n/**\r\n * Properties for Condensed List Component\r\n * @member title - Title of condensed list\r\n * @member items - Array of items to be rendered\r\n * @member newLinkTo - Link for list items\r\n * @member newLinkToTitle - Title of newLink\r\n * @member onClick - Function to call on clicking items\r\n * @member onDelete - Function to call on deleting items\r\n * @member Component - Component to be rendered for list items\r\n */\r\ninterface ICondensedListProps {\r\n    title: string;\r\n    Component: any;\r\n    items: any[];\r\n    newLinkTo?: string;\r\n    newLinkToTitle?: string;\r\n    onClick?: (item) => void;\r\n    onDelete?: (item) => void;\r\n}\r\n\r\n/**\r\n * @name - Condensed List\r\n * @description - Clickable, deletable and linkable list of items\r\n */\r\nexport default class CondensedList extends React.Component<ICondensedListProps> {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.onItemClick = this.onItemClick.bind(this);\r\n        this.onItemDelete = this.onItemDelete.bind(this);\r\n    }\r\n\r\n    public render() {\r\n        const { title, items, newLinkTo, newLinkToTitle, Component } = this.props;\r\n\r\n        return (\r\n            <div className=\"condensed-list\">\r\n                <div className=\"condensed-list-header bg-darker-2\">\r\n                    <span>{title}</span>\r\n                    {newLinkTo &&\r\n                        <Link to={newLinkTo} className=\"float-right add-button\" role=\"button\" title={newLinkToTitle}\r\n                            id=\"addConnection\">\r\n                            <FontIcon iconName=\"Add\" />\r\n                        </Link>\r\n                    }\r\n                </div>\r\n                <div className=\"condensed-list-body\">\r\n                    {(!items) &&\r\n                        <div className=\"p-3 text-center\">\r\n                            <Spinner size={SpinnerSize.small} />\r\n                        </div>\r\n                    }\r\n                    {(items && items.length === 0) &&\r\n                        <div className=\"p-3 text-center\">No items found</div>\r\n                    }\r\n                    {(items && items.length > 0) &&\r\n                        <ul className=\"condensed-list-items\">\r\n                            {items.map((item) => <Component key={item.id}\r\n                                item={item}\r\n                                onClick={(e) => this.onItemClick(e, item)}\r\n                                onDelete={(e) => this.onItemDelete(e, item)} />)}\r\n                        </ul>\r\n                    }\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private onItemClick = (e, item) => {\r\n        if (this.props.onClick) {\r\n            this.props.onClick(item);\r\n        }\r\n    }\r\n\r\n    private onItemDelete = (e: SyntheticEvent, item) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (this.props.onDelete) {\r\n            this.props.onDelete(item);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Generic list item with an onClick function and a name\r\n * @param param0 - {item: {name: \"\"}, onClick: (item) => void;}\r\n */\r\nexport function ListItem({ item, onClick }) {\r\n    return (\r\n        <li>\r\n            {/* eslint-disable-next-line */}\r\n            <a className=\"condensed-list-item\" onClick={onClick}>\r\n                <span className=\"px-2\">{item.name}</span>\r\n            </a>\r\n        </li>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { toast } from \"react-toastify\";\r\nimport { Button, Modal, ModalBody, ModalFooter, ModalHeader } from \"reactstrap\";\r\nimport { strings, interpolate } from \"../../../../common/strings\";\r\nimport { IConnection, StorageType, ErrorCode, AppError } from \"../../../../models/applicationState\";\r\nimport { StorageProviderFactory } from \"../../../../providers/storage/storageProviderFactory\";\r\nimport CondensedList, { ListItem } from \"../condensedList/condensedList\";\r\n\r\n/**\r\n * Properties for Cloud File Picker\r\n * @member connections - Array of connections to choose from\r\n * @member onSubmit - Function to call with contents of selected file\r\n * @member onCancel - Optional function to call on modal closed\r\n * @member fileExtension - Filter on files with extension\r\n */\r\nexport interface ICloudFilePickerProps {\r\n    connections: IConnection[];\r\n    onSubmit: (content: string) => void;\r\n\r\n    onCancel?: () => void;\r\n    fileExtension?: string;\r\n}\r\n\r\n/**\r\n * State for Cloud File Picker\r\n * @member isOpen - Cloud File Picker is open\r\n * @member modalHeader - Header for Picker modal\r\n * @member condensedList - List of rendered objects for picking\r\n * @member selectedConnection - Connection selected in picker\r\n * @member selectedFile - File selected in picker\r\n * @member okDisabled - Ok button is disabled\r\n * @member backDisabled - Back button is disabled\r\n */\r\nexport interface ICloudFilePickerState {\r\n    isOpen: boolean;\r\n    modalHeader: string;\r\n    condensedList: any;\r\n    selectedConnection: IConnection;\r\n    selectedFile: string;\r\n    okDisabled: boolean;\r\n    backDisabled: boolean;\r\n}\r\n\r\n/**\r\n * @name - Cloud File Picker\r\n * @description - Modal to choose and read file from cloud connections\r\n */\r\nexport class CloudFilePicker extends React.Component<ICloudFilePickerProps, ICloudFilePickerState> {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.open = this.open.bind(this);\r\n        this.close = this.close.bind(this);\r\n\r\n        this.getInitialState = this.getInitialState.bind(this);\r\n        this.ok = this.ok.bind(this);\r\n        this.back = this.back.bind(this);\r\n        this.connectionList = this.connectionList.bind(this);\r\n        this.onClickConnection = this.onClickConnection.bind(this);\r\n        this.fileList = this.fileList.bind(this);\r\n        this.onClickFile = this.onClickFile.bind(this);\r\n\r\n        this.state = this.getInitialState();\r\n    }\r\n\r\n    public render() {\r\n        const closeBtn = <button className=\"close\" onClick={this.close}>&times;</button>;\r\n\r\n        return(\r\n            <Modal isOpen={this.state.isOpen} centered={true}>\r\n                <ModalHeader toggle={this.close} close={closeBtn}>\r\n                    {this.state.modalHeader}\r\n                </ModalHeader>\r\n                <ModalBody>\r\n                    {this.state.condensedList}\r\n                </ModalBody>\r\n                <ModalFooter>\r\n                    {this.state.selectedFile || \"\"}\r\n                    <Button\r\n                        className=\"btn btn-success mr-1\"\r\n                        onClick={this.ok}\r\n                        disabled={this.state.okDisabled}>\r\n                        Ok\r\n                    </Button>\r\n                    {this.state.backDisabled ?\r\n                        <Button onClick={this.close}>Close</Button>\r\n                    :\r\n                        <Button onClick={this.back}>Go Back</Button>\r\n                    }\r\n                </ModalFooter>\r\n            </Modal>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Open Cloud File Picker\r\n     */\r\n    public open(): void {\r\n        this.setState({isOpen: true});\r\n    }\r\n\r\n    /**\r\n     * Close Cloud File Picker\r\n     */\r\n    public close(): void {\r\n        this.setState(this.getInitialState(),\r\n            () => {\r\n                if (this.props.onCancel) {\r\n                    this.props.onCancel();\r\n                }\r\n            },\r\n        );\r\n    }\r\n\r\n    private getInitialState(): ICloudFilePickerState {\r\n        return {\r\n            isOpen: false,\r\n            modalHeader: strings.homePage.openCloudProject.selectConnection,\r\n            condensedList: this.connectionList(),\r\n            selectedConnection: null,\r\n            selectedFile: null,\r\n            okDisabled: true,\r\n            backDisabled: true,\r\n        };\r\n    }\r\n\r\n    private async ok() {\r\n        if (this.state.selectedConnection && this.state.selectedFile) {\r\n            const storageProvider = StorageProviderFactory.createFromConnection(this.state.selectedConnection);\r\n            const content = await storageProvider.readText(this.state.selectedFile);\r\n            this.props.onSubmit(content);\r\n        }\r\n    }\r\n\r\n    private back() {\r\n        this.setState({\r\n            ...this.getInitialState(),\r\n            isOpen: true,\r\n        });\r\n    }\r\n\r\n    private getCondensedList(title: string, items: any[], onClick) {\r\n        return <CondensedList\r\n            title={title}\r\n            items={items}\r\n            Component={ListItem}\r\n            onClick={onClick}\r\n        />;\r\n    }\r\n\r\n    private isCloudConnection(connection: IConnection): boolean {\r\n        try {\r\n            const storageProvider = StorageProviderFactory.createFromConnection(connection);\r\n            return storageProvider.storageType === StorageType.Cloud;\r\n        } catch (e) {\r\n            // Catches connections that are not registered as StorageProviders (e.g. Bing Image search)\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private getCloudConnections(connections: IConnection[]): IConnection[] {\r\n        return connections.filter(this.isCloudConnection);\r\n    }\r\n\r\n    private connectionList() {\r\n        const connections = this.getCloudConnections(this.props.connections);\r\n        return this.getCondensedList(\"Cloud Connections\", connections, (args) => this.onClickConnection(args));\r\n    }\r\n\r\n    private async onClickConnection(args) {\r\n        const connection: IConnection = {\r\n            ...args,\r\n        };\r\n        try {\r\n            const fileList = await this.fileList(connection);\r\n            this.setState({\r\n                selectedConnection: connection,\r\n                modalHeader: `Select a file from \"${connection.name}\"`,\r\n                condensedList: fileList,\r\n                backDisabled: false,\r\n            });\r\n        } catch (err) {\r\n            if (err instanceof AppError && err.errorCode === ErrorCode.BlobContainerIONotFound) {\r\n                const reason = interpolate(strings.errors.blobContainerIONotFound.message, {});\r\n                toast.error(reason, { autoClose: false });\r\n                return;\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private async fileList(connection: IConnection) {\r\n        const storageProvider = StorageProviderFactory.createFromConnection(connection);\r\n        const files = await storageProvider.listFiles(\r\n            connection.providerOptions[\"containerName\"],\r\n            this.props.fileExtension);\r\n        const fileItems = [];\r\n        for (let i = 0; i < files.length; i++) {\r\n            fileItems.push({\r\n                id: `file-${i + 1}`,\r\n                name: files[i],\r\n            });\r\n        }\r\n        return this.getCondensedList(\r\n            `${this.props.fileExtension || \"All\"} Files in \"${connection.name}\"`,\r\n            fileItems,\r\n            this.onClickFile,\r\n        );\r\n    }\r\n\r\n    private onClickFile(args) {\r\n        const fileName = args.name;\r\n        this.setState({\r\n            selectedFile: fileName,\r\n            okDisabled: false,\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { ReactElement } from \"react\";\r\nimport {\r\n    Customizer,\r\n    Dialog,\r\n    DialogFooter,\r\n    DialogType,\r\n    ICustomizations,\r\n    ITheme,\r\n    PrimaryButton,\r\n    DefaultButton,\r\n} from \"office-ui-fabric-react\";\r\nimport { MessageFormatHandler } from \"../messageBox/messageBox\";\r\nimport { getDarkTheme } from \"../../../../common/themes\";\r\n\r\n/**\r\n * Properties for Confirm Component\r\n * @member confirmButtonText - Text displayed on 'Confirm' button. Default 'Yes'\r\n * @member cancelButtonText - Text displayed on 'Cancel' button. Default 'No'\r\n * @member confirmButtonTheme - Theme of 'Confirm' button. Default 'primary'\r\n * @member onConfirm - Function to call on confirm\r\n * @member onCancel - Function to call on cancel\r\n */\r\nexport interface IConfirmProps {\r\n    title?: string;\r\n    message: string | ReactElement<any> | MessageFormatHandler;\r\n    confirmButtonText?: string;\r\n    cancelButtonText?: string;\r\n    confirmButtonTheme?: ITheme;\r\n    onConfirm: (...params: any[]) => void;\r\n    onCancel?: (...params: any[]) => void;\r\n}\r\n\r\n/**\r\n * State for Confirm Component\r\n * @member params - Open ended parameters that are passed on opening modal\r\n */\r\nexport interface IConfirmState {\r\n    params: any[];\r\n    hideDialog: boolean;\r\n}\r\n\r\n/**\r\n * @name - Confirm\r\n * @description - Dialog for confirming an action\r\n */\r\nexport default class Confirm extends React.Component<IConfirmProps, IConfirmState> {\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            params: null,\r\n            hideDialog: true,\r\n        };\r\n\r\n        this.open = this.open.bind(this);\r\n        this.close = this.close.bind(this);\r\n        this.onConfirmClick = this.onConfirmClick.bind(this);\r\n        this.onCancelClick = this.onCancelClick.bind(this);\r\n    }\r\n\r\n    public render() {\r\n        const dark: ICustomizations = {\r\n            settings: {\r\n              theme: getDarkTheme(),\r\n            },\r\n            scopedSettings: {},\r\n        };\r\n        const { confirmButtonTheme } = this.props;\r\n        const { hideDialog } = this.state;\r\n\r\n        return (\r\n            <Customizer {...dark}>\r\n                {!hideDialog &&\r\n                    <Dialog\r\n                        hidden={hideDialog}\r\n                        onDismiss={this.close}\r\n                        dialogContentProps={{\r\n                            type: DialogType.normal,\r\n                            title: this.props.title,\r\n                            subText: this.getMessage(this.props.message),\r\n                        }}\r\n                        modalProps={{\r\n                            isBlocking: true,\r\n                        }}\r\n                    >\r\n                        <DialogFooter>\r\n                            <PrimaryButton\r\n                                theme={confirmButtonTheme}\r\n                                onClick={this.onConfirmClick}\r\n                                text={this.props.confirmButtonText || \"Yes\"} />\r\n                            <DefaultButton\r\n                                onClick={this.onCancelClick}\r\n                                text={this.props.cancelButtonText || \"No\"} />\r\n                        </DialogFooter>\r\n                    </Dialog>\r\n                }\r\n            </Customizer>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Open Confirm Dialog\r\n     * @param params - Array of parameters passed to onConfirm function\r\n     */\r\n    public open(...params: any[]): void {\r\n        this.setState({ params, hideDialog: false });\r\n    }\r\n\r\n    /**\r\n     * Close Confirm Dialog\r\n     */\r\n    public close(): void {\r\n        this.setState({ hideDialog: true });\r\n    }\r\n\r\n    private onConfirmClick() {\r\n        this.props.onConfirm.apply(null, this.state.params);\r\n        this.close();\r\n    }\r\n\r\n    private onCancelClick() {\r\n        if (this.props.onCancel) {\r\n            this.props.onCancel.apply(null, this.state.params);\r\n        }\r\n        this.close();\r\n    }\r\n\r\n    private getMessage = (message: string | MessageFormatHandler | ReactElement<any>) => {\r\n        if (typeof message === \"function\") {\r\n            return message.apply(this, this.state.params);\r\n        } else {\r\n            return message;\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon, IconButton } from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport \"../../../../App.scss\";\r\n\r\nexport default function RecentProjectItem({ item, onClick, onDelete }) {\r\n    return (\r\n        <li className=\"recent-project-item\">\r\n            {/* eslint-disable-next-line */}\r\n            <a className=\"condensed-list-item\" href=\"#\" onClick={onClick} aria-label={`${item.name} project`}>\r\n                <FontIcon iconName=\"OpenFolderHorizontal\" />\r\n                <span className=\"px-2 ms-Fabric\" style={{color: \"inherit\"}}>{item.name}</span>\r\n                <IconButton className=\"float-right app-delete-button\"\r\n                    title={strings.common.delete}\r\n                    onClick={onDelete}>\r\n                    <FontIcon iconName=\"Delete\" className=\"app-delete-icon\" />\r\n                </IconButton>\r\n            </a>\r\n        </li>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { SyntheticEvent } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { strings, interpolate } from \"../../../../common/strings\";\r\nimport { getPrimaryRedTheme } from \"../../../../common/themes\";\r\nimport IProjectActions, * as projectActions from \"../../../../redux/actions/projectActions\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport { CloudFilePicker } from \"../../common/cloudFilePicker/cloudFilePicker\";\r\nimport CondensedList from \"../../common/condensedList/condensedList\";\r\nimport Confirm from \"../../common/confirm/confirm\";\r\nimport \"./homePage.scss\";\r\nimport RecentProjectItem from \"./recentProjectItem\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport {\r\n    IApplicationState, IConnection, IProject,\r\n    ErrorCode, AppError, IAppSettings,\r\n} from \"../../../../models/applicationState\";\r\nimport { StorageProviderFactory } from \"../../../../providers/storage/storageProviderFactory\";\r\nimport { decryptProject } from \"../../../../common/utils\";\r\nimport { toast } from \"react-toastify\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\nexport interface IHomePageProps extends RouteComponentProps, React.Props<HomePage> {\r\n    recentProjects: IProject[];\r\n    connections: IConnection[];\r\n    actions: IProjectActions;\r\n    applicationActions: IApplicationActions;\r\n    appSettings: IAppSettings;\r\n    project: IProject;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\nexport interface IHomePageState {\r\n    cloudPickerOpen: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        recentProjects: state.recentProjects,\r\n        connections: state.connections,\r\n        appSettings: state.appSettings,\r\n        project: state.currentProject,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(projectActions, dispatch),\r\n        applicationActions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class HomePage extends React.Component<IHomePageProps, IHomePageState> {\r\n\r\n    public state: IHomePageState = {\r\n        cloudPickerOpen: false,\r\n    };\r\n\r\n    private newProjectRef = React.createRef<HTMLAnchorElement>();\r\n    private deleteConfirmRef = React.createRef<Confirm>();\r\n    private cloudFilePickerRef = React.createRef<CloudFilePicker>();\r\n\r\n    public async componentDidMount() {\r\n        this.props.appTitleActions.setTitle(\"Welcome\");\r\n        this.newProjectRef.current.focus();\r\n        document.title = strings.homePage.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public async componentDidUpdate() {\r\n        this.newProjectRef.current.focus();\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"app-homepage\" id=\"pageHome\">\r\n                <div className=\"app-homepage-main\">\r\n                    <ul>\r\n                        <li>\r\n                            {/* eslint-disable-next-line */}\r\n                            <a ref={this.newProjectRef}\r\n                                id=\"home_newProject\"\r\n                                href=\"#\" onClick={this.createNewProject} className=\"p-5 new-project\" role=\"button\">\r\n                                <FontIcon iconName=\"AddTo\" className=\"icon-9x\" />\r\n                                <div>{strings.homePage.newProject}</div>\r\n                            </a>\r\n                        </li>\r\n                        <li>\r\n                            {/*Open Cloud Project*/}\r\n                            {/* eslint-disable-next-line */}\r\n                            <a href=\"#\" onClick={this.handleOpenCloudProjectClick}\r\n                                className=\"p-5 cloud-open-project\" role=\"button\">\r\n                                <FontIcon iconName=\"Cloud\" className=\"icon-9x\" />\r\n                                <div>{strings.homePage.openCloudProject.title}</div>\r\n                            </a>\r\n                            <CloudFilePicker\r\n                                ref={this.cloudFilePickerRef}\r\n                                connections={this.props.connections}\r\n                                onSubmit={(content) => this.loadSelectedProject(JSON.parse(content))}\r\n                                fileExtension={constants.projectFileExtension}\r\n                            />\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                {(this.props.recentProjects && this.props.recentProjects.length > 0) &&\r\n                    <div className=\"app-homepage-recent bg-lighter-1\">\r\n                        <CondensedList\r\n                            title={strings.homePage.recentProjects}\r\n                            Component={RecentProjectItem}\r\n                            items={this.props.recentProjects}\r\n                            onClick={this.freshLoadSelectedProject}\r\n                            onDelete={(project) => this.deleteConfirmRef.current.open(project)} />\r\n                    </div>\r\n                }\r\n                <Confirm title=\"Delete Project\"\r\n                    ref={this.deleteConfirmRef as any}\r\n                    message={(project: IProject) => `${strings.homePage.deleteProject.confirmation} ${project.name}?`}\r\n                    confirmButtonTheme={getPrimaryRedTheme()}\r\n                    onConfirm={this.deleteProject} />\r\n                <SkipButton skipTo=\"pageHome\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private createNewProject = (e: SyntheticEvent) => {\r\n        this.props.actions.closeProject();\r\n        this.props.history.push(\"/projects/create\");\r\n\r\n        e.preventDefault();\r\n    }\r\n\r\n    private handleOpenCloudProjectClick = () => {\r\n        this.cloudFilePickerRef.current.open();\r\n    }\r\n\r\n    private loadSelectedProject = async (project: IProject) => {\r\n        await this.props.actions.loadProject(project);\r\n        this.props.history.push(`/projects/${project.id}/edit`);\r\n    }\r\n\r\n    private freshLoadSelectedProject = async (project: IProject) => {\r\n        // Lookup security token used to decrypt project settings\r\n        const projectToken = this.props.appSettings.securityTokens\r\n            .find((securityToken) => securityToken.name === project.securityToken);\r\n\r\n        if (!projectToken) {\r\n            throw new AppError(ErrorCode.SecurityTokenNotFound, \"Security Token Not Found\");\r\n        }\r\n\r\n        // Load project from storage provider to keep the project in latest state\r\n        const decryptedProject = await decryptProject(project, projectToken);\r\n        const storageProvider = StorageProviderFactory.createFromConnection(decryptedProject.sourceConnection);\r\n        try {\r\n            let projectStr: string;\r\n            try {\r\n                projectStr = await storageProvider.readText(\r\n                    `${decryptedProject.name}${constants.projectFileExtension}`);\r\n            } catch (err) {\r\n                if (err instanceof AppError && err.errorCode === ErrorCode.BlobContainerIONotFound) {\r\n                    // try old file extension\r\n                    projectStr = await storageProvider.readText(\r\n                        `${decryptedProject.name}${constants.projectFileExtensionOld}`);\r\n                } else {\r\n                    throw err;\r\n                }\r\n            }\r\n            const selectedProject = { ...JSON.parse(projectStr), sourceConnection: project.sourceConnection };\r\n            await this.loadSelectedProject(selectedProject);\r\n        } catch (err) {\r\n            if (err instanceof AppError && err.errorCode === ErrorCode.BlobContainerIONotFound) {\r\n                const reason = interpolate(strings.errors.projectNotFound.message, { file: `${project.name}${constants.projectFileExtension}`, container: project.sourceConnection.name });\r\n                toast.error(reason, { autoClose: false });\r\n                return;\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private deleteProject = async (project: IProject) => {\r\n        await this.props.actions.deleteProject(project);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { Fragment } from \"react\";\r\nimport { ObjectFieldTemplateProps } from \"react-jsonschema-form\";\r\n\r\nexport function ObjectFieldTemplate(props: ObjectFieldTemplateProps) {\r\n    return (\r\n        <Fragment>\r\n            {props.title}\r\n            {props.description}\r\n            {props.properties.map((item) => item.content)}\r\n        </Fragment>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nfunction backFillAriaLabelledBy(id: string) {\r\n    const element = document.getElementById(id);\r\n    if (element && !element.hasAttribute(\"aria-labelledby\")) {\r\n        const errorId = `${id}_errors`;\r\n        const errorElement = document.getElementById(errorId);\r\n        if (errorElement) {\r\n            const ariaAttrNode = document.createAttribute(\"aria-labelledby\");\r\n            ariaAttrNode.value = errorId;\r\n            element.setAttributeNode(ariaAttrNode);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getPropertiesIds(properties: any) {\r\n    const Ids: string[] = [];\r\n    Object.keys(properties).map((item) => Ids.push(`root_${item}`));\r\n    return Ids;\r\n}\r\n\r\nexport {backFillAriaLabelledBy, getPropertiesIds};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { Fragment, useEffect } from \"react\";\r\nimport { FieldTemplateProps } from \"react-jsonschema-form\";\r\nimport { backFillAriaLabelledBy } from \"../jsonSchemaFormHelper\";\r\n\r\nexport default function CustomFieldTemplate(props: FieldTemplateProps) {\r\n    const { id, label, required, description, rawErrors, schema, uiSchema, children } = props;\r\n    useEffect(() => {\r\n        backFillAriaLabelledBy(id);\r\n    });\r\n\r\n    const classNames = [];\r\n    if (props.schema.type === \"object\") {\r\n        classNames.push(\"object-wrapper\");\r\n    } else {\r\n        classNames.push(\"form-group\");\r\n    }\r\n\r\n    if (rawErrors && rawErrors.length > 0) {\r\n        classNames.push(\"is-invalid\");\r\n    } else {\r\n        classNames.push(\"is-valid\");\r\n    }\r\n\r\n    return (\r\n        <div className={classNames.join(\" \")}>\r\n            { /* Render label for non-objects except for when an object has defined a ui:field template */}\r\n            {schema.type !== \"array\" &&\r\n                (schema.type !== \"object\" || (schema.type === \"object\" && uiSchema[\"ui:field\"])) &&\r\n                <label htmlFor={id}>{label}{required ? \"*\" : null}</label>\r\n            }\r\n            {schema.type === \"array\" &&\r\n                <Fragment>\r\n                    <h4>{label}</h4>\r\n                    {description && <small>{description}</small>}\r\n                </Fragment>\r\n            }\r\n            {children}\r\n            {\r\n                schema.type !== \"array\" && description &&\r\n                <small className=\"text-muted\">\r\n                    {description}\r\n                </small>\r\n            }\r\n            {rawErrors && rawErrors.length > 0 &&\r\n                <div className=\"invalid-feedback\" id={id + \"_errors\"}>\r\n                    {rawErrors.map((errorMessage, idx) => <p key={idx}>{label} {errorMessage}</p>)}\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { ArrayFieldTemplateProps } from \"react-jsonschema-form\";\r\nimport { FontIcon, PrimaryButton } from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { getPrimaryBlueTheme, getPrimaryGreenTheme } from \"../../../../common/themes\";\r\n\r\nexport function ArrayFieldTemplate(props: ArrayFieldTemplateProps) {\r\n    const [focusFlag, setFocusFlag] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (focusFlag) {\r\n            document.getElementById(\"addSecurityToken\").focus();\r\n            setFocusFlag(false);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <div>\r\n            {props.canAdd &&\r\n                <div className=\"array-field-toolbar my-3\">\r\n                    <PrimaryButton\r\n                        theme={getPrimaryBlueTheme()}\r\n                        type=\"button\"\r\n                        className=\"\"\r\n                        id=\"addSecurityToken\"\r\n                        autoFocus={true}\r\n                        onClick={props.onAddClick}>\r\n                        <FontIcon iconName = \"AddTo\" className=\"mr-2\" />\r\n                        Add {props.schema.title}\r\n                    </PrimaryButton>\r\n                </div>\r\n            }\r\n            {props.items.map((item) => {\r\n                return <div className=\"form-row\" key={item.index}>\r\n                    {item.children}\r\n                    {item.hasRemove &&\r\n                        <div className=\"array-item-toolbar\">\r\n                            <label className=\"labelClose\">Delete</label>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreenTheme()}\r\n                                type=\"button\"\r\n                                className=\"flex-center\"\r\n                                onClick={item.onDropIndexClick(item.index)}\r\n                                onClickCapture={() => setFocusFlag(true)}>\r\n                                <FontIcon iconName=\"Delete\" className=\"mr-2\" />\r\n                                {strings.common.delete}\r\n                            </PrimaryButton>\r\n                        </div>\r\n                    }\r\n                </div>;\r\n            })}\r\n        </div>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon, DefaultButton } from \"office-ui-fabric-react\";\r\nimport { getPrimaryGreyTheme } from \"../../../../common/themes\";\r\n\r\n/**\r\n * Protected input properties\r\n * @member value - The value to bind to the component\r\n * @member securityToken - Optional value used to encrypt/decrypt the value\r\n */\r\nexport interface IProtectedInputProps extends React.Props<ProtectedInput> {\r\n    id: string;\r\n    value: string;\r\n    readOnly?: boolean;\r\n    onChange: (value: string) => void;\r\n}\r\n\r\n/** Protected input state\r\n * @member showKey - Whether or not the input field renders as text or password field type\r\n * @member decryptedValue - The decrypted value to bind to the input field\r\n */\r\nexport interface IProtectedInputState {\r\n    showKey: boolean;\r\n    value: string;\r\n}\r\n\r\n/**\r\n * Protected input Component\r\n * @description - Used for sensitive fields such as passwords, keys, tokens, etc\r\n */\r\nexport class ProtectedInput extends React.Component<IProtectedInputProps, IProtectedInputState> {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            showKey: false,\r\n            value: this.props.value || \"\",\r\n        };\r\n\r\n        this.toggleKeyVisibility = this.toggleKeyVisibility.bind(this);\r\n        this.copyKey = this.copyKey.bind(this);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    public componentDidMount() {\r\n        this.props.onChange(this.props.value);\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: IProtectedInputProps) {\r\n        if (prevProps.value !== this.props.value) {\r\n            this.setState({ value: this.props.value || \"\" });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { id, readOnly } = this.props;\r\n        const { showKey, value } = this.state;\r\n\r\n        return (\r\n            <div className=\"input-group\">\r\n                <input id={id}\r\n                    type={showKey ? \"text\" : \"password\"}\r\n                    readOnly={readOnly}\r\n                    required\r\n                    autoComplete=\"new-password\"\r\n                    className=\"form-control\"\r\n                    value={value}\r\n                    onChange={this.onChange} />\r\n                <div className=\"input-group-append\">\r\n                    <DefaultButton\r\n                        className=\"portected-input-margin\"\r\n                        theme={getPrimaryGreyTheme()}\r\n                        type=\"button\"\r\n                        title={showKey ? \"Hide\" : \"Show\"}\r\n                        onClick={this.toggleKeyVisibility}>\r\n                        <FontIcon iconName={showKey ? \"Hide3\" : \"View\"}/>\r\n                    </DefaultButton>\r\n                    <DefaultButton\r\n                        theme={getPrimaryGreyTheme()}\r\n                        type=\"button\"\r\n                        title=\"Copy\"\r\n                        onClick={this.copyKey}>\r\n                        <FontIcon iconName=\"Copy\" />\r\n                    </DefaultButton>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private onChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n        this.setState({ value: e.target.value }, () => this.props.onChange(this.state.value));\r\n    }\r\n\r\n    private toggleKeyVisibility() {\r\n        this.setState({\r\n            showKey: !this.state.showKey,\r\n        });\r\n    }\r\n\r\n    private async copyKey() {\r\n        const clipboard = (navigator as any).clipboard;\r\n        if (clipboard && clipboard.writeText && typeof clipboard.writeText === \"function\") {\r\n            await clipboard.writeText(this.state.value);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FieldProps, WidgetProps } from \"react-jsonschema-form\";\r\nimport Guard from \"../../../../common/guard\";\r\n\r\n/**\r\n * Custom field for react-jsonschema-form\r\n * @param Widget UI Widget for form\r\n * @param mapProps Function mapping props to an object\r\n */\r\nexport function CustomField<Props = {}>(Widget: any, mapProps?: (props: FieldProps) => Props) {\r\n    Guard.null(Widget);\r\n\r\n    return function render(props: FieldProps) {\r\n        const widgetProps = mapProps ? mapProps(props) : props;\r\n        return (<Widget {...widgetProps} />);\r\n    };\r\n}\r\n\r\n/**\r\n * Custom widget for react-jsonschema-form\r\n * @param Widget UI Widget for form\r\n * @param mapProps Function mapping component props to form widget props\r\n */\r\nexport function CustomWidget<Props = {}>(Widget: any, mapProps?: (props: WidgetProps) => Props) {\r\n    Guard.null(Widget);\r\n\r\n    return function render(props: WidgetProps) {\r\n        const widgetProps = mapProps ? mapProps(props) : props;\r\n        return (<Widget {...widgetProps} />);\r\n    };\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { strings, addLocValues } from \"../../../../common/strings\";\r\nimport Form, { FormValidation } from \"react-jsonschema-form\";\r\nimport { ObjectFieldTemplate } from \"../../common/objectField/objectFieldTemplate\";\r\nimport CustomFieldTemplate from \"../../common/customField/customFieldTemplate\";\r\nimport { ArrayFieldTemplate } from \"../../common/arrayField/arrayFieldTemplate\";\r\nimport { IAppSettings } from \"../../../../models/applicationState\";\r\nimport { ProtectedInput } from \"../../common/protectedInput/protectedInput\";\r\nimport { CustomField } from \"../../common/customField/customField\";\r\nimport { generateKey } from \"../../../../common/crypto\";\r\nimport { PrimaryButton } from \"office-ui-fabric-react\";\r\nimport { getPrimaryGreenTheme, getPrimaryGreyTheme } from \"../../../../common/themes\";\r\n// tslint:disable-next-line:no-var-requires\r\nconst formSchema = addLocValues(require(\"./appSettingsForm.json\"));\r\n// tslint:disable-next-line:no-var-requires\r\nconst uiSchema = addLocValues(require(\"./appSettingsForm.ui.json\"));\r\n\r\nexport interface IAppSettingsFormProps extends React.Props<AppSettingsForm> {\r\n    appSettings: IAppSettings;\r\n    onSubmit: (appSettings: IAppSettings) => void;\r\n    onCancel?: () => void;\r\n}\r\n\r\nexport interface IAppSettingsFormState {\r\n    classNames: string[];\r\n    formSchema: any;\r\n    uiSchema: any;\r\n    appSettings: IAppSettings;\r\n}\r\n\r\nexport class AppSettingsForm extends React.Component<IAppSettingsFormProps, IAppSettingsFormState> {\r\n    private fields = {\r\n        securityToken: CustomField(ProtectedInput, (props) => ({\r\n            id: props.idSchema.$id,\r\n            value: props.formData || generateKey(),\r\n            onChange: props.onChange,\r\n        })),\r\n    };\r\n\r\n    constructor(props: IAppSettingsFormProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            formSchema: { ...formSchema },\r\n            uiSchema: { ...uiSchema },\r\n            appSettings: { ...this.props.appSettings },\r\n            classNames: [\"needs-validation\"],\r\n        };\r\n\r\n        this.onFormValidate = this.onFormValidate.bind(this);\r\n        this.onFormCancel = this.onFormCancel.bind(this);\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: IAppSettingsFormProps) {\r\n        if (prevProps.appSettings !== this.props.appSettings) {\r\n            this.setState({\r\n                appSettings: { ...this.props.appSettings },\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"app-settings-page-form p-3\">\r\n                <h3 className=\"mb-3 flex-center\">\r\n                    <FontIcon iconName=\"Settings\" />\r\n                    <span className=\"px-2\">{strings.appSettings.title}</span>\r\n                </h3>\r\n                <div className=\"m-3\">\r\n                    <Form\r\n                        className={this.state.classNames.join(\" \")}\r\n                        showErrorList={false}\r\n                        liveValidate={true}\r\n                        noHtml5Validate={true}\r\n                        fields={this.fields}\r\n                        ObjectFieldTemplate={ObjectFieldTemplate}\r\n                        FieldTemplate={CustomFieldTemplate}\r\n                        ArrayFieldTemplate={ArrayFieldTemplate}\r\n                        validate={this.onFormValidate}\r\n                        schema={this.state.formSchema}\r\n                        uiSchema={this.state.uiSchema}\r\n                        formData={this.state.appSettings}\r\n                        onSubmit={(form) => this.props.onSubmit(form.formData)}>\r\n                        <div>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreenTheme()}\r\n                                className=\"mr-2\"\r\n                                type=\"submit\">\r\n                                {strings.appSettings.save}\r\n                            </PrimaryButton>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreyTheme()}\r\n                                type=\"button\"\r\n                                onClick={this.onFormCancel}>\r\n                                {strings.common.cancel}\r\n                            </PrimaryButton>\r\n                        </div>\r\n                    </Form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private onFormValidate(appSettings: IAppSettings, errors: FormValidation) {\r\n        if (this.state.classNames.indexOf(\"was-validated\") === -1) {\r\n            this.setState({\r\n                classNames: [...this.state.classNames, \"was-validated\"],\r\n            });\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    private onFormCancel() {\r\n        if (this.props.onCancel) {\r\n            this.props.onCancel();\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport { IApplicationState, IAppSettings } from \"../../../../models/applicationState\";\r\nimport \"./appSettingsPage.scss\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { AppSettingsForm } from \"./appSettingsForm\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\n/**\r\n * Props for App Settings Page\r\n * @member appSettings - Current Application settings\r\n * @member connections - Application connections\r\n * @member actions - Application actions\r\n * @member appTitleActions - Application Title actions\r\n */\r\nexport interface IAppSettingsProps extends RouteComponentProps, React.Props<AppSettingsPage> {\r\n    appSettings: IAppSettings;\r\n    actions: IApplicationActions;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\n/**\r\n * State for App Settings Page\r\n * @member formSchema - JSON Form Schema for page\r\n * @member uiSchema - JSON Form UI Schema for page\r\n * @member appSettings - Application settings\r\n */\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        appSettings: state.appSettings,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n/**\r\n * Page for viewing and editing application settings\r\n */\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class AppSettingsPage extends React.Component<IAppSettingsProps> {\r\n    constructor(props: IAppSettingsProps) {\r\n        super(props);\r\n\r\n        this.onFormSubmit = this.onFormSubmit.bind(this);\r\n        this.onFormCancel = this.onFormCancel.bind(this);\r\n    }\r\n\r\n    public async componentDidMount() {\r\n        this.props.appTitleActions.setTitle(strings.appSettings.title);\r\n        document.title = strings.appSettings.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"app-settings-page\" id=\"pageAppSettings\">\r\n                <AppSettingsForm\r\n                    appSettings={this.props.appSettings}\r\n                    onSubmit={this.onFormSubmit}\r\n                    onCancel={this.onFormCancel} />\r\n                <SkipButton skipTo=\"pageAppSettings\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private async onFormSubmit(appSettings: IAppSettings) {\r\n        await this.props.actions.saveAppSettings(appSettings);\r\n        toast.success(strings.appSettings.messages.saveSuccess);\r\n        this.props.history.goBack();\r\n    }\r\n\r\n    private onFormCancel() {\r\n        this.props.history.goBack();\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport Chart from \"chart.js\";\r\nimport { ITag } from \"../../../../models/applicationState\";\r\n\r\nexport interface ITrainChartProps {\r\n    accuracies: object;\r\n    modelId: string;\r\n    projectTags: ITag[];\r\n}\r\n\r\nexport interface ITrainChartState {}\r\n\r\n// Use PureComponent instead of Component to avoid re-rendering if Props are same\r\nexport default class TrainChart\r\n    extends React.PureComponent<ITrainChartProps, ITrainChartState> {\r\n\r\n    private chartRef: React.RefObject<HTMLCanvasElement> = React.createRef();\r\n    private chart;\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"train-chart-container\">\r\n            <canvas ref={this.chartRef} id=\"chart-canvas\" className=\"train-chart\"></canvas>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public componentDidMount = (): void => {\r\n        this.chart = this.newChart();\r\n    }\r\n\r\n    public componentDidUpdate = (): void => {\r\n        this.chart = this.newChart();\r\n    }\r\n\r\n    private newChart = (): Chart => {\r\n        return new Chart(this.chartRef.current, {\r\n            type: \"horizontalBar\",\r\n            data: this.chartData(),\r\n            options: this.chartOptions(),\r\n        });\r\n    }\r\n\r\n    private chartData = (): object => {\r\n        return {\r\n            labels: this.getLabels(),\r\n            datasets: [{\r\n                data: this.getData(),\r\n                backgroundColor: this.getColor(),\r\n            }],\r\n        };\r\n    }\r\n\r\n    private getLabels = (): string[] => {\r\n        return Object\r\n            .entries(this.props.accuracies)\r\n            .map((entry) =>\r\n                entry[0] + \" (\" + this.toPercent(entry[1]) + \"%)\");\r\n    }\r\n\r\n    private getData = (): string[] => {\r\n        return Object\r\n            .values(this.props.accuracies)\r\n            .map((val) => (val * 100).toFixed(2));\r\n    }\r\n\r\n    private getColor = (): string[] => {\r\n        return Object.keys(this.props.accuracies)\r\n            .map((label) => {\r\n                const tag = this.props.projectTags\r\n                    .find((tag) => label === tag.name);\r\n                return tag ? tag.color : \"#eeeeee\";\r\n            });\r\n    }\r\n\r\n    private chartOptions = (): object => {\r\n        return {\r\n            maintainAspectRatio: false,\r\n            legend: {\r\n                display: false,\r\n            },\r\n            title: {\r\n                display: true,\r\n                text: \"Accuracy (%)\",\r\n            },\r\n            scales: {\r\n                xAxes: [{\r\n                    ticks: {\r\n                        beginAtZero: true,\r\n                    },\r\n                }],\r\n                yAxes: [{\r\n                    barThickness: 6,\r\n                }],\r\n            },\r\n            animation: {\r\n                easing: \"easeInOutCubic\",\r\n            },\r\n            layout: {\r\n                padding: 20,\r\n            },\r\n        };\r\n    }\r\n\r\n    private toPercent(num: number): string {\r\n        return (num * 100).toFixed(2);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\n\r\nexport interface ITrainRecordProps {\r\n    accuracies?: object;\r\n    averageAccuracy: number;\r\n    modelInfo: {\r\n        modelId: string;\r\n        createdDateTime: string;\r\n    };\r\n}\r\n\r\nexport interface ITrainRecordState {}\r\n\r\nexport default class TrainRecord extends React.Component<ITrainRecordProps, ITrainRecordState> {\r\n    public render() {\r\n        return (\r\n            <aside className=\"mt-3\">\r\n                <h5> Model information </h5>\r\n                <div>\r\n                    <h6> Model ID </h6>\r\n                    <p>\r\n                        {this.props.modelInfo.modelId}\r\n                    </p>\r\n                    <h6> Created date and time</h6>\r\n                    <p>\r\n                        {new Date(this.props.modelInfo.createdDateTime).toLocaleString()}\r\n                    </p>\r\n                    <h6> Average accuracy </h6>\r\n                    <p>\r\n                        {(this.props.averageAccuracy * 100).toFixed(2) + \"%\"}\r\n                    </p>\r\n                    <div className=\"accuracy-info\">\r\n                        <a href=\"https://aka.ms/form-recognizer/docs/train\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                            <FontIcon iconName=\"Info\" />\r\n                            <span>Learn more about improving model accuracy.</span>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { FontIcon, PrimaryButton } from \"office-ui-fabric-react\";\r\nimport TrainRecord, { ITrainRecordProps } from \"./trainRecord\";\r\nimport { getPrimaryGreyTheme } from \"../../../../common/themes\";\r\n\r\nexport interface ITrainPanelProps {\r\n    currTrainRecord: ITrainRecordProps;\r\n    updateViewTypeCallback: (viewType: \"tableView\" | \"chartView\") => void;\r\n    viewType: \"chartView\" | \"tableView\";\r\n}\r\n\r\nexport interface ITrainPanelState {}\r\n\r\nexport default class TrainPanel\r\n    extends React.Component<ITrainPanelProps, ITrainPanelState> {\r\n\r\n    public render() {\r\n        const currTrainRecord = this.props.currTrainRecord;\r\n\r\n        return (\r\n            <div className=\"m-3\">\r\n            <h4> Training record </h4>\r\n            <PrimaryButton\r\n                theme={getPrimaryGreyTheme()}\r\n                className=\"mt-3 d-none\">\r\n                <FontIcon iconName=\"Download\" className=\"mr-2\" />\r\n                Download model zip\r\n            </PrimaryButton>\r\n            {currTrainRecord &&\r\n                <TrainRecord\r\n                    averageAccuracy={currTrainRecord.averageAccuracy}\r\n                    modelInfo={currTrainRecord.modelInfo} />\r\n            }\r\n        </div>\r\n        );\r\n    }\r\n\r\n    private renderButton = (vt: \"tableView\" | \"chartView\", faClass: string) => {\r\n        const active: boolean = this.props.viewType === vt;\r\n\r\n        return (\r\n                <button\r\n                className={\"btn btn-light \" + (active ? \"active\" : \"\")}\r\n                aria-pressed={active}\r\n                onClick={() => this.props.updateViewTypeCallback(vt)}>\r\n                    <i className={\"fas \" + faClass}></i>\r\n                </button>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\n\r\nexport interface ITrainTableProps {\r\n    trainMessage: string;\r\n    accuracies: object;\r\n}\r\n\r\nexport interface ITrainTableState {}\r\n\r\nexport default class TrainTable\r\n    extends React.Component<ITrainTableProps, ITrainTableState> {\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"train-accuracytable-container\">\r\n                {!this.props.accuracies && <table className=\"accuracytable\">\r\n                    <tbody>\r\n                        <tr>\r\n                            <th> Train Message </th>\r\n                            <td> {this.props.trainMessage} </td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>}\r\n                {this.props.accuracies &&\r\n                    <table className=\"accuracytable table-sm\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <th>\r\n                                    Tag\r\n                                </th>\r\n                                <th className=\"text-right\">\r\n                                    Estimated Accuracy\r\n                                </th>\r\n                            </tr>\r\n                            {\r\n                                Object.entries(this.props.accuracies).map((entry) =>\r\n                                    <tr key={entry[0]}>\r\n                                        <td>{entry[0]}</td>\r\n                                        <td className=\"text-right\">{(entry[1] * 100).toFixed(2) + \"%\"}</td>\r\n                                    </tr>)\r\n                            }\r\n                        </tbody>\r\n                    </table>\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { Prompt } from \"react-router-dom\";\r\n\r\nexport interface IPreventLeavingProps {\r\n    when?: boolean;\r\n    message: string;\r\n}\r\n\r\nexport default class PreventLeaving extends React.Component<IPreventLeavingProps> {\r\n    public async componentDidMount() {\r\n        window.addEventListener(\"beforeunload\", this.onBeforeUnload);\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        window.removeEventListener(\"beforeunload\", this.onBeforeUnload);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <Prompt when={!!this.props.when} message={this.props.message} />\r\n        );\r\n    }\r\n\r\n    private onBeforeUnload = (ev: BeforeUnloadEvent) => {\r\n        if (this.props.when) {\r\n            // Most browsers don't support custom text anymore.\r\n            // Safari requires a non-empty string.\r\n            const msg = this.props.message || \"Are you sure you want to leave this page?\";\r\n            ev.returnValue = msg;\r\n            return msg;\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { constants } from \"../common/constants\";\r\nimport { AppError, ErrorCode } from \"../models/applicationState\";\r\nimport { delay } from \"../common/utils\";\r\nimport axios, { AxiosRequestConfig, AxiosPromise } from \"axios\";\r\nimport { strings } from \"../common/strings\";\r\n\r\nexport default class ServiceHelper {\r\n    public static handleServiceError = (err: any) => {\r\n        if (err && err.response) {\r\n            if (err.response.status === 401) {\r\n                const message = (err.response.data && err.response.data.error && err.response.data.error.message) || \"Please make sure the API key is correct.\";\r\n                throw new AppError(ErrorCode.HttpStatusUnauthorized, message, \"Permission Denied\");\r\n            } else if (err.response.status === 404) {\r\n                throw new AppError(\r\n                    ErrorCode.HttpStatusNotFound,\r\n                    \"Please make sure the service endpoint is correct.\",\r\n                    \"Endpoint not found\");\r\n            } else if (err.response.status === 429) {\r\n                const response = err.response;\r\n                let errorCode = ErrorCode.Unknown;\r\n                let errorMessage = \"\";\r\n                let errorTitle = \"\";\r\n                if (response.data && response.data.error && response.data.error.code === \"1014\") {\r\n                    errorCode = ErrorCode.ModelCountLimitExceeded;\r\n                    errorMessage = strings.errors.modelCountLimitExceeded.message;\r\n                    errorTitle = strings.errors.modelCountLimitExceeded.title;\r\n                } else {\r\n                    errorCode = ErrorCode.HttpStatusTooManyRequests;\r\n                    errorMessage = strings.errors.tooManyRequests.message;\r\n                    errorTitle = strings.errors.tooManyRequests.title;\r\n                }\r\n                throw new AppError(errorCode, errorMessage, errorTitle);\r\n            } else if (err.response.data && err.response.data.error && err.response.data.error.code === \"1001\") {\r\n                throw new AppError(\r\n                    ErrorCode.ModelNotFound,\r\n                    err.response.data.error.message);\r\n            } else if (err.response.data && err.response.data.error && err.response.data.error.message) {\r\n                throw new AppError(\r\n                    ErrorCode.Unknown,\r\n                    err.response.data.error.message);\r\n            } else {\r\n                throw new AppError(\r\n                    ErrorCode.Unknown,\r\n                    \"An error occurred in the service. Please try again later.\",\r\n                    \"Error\");\r\n            }\r\n        } else {\r\n            // Network Error\r\n            throw new AppError(\r\n                ErrorCode.HttpStatusNotFound,\r\n                \"Cannot resolve the host name. Please make sure the service endpoint is correct.\",\r\n                \"Endpoint not found\");\r\n        }\r\n    }\r\n\r\n    public static postWithAutoRetry = <T>(\r\n        url: string,\r\n        data?: any,\r\n        config?: AxiosRequestConfig,\r\n        apiKey?: string,\r\n    ): AxiosPromise<T> =>\r\n        ServiceHelper.sendRequestWithAutoRetry(() => axios.post(url, data, ServiceHelper.applyApiKey(config, apiKey)))\r\n\r\n    public static getWithAutoRetry = <T = any>(\r\n        url: string,\r\n        config?: AxiosRequestConfig,\r\n        apiKey?: string,\r\n    ): AxiosPromise<T> =>\r\n        ServiceHelper.sendRequestWithAutoRetry(() => axios.get(url, ServiceHelper.applyApiKey(config, apiKey)))\r\n\r\n    private static applyApiKey = (config?: AxiosRequestConfig, apiKey?: string) => ({\r\n        ...config,\r\n        headers: {\r\n            ...config.headers,\r\n            ...(apiKey ? { [constants.apiKeyHeader]: apiKey } : {}),\r\n        },\r\n    })\r\n\r\n    private static sendRequestWithAutoRetry = async <T>(request: () => AxiosPromise<T>) => {\r\n        let currentRetry = 0;\r\n        while (true) {\r\n            try {\r\n                return await request();\r\n            } catch (err) {\r\n                currentRetry++;\r\n                if (currentRetry > constants.maxRetry || !ServiceHelper.isTransient(err)) {\r\n                    throw err;\r\n                }\r\n\r\n                await delay(constants.initialRetryInterval * Math.pow(2, currentRetry - 1));\r\n            }\r\n        }\r\n    }\r\n\r\n    private static isTransient = (err) => {\r\n        if (err && err.response) {\r\n            const response = err.response;\r\n            if (response.status === 429\r\n                && response.data\r\n                && response.data.error\r\n                && response.data.error.code === \"1014\") {\r\n                return false;\r\n            }\r\n            return [408, 429, 444, 500, 503, 504].includes(err.response.status);\r\n        }\r\n        return false;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { FontIcon, PrimaryButton, Spinner, SpinnerSize} from \"office-ui-fabric-react\";\r\nimport IProjectActions, * as projectActions from \"../../../../redux/actions/projectActions\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport {\r\n    IApplicationState, IConnection, IProject, IAppSettings,\r\n} from \"../../../../models/applicationState\";\r\nimport TrainChart from \"./trainChart\";\r\nimport TrainPanel from \"./trainPanel\";\r\nimport TrainTable from \"./trainTable\";\r\nimport { ITrainRecordProps } from \"./trainRecord\";\r\nimport \"./trainPage.scss\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport _ from \"lodash\";\r\nimport Alert from \"../../common/alert/alert\";\r\nimport url from \"url\";\r\nimport PreventLeaving from \"../../common/preventLeaving/preventLeaving\";\r\nimport ServiceHelper from \"../../../../services/serviceHelper\";\r\nimport { getPrimaryGreenTheme } from \"../../../../common/themes\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\nexport interface ITrainPageProps extends RouteComponentProps, React.Props<TrainPage> {\r\n    connections: IConnection[];\r\n    appSettings: IAppSettings;\r\n    project: IProject;\r\n    actions: IProjectActions;\r\n    applicationActions: IApplicationActions;\r\n    recentProjects: IProject[];\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\nexport interface ITrainPageState {\r\n    trainMessage: string;\r\n    isTraining: boolean;\r\n    currTrainRecord: ITrainRecordProps;\r\n    viewType: \"chartView\" | \"tableView\";\r\n    showTrainingFailedWarning: boolean;\r\n    trainingFailedMessage: string;\r\n}\r\n\r\ninterface ITrainApiResponse {\r\n    modelId: string;\r\n    createdDateTime: string;\r\n    averageModelAccuracy: number;\r\n    fields: object[];\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        appSettings: state.appSettings,\r\n        project: state.currentProject,\r\n        connections: state.connections,\r\n        recentProjects: state.recentProjects,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(projectActions, dispatch),\r\n        applicationActions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class TrainPage extends React.Component<ITrainPageProps, ITrainPageState> {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            trainMessage: strings.train.notTrainedYet,\r\n            isTraining: false,\r\n            currTrainRecord: null,\r\n            viewType: \"tableView\",\r\n            showTrainingFailedWarning: false,\r\n            trainingFailedMessage: \"\",\r\n        };\r\n    }\r\n\r\n    public async componentDidMount() {\r\n        const projectId = this.props.match.params[\"projectId\"];\r\n        if (projectId) {\r\n            const project = this.props.recentProjects.find((project) => project.id === projectId);\r\n            await this.props.actions.loadProject(project);\r\n\r\n            this.props.appTitleActions.setTitle(project.name);\r\n            this.updateCurrTrainRecord(this.getProjectTrainRecord());\r\n        }\r\n        document.title = strings.train.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public render() {\r\n        const currTrainRecord = this.state.currTrainRecord;\r\n\r\n        return (\r\n            <div className=\"train-page\" id=\"pageTrain\">\r\n                <main className=\"train-page-main\">\r\n                    {currTrainRecord &&\r\n                        <div>\r\n                            <h3> Train Result </h3>\r\n                            <span> Model ID: {currTrainRecord.modelInfo.modelId} </span>\r\n                        </div>\r\n                    }\r\n                    {this.state.viewType === \"tableView\" &&\r\n                        <TrainTable\r\n                            trainMessage={this.state.trainMessage}\r\n                            accuracies={currTrainRecord && currTrainRecord.accuracies} />}\r\n\r\n                    {this.state.viewType === \"chartView\" && currTrainRecord &&\r\n                        <TrainChart\r\n                            accuracies={currTrainRecord.accuracies}\r\n                            modelId={currTrainRecord.modelInfo.modelId}\r\n                            projectTags={this.props.project.tags} />\r\n                    }\r\n                </main>\r\n                <div className=\"train-page-menu bg-lighter-1\">\r\n                    <div className=\"condensed-list\">\r\n                        <div className=\"condensed-list-body\">\r\n                            <div className=\"m-3\">\r\n                                <h4 className=\"text-shadow-none\"> Train a new model </h4>\r\n                                {!this.state.isTraining ? (\r\n                                    <PrimaryButton\r\n                                        id=\"train_trainButton\"\r\n                                        theme={getPrimaryGreenTheme()}\r\n                                        autoFocus={true}\r\n                                        className=\"flex-center\"\r\n                                        onClick={this.handleTrainClick}>\r\n                                        <FontIcon iconName=\"MachineLearning\" />\r\n                                        <h6 className=\"d-inline text-shadow-none ml-2 mb-0\"> {strings.train.title} </h6>\r\n                                    </PrimaryButton>\r\n                                ) : (\r\n                                    <div className=\"loading-container\">\r\n                                        <Spinner\r\n                                            label=\"Training in progress...\"\r\n                                            ariaLive=\"assertive\"\r\n                                            labelPosition=\"right\"\r\n                                            size={SpinnerSize.large}\r\n                                        />\r\n                                    </div>\r\n                                )\r\n                                }\r\n                            </div>\r\n                            <div className={!this.state.isTraining ? \"\" : \"greyOut\"}>\r\n                                {currTrainRecord &&\r\n                                    <TrainPanel\r\n                                        currTrainRecord={currTrainRecord}\r\n                                        viewType={this.state.viewType}\r\n                                        updateViewTypeCallback={this.handleViewTypeClick}\r\n                                    />\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <Alert\r\n                    show={this.state.showTrainingFailedWarning}\r\n                    title=\"Training Failed\"\r\n                    message={this.state.trainingFailedMessage}\r\n                    onClose={() => this.setState({ showTrainingFailedWarning: false })}\r\n                />\r\n                <PreventLeaving\r\n                    when={this.state.isTraining}\r\n                    message={\"A training operation is currently in progress, are you sure you want to leave?\"}\r\n                />\r\n                <SkipButton skipTo=\"pageTrain\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private handleTrainClick = () => {\r\n        this.setState({\r\n            isTraining: true,\r\n            trainMessage: strings.train.training,\r\n        });\r\n\r\n        this.trainProcess().then((trainResult) => {\r\n            this.setState((prevState, props) => ({\r\n                isTraining: false,\r\n                trainMessage: this.getTrainMessage(trainResult),\r\n                currTrainRecord: this.getProjectTrainRecord(),\r\n            }));\r\n        }).catch((err) => {\r\n            this.setState({\r\n                isTraining: false,\r\n                trainMessage: err.message,\r\n            });\r\n        });\r\n    }\r\n\r\n    private handleViewTypeClick = (viewType: \"tableView\" | \"chartView\"): void => {\r\n        this.setState({ viewType });\r\n    }\r\n\r\n    private async trainProcess(): Promise<any> {\r\n        try {\r\n            const trainRes = await this.train();\r\n            const trainStatusRes =\r\n                await this.getTrainStatus(trainRes.headers[\"location\"]);\r\n            const updatedProject = this.buildUpdatedProject(\r\n                this.parseTrainResult(trainStatusRes),\r\n            );\r\n            await this.props.actions.saveProject(updatedProject);\r\n\r\n            return trainStatusRes;\r\n        } catch (errorMessage) {\r\n            this.setState({\r\n                showTrainingFailedWarning: true,\r\n                trainingFailedMessage: (errorMessage !== undefined && errorMessage.message !== undefined\r\n                    ? errorMessage.message : errorMessage),\r\n            });\r\n        }\r\n    }\r\n\r\n    private async train(): Promise<any> {\r\n        const baseURL = url.resolve(\r\n            this.props.project.apiUriBase,\r\n            constants.apiModelsPath,\r\n        );\r\n        const provider = this.props.project.sourceConnection.providerOptions as any;\r\n        const trainSourceURL = provider.sas;\r\n\r\n        const payload = {\r\n            source: trainSourceURL,\r\n            sourceFilter: {\r\n                prefix: this.props.project.folderPath ? this.props.project.folderPath : \"\",\r\n                includeSubFolders: false,\r\n            },\r\n            useLabelFile: true,\r\n        };\r\n        try {\r\n            return await ServiceHelper.postWithAutoRetry(\r\n                baseURL,\r\n                payload,\r\n                {},\r\n                this.props.project.apiKey as string,\r\n            );\r\n        } catch (err) {\r\n            ServiceHelper.handleServiceError(err);\r\n        }\r\n    }\r\n\r\n    private async getTrainStatus(operationLocation: string): Promise<any> {\r\n        const timeoutPerFileInMs = 10000;  // 10 second for each file\r\n        const minimumTimeoutInMs = 300000;  // 5 minutes minimum waiting time  for each traingin process\r\n        const extendedTimeoutInMs = timeoutPerFileInMs * Object.keys(this.props.project.assets || []).length;\r\n        const res = this.poll(() => {\r\n            return ServiceHelper.getWithAutoRetry(\r\n                operationLocation,\r\n                { headers: { \"cache-control\": \"no-cache\" } },\r\n                this.props.project.apiKey as string);\r\n        }, Math.max(extendedTimeoutInMs, minimumTimeoutInMs), 1000);\r\n\r\n        return res;\r\n    }\r\n\r\n    private buildUpdatedProject = (newTrainRecord: ITrainRecordProps): IProject => {\r\n        return {\r\n            ...this.props.project,\r\n            trainRecord: newTrainRecord,\r\n        };\r\n    }\r\n\r\n    private getTrainMessage = (trainingResult): string => {\r\n        if (trainingResult !== undefined && trainingResult.modelInfo !== undefined\r\n            && trainingResult.modelInfo.status === \"ready\") {\r\n            return \"Trained successfully\";\r\n        }\r\n        return \"Training failed\";\r\n    }\r\n\r\n    private getProjectTrainRecord = (): ITrainRecordProps => {\r\n        return _.get(this, \"props.project.trainRecord\", null);\r\n    }\r\n\r\n    private updateCurrTrainRecord = (curr: ITrainRecordProps): void => {\r\n        this.setState({ currTrainRecord: curr });\r\n    }\r\n\r\n    private parseTrainResult = (response: ITrainApiResponse): ITrainRecordProps => {\r\n        return {\r\n            modelInfo: {\r\n                modelId: response[\"modelInfo\"][\"modelId\"],\r\n                createdDateTime: response[\"modelInfo\"][\"createdDateTime\"],\r\n            },\r\n            averageAccuracy: response[\"trainResult\"][\"averageModelAccuracy\"],\r\n            accuracies: this.buildAccuracies(response[\"trainResult\"][\"fields\"]),\r\n        };\r\n    }\r\n\r\n    private buildAccuracies = (fields: object[]): object => {\r\n        const accuracies = {};\r\n        for (const field of fields) {\r\n            accuracies[field[\"fieldName\"]] = field[\"accuracy\"];\r\n        }\r\n        return accuracies;\r\n    }\r\n\r\n    /**\r\n     * Poll function to repeatly check if request succeeded\r\n     * @param func - function that will be called repeatly\r\n     * @param timeout - timeout\r\n     * @param interval - interval\r\n     */\r\n    private poll = (func, timeout, interval): Promise<any> => {\r\n        const endTime = Number(new Date()) + (timeout || 10000);\r\n        interval = interval || 100;\r\n\r\n        const checkSucceeded = (resolve, reject) => {\r\n            const ajax = func();\r\n            ajax.then((response) => {\r\n                if (response.data.modelInfo && response.data.modelInfo.status === \"ready\") {\r\n                    resolve(response.data);\r\n                } else if (response.data.modelInfo && response.data.modelInfo.status === \"invalid\") {\r\n                    const message = _.get(\r\n                        response,\r\n                        \"data.trainResult.errors[0].message\",\r\n                        \"Sorry, we got errors while training the model.\");\r\n                    reject(message);\r\n                } else if (Number(new Date()) < endTime) {\r\n                    // If the request isn't succeeded and the timeout hasn't elapsed, go again\r\n                    setTimeout(checkSucceeded, interval, resolve, reject);\r\n                } else {\r\n                    // Didn't succeeded after too much time, reject\r\n                    reject(new Error(\"Timed out, sorry, it seems the training process took too long.\"));\r\n                }\r\n            });\r\n        };\r\n\r\n        return new Promise(checkSucceeded);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport shortid from \"shortid\";\r\nimport Guard from \"../common/guard\";\r\nimport { IConnection } from \"../models/applicationState\";\r\nimport { AssetProviderFactory } from \"../providers/storage/assetProviderFactory\";\r\n\r\n/**\r\n * Functions required for a connection service\r\n * @member save - Save a connection\r\n */\r\nexport interface IConnectionService {\r\n    save(connection: IConnection): Promise<IConnection>;\r\n}\r\n\r\n/**\r\n * @name - Connection Service\r\n * @description - Functions for dealing with project connections\r\n */\r\nexport default class ConnectionService implements IConnectionService {\r\n\r\n    /**\r\n     * Save a connection\r\n     * @param connection - Connection to save\r\n     */\r\n    public save(connection: IConnection) {\r\n        Guard.null(connection);\r\n\r\n        return new Promise<IConnection>(async (resolve, reject) => {\r\n            try {\r\n                if (!connection.id) {\r\n                    connection.id = shortid.generate();\r\n                }\r\n\r\n                const assetProvider = AssetProviderFactory.createFromConnection(connection);\r\n                if (assetProvider.initialize) {\r\n                    await assetProvider.initialize();\r\n                }\r\n\r\n                resolve(connection);\r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IConnection } from \"../../models/applicationState\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\nimport { IPayloadAction, createPayloadAction } from \"./actionCreators\";\r\nimport { Dispatch } from \"redux\";\r\nimport ConnectionService from \"../../services/connectionService\";\r\n\r\n/**\r\n * Actions to be performed in relation to connections\r\n */\r\nexport default interface IConnectionActions {\r\n    loadConnection(connection: IConnection): Promise<IConnection>;\r\n    saveConnection(connection: IConnection): Promise<IConnection>;\r\n    deleteConnection(connection: IConnection): Promise<void>;\r\n}\r\n\r\n/**\r\n * Dispatches Load Connection action and resolves with IConnection\r\n * @param connection - Connection to load\r\n */\r\nexport function loadConnection(connection: IConnection): (dispatch: Dispatch) => Promise<IConnection> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(loadConnectionAction(connection));\r\n        return Promise.resolve(connection);\r\n    };\r\n}\r\n\r\n/**\r\n * Dispatches Save Connection action and resolves with IConnection\r\n * @param connection - Connection to save\r\n */\r\nexport function saveConnection(connection: IConnection): (dispatch: Dispatch) => Promise<IConnection> {\r\n    return async (dispatch: Dispatch) => {\r\n        const connectionService = new ConnectionService();\r\n        await connectionService.save(connection);\r\n        dispatch(saveConnectionAction(connection));\r\n        return Promise.resolve(connection);\r\n    };\r\n}\r\n\r\n/**\r\n * Dispatches Delete Connection action and resolves with IConnection\r\n * @param connection - Connection to delete\r\n */\r\nexport function deleteConnection(connection: IConnection): (dispatch: Dispatch) => Promise<void> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(deleteConnectionAction(connection));\r\n        return Promise.resolve();\r\n    };\r\n}\r\n\r\n/**\r\n * Load connection action type\r\n */\r\nexport interface ILoadConnectionAction extends IPayloadAction<string, IConnection> {\r\n    type: ActionTypes.LOAD_CONNECTION_SUCCESS;\r\n}\r\n\r\n/**\r\n * Save connection action type\r\n */\r\nexport interface ISaveConnectionAction extends IPayloadAction<string, IConnection> {\r\n    type: ActionTypes.SAVE_CONNECTION_SUCCESS;\r\n}\r\n\r\n/**\r\n * Delete connection action type\r\n */\r\nexport interface IDeleteConnectionAction extends IPayloadAction<string, IConnection> {\r\n    type: ActionTypes.DELETE_CONNECTION_SUCCESS;\r\n}\r\n\r\n/**\r\n * Instance of load connection action\r\n */\r\nexport const loadConnectionAction = createPayloadAction<ILoadConnectionAction>(ActionTypes.LOAD_CONNECTION_SUCCESS);\r\n/**\r\n * Instance of save connection action\r\n */\r\nexport const saveConnectionAction = createPayloadAction<ISaveConnectionAction>(ActionTypes.SAVE_CONNECTION_SUCCESS);\r\n/**\r\n * Instance of delete connection action\r\n */\r\nexport const deleteConnectionAction =\r\n    createPayloadAction<IDeleteConnectionAction>(ActionTypes.DELETE_CONNECTION_SUCCESS);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport _ from \"lodash\";\r\nimport { StorageProviderFactory } from \"../../../../providers/storage/storageProviderFactory\";\r\nimport { AssetProviderFactory } from \"../../../../providers/storage/assetProviderFactory\";\r\n\r\n/**\r\n * Properties for Connection Provider Picker\r\n * @member onChange - Function to call on change of selected value\r\n * @member id - ID of HTML select element\r\n * @member value - Selected value of picker\r\n */\r\nexport interface IConnectionProviderPickerProps {\r\n    onChange: (value: string) => void;\r\n    id: string;\r\n    value: string;\r\n}\r\n\r\n/**\r\n * Creates HTML select object for selecting an asset or storage provider\r\n * @param props Properties for picker\r\n */\r\nexport default function ConnectionProviderPicker(props: IConnectionProviderPickerProps) {\r\n    const storageProviders = _.values(StorageProviderFactory.providers);\r\n    const assetProviders = _.values(AssetProviderFactory.providers);\r\n\r\n    const allProviders = _([])\r\n        .concat(assetProviders)\r\n        .concat(storageProviders)\r\n        .uniqBy(\"name\")\r\n        .orderBy(\"displayName\")\r\n        .value();\r\n\r\n    function onChange(e) {\r\n        props.onChange(e.target.value);\r\n    }\r\n\r\n    return (\r\n        <select id={props.id}\r\n            className=\"form-control\"\r\n            value={props.value}\r\n            onChange={onChange}>\r\n            <option value=\"\">Select Provider</option>\r\n            {\r\n                allProviders.map((provider) =>\r\n                    <option key={provider.name} value={provider.name}>\r\n                        {provider.displayName}\r\n                    </option>)\r\n            }\r\n        </select>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport Form, { Widget, IChangeEvent, FormValidation } from \"react-jsonschema-form\";\r\nimport { FontIcon, PrimaryButton} from \"office-ui-fabric-react\";\r\nimport { IConnection } from \"../../../../models/applicationState\";\r\nimport { strings, addLocValues } from \"../../../../common/strings\";\r\nimport CustomFieldTemplate from \"../../common/customField/customFieldTemplate\";\r\nimport ConnectionProviderPicker from \"../../common/connectionProviderPicker/connectionProviderPicker\";\r\nimport { ProtectedInput } from \"../../common/protectedInput/protectedInput\";\r\nimport Checkbox from \"rc-checkbox\";\r\nimport \"rc-checkbox/assets/index.css\";\r\nimport { CustomWidget } from \"../../common/customField/customField\";\r\nimport { isBrowser } from \"../../../../common/hostProcess\";\r\nimport { getPrimaryGreenTheme, getPrimaryGreyTheme} from \"../../../../common/themes\";\r\nimport { backFillAriaLabelledBy, getPropertiesIds } from \"../../common/jsonSchemaFormHelper\";\r\n// tslint:disable-next-line:no-var-requires\r\nconst formSchema = addLocValues(require(\"./connectionForm.json\"));\r\n// tslint:disable-next-line:no-var-requires\r\nconst uiSchema = addLocValues(require(\"./connectionForm.ui.json\"));\r\n\r\n/**\r\n * Properties for Connection form\r\n * @member connection - Form being viewed/edited\r\n * @member onSubmit - Function called upon form submission\r\n * @member onCancel - Function called upon cancellation of form\r\n */\r\nexport interface IConnectionFormProps extends React.Props<ConnectionForm> {\r\n    connection: IConnection;\r\n    onSubmit: (connection: IConnection) => void;\r\n    onCancel?: () => void;\r\n}\r\n\r\n/**\r\n * State for Connection Form\r\n * @member providerName - Name of connection provider\r\n * @member formSchema - JSON Form Schema\r\n * @member uiSchema - JSON Form UI Schema\r\n * @member formData - Current state of form data as a Connection\r\n * @member classNames - HTML Class names for form element\r\n */\r\nexport interface IConnectionFormState {\r\n    providerName: string;\r\n    formSchema: any;\r\n    uiSchema: any;\r\n    formData: IConnection;\r\n    classNames: string[];\r\n}\r\n\r\n/**\r\n * Form for viewing, creating and editing connections\r\n */\r\nexport default class ConnectionForm extends React.Component<IConnectionFormProps, IConnectionFormState> {\r\n    private widgets = {\r\n        connectionProviderPicker: (ConnectionProviderPicker as any) as Widget,\r\n        protectedInput: (ProtectedInput as any) as Widget,\r\n        checkbox: CustomWidget(Checkbox, (props) => ({\r\n            checked: props.value,\r\n            onChange: (value) => props.onChange(value.target.checked),\r\n            disabled: props.disabled,\r\n        })),\r\n    };\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            classNames: [\"needs-validation\"],\r\n            formSchema: { ...formSchema },\r\n            uiSchema: { ...uiSchema },\r\n            providerName: \"azureBlobStorage\",\r\n            formData: this.props.connection,\r\n        };\r\n\r\n        this.onFormCancel = this.onFormCancel.bind(this);\r\n        this.onFormValidate = this.onFormValidate.bind(this);\r\n        this.onFormChange = this.onFormChange.bind(this);\r\n    }\r\n\r\n    public componentDidMount() {\r\n        if (this.props.connection) {\r\n            this.bindForm(this.props.connection);\r\n        }\r\n        const connectionFormIds = getPropertiesIds(this.state.formSchema.properties);\r\n        connectionFormIds.forEach((id) => {\r\n            backFillAriaLabelledBy(id);\r\n        });\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: IConnectionFormProps) {\r\n        if (prevProps.connection !== this.props.connection) {\r\n            this.bindForm(this.props.connection);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"app-connections-page-detail m-3\">\r\n                <h3>\r\n                    <FontIcon iconName=\"Plug\" />\r\n                    <span className=\"px-2\">\r\n                        {strings.connections.settings}\r\n                    </span>\r\n                </h3>\r\n                <div className=\"m-3\">\r\n                    {isBrowser() &&\r\n                        <div className=\"alert alert-warning warning\"\r\n                            role=\"alert\">\r\n                            <FontIcon iconName=\"WarningSolid\" className=\"mr-1\" />\r\n                            {strings.formatString(\r\n                                strings.connections.blobCorsWarning,\r\n                                <a\r\n                                    href=\"https://aka.ms/blob-cors\"\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\">\r\n                                    {strings.connections.azDocLinkText}\r\n                                </a>)\r\n                            }\r\n                        </div>\r\n                    }\r\n                    <Form\r\n                        className={this.state.classNames.join(\" \")}\r\n                        showErrorList={false}\r\n                        liveValidate={true}\r\n                        noHtml5Validate={true}\r\n                        FieldTemplate={CustomFieldTemplate}\r\n                        validate={this.onFormValidate}\r\n                        widgets={this.widgets}\r\n                        schema={this.state.formSchema}\r\n                        uiSchema={this.state.uiSchema}\r\n                        formData={this.state.formData}\r\n                        onChange={this.onFormChange}\r\n                        onSubmit={(form) => this.props.onSubmit(form.formData)}>\r\n                        <div>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreenTheme()}\r\n                                className=\"mr-2\"\r\n                                type=\"submit\">\r\n                                {strings.connections.save}\r\n                            </PrimaryButton>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreyTheme()}\r\n                                type=\"button\"\r\n                                onClick={this.onFormCancel}>\r\n                                {strings.common.cancel}\r\n                            </PrimaryButton>\r\n                        </div>\r\n                    </Form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private onFormValidate(connection: IConnection, errors: FormValidation) {\r\n        if (connection.providerType === \"\") {\r\n            errors.providerType.addError(\"is a required property\");\r\n        }\r\n\r\n        if (this.state.classNames.indexOf(\"was-validated\") === -1) {\r\n            this.setState({\r\n                classNames: [...this.state.classNames, \"was-validated\"],\r\n            });\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    private onFormChange = (args: IChangeEvent<IConnection>) => {\r\n        const providerType = args.formData.providerType;\r\n\r\n        if (providerType !== this.state.providerName) {\r\n            this.bindForm(args.formData, true);\r\n        } else {\r\n            this.setState({\r\n                formData: args.formData,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onFormCancel() {\r\n        if (this.props.onCancel) {\r\n            this.props.onCancel();\r\n        }\r\n    }\r\n\r\n    private bindForm(connection: IConnection, resetProviderOptions: boolean = false) {\r\n        const providerType = connection ? connection.providerType : \"\";\r\n        let newFormSchema: any = this.state.formSchema;\r\n        let newUiSchema: any = this.state.uiSchema;\r\n\r\n        if (providerType) {\r\n            const providerSchema = addLocValues(require(`../../../../providers/storage/${providerType}.json`));\r\n            const providerUiSchema = addLocValues(require(`../../../../providers/storage/${providerType}.ui.json`));\r\n\r\n            newFormSchema = { ...formSchema };\r\n            newFormSchema.properties[\"providerOptions\"] = providerSchema;\r\n\r\n            newUiSchema = { ...uiSchema };\r\n            newUiSchema[\"providerOptions\"] = providerUiSchema;\r\n        } else {\r\n            newFormSchema = { ...formSchema };\r\n            delete newFormSchema.properties[\"providerOptions\"];\r\n\r\n            newUiSchema = { ...uiSchema };\r\n            delete newUiSchema[\"providerOptions\"];\r\n\r\n            resetProviderOptions = true;\r\n        }\r\n\r\n        const formData = { ...connection };\r\n        formData.providerType = providerType;\r\n        if (resetProviderOptions) {\r\n            formData.providerOptions = {};\r\n        }\r\n\r\n        this.setState({\r\n            providerName: providerType,\r\n            formSchema: newFormSchema,\r\n            uiSchema: newUiSchema,\r\n            formData,\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport { FontIcon, IconButton } from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport \"../../../../App.scss\";\r\n\r\nexport default function ConnectionItem({ item, onClick, onDelete }) {\r\n    return (\r\n        <li onClick={onClick}>\r\n            <NavLink className=\"condensed-list-item\" to={`/connections/${item.id}`}\r\n                aria-label={`${item.name} connection`}>\r\n                <FontIcon iconName=\"Edit\" />\r\n                <span className=\"px-2\">{item.name}</span>\r\n                <IconButton className=\"float-right app-delete-button\"\r\n                    title={strings.common.delete}\r\n                    onClick={onDelete}>\r\n                    <FontIcon iconName=\"Delete\" className=\"app-delete-icon\"/>\r\n                </IconButton>\r\n            </NavLink>\r\n        </li>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Route, RouteComponentProps } from \"react-router-dom\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { strings, interpolate } from \"../../../../common/strings\";\r\nimport { getPrimaryRedTheme } from \"../../../../common/themes\";\r\nimport { IApplicationState, IConnection } from \"../../../../models/applicationState\";\r\nimport IConnectionActions, * as connectionActions from \"../../../../redux/actions/connectionActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport CondensedList from \"../../common/condensedList/condensedList\";\r\nimport Confirm from \"../../common/confirm/confirm\";\r\nimport ConnectionForm from \"./connectionForm\";\r\nimport ConnectionItem from \"./connectionItem\";\r\nimport \"./connectionsPage.scss\";\r\nimport { toast } from \"react-toastify\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\n/**\r\n * Properties for Connection Page\r\n * @member connections - Array of Connections\r\n * @member actions - Actions to perform\r\n * @member appTitleActions - Application Title Actions\r\n */\r\nexport interface IConnectionPageProps extends RouteComponentProps, React.Props<ConnectionPage> {\r\n    connections: IConnection[];\r\n    actions: IConnectionActions;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\n/**\r\n * State of Connection Page\r\n * @member connection - Connection currently being viewed/edited\r\n */\r\nexport interface IConnectionPageState {\r\n    connection: IConnection;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        connections: state.connections,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(connectionActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n/**\r\n * Page for viewing/editing connections\r\n */\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class ConnectionPage extends React.Component<IConnectionPageProps, IConnectionPageState> {\r\n    private confirmDelete: React.RefObject<Confirm>;\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            connection: { id: null, name: null, providerType: \"azureBlobStorage\", providerOptions: {} },\r\n        };\r\n\r\n        this.confirmDelete = React.createRef<Confirm>();\r\n        this.onFormSubmit = this.onFormSubmit.bind(this);\r\n        this.onFormCancel = this.onFormCancel.bind(this);\r\n        this.onConnectionDelete = this.onConnectionDelete.bind(this);\r\n    }\r\n\r\n    public async componentDidMount() {\r\n        const connectionId = this.props.match.params[\"connectionId\"];\r\n        if (connectionId) {\r\n            this.loadConnection(connectionId);\r\n        }\r\n\r\n        this.props.appTitleActions.setTitle(strings.connections.title);\r\n        document.title = strings.connections.title + \" - \" + strings.appName;\r\n        document.getElementById(\"addConnection\").focus();\r\n    }\r\n\r\n    public componentDidUpdate = (prevProps) => {\r\n        const prevConnectionId = prevProps.match.params[\"connectionId\"];\r\n        const newConnectionId = this.props.match.params[\"connectionId\"];\r\n\r\n        if (prevConnectionId !== newConnectionId) {\r\n            this.loadConnection(newConnectionId);\r\n        }\r\n        document.getElementById(\"addConnection\").focus();\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"app-connections-page\" id=\"pageConnections\">\r\n                <div className=\"app-connections-page-list bg-lighter-1\">\r\n                    <CondensedList\r\n                        title={strings.connections.title}\r\n                        newLinkTo={\"/connections/create\"}\r\n                        newLinkToTitle={strings.connections.new}\r\n                        onDelete={(connection) => this.confirmDelete.current.open(connection)}\r\n                        Component={ConnectionItem}\r\n                        items={this.props.connections} />\r\n                </div>\r\n\r\n                <Confirm ref={this.confirmDelete}\r\n                    title=\"Delete Connection\"\r\n                    // tslint:disable-next-line:max-line-length\r\n                    message={(connection: IConnection) => `Are you sure you want to delete the connection '${connection.name}'?`}\r\n                    confirmButtonTheme={getPrimaryRedTheme()}\r\n                    onConfirm={(connection) => this.onConnectionDelete(connection)} />\r\n\r\n                <Route exact path=\"/connections\" render={(props) =>\r\n                    <div className=\"app-connections-page-detail m-3\">\r\n                        <h6>{strings.connections.instructions}</h6>\r\n                    </div>\r\n                } />\r\n\r\n                <Route exact path=\"/connections/:connectionId\" render={(props) =>\r\n                    <ConnectionForm\r\n                        connection={this.state.connection}\r\n                        onSubmit={this.onFormSubmit}\r\n                        onCancel={this.onFormCancel} />\r\n                } />\r\n\r\n                <SkipButton skipTo=\"pageConnections\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private async loadConnection(connectionId: string) {\r\n        let connection = this.props.connections.find((connection) => connection.id === connectionId);\r\n        if (!connection) {\r\n            connection = { id: null, name: null, providerType: \"azureBlobStorage\", providerOptions: {} };\r\n        }\r\n        this.setState({ connection });\r\n    }\r\n\r\n    private onConnectionDelete = async (connection: IConnection) => {\r\n        await this.props.actions.deleteConnection(connection);\r\n\r\n        toast.info(interpolate(strings.connections.messages.deleteSuccess, { connection }));\r\n\r\n        if (this.state.connection === connection) {\r\n            this.props.history.push(\"/connections\");\r\n            this.setState({ connection: null });\r\n        }\r\n    }\r\n\r\n    private onFormSubmit = async (connection: IConnection) => {\r\n        try {\r\n            connection.providerOptions[\"sas\"] = connection.providerOptions[\"sas\"].trim();\r\n            await this.props.actions.saveConnection(connection);\r\n            toast.success(interpolate(strings.connections.messages.saveSuccess, { connection }));\r\n\r\n            this.props.history.push(\"/connections\");\r\n        } catch (error) {\r\n            alert(error);\r\n        }\r\n    }\r\n\r\n    private onFormCancel() {\r\n        this.props.history.push(\"/connections\");\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IAssetPreviewProps } from \"./assetPreview\";\r\nimport { loadImageToCanvas } from \"../../../../common/utils\";\r\nimport { constants } from \"../../../../common/constants\";\r\n\r\ninterface IImageAssetState {\r\n    imageUri: string;\r\n}\r\n\r\n/**\r\n * ImageAsset component used to render all image assets\r\n */\r\nexport class ImageAsset extends React.Component<IAssetPreviewProps, IImageAssetState> {\r\n    private image: React.RefObject<HTMLImageElement> = React.createRef();\r\n\r\n    constructor(props: IAssetPreviewProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            imageUri: null,\r\n        };\r\n    }\r\n\r\n    public async componentDidMount() {\r\n        if (this.props.asset != null) {\r\n            const canvas = await loadImageToCanvas(this.props.asset.path);\r\n            this.setState({\r\n                imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedThumbnailQuality),\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <img ref={this.image}\r\n                src={this.state.imageUri}\r\n                alt={this.props.asset.name}\r\n                onLoad={this.onLoad}\r\n                onError={(e) => {\r\n                    this.props.onError(e);\r\n                }}\r\n                crossOrigin=\"anonymous\" />);\r\n    }\r\n\r\n    private onLoad = () => {\r\n        if (this.props.onLoaded) {\r\n            this.props.onLoaded(this.image.current);\r\n        }\r\n        if (this.props.onActivated) {\r\n            this.props.onActivated(this.image.current);\r\n        }\r\n        if (this.props.onDeactivated) {\r\n            this.props.onDeactivated(this.image.current);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IAssetPreviewProps } from \"./assetPreview\";\r\nimport * as pdfjsLib from \"pdfjs-dist\";\r\nimport { constants } from \"../../../../common/constants\";\r\n\r\n// temp hack for enabling worker\r\npdfjsLib.GlobalWorkerOptions.workerSrc = constants.pdfjsWorkerSrc(pdfjsLib.version);\r\n\r\nexport interface IPDFAssetState {\r\n    imageUri: string;\r\n}\r\n\r\n/**\r\n * PDFAsset component used to render all PDF assets\r\n */\r\nexport class PDFAsset extends React.Component<IAssetPreviewProps, IPDFAssetState> {\r\n    private image: React.RefObject<HTMLImageElement> = React.createRef();\r\n\r\n    constructor(props: IAssetPreviewProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            imageUri: \"\",\r\n        };\r\n    }\r\n\r\n    public componentDidMount() {\r\n        if (this.props.asset != null) {\r\n            this.loadPdfFile(this.props.asset.path);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <img ref={this.image}\r\n                src={this.state.imageUri}\r\n                alt={this.props.asset.name}\r\n                onLoad={this.onLoad}\r\n                style={ { display: this.state.imageUri ? \"block\" : \"none\" } }\r\n                crossOrigin=\"anonymous\" />\r\n        );\r\n    }\r\n\r\n    private loadPdfFile = (url) => {\r\n        const loadingTask = pdfjsLib.getDocument(url);\r\n        loadingTask.promise.then((pdf) => {\r\n            // Fetch the first page\r\n            this.loadPdfPage(pdf, 1 /*pageNumber*/);\r\n        }, (reason) => {\r\n            // PDF loading error\r\n            if (this.props.onError) {\r\n                this.props.onError(reason);\r\n            }\r\n        });\r\n    }\r\n\r\n    private loadPdfPage = (pdf, pageNumber) => {\r\n        pdf.getPage(pageNumber).then((page) => {\r\n            const defaultScale = 1;\r\n            const viewport = page.getViewport({ scale: defaultScale });\r\n\r\n            // Prepare canvas using PDF page dimensions\r\n            const canvas = document.createElement(\"canvas\");\r\n            const context = canvas.getContext(\"2d\");\r\n            canvas.height = viewport.height;\r\n            canvas.width = viewport.width;\r\n\r\n            // Render PDF page into canvas context\r\n            const renderContext = {\r\n                canvasContext: context,\r\n                viewport,\r\n            };\r\n\r\n            const renderTask = page.render(renderContext);\r\n            renderTask.promise.then(() => {\r\n                this.setState({\r\n                    imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedThumbnailQuality),\r\n                });\r\n            });\r\n          });\r\n    }\r\n\r\n    private onLoad = () => {\r\n        if (this.props.onLoaded) {\r\n            this.props.onLoaded(this.image.current);\r\n        }\r\n        if (this.props.onActivated) {\r\n            this.props.onActivated(this.image.current);\r\n        }\r\n        if (this.props.onDeactivated) {\r\n            this.props.onDeactivated(this.image.current);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IAssetPreviewProps } from \"./assetPreview\";\r\nimport { IAsset } from \"../../../../models/applicationState\";\r\nimport HtmlFileReader from \"../../../../common/htmlFileReader\";\r\nimport { parseTiffData, renderTiffToCanvas } from \"../../../../common/utils\";\r\nimport { constants } from \"../../../../common/constants\";\r\n\r\nexport interface ITiffAsset {\r\n    imageUri: string;\r\n}\r\n\r\n/**\r\n * TiffAsset component used to render all Tiff assets\r\n */\r\nexport class TiffAsset extends React.Component<IAssetPreviewProps, ITiffAsset> {\r\n    private image: React.RefObject<HTMLImageElement> = React.createRef();\r\n\r\n    constructor(props: IAssetPreviewProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            imageUri: \"\",\r\n        };\r\n    }\r\n\r\n    public componentDidMount() {\r\n        if (this.props.asset != null) {\r\n            this.loadTiffFile(this.props.asset);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <img ref={this.image}\r\n                src={this.state.imageUri}\r\n                alt={this.props.asset.name}\r\n                onLoad={this.onLoad}\r\n                style={ { display: this.state.imageUri ? \"block\" : \"none\" } }\r\n                crossOrigin=\"anonymous\" />\r\n        );\r\n    }\r\n\r\n    private loadTiffFile = async (asset: IAsset) => {\r\n        const assetArrayBuffer = await HtmlFileReader.getAssetArray(asset);\r\n        const tiffImages = parseTiffData(assetArrayBuffer);\r\n        this.loadTiffPage(tiffImages, 1 /*pageNumber*/);\r\n    }\r\n\r\n    private loadTiffPage = (tiffImages, pageNumber) => {\r\n        const tiffImage = tiffImages[pageNumber - 1];\r\n        const canvas = renderTiffToCanvas(tiffImage);\r\n        this.setState({\r\n            imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedThumbnailQuality),\r\n        });\r\n}\r\n\r\n    private onLoad = () => {\r\n        if (this.props.onLoaded) {\r\n            this.props.onLoaded(this.image.current);\r\n        }\r\n        if (this.props.onActivated) {\r\n            this.props.onActivated(this.image.current);\r\n        }\r\n        if (this.props.onDeactivated) {\r\n            this.props.onDeactivated(this.image.current);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { SyntheticEvent } from \"react\";\r\nimport { IAsset, AssetType } from \"../../../../models/applicationState\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { ImageAsset } from \"./imageAsset\";\r\nimport { PDFAsset } from \"./pdfAsset\";\r\nimport { TiffAsset } from \"./tiffAsset\";\r\nimport { Spinner, SpinnerSize } from \"office-ui-fabric-react/lib/Spinner\";\r\nimport { Label } from \"office-ui-fabric-react/lib/Label\";\r\n\r\nexport interface IGenericContentSource {\r\n    width: number;\r\n    height: number;\r\n    offsetWidth: number;\r\n    offsetHeight: number;\r\n    offsetTop: number;\r\n    offsetLeft: number;\r\n}\r\nexport type ContentSource = HTMLImageElement | HTMLVideoElement | IGenericContentSource;\r\n\r\n/**\r\n * AssetPreview component properties\r\n */\r\nexport interface IAssetPreviewProps {\r\n    /** The Asset to preview */\r\n    asset: IAsset;\r\n    /** Specifies whether the asset controls are enabled */\r\n    controlsEnabled?: boolean;\r\n    /** Event handler that fires when the asset has been loaded */\r\n    onLoaded?: (ContentSource: ContentSource) => void;\r\n    /** Event handler that fires when the asset has been activated (ex. Video resumes playing) */\r\n    onActivated?: (contentSource: ContentSource) => void;\r\n    /** Event handler that fires when the asset has been deactivated (ex. Canvas tools takes over) */\r\n    onDeactivated?: (contentSource: ContentSource) => void;\r\n    /** Event handler that fires when an error occurred loading an asset */\r\n    onError?: (event: React.SyntheticEvent) => void;\r\n    /** Event handler that fires when the loaded asset has changed */\r\n    onAssetChanged?: (asset: IAsset) => void;\r\n    /** Event handler that fires right before an asset has changed */\r\n    onBeforeAssetChanged?: () => boolean;\r\n}\r\n\r\n/**\r\n * State for Asset Preview\r\n * @member loaded - Asset is loaded\r\n */\r\nexport interface IAssetPreviewState {\r\n    loaded: boolean;\r\n    hasError: boolean;\r\n}\r\n\r\n/**\r\n * @name - Asset Preview\r\n * @description - Small preview of assets for selection in editor page\r\n */\r\nexport class AssetPreview extends React.Component<IAssetPreviewProps, IAssetPreviewState> {\r\n    /** Default properties for component if not defined */\r\n    public static defaultProps: IAssetPreviewProps = {\r\n        asset: null,\r\n        controlsEnabled: true,\r\n    };\r\n\r\n    constructor(props: IAssetPreviewProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            loaded: false,\r\n            hasError: false,\r\n        };\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: Readonly<IAssetPreviewProps>) {\r\n        if (this.props.asset.id !== prevProps.asset.id) {\r\n            this.setState({\r\n                loaded: false,\r\n                hasError: false,\r\n            });\r\n\r\n            if (this.props.onAssetChanged) {\r\n                this.props.onAssetChanged(this.props.asset);\r\n            }\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { loaded, hasError } = this.state;\r\n        const size = this.props.asset.size;\r\n        const classNames = [\"asset-preview\"];\r\n        if (size) {\r\n            if (size.width > size.height) {\r\n                classNames.push(\"landscape\");\r\n            } else {\r\n                classNames.push(\"portrait\");\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div className={classNames.join(\" \")}>\r\n                <div className=\"asset-preview-container\">\r\n                    {!loaded &&\r\n                        <div className=\"asset-loading\">\r\n                            <div className=\"asset-loading-spinner\">\r\n                                <Spinner size={SpinnerSize.small} />\r\n                            </div>\r\n                        </div>\r\n                    }\r\n                    {this.props.asset.isRunningOCR &&\r\n                        <div className=\"asset-loading\">\r\n                            <div className=\"asset-loading-ocr-spinner\">\r\n                                <Label className=\"p-0\" ></Label>\r\n                                <Spinner size={SpinnerSize.small} label=\"Running OCR...\" ariaLive=\"off\" labelPosition=\"right\"/>\r\n                            </div>\r\n                        </div>\r\n                    }\r\n                    {hasError &&\r\n                        <div className=\"asset-error text-danger\">\r\n                            <i className=\"fas fa-2x fa-exclamation-circle\" />\r\n                            <p className=\"m-2\">{strings.editorPage.assetError}</p>\r\n                        </div>\r\n                    }\r\n                    {!hasError &&\r\n                        this.renderAsset()\r\n                    }\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderAsset = () => {\r\n        const { asset } = this.props;\r\n        const rootAsset = asset.parent || asset;\r\n\r\n        switch (asset.type) {\r\n            case AssetType.Image:\r\n                return <ImageAsset asset={rootAsset}\r\n                    onLoaded={this.onAssetLoad}\r\n                    onError={this.onError}\r\n                    onActivated={this.props.onActivated}\r\n                    onDeactivated={this.props.onDeactivated} />;\r\n            case AssetType.TIFF:\r\n                return <TiffAsset asset={rootAsset}\r\n                    onLoaded={this.onAssetLoad}\r\n                    onError={this.onError}\r\n                    onActivated={this.props.onActivated}\r\n                    onDeactivated={this.props.onDeactivated} />;\r\n            case AssetType.PDF:\r\n                return <PDFAsset asset={rootAsset}\r\n                    onLoaded={this.onAssetLoad}\r\n                    onError={this.onError}\r\n                    onActivated={this.props.onActivated}\r\n                    onDeactivated={this.props.onDeactivated} />;\r\n            default:\r\n                return <div className=\"asset-error\">{strings.editorPage.assetError}</div>;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internal event handler for when the referenced asset has been loaded\r\n     * @param contentSource The visual HTML element of the asset (img/video tag)\r\n     */\r\n    private onAssetLoad = (contentSource: ContentSource) => {\r\n        this.setState({\r\n            loaded: true,\r\n        }, () => {\r\n            if (this.props.onLoaded) {\r\n                this.props.onLoaded(contentSource);\r\n            }\r\n        });\r\n    }\r\n\r\n    private onError = (e: SyntheticEvent) => {\r\n        this.setState({\r\n            hasError: true,\r\n            loaded: true,\r\n        }, () => {\r\n            if (this.props.onError) {\r\n                this.props.onError(e);\r\n            }\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport RcAlign, { AlignProps } from \"rc-align\";\r\nimport \"./align.scss\";\r\n\r\nexport function Align(props: AlignProps) {\r\n    const { children } = props;\r\n    return (\r\n        children &&\r\n        <RcAlign {...props}>\r\n            <div className=\"align-portal\">\r\n                {children}\r\n            </div>\r\n        </RcAlign>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { AlignProps } from \"rc-align\";\r\nimport { Align } from \"./align\";\r\nimport \"./align.scss\";\r\n\r\nexport class AlignPortal extends React.Component<AlignProps> {\r\n\r\n    private portalElement: Element;\r\n\r\n    constructor(props: AlignProps) {\r\n        super(props);\r\n        this.portalElement = document.createElement(\"div\");\r\n        this.portalElement.classList.add(\"align-portal-sticky\");\r\n    }\r\n\r\n    public componentDidMount() {\r\n        document.body.appendChild(this.portalElement);\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        document.body.removeChild(this.portalElement);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            ReactDOM.createPortal(\r\n                <Align {...this.props}/>\r\n                , this.portalElement)\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IconButton } from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { ITag } from \"../../../../models/applicationState\";\r\n\r\nenum Categories {\r\n    General,\r\n    Separator,\r\n    Modifier,\r\n}\r\n\r\n/** Properties for tag input toolbar */\r\nexport interface ITagInputToolbarProps {\r\n    /** Currently selected tag */\r\n    selectedTag: ITag;\r\n    /** Function to call when add tags button is clicked */\r\n    onAddTags: () => void;\r\n    /** Function to call when search tags button is clicked */\r\n    onSearchTags: () => void;\r\n    /** Function to call when lock tags button is clicked */\r\n    onLockTag: (tag: ITag) => void;\r\n    /** Function to call when edit tag button is clicked */\r\n    onRenameTag: (tag: ITag) => void;\r\n    /** Function to call when delete button is clicked */\r\n    onDelete: (tag: ITag) => void;\r\n    /** Function to call when one of the re-order buttons is clicked */\r\n    onReorder: (tag: ITag, displacement: number) => void;\r\n}\r\n\r\ninterface ITagInputToolbarItemProps {\r\n    displayName: string;\r\n    icon?: string;\r\n    category?: Categories;\r\n    handler?: () => void;\r\n    accelerators?: string[];\r\n}\r\n\r\nexport default class TagInputToolbar extends React.Component<ITagInputToolbarProps> {\r\n    public render() {\r\n        return (\r\n            <div className=\"tag-input-toolbar\">\r\n                {this.renderItems()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getToolbarItems = (): ITagInputToolbarItemProps[] => {\r\n        return [\r\n            {\r\n                displayName: strings.tags.toolbar.add,\r\n                icon: \"Add\",\r\n                category: Categories.General,\r\n                handler: this.handleAdd,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.search,\r\n                icon: \"Search\",\r\n                category: Categories.General,\r\n                handler: this.handleSearch,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.vertiline,\r\n                category: Categories.Separator,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.rename,\r\n                icon: \"Rename\",\r\n                category: Categories.Modifier,\r\n                handler: this.handleRename,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.moveUp,\r\n                icon: \"Up\",\r\n                category: Categories.Modifier,\r\n                handler: this.handleMoveUp,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.moveDown,\r\n                icon: \"Down\",\r\n                category: Categories.Modifier,\r\n                handler: this.handleMoveDown,\r\n            },\r\n            {\r\n                displayName: strings.tags.toolbar.delete,\r\n                icon: \"Delete\",\r\n                category: Categories.Modifier,\r\n                handler: this.handleDelete,\r\n            },\r\n        ];\r\n    }\r\n\r\n    private renderItems = () => {\r\n        const modifierDisabled = !this.props.selectedTag;\r\n        const modifierClassNames = [\"tag-input-toolbar-iconbutton\"];\r\n        if (modifierDisabled) {\r\n            modifierClassNames.push(\"tag-input-toolbar-iconbutton-disabled\");\r\n        }\r\n\r\n        const modifierClassName = modifierClassNames.join(\" \");\r\n\r\n        return(\r\n            this.getToolbarItems().map((itemConfig, index) => {\r\n                if (itemConfig.category === Categories.General) {\r\n                    return (\r\n                        <IconButton\r\n                            key={itemConfig.displayName}\r\n                            title={itemConfig.displayName}\r\n                            ariaLabel={itemConfig.displayName}\r\n                            className=\"tag-input-toolbar-iconbutton\"\r\n                            iconProps={{iconName: itemConfig.icon}}\r\n                            autoFocus={!index}\r\n                            onClick={(e) => this.onToolbarItemClick(e, itemConfig)} />\r\n                    );\r\n                } else if (itemConfig.category === Categories.Separator) {\r\n                    return (<div className=\"tag-input-toolbar-separator\" key={itemConfig.displayName}></div>);\r\n                } else if (itemConfig.category === Categories.Modifier) {\r\n                    return (\r\n                        <IconButton\r\n                            key={itemConfig.displayName}\r\n                            disabled={modifierDisabled}\r\n                            title={itemConfig.displayName}\r\n                            ariaLabel={itemConfig.displayName}\r\n                            className={modifierClassName}\r\n                            iconProps={{iconName: itemConfig.icon}}\r\n                            onClick={(e) => this.onToolbarItemClick(e, itemConfig)} />\r\n                    );\r\n                } else {\r\n                    throw new Error(`Unsupported item category ${itemConfig.category}`);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    private onToolbarItemClick = (e: any, itemConfig: ITagInputToolbarItemProps): void => {\r\n        e.stopPropagation();\r\n        itemConfig.handler();\r\n    }\r\n\r\n    private handleAdd = () => {\r\n        this.props.onAddTags();\r\n    }\r\n\r\n    private handleSearch = () => {\r\n        this.props.onSearchTags();\r\n    }\r\n\r\n    private handleRename = () => {\r\n        if (this.props.selectedTag) {\r\n            this.props.onRenameTag(this.props.selectedTag);\r\n        }\r\n    }\r\n\r\n    private handleMoveUp = () => {\r\n        if (this.props.selectedTag) {\r\n            this.props.onReorder(this.props.selectedTag, -1);\r\n        }\r\n    }\r\n\r\n    private handleMoveDown = () => {\r\n        if (this.props.selectedTag) {\r\n            this.props.onReorder(this.props.selectedTag, 1);\r\n        }\r\n    }\r\n\r\n    private handleDelete = () => {\r\n        if (this.props.selectedTag) {\r\n            this.props.onDelete(this.props.selectedTag);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { GithubPicker } from \"react-color\";\r\n\r\nexport interface IColorPickerProps {\r\n    show: boolean;\r\n    color: string;\r\n    colors: string[];\r\n    onEditColor: (color: string) => void;\r\n}\r\n\r\nexport class ColorPicker extends React.Component<IColorPickerProps> {\r\n\r\n    private pickerBackground = \"#252526\";\r\n\r\n    public render() {\r\n        return (\r\n            this.props.show &&\r\n            this.GithubPicker()\r\n        );\r\n    }\r\n\r\n    private onChange = (color) => {\r\n        this.props.onEditColor(color.hex);\r\n    }\r\n\r\n    private GithubPicker = () => {\r\n        return (\r\n            <div className=\"color-picker-container\">\r\n                <GithubPicker\r\n                    color={{hex: this.props.color}}\r\n                    onChangeComplete={this.onChange}\r\n                    colors={this.props.colors}\r\n                    width={160}\r\n                    styles={{\r\n                        default: {\r\n                            card: {\r\n                                background: this.pickerBackground,\r\n                            },\r\n                        },\r\n                    }}\r\n                    triangle={\"hide\"}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { ILabel, IFormRegion } from \"../../../../models/applicationState\";\r\n\r\nexport interface ITagInputItemLabelProps {\r\n    label: ILabel;\r\n    onLabelEnter: (label: ILabel) => void;\r\n    onLabelLeave: (label: ILabel) => void;\r\n}\r\n\r\nexport interface ITagInputItemLabelState {}\r\n\r\nexport default class TagInputItemLabel extends React.Component<ITagInputItemLabelProps, ITagInputItemLabelState> {\r\n    public render() {\r\n        return (\r\n            <div\r\n                className={\"tag-item-label px-2\"}\r\n                onMouseEnter={this.handleMouseEnter}\r\n                onMouseLeave={this.handleMouseLeave}>\r\n                {this.props.label.value.map((formRegion: IFormRegion) => formRegion.text).join(\" \")}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private handleMouseEnter = () => {\r\n        this.props.onLabelEnter(this.props.label);\r\n    }\r\n\r\n    private handleMouseLeave = () => {\r\n        this.props.onLabelLeave(this.props.label);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport const tagIndexKeys: string[] = [\r\n    \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\",\r\n    \"q\", \"w\", \"e\", \"r\", \"t\", \"y\", \"u\", \"i\", \"o\", \"p\",\r\n    \"a\", \"s\", \"d\", \"f\", \"g\", \"h\", \"j\", \"k\", \"l\",\r\n    \"z\", \"x\", \"c\", \"v\", \"b\", \"n\", \"m\",\r\n];\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { MouseEvent } from \"react\";\r\nimport { FontIcon, IconButton } from \"office-ui-fabric-react\";\r\nimport { ITag, ILabel, FieldType, FieldFormat } from \"../../../../models/applicationState\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport TagInputItemLabel from \"./tagInputItemLabel\";\r\nimport { tagIndexKeys } from \"./tagIndexKeys\";\r\n\r\nexport interface ITagClickProps {\r\n    ctrlKey?: boolean;\r\n    altKey?: boolean;\r\n    keyClick?: boolean;\r\n    clickedColor?: boolean;\r\n    clickedDropDown?: boolean;\r\n}\r\n\r\n/**\r\n * Properties for tag input item\r\n */\r\nexport interface ITagInputItemProps {\r\n    /** Tag represented by item */\r\n    tag: ITag;\r\n    /** Index of tag within tags array */\r\n    index: number;\r\n    /** Labels owned by the tag */\r\n    labels: ILabel[];\r\n    /** Tag is currently renaming */\r\n    isRenaming: boolean;\r\n    /** Tag is currently locked for application */\r\n    isLocked: boolean;\r\n    /** Tag is currently selected */\r\n    isSelected: boolean;\r\n    /** Tag is currently applied to one of the selected regions */\r\n    appliedToSelectedRegions: boolean;\r\n    /** Function to call upon clicking item */\r\n    onClick: (tag: ITag, props: ITagClickProps) => void;\r\n    /** Apply new name to tag */\r\n    onRename: (oldTag: ITag, newName: string, cancelCallback: () => void) => void;\r\n    onLabelEnter: (label: ILabel) => void;\r\n    onLabelLeave: (label: ILabel) => void;\r\n    onTagChanged?: (oldTag: ITag, newTag: ITag) => void;\r\n}\r\n\r\nexport interface ITagInputItemState {\r\n    /** Tag is currently renaming */\r\n    isRenaming: boolean;\r\n\r\n    /** Tag is currently locked for application */\r\n    isLocked: boolean;\r\n}\r\n\r\nexport default class TagInputItem extends React.Component<ITagInputItemProps, ITagInputItemState> {\r\n\r\n    public state: ITagInputItemState = {\r\n        isRenaming: false,\r\n        isLocked: false,\r\n    };\r\n\r\n    private itemRef = React.createRef<HTMLDivElement>();\r\n    private inputElement: HTMLInputElement;\r\n\r\n    public componentDidUpdate(prevProps: ITagInputItemProps) {\r\n        if (prevProps.isRenaming !== this.props.isRenaming) {\r\n            this.setState({\r\n                isRenaming: this.props.isRenaming,\r\n            });\r\n        }\r\n\r\n        if (prevProps.isLocked !== this.props.isLocked) {\r\n            this.setState({\r\n                isLocked: this.props.isLocked,\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const style: any = {\r\n            background: this.props.tag.color,\r\n        };\r\n\r\n        return (\r\n            <div className={\"tag-item-block\"}>\r\n                <div\r\n                    className={\"tag-color\"}\r\n                    style={style}\r\n                    onClick={this.onColorClick}>\r\n                </div>\r\n                <div className={\"tag-item-block-2\"}>\r\n                    {\r\n                        this.props.tag &&\r\n                        <div\r\n                            ref={this.itemRef}\r\n                            className={this.getItemClassName()}\r\n                            style={style}>\r\n                            <div\r\n                                className={\"tag-content pr-2\"}\r\n                                onClick={this.onNameClick}>\r\n                                {this.getTagContent()}\r\n                            </div>\r\n                            {\r\n                                this.state.isLocked &&\r\n                                <div></div>\r\n                            }\r\n                        </div>\r\n                    }\r\n                    {this.renderTagDetail()}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public getTagNameRef() {\r\n        return this.itemRef;\r\n    }\r\n\r\n    private onDropdownClick = (e: MouseEvent<HTMLButtonElement>) => {\r\n        e.stopPropagation();\r\n\r\n        const clickedDropDown = true;\r\n        this.props.onClick(this.props.tag, { clickedDropDown });\r\n    }\r\n\r\n    private onColorClick = (e: MouseEvent) => {\r\n        e.stopPropagation();\r\n\r\n        const ctrlKey = e.ctrlKey || e.metaKey;\r\n        const altKey = e.altKey;\r\n        const clickedColor = true;\r\n        this.props.onClick(this.props.tag, { ctrlKey, altKey, clickedColor });\r\n    }\r\n\r\n    private onNameClick = (e: MouseEvent) => {\r\n        e.stopPropagation();\r\n\r\n        const ctrlKey = e.ctrlKey || e.metaKey;\r\n        const altKey = e.altKey;\r\n        this.props.onClick(this.props.tag, { ctrlKey, altKey });\r\n    }\r\n\r\n    private getItemClassName = () => {\r\n        const classNames = [\"tag-item\"];\r\n        if (this.props.isSelected) {\r\n            classNames.push(\"tag-item-selected\");\r\n        }\r\n        if (this.props.appliedToSelectedRegions) {\r\n            classNames.push(\"tag-item-applied\");\r\n        }\r\n        return classNames.join(\" \");\r\n    }\r\n\r\n    private getTagContent = () => {\r\n        const displayIndex = this.getDisplayIndex();\r\n        return (\r\n            <div className={\"tag-name-container\"}\r\n                onMouseEnter={this.handleMouseEnter}\r\n                onMouseLeave={this.handleMouseLeave}>\r\n                {\r\n                    (this.isTypeOrFormatSpecified()) &&\r\n                    <FontIcon iconName=\"Link\" className=\"pl-1\" />\r\n                }\r\n                <div className=\"tag-name-body\">\r\n                    {\r\n                        this.state.isRenaming\r\n                        ?\r\n                        <input\r\n                            ref={this.onInputRef}\r\n                            className={`tag-name-editor ${this.getContentClassName()}`}\r\n                            type=\"text\"\r\n                            defaultValue={this.props.tag.name}\r\n                            onKeyDown={(e) => this.onInputKeyDown(e)}\r\n                            onBlur={this.onInputBlur}\r\n                            autoFocus={true}\r\n                        />\r\n                        :\r\n                        <span title={this.props.tag.name} className={this.getContentClassName()}>\r\n                            {this.props.tag.name}\r\n                        </span>\r\n                    }\r\n                </div>\r\n                <div className={\"tag-icons-container\"}>\r\n                    {(displayIndex !== null)\r\n                        ?\r\n                        <span className=\"tag-index-span border border-white rounded-sm \">{displayIndex}</span>\r\n                        :\r\n                        <span className=\"tag-index-span\"></span>\r\n                    }\r\n                    <IconButton\r\n                        title={strings.tags.toolbar.contextualMenu}\r\n                        ariaLabel={strings.tags.toolbar.contextualMenu}\r\n                        className=\"tag-input-toolbar-iconbutton ml-2\"\r\n                        iconProps={{iconName: \"ChevronDown\"}}\r\n                        onClick={this.onDropdownClick} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderTagDetail = () => {\r\n        return this.props.labels.map((label, idx) =>\r\n            <TagInputItemLabel\r\n                key={idx}\r\n                label={label}\r\n                onLabelEnter={this.props.onLabelEnter}\r\n                onLabelLeave={this.props.onLabelLeave}\r\n            />);\r\n    }\r\n\r\n    private onInputRef = (element: HTMLInputElement) => {\r\n        this.inputElement = element;\r\n        if (element) {\r\n            element.select();\r\n        }\r\n    }\r\n\r\n    private onInputBlur = (e: React.FocusEvent<HTMLInputElement>) => {\r\n        this.onRenameTag();\r\n    }\r\n\r\n    private onInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === \"Enter\") {\r\n            this.inputElement.blur();\r\n        } else if (e.key === \"Escape\") {\r\n            this.setState({\r\n                isRenaming: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onRenameTag() {\r\n        if (!this.inputElement) {\r\n            return;\r\n        }\r\n        const tag = this.props.tag;\r\n        const name = this.inputElement.value.trim();\r\n        this.props.onRename(tag, name, () => {\r\n            this.setState({\r\n                isRenaming: false,\r\n            });\r\n        });\r\n    }\r\n\r\n    private getContentClassName = () => {\r\n        const classNames = [\"tag-name-text px-2 pb-1\"];\r\n        if (this.isTypeOrFormatSpecified()) {\r\n            classNames.push(\"tag-name-text-typed\");\r\n        }\r\n        return classNames.join(\" \");\r\n    }\r\n\r\n    private getDisplayIndex = () => {\r\n        const index = this.props.index;\r\n        if (index >= 0 && index < tagIndexKeys.length) {\r\n            return tagIndexKeys[index];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private isTypeOrFormatSpecified = () => {\r\n        const {tag} = this.props;\r\n        return (tag.type && tag.type !== FieldType.String) ||\r\n            (tag.format && tag.format !== FieldFormat.NotSpecified);\r\n    }\r\n\r\n    private handleMouseEnter = () => {\r\n        const { labels } = this.props;\r\n        if (labels.length > 0) {\r\n            this.props.onLabelEnter(labels[0]);\r\n        }\r\n    }\r\n\r\n    private handleMouseLeave = () => {\r\n        const { labels } = this.props;\r\n        if (labels.length > 0) {\r\n            this.props.onLabelLeave(labels[0]);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { KeyboardEvent } from \"react\";\r\nimport {\r\n    ContextualMenu,\r\n    ContextualMenuItemType,\r\n    Customizer,\r\n    FontIcon,\r\n    IContextualMenuItem,\r\n    ICustomizations,\r\n} from \"office-ui-fabric-react\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport { getDarkTheme } from \"../../../../common/themes\";\r\nimport { AlignPortal } from \"../align/alignPortal\";\r\nimport { randomIntInRange } from \"../../../../common/utils\";\r\nimport { IRegion, ITag, ILabel, FieldType, FieldFormat } from \"../../../../models/applicationState\";\r\nimport { ColorPicker } from \"../colorPicker\";\r\nimport \"./tagInput.scss\";\r\nimport \"../condensedList/condensedList.scss\";\r\nimport TagInputItem, { ITagInputItemProps, ITagClickProps } from \"./tagInputItem\";\r\nimport TagInputToolbar from \"./tagInputToolbar\";\r\nimport { toast } from \"react-toastify\";\r\n// tslint:disable-next-line:no-var-requires\r\nconst tagColors = require(\"../../common/tagColors.json\");\r\n\r\nenum TagMenuItem {\r\n    Delete = \"delete\",\r\n    MoveUp = \"moveup\",\r\n    MoveDown = \"movedown\",\r\n    Rename = \"rename\",\r\n}\r\n\r\nexport enum TagOperationMode {\r\n    None,\r\n    ColorPicker,\r\n    ContextualMenu,\r\n    Rename,\r\n}\r\n\r\nexport interface ITagInputProps {\r\n    /** Current list of tags */\r\n    tags: ITag[];\r\n    /** Function called on tags change */\r\n    onChange: (tags: ITag[]) => void;\r\n    /** Currently selected regions in canvas */\r\n    selectedRegions?: IRegion[];\r\n    /** The labels in the canvas */\r\n    labels: ILabel[];\r\n    /** Tags that are currently locked for editing experience */\r\n    lockedTags?: string[];\r\n    /** Updates to locked tags */\r\n    onLockedTagsChange?: (locked: string[]) => void;\r\n    /** Place holder for input text box */\r\n    placeHolder?: string;\r\n    /** Function to call on clicking individual tag */\r\n    onTagClick?: (tag: ITag) => void;\r\n    /** Function to call on clicking individual tag while holding CTRL key */\r\n    onCtrlTagClick?: (tag: ITag) => void;\r\n    /** Function to call when tag is renamed */\r\n    onTagRename?: (oldTag: ITag, newTag: ITag, cancelCallback: () => void) => void;\r\n    /** Function to call when tag is deleted */\r\n    onTagDeleted?: (tagName: string) => void;\r\n    /** Always show tag input box */\r\n    showTagInputBox?: boolean;\r\n    /** Always show tag search box */\r\n    showSearchBox?: boolean;\r\n    /** Callback function for TagInputItemLabel mouse enter */\r\n    onLabelEnter: (label: ILabel) => void;\r\n    /** Callback function for TagInputItemLabel mouse leave */\r\n    onLabelLeave: (label: ILabel) => void;\r\n    /** Function to handle tag change */\r\n    onTagChanged?: (oldTag: ITag, newTag: ITag) => void;\r\n}\r\n\r\nexport interface ITagInputState {\r\n    tags: ITag[];\r\n    tagOperation: TagOperationMode;\r\n    addTags: boolean;\r\n    searchTags: boolean;\r\n    searchQuery: string;\r\n    selectedTag: ITag;\r\n}\r\n\r\nfunction filterFormat(type: FieldType): FieldFormat[] {\r\n    switch (type) {\r\n        case FieldType.String:\r\n            return [\r\n                FieldFormat.NotSpecified,\r\n                FieldFormat.Alphanumeric,\r\n                FieldFormat.NoWhiteSpaces,\r\n            ];\r\n        case FieldType.Number:\r\n            return [\r\n                FieldFormat.NotSpecified,\r\n                FieldFormat.Currency,\r\n            ];\r\n        case FieldType.Integer:\r\n            return [\r\n                FieldFormat.NotSpecified,\r\n            ];\r\n        case FieldType.Date:\r\n            return [\r\n                FieldFormat.NotSpecified,\r\n                FieldFormat.DMY,\r\n                FieldFormat.MDY,\r\n                FieldFormat.YMD,\r\n            ];\r\n        case FieldType.Time:\r\n            return [\r\n                FieldFormat.NotSpecified,\r\n            ];\r\n        default:\r\n            return [ FieldFormat.NotSpecified ];\r\n    }\r\n}\r\n\r\nfunction isNameEqual(x: string, y: string) {\r\n    return x.trim().toLocaleLowerCase() === y.trim().toLocaleLowerCase();\r\n}\r\n\r\nexport class TagInput extends React.Component<ITagInputProps, ITagInputState> {\r\n\r\n    public state: ITagInputState = {\r\n        tags: this.props.tags || [],\r\n        tagOperation: TagOperationMode.None,\r\n        addTags: this.props.showTagInputBox,\r\n        searchTags: this.props.showSearchBox,\r\n        searchQuery: \"\",\r\n        selectedTag: null,\r\n    };\r\n\r\n    private tagItemRefs: Map<string, TagInputItem> = new Map<string, TagInputItem>();\r\n    private headerRef = React.createRef<HTMLDivElement>();\r\n    private inputRef = React.createRef<HTMLInputElement>();\r\n\r\n    public componentDidUpdate(prevProps: ITagInputProps) {\r\n        if (prevProps.tags !== this.props.tags) {\r\n            let selectedTag = this.state.selectedTag;\r\n            if (selectedTag) {\r\n                selectedTag = this.props.tags.find((tag) => isNameEqual(tag.name, selectedTag.name));\r\n            }\r\n\r\n            this.setState({\r\n                tags: this.props.tags,\r\n                selectedTag,\r\n            });\r\n        }\r\n\r\n        if (prevProps.selectedRegions !== this.props.selectedRegions && this.props.selectedRegions.length > 0) {\r\n            this.setState({\r\n                selectedTag: null,\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const dark: ICustomizations = {\r\n            settings: {\r\n              theme: getDarkTheme(),\r\n            },\r\n            scopedSettings: {},\r\n        };\r\n\r\n        const { selectedTag, tagOperation } = this.state;\r\n        const selectedTagRef = selectedTag ? this.tagItemRefs.get(selectedTag.name).getTagNameRef() : null;\r\n\r\n        return (\r\n            <div className=\"tag-input\">\r\n                <div ref={this.headerRef} className=\"tag-input-header p-2\">\r\n                    <span className=\"tag-input-title\">{strings.tags.title}</span>\r\n                    <TagInputToolbar\r\n                        selectedTag={this.state.selectedTag}\r\n                        onAddTags={() => this.setState({ addTags: !this.state.addTags })}\r\n                        onSearchTags={() => this.setState({\r\n                            searchTags: !this.state.searchTags,\r\n                            searchQuery: \"\",\r\n                        })}\r\n                        onRenameTag={this.onRenameTag}\r\n                        onLockTag={this.onLockTag}\r\n                        onDelete={this.onDeleteTag}\r\n                        onReorder={this.onReOrder}\r\n                    />\r\n                </div>\r\n                <div className=\"tag-input-body-container\">\r\n                    <div className=\"tag-input-body\">\r\n                        {\r\n                            this.state.searchTags &&\r\n                            <div className=\"tag-input-text-input-row search-input\">\r\n                                <input\r\n                                    className=\"tag-search-box\"\r\n                                    type=\"text\"\r\n                                    onKeyDown={this.onSearchKeyDown}\r\n                                    onChange={(e) => this.setState({ searchQuery: e.target.value })}\r\n                                    placeholder=\"Search tags\"\r\n                                    autoFocus={true}\r\n                                />\r\n                                <FontIcon iconName=\"Search\" />\r\n                            </div>\r\n                        }\r\n                        <div className=\"tag-input-items\">\r\n                            {this.renderTagItems()}\r\n                            <Customizer {...dark}>\r\n                                {\r\n                                    tagOperation === TagOperationMode.ContextualMenu && selectedTagRef &&\r\n                                    <ContextualMenu\r\n                                        className=\"tag-input-contextual-menu\"\r\n                                        items={this.getContextualMenuItems()}\r\n                                        target={selectedTagRef}\r\n                                        onDismiss={this.onHideContextualMenu}\r\n                                    />\r\n                                }\r\n                            </Customizer>\r\n                            {this.getColorPickerPortal()}\r\n                        </div>\r\n                        {\r\n                            this.state.addTags &&\r\n                            <div className=\"tag-input-text-input-row new-tag-input\">\r\n                                <input\r\n                                    className=\"tag-input-box\"\r\n                                    type=\"text\"\r\n                                    onKeyDown={this.onAddTagKeyDown}\r\n                                    // Add mouse event\r\n                                    onBlur={this.onAddTagWithBlur}\r\n                                    placeholder=\"Add new tag\"\r\n                                    autoFocus={true}\r\n                                    ref={this.inputRef}\r\n                                />\r\n                                <FontIcon iconName=\"Tag\" />\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public triggerNewTagBlur() {\r\n        if (this.inputRef.current) {\r\n            this.inputRef.current.blur();\r\n        }\r\n    }\r\n\r\n    private onRenameTag = (tag: ITag) => {\r\n        const tagOperation = this.state.tagOperation === TagOperationMode.Rename\r\n            ? TagOperationMode.None : TagOperationMode.Rename;\r\n        this.setState({\r\n            tagOperation,\r\n        });\r\n    }\r\n\r\n    private onLockTag = (tag: ITag) => {\r\n        if (!tag) {\r\n            return;\r\n        }\r\n        let lockedTags = [...this.props.lockedTags];\r\n        if (lockedTags.find((str) => isNameEqual(tag.name, str))) {\r\n            lockedTags = lockedTags.filter((str) => !isNameEqual(tag.name, str));\r\n        } else {\r\n            lockedTags.push(tag.name);\r\n        }\r\n        this.props.onLockedTagsChange(lockedTags);\r\n    }\r\n\r\n    private onReOrder = (tag: ITag, displacement: number) => {\r\n        if (!tag) {\r\n            return;\r\n        }\r\n        const tags = [...this.state.tags];\r\n        const currentIndex = tags.indexOf(tag);\r\n        const newIndex = currentIndex + displacement;\r\n        if (newIndex < 0 || newIndex >= tags.length) {\r\n            return;\r\n        }\r\n        tags.splice(currentIndex, 1);\r\n        tags.splice(newIndex, 0, tag);\r\n        this.setState({\r\n            tags,\r\n        }, () => this.props.onChange(tags));\r\n    }\r\n\r\n    private handleColorChange = (color: string) => {\r\n        const tag = this.state.selectedTag;\r\n        const tags = this.state.tags.map((t) => {\r\n            return (isNameEqual(t.name, tag.name)) ? {\r\n                ...tag,\r\n                color,\r\n            } : t;\r\n        });\r\n        this.setState({\r\n            tags,\r\n            tagOperation: TagOperationMode.None,\r\n        }, () => this.props.onChange(tags));\r\n    }\r\n\r\n    private addTag = (tag: ITag) => {\r\n        try {\r\n            this.validateTagLength(tag);\r\n            this.validateTagUniqness(tag, this.state.tags);\r\n        } catch (error) {\r\n            toast.warn(error.toString());\r\n            return;\r\n        }\r\n\r\n        const tags = [...this.state.tags, tag];\r\n        this.setState({\r\n            tags,\r\n        }, () => this.props.onChange(tags));\r\n    }\r\n\r\n    private onTagRename = (tag: ITag, name: string, cancelCallback: () => void) => {\r\n        const cancelRename = () => {\r\n            cancelCallback();\r\n            this.setState({\r\n                tagOperation: TagOperationMode.None,\r\n            });\r\n        };\r\n\r\n        if (isNameEqual(tag.name, name)) {\r\n            cancelRename();\r\n            return;\r\n        }\r\n\r\n        const newTag = {\r\n            ...tag,\r\n            name,\r\n        };\r\n\r\n        try {\r\n            const tagsWithoutOldTag = this.state.tags.filter((elem) => !isNameEqual(elem.name, tag.name));\r\n            this.validateTagLength(newTag);\r\n            this.validateTagUniqness(newTag, tagsWithoutOldTag);\r\n        } catch (error) {\r\n            toast.warn(error.toString());\r\n            return;\r\n        }\r\n\r\n        if (this.props.onTagRename) {\r\n            this.props.onTagRename(tag, newTag, cancelRename);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private onDeleteTag = (tag: ITag) => {\r\n        if (!tag) {\r\n            return;\r\n        }\r\n        this.props.onTagDeleted(tag.name);\r\n    }\r\n\r\n    private getColorPickerPortal = () => {\r\n        const { selectedTag } = this.state;\r\n        const showColorPicker = this.state.tagOperation === TagOperationMode.ColorPicker;\r\n        return (\r\n            <AlignPortal align={{points: [ \"tr\", \"tl\" ]}} target={() => this.headerRef.current}>\r\n                <div className=\"tag-input-colorpicker-container\">\r\n                    {\r\n                        showColorPicker &&\r\n                        <ColorPicker\r\n                            color={selectedTag && selectedTag.color}\r\n                            colors={tagColors}\r\n                            onEditColor={this.handleColorChange}\r\n                            show={showColorPicker}\r\n                        />\r\n                    }\r\n                </div>\r\n            </AlignPortal>\r\n        );\r\n    }\r\n\r\n    private renderTagItems = () => {\r\n        let props = this.createTagItemProps();\r\n        const query = this.state.searchQuery;\r\n        this.tagItemRefs.clear();\r\n\r\n        if (query.length) {\r\n            props = props.filter((prop) => prop.tag.name.toLowerCase().includes(query.toLowerCase()));\r\n        }\r\n\r\n        return props.map((prop) =>\r\n            <TagInputItem\r\n                {...prop}\r\n                key={prop.tag.name}\r\n                labels={this.setTagLabels(prop.tag.name)}\r\n                ref={(item) => this.setTagItemRef(item, prop.tag)}\r\n                onLabelEnter={this.props.onLabelEnter}\r\n                onLabelLeave={this.props.onLabelLeave}\r\n                onTagChanged={this.props.onTagChanged}\r\n            />);\r\n    }\r\n\r\n    private setTagItemRef = (item: TagInputItem, tag: ITag) => {\r\n        this.tagItemRefs.set(tag.name, item);\r\n        return item;\r\n    }\r\n\r\n    private setTagLabels = (key: string): ILabel[] => {\r\n        return this.props.labels.filter((label) => label.label === key);\r\n    }\r\n\r\n    private createTagItemProps = (): ITagInputItemProps[] => {\r\n        const { tags, selectedTag, tagOperation } = this.state;\r\n        const selectedRegionTagSet = this.getSelectedRegionTagSet();\r\n\r\n        return tags.map((tag) => (\r\n            {\r\n                tag,\r\n                index: tags.findIndex((t) => isNameEqual(t.name, tag.name)),\r\n                isLocked: this.props.lockedTags\r\n                    && this.props.lockedTags.findIndex((str) => isNameEqual(tag.name, str)) > -1,\r\n                isRenaming: selectedTag && isNameEqual(selectedTag.name, tag.name)\r\n                    && tagOperation === TagOperationMode.Rename,\r\n                isSelected: selectedTag && isNameEqual(selectedTag.name, tag.name),\r\n                appliedToSelectedRegions: selectedRegionTagSet.has(tag.name),\r\n                onClick: this.onTagItemClick,\r\n                onRename: this.onTagRename,\r\n            } as ITagInputItemProps\r\n        ));\r\n    }\r\n\r\n    private getSelectedRegionTagSet = (): Set<string> => {\r\n        const result = new Set<string>();\r\n        if (this.props.selectedRegions) {\r\n            for (const region of this.props.selectedRegions) {\r\n                for (const tag of region.tags) {\r\n                    result.add(tag);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private onTagItemClick = (tag: ITag, props: ITagClickProps) => {\r\n        if (props.ctrlKey && this.props.onCtrlTagClick) { // Lock tags\r\n            this.props.onCtrlTagClick(tag);\r\n        } else if (props.altKey) { // Edit tag\r\n            this.setState({\r\n                selectedTag: tag,\r\n                tagOperation: TagOperationMode.Rename,\r\n            });\r\n        } else if (props.clickedDropDown) {\r\n            const { selectedTag } = this.state;\r\n            const showContextualMenu = !selectedTag || !isNameEqual(selectedTag.name, tag.name)\r\n                || this.state.tagOperation !== TagOperationMode.ContextualMenu;\r\n            const tagOperation = showContextualMenu ? TagOperationMode.ContextualMenu : TagOperationMode.None;\r\n            this.setState({\r\n                selectedTag: tag,\r\n                tagOperation,\r\n            });\r\n        } else if (props.clickedColor) {\r\n            const { selectedTag, tagOperation } = this.state;\r\n            const showColorPicker = tagOperation !== TagOperationMode.ColorPicker;\r\n            const newTagOperation = showColorPicker ? TagOperationMode.ColorPicker : TagOperationMode.None;\r\n            this.setState({\r\n                selectedTag: showColorPicker ? tag : selectedTag,\r\n                tagOperation: newTagOperation,\r\n            });\r\n        } else { // Select tag\r\n            const { selectedTag, tagOperation: oldTagOperation } = this.state;\r\n            const selected = selectedTag && isNameEqual(selectedTag.name, tag.name);\r\n            const tagOperation = selected ? oldTagOperation : TagOperationMode.None;\r\n            let deselect = selected && oldTagOperation === TagOperationMode.None;\r\n\r\n            // Only fire click event if a region is selected\r\n            if (this.props.selectedRegions &&\r\n                this.props.selectedRegions.length > 0 &&\r\n                this.props.onTagClick) {\r\n                deselect = false;\r\n                this.props.onTagClick(tag);\r\n            }\r\n\r\n            this.setState({\r\n                selectedTag: deselect ? null : tag,\r\n                tagOperation,\r\n            });\r\n\r\n       }\r\n    }\r\n\r\n    private onSearchKeyDown = (event: KeyboardEvent): void => {\r\n        if (event.key === \"Escape\") {\r\n            this.setState({\r\n                searchTags: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onAddTagKeyDown = (event) => {\r\n        // Add handle mouse event functionality\r\n        if (event.key === \"Enter\") {\r\n            // validate and add\r\n            this.creatTagInput(event.target.value.trim());\r\n            event.target.value = \"\";\r\n        }\r\n        if (event.key === \"Escape\") {\r\n            this.setState({\r\n                addTags: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onAddTagWithBlur = (event: any) => {\r\n        if (event.target.value) {\r\n            this.creatTagInput(event.target.value.trim());\r\n            event.target.value = \"\";\r\n        }\r\n    }\r\n\r\n    private creatTagInput = (value: any) => {\r\n        const newTag: ITag = {\r\n                name: value,\r\n                color: this.getNextColor(),\r\n                type: FieldType.String,\r\n                format: FieldFormat.NotSpecified,\r\n        };\r\n        if (newTag.name.length && ![...this.state.tags, newTag].containsDuplicates((t) => t.name)) {\r\n            this.addTag(newTag);\r\n        } else if (!newTag.name.length) {\r\n            toast.warn(strings.tags.warnings.emptyName);\r\n        } else {\r\n            toast.warn(strings.tags.warnings.existingName);\r\n        }\r\n    }\r\n\r\n    private getNextColor = () => {\r\n        const tags = this.state.tags;\r\n\r\n        for (const color of tagColors) {\r\n            let vacancy = true;\r\n            for (const tag of tags) {\r\n                if (color.toLowerCase() === tag.color.toLowerCase()) {\r\n                    vacancy = false;\r\n                    break;\r\n                }\r\n            }\r\n            if (vacancy) {\r\n                return color;\r\n            }\r\n        }\r\n\r\n        return tagColors[randomIntInRange(0, tagColors.length - 1)];\r\n    }\r\n\r\n    private validateTagLength = (tag: ITag) => {\r\n        if (!tag.name.trim().length) {\r\n            throw new Error(strings.tags.warnings.emptyName);\r\n        }\r\n        if (tag.name.length >= 128) {\r\n            throw new Error(\"Tag name is too long (>= 128).\");\r\n        }\r\n    }\r\n\r\n    private validateTagUniqness = (tag: ITag, tags: ITag[]) => {\r\n        if (tags.some((t) => isNameEqual(t.name, tag.name))) {\r\n            throw new Error(strings.tags.warnings.existingName);\r\n        }\r\n    }\r\n\r\n    private onHideContextualMenu = () => {\r\n        this.setState({tagOperation: TagOperationMode.None});\r\n    }\r\n\r\n    private getContextualMenuItems = (): IContextualMenuItem[] => {\r\n        const tag = this.state.selectedTag;\r\n        if (!tag) {\r\n            return [];\r\n        }\r\n\r\n        const menuItems: IContextualMenuItem[] = [\r\n            {\r\n                key: \"type\",\r\n                iconProps: {\r\n                    iconName: \"Link\",\r\n                },\r\n                text: tag.type ? tag.type : strings.tags.toolbar.type,\r\n                subMenuProps: {\r\n                    items: this.getTypeSubMenuItems(),\r\n                },\r\n            },\r\n            {\r\n                key: \"format\",\r\n                iconProps: {\r\n                    iconName: \"Link\",\r\n                },\r\n                text: tag.format ? tag.format : strings.tags.toolbar.format,\r\n                subMenuProps: {\r\n                    items: this.getFormatSubMenuItems(),\r\n                },\r\n            },\r\n            {\r\n                key: \"divider_1\",\r\n                itemType: ContextualMenuItemType.Divider,\r\n            },\r\n            {\r\n                key: TagMenuItem.Rename,\r\n                iconProps: {\r\n                    iconName: \"Rename\",\r\n                },\r\n                text: strings.tags.toolbar.rename,\r\n                onClick: this.onMenuItemClick,\r\n            },\r\n            {\r\n                key: TagMenuItem.MoveUp,\r\n                iconProps: {\r\n                    iconName: \"Up\",\r\n                },\r\n                text: strings.tags.toolbar.moveUp,\r\n                onClick: this.onMenuItemClick,\r\n            },\r\n            {\r\n                key: TagMenuItem.MoveDown,\r\n                iconProps: {\r\n                    iconName: \"Down\",\r\n                },\r\n                text: strings.tags.toolbar.moveDown,\r\n                onClick: this.onMenuItemClick,\r\n            },\r\n            {\r\n                key: TagMenuItem.Delete,\r\n                iconProps: {\r\n                    iconName: \"Delete\",\r\n                },\r\n                text: strings.tags.toolbar.delete,\r\n                onClick: this.onMenuItemClick,\r\n            },\r\n        ];\r\n\r\n        return menuItems;\r\n    }\r\n\r\n    private getTypeSubMenuItems = (): IContextualMenuItem[] => {\r\n        const tag = this.state.selectedTag;\r\n        const types = Object.values(FieldType);\r\n\r\n        return types.map((type) => {\r\n            return {\r\n                key: type,\r\n                text: type,\r\n                canCheck: true,\r\n                isChecked: type === tag.type,\r\n                onClick: this.onTypeSelect,\r\n            } as IContextualMenuItem;\r\n        });\r\n    }\r\n\r\n    private getFormatSubMenuItems = (): IContextualMenuItem[] => {\r\n        const tag = this.state.selectedTag;\r\n        const formats = filterFormat(tag.type);\r\n\r\n        return formats.map((format) => {\r\n            return {\r\n                key: format,\r\n                text: format,\r\n                canCheck: true,\r\n                isChecked: format === tag.format,\r\n                onClick: this.onFormatSelect,\r\n            } as IContextualMenuItem;\r\n        });\r\n    }\r\n\r\n    private onTypeSelect = (event: React.MouseEvent<HTMLButtonElement>, item?: IContextualMenuItem): void => {\r\n        event.preventDefault();\r\n        const type = item.text as FieldType;\r\n        const tag = this.state.selectedTag;\r\n        if (type === tag.type) {\r\n            return;\r\n        }\r\n\r\n        const newTag = {\r\n            ...tag,\r\n            type,\r\n            format: FieldFormat.NotSpecified,\r\n        };\r\n\r\n        if (this.props.onTagChanged) {\r\n            this.props.onTagChanged(tag, newTag);\r\n        }\r\n    }\r\n\r\n    private onFormatSelect = (event: React.MouseEvent<HTMLButtonElement>, item?: IContextualMenuItem): void => {\r\n        event.preventDefault();\r\n        const format = item.text as FieldFormat;\r\n        const tag = this.state.selectedTag;\r\n        if (format === tag.format) {\r\n            return;\r\n        }\r\n\r\n        const newTag = {\r\n            ...tag,\r\n            format,\r\n        };\r\n\r\n        if (this.props.onTagChanged) {\r\n            this.props.onTagChanged(tag, newTag);\r\n        }\r\n    }\r\n\r\n    private onMenuItemClick = (event: React.MouseEvent<HTMLButtonElement>, item?: IContextualMenuItem): void => {\r\n        event.preventDefault();\r\n        const tag = this.state.selectedTag;\r\n        if (!tag) {\r\n            return;\r\n        }\r\n\r\n        switch (item.key) {\r\n            case TagMenuItem.MoveDown:\r\n                this.onReOrder(tag, 1);\r\n                break;\r\n            case TagMenuItem.MoveUp:\r\n                this.onReOrder(tag, -1);\r\n                break;\r\n            case TagMenuItem.Rename:\r\n                this.onRenameTag(tag);\r\n                break;\r\n            case TagMenuItem.Delete:\r\n                this.onDeleteTag(tag);\r\n                break;\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"../common/guard\";\r\nimport { IProject } from \"../models/applicationState\";\r\nimport { IStorageProvider, StorageProviderFactory } from \"../providers/storage/storageProviderFactory\";\r\nimport { constants } from \"../common/constants\";\r\nimport ServiceHelper from \"./serviceHelper\";\r\n\r\nexport enum OcrStatus {\r\n    loadingFromAzureBlob,\r\n    runningOCR,\r\n    done,\r\n}\r\n\r\n/**\r\n * @name - OCR Service\r\n * @description - Functions for dealing with OCR\r\n */\r\nexport class OCRService {\r\n    private storageProviderInstance: IStorageProvider;\r\n\r\n    constructor(private project: IProject) {\r\n        Guard.null(project);\r\n    }\r\n\r\n    /**\r\n     * get recognized text from OCR service\r\n     * @param filePath - filepath sent to OCR\r\n     * @param fileName - name of OCR file\r\n     */\r\n    public async getRecognizedText(\r\n        filePath: string,\r\n        fileName: string,\r\n        onStatusChanged?: (ocrStatus: OcrStatus) => void): Promise<any> {\r\n        Guard.empty(filePath);\r\n        Guard.empty(this.project.apiUriBase);\r\n\r\n        const notifyStatusChanged = (ocrStatus: OcrStatus) => onStatusChanged && onStatusChanged(ocrStatus);\r\n        const ocrFileName = decodeURIComponent(`${fileName}${constants.ocrFileExtension}`);\r\n\r\n        let ocrJson;\r\n        try {\r\n            notifyStatusChanged(OcrStatus.loadingFromAzureBlob);\r\n            ocrJson = await this.readOcrFile(ocrFileName);\r\n            if (!this.isValidOcrFormat(ocrJson)) {\r\n                ocrJson = await this.fetchOcrUriResult(filePath, ocrFileName);\r\n            }\r\n        } catch (e) {\r\n            notifyStatusChanged(OcrStatus.runningOCR);\r\n            ocrJson = await this.fetchOcrUriResult(filePath, ocrFileName);\r\n        } finally {\r\n            notifyStatusChanged(OcrStatus.done);\r\n        }\r\n\r\n        return ocrJson;\r\n    }\r\n\r\n    /**\r\n     * Get Storage Provider from project's target connection\r\n     */\r\n    protected get storageProvider(): IStorageProvider {\r\n        if (!this.storageProviderInstance) {\r\n            this.storageProviderInstance = StorageProviderFactory.create(\r\n                this.project.sourceConnection.providerType,\r\n                this.project.sourceConnection.providerOptions,\r\n            );\r\n        }\r\n\r\n        return this.storageProviderInstance;\r\n    }\r\n\r\n    private readOcrFile = async (ocrFileName: string) => {\r\n        const json = await this.storageProvider.readText(ocrFileName, true);\r\n        if (json !== null) {\r\n            return new Promise((resolve, reject) => {\r\n                resolve(JSON.parse(json));\r\n            });\r\n        }\r\n    }\r\n\r\n    private fetchOcrUriResult = async (filePath: string, ocrFileName: string) => {\r\n        try {\r\n            const headers = { \"Content-Type\": \"application/json\" };\r\n            const response = await ServiceHelper.postWithAutoRetry(\r\n                this.project.apiUriBase + \"/formrecognizer/v2.0-preview/layout/analyze\",\r\n                { url: filePath },\r\n                { headers },\r\n                this.project.apiKey as string,\r\n            );\r\n\r\n            const operationLocation = response.headers[\"operation-location\"];\r\n            return this.poll(\r\n                () => ServiceHelper.getWithAutoRetry(operationLocation, { headers }, this.project.apiKey as string),\r\n                120000,\r\n                1500).then((data) => {\r\n                    this.save(ocrFileName, data);\r\n                    return data;\r\n                });\r\n        } catch (err) {\r\n            ServiceHelper.handleServiceError(err);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save OCR\r\n     * @param metadata - Metadata for asset\r\n     */\r\n    private async save(fileName: string, ocrJson: any): Promise<any> {\r\n        Guard.empty(fileName);\r\n        Guard.null(ocrJson);\r\n\r\n        await this.storageProvider.writeText(fileName, JSON.stringify(ocrJson, null, 4));\r\n        return ocrJson;\r\n    }\r\n\r\n    /**\r\n     * Poll function to repeatly check if request succeeded\r\n     * @param func - function that will be called repeatly\r\n     * @param timeout - timeout\r\n     * @param interval - interval\r\n     */\r\n    private poll = (func, timeout, interval): Promise<any> => {\r\n        const endTime = Number(new Date()) + (timeout || 10000);\r\n        interval = interval || 100;\r\n\r\n        const checkSucceeded = (resolve, reject) => {\r\n            const ajax = func();\r\n            ajax.then((response) => {\r\n                if (response.data.status.toLowerCase() === constants.statusCodeSucceeded) {\r\n                    resolve(response.data);\r\n                } else if (Number(new Date()) < endTime) {\r\n                    // If the request isn't succeeded and the timeout hasn't elapsed, go again\r\n                    setTimeout(checkSucceeded, interval, resolve, reject);\r\n                } else {\r\n                    // Didn't succeeded after too much time, reject\r\n                    reject(new Error(\"Timed out for getting OCR results\"));\r\n                }\r\n            });\r\n        };\r\n\r\n        return new Promise(checkSucceeded);\r\n    }\r\n\r\n    private isValidOcrFormat = (ocr): boolean => {\r\n        return ocr && ocr.analyzeResult && ocr.analyzeResult.readResults;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Static functions to assist in operations within Canvas component\r\n */\r\nexport default class CanvasHelpers {\r\n\r\n    /**\r\n     * Adds tag (and remove others) to array if it does not contain the tag,\r\n     * @param tags Array of tags\r\n     * @param tag Tag to add\r\n     */\r\n    public static setSingleTag(tags: string[], tag: string): string[] {\r\n        return [tag];\r\n    }\r\n\r\n    /**\r\n     * Adds tag to array if it does not contain the tag,\r\n     * removes tag if already contained. Performs operations in place\r\n     * @param tags Array of tags\r\n     * @param tag Tag to toggle\r\n     */\r\n    public static toggleTag(tags: string[], tag: string): string[] {\r\n        const tagIndex = tags.findIndex((existingTag) => existingTag === tag);\r\n        if (tagIndex === -1) {\r\n            // Tag isn't found within region tags, add it\r\n            return [...tags, tag];\r\n        } else {\r\n            // Tag is within region tags, remove it\r\n            return tags.filter((t) => t !== tag);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport default class Utils {\r\n    // convert degree to radians\r\n    public static degreeToRadians(degree: number) {\r\n        return degree * Math.PI * 2 / 360;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Feature, MapBrowserEvent, View } from \"ol\";\r\nimport { Extent, getCenter } from \"ol/extent\";\r\nimport { defaults as defaultInteractions, DragPan, Interaction } from \"ol/interaction.js\";\r\nimport ImageLayer from \"ol/layer/Image\";\r\nimport Layer from \"ol/layer/Layer\";\r\nimport VectorLayer from \"ol/layer/Vector\";\r\nimport Map from \"ol/Map\";\r\nimport Projection from \"ol/proj/Projection\";\r\nimport Static from \"ol/source/ImageStatic.js\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport * as React from \"react\";\r\nimport \"./styles.css\";\r\nimport Utils from \"./utils\";\r\n\r\ninterface IImageMapProps {\r\n    imageUri: string;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    imageAngle?: number;\r\n\r\n    featureStyler?: any;\r\n    tableBorderFeatureStyler?: any;\r\n    tableIconFeatureStyler?: any;\r\n    tableIconBorderFeatureStyler?: any;\r\n\r\n    enableFeatureSelection?: boolean;\r\n    handleTextFeatureSelect?: (feature: any, isTaggle: boolean) => void;\r\n    hoveringFeature?: string;\r\n\r\n    onMapReady: () => void;\r\n    handleTableToolTipChange?: (display: string, width: number, height: number, top: number,\r\n                                left: number, rows: number, columns: number, featureID: string) => void;\r\n\r\n}\r\n\r\nexport class ImageMap extends React.Component<IImageMapProps> {\r\n    private map: Map;\r\n    private imageLayer: ImageLayer;\r\n    private textVectorLayer: VectorLayer;\r\n    private tableBorderVectorLayer: VectorLayer;\r\n    private tableIconVectorLayer: VectorLayer;\r\n    private tableIconBorderVectorLayer: VectorLayer;\r\n\r\n    private mapElement: HTMLDivElement | null = null;\r\n\r\n    private imageExtent: number[];\r\n\r\n    private countPointerDown: number = 0;\r\n    private isSwiping: boolean = false;\r\n\r\n    private readonly TEXT_VECTOR_LAYER_NAME = \"textVectorLayer\";\r\n    private readonly TABLE_BORDER_VECTOR_LAYER_NAME = \"tableBorderVectorLayer\";\r\n    private readonly TABLE_ICON_VECTOR_LAYER_NAME = \"tableIconVectorLayer\";\r\n    private readonly TABLE_ICON_BORDER_VECTOR_LAYER_NAME = \"tableIconBorderVectorLayer\";\r\n\r\n    private ignorePointerMoveEventCount: number = 5;\r\n    private pointerMoveEventCount: number = 0;\r\n\r\n    private textVectorLayerFilter = {\r\n        layerFilter: (layer: Layer) => layer.get(\"name\") === this.TEXT_VECTOR_LAYER_NAME,\r\n    };\r\n\r\n    private tableIconBorderVectorLayerFilter = {\r\n        layerFilter: (layer: Layer) => layer.get(\"name\") === this.TABLE_ICON_BORDER_VECTOR_LAYER_NAME,\r\n    };\r\n\r\n    constructor(props: IImageMapProps) {\r\n        super(props);\r\n\r\n        this.imageExtent = [0, 0, this.props.imageWidth, this.props.imageHeight];\r\n    }\r\n\r\n    public componentDidMount() {\r\n        this.initMap();\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: IImageMapProps) {\r\n        if (prevProps.imageUri !== this.props.imageUri) {\r\n            this.imageExtent = [0, 0, this.props.imageWidth, this.props.imageHeight];\r\n            this.setImage(this.props.imageUri, this.imageExtent);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"map-wrapper\">\r\n                <div id=\"map\" className=\"map\" ref={(el) => this.mapElement = el}></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Hide/Display table features\r\n     */\r\n    public toggleTableFeatureVisibility = () => {\r\n        this.tableBorderVectorLayer.setVisible(!this.tableBorderVectorLayer.getVisible());\r\n        this.tableIconVectorLayer.setVisible(!this.tableIconVectorLayer.getVisible());\r\n        this.tableIconBorderVectorLayer.setVisible(!this.tableIconBorderVectorLayer.getVisible());\r\n    }\r\n\r\n    public getResolutionForZoom = (zoom: number) => {\r\n        return this.map.getView().getResolutionForZoom(zoom);\r\n    }\r\n\r\n    /**\r\n     * Hide/Display text features\r\n     */\r\n    public toggleTextFeatureVisibility = () => {\r\n        this.textVectorLayer.setVisible(!this.textVectorLayer.getVisible());\r\n    }\r\n\r\n    /**\r\n     * Add one feature to the map\r\n     */\r\n    public addFeature = (feature: Feature) => {\r\n        this.textVectorLayer.getSource().addFeature(feature);\r\n    }\r\n\r\n    public addTableBorderFeature = (feature: Feature) => {\r\n        this.tableBorderVectorLayer.getSource().addFeature(feature);\r\n    }\r\n\r\n    public addTableIconFeature = (feature: Feature) => {\r\n        this.tableIconVectorLayer.getSource().addFeature(feature);\r\n    }\r\n\r\n    public addTableIconBorderFeature = (feature: Feature) => {\r\n        this.tableIconBorderVectorLayer.getSource().addFeature(feature);\r\n    }\r\n\r\n    /**\r\n     * Add features to the map\r\n     */\r\n    public addFeatures = (features: Feature[]) => {\r\n        this.textVectorLayer.getSource().addFeatures(features);\r\n    }\r\n\r\n    public addTableBorderFeatures = (features: Feature[]) => {\r\n        this.tableBorderVectorLayer.getSource().addFeatures(features);\r\n    }\r\n\r\n    public addTableIconFeatures = (features: Feature[]) => {\r\n        this.tableIconVectorLayer.getSource().addFeatures(features);\r\n    }\r\n\r\n    public addTableIconBorderFeatures = (features: Feature[]) => {\r\n        this.tableIconBorderVectorLayer.getSource().addFeatures(features);\r\n    }\r\n\r\n    /**\r\n     * Add interaction to the map\r\n     */\r\n    public addInteraction = (interaction: Interaction) => {\r\n        this.map.addInteraction(interaction);\r\n    }\r\n\r\n    /**\r\n     * Get all features from the map\r\n     */\r\n    public getAllFeatures = () => {\r\n        return this.textVectorLayer.getSource().getFeatures();\r\n    }\r\n\r\n    public getFeatureByID = (featureID) => {\r\n        return this.textVectorLayer.getSource().getFeatureById(featureID);\r\n    }\r\n\r\n    public getTableBorderFeatureByID = (featureID) => {\r\n        return this.tableBorderVectorLayer.getSource().getFeatureById(featureID);\r\n    }\r\n\r\n    public getTableIconFeatureByID = (featureID) => {\r\n        return this.tableIconVectorLayer.getSource().getFeatureById(featureID);\r\n    }\r\n\r\n    public getTableIconBorderFeatureByID = (featureID) => {\r\n        return this.tableIconBorderVectorLayer.getSource().getFeatureById(featureID);\r\n    }\r\n\r\n    /**\r\n     * Remove specific feature object from the map\r\n     */\r\n    public removeFeature = (feature: Feature) => {\r\n        this.textVectorLayer.getSource().removeFeature(feature);\r\n    }\r\n\r\n    /**\r\n     * Remove all features from the map\r\n     */\r\n    public removeAllFeatures = () => {\r\n        if (this.props.handleTableToolTipChange) {\r\n            this.props.handleTableToolTipChange(\"none\", 0, 0, 0, 0, 0, 0, null);\r\n        }\r\n        this.textVectorLayer.getSource().clear();\r\n        this.tableBorderVectorLayer.getSource().clear();\r\n        this.tableIconVectorLayer.getSource().clear();\r\n        this.tableIconBorderVectorLayer.getSource().clear();\r\n\r\n    }\r\n\r\n    /**\r\n     * Remove interaction from the map\r\n     */\r\n    public removeInteraction = (interaction: Interaction) => {\r\n        this.map.removeInteraction(interaction);\r\n    }\r\n\r\n    /**\r\n     * Get the image extent (left, top, right, bottom)\r\n     */\r\n    public getImageExtent = () => {\r\n        return this.imageExtent;\r\n    }\r\n\r\n    /**\r\n     * Get features at specific extend\r\n     */\r\n    public getFeaturesInExtent = (extent: Extent): Feature[] => {\r\n        const features: Feature[] = [];\r\n        this.textVectorLayer.getSource().forEachFeatureInExtent(extent, (feature) => {\r\n            features.push(feature);\r\n        });\r\n        return features;\r\n    }\r\n\r\n    public zoomIn = () => {\r\n        this.map.getView().setZoom(this.map.getView().getZoom() + 0.3);\r\n    }\r\n\r\n    public zoomOut = () => {\r\n        this.map.getView().setZoom(this.map.getView().getZoom() - 0.3);\r\n    }\r\n\r\n    public resetZoom = () => {\r\n        this.map.getView().setZoom(0);\r\n    }\r\n\r\n    private initMap = () => {\r\n        const projection = this.createProjection(this.imageExtent);\r\n\r\n        this.imageLayer = new ImageLayer({\r\n            source: this.createImageSource(this.props.imageUri, projection, this.imageExtent),\r\n        });\r\n\r\n        const textOptions: any = {};\r\n        textOptions.name = this.TEXT_VECTOR_LAYER_NAME;\r\n        textOptions.style = this.props.featureStyler;\r\n        textOptions.source = new VectorSource();\r\n        this.textVectorLayer = new VectorLayer(textOptions);\r\n\r\n        const tableBorderOptions: any = {};\r\n        tableBorderOptions.name = this.TABLE_BORDER_VECTOR_LAYER_NAME;\r\n        tableBorderOptions.style = this.props.tableBorderFeatureStyler;\r\n        tableBorderOptions.source = new VectorSource();\r\n        this.tableBorderVectorLayer = new VectorLayer(tableBorderOptions);\r\n\r\n        const tableIconOptions: any = {};\r\n        tableIconOptions.name = this.TABLE_ICON_VECTOR_LAYER_NAME;\r\n        tableIconOptions.style = this.props.tableIconFeatureStyler;\r\n        tableIconOptions.updateWhileAnimating = true;\r\n        tableIconOptions.updateWhileInteracting = true;\r\n        tableIconOptions.source = new VectorSource();\r\n        this.tableIconVectorLayer = new VectorLayer(tableIconOptions);\r\n\r\n        const tableIconBorderOptions: any = {};\r\n        tableIconBorderOptions.name = this.TABLE_ICON_BORDER_VECTOR_LAYER_NAME;\r\n        tableIconBorderOptions.style = this.props.tableIconBorderFeatureStyler;\r\n        tableIconBorderOptions.source = new VectorSource();\r\n        this.tableIconBorderVectorLayer = new VectorLayer(tableIconBorderOptions);\r\n\r\n        this.map = new Map({\r\n            controls: [] ,\r\n            interactions: defaultInteractions({ doubleClickZoom: false,\r\n                pinchRotate: false }),\r\n            target: \"map\",\r\n            layers: [\r\n                this.imageLayer,\r\n                this.textVectorLayer,\r\n                this.tableBorderVectorLayer,\r\n                this.tableIconVectorLayer,\r\n                this.tableIconBorderVectorLayer,\r\n            ],\r\n            view: this.createMapView(projection, this.imageExtent),\r\n        });\r\n\r\n        this.map.on(\"pointerdown\", this.handlePointerDown);\r\n        this.map.on(\"pointermove\", this.handlePointerMove);\r\n        this.map.on(\"pointermove\", this.handlePointerMoveOnTableIcon);\r\n        this.map.on(\"pointerup\", this.handlePointerUp);\r\n    }\r\n\r\n    private setImage = (imageUri: string, imageExtent: number[]) => {\r\n        const projection = this.createProjection(imageExtent);\r\n        this.imageLayer.setSource(this.createImageSource(imageUri, projection, imageExtent));\r\n        const mapView = this.createMapView(projection, imageExtent);\r\n        this.map.setView(mapView);\r\n    }\r\n\r\n    private createProjection = (imageExtend: number[]) => {\r\n        return new Projection({\r\n            code: \"xkcd-image\",\r\n            units: \"pixels\",\r\n            extent: imageExtend,\r\n        });\r\n    }\r\n\r\n    private createMapView = (projection: Projection, imageExtend: number[]) => {\r\n        const minZoom = this.getMinimumZoom();\r\n        const rotation = (this.props.imageAngle)\r\n            ? Utils.degreeToRadians((this.props.imageAngle + 360) % 360)\r\n            : 0;\r\n\r\n        return new View({\r\n            projection,\r\n            center: getCenter(imageExtend),\r\n            rotation,\r\n            zoom: minZoom,\r\n            minZoom,\r\n        });\r\n    }\r\n\r\n    private createImageSource = (imageUri: string, projection: Projection, imageExtend: number[]) => {\r\n        return new Static({\r\n            url: imageUri,\r\n            projection,\r\n            imageExtent: imageExtend,\r\n        });\r\n    }\r\n\r\n    private getMinimumZoom = () => {\r\n        // In openlayers, the image will be projected into 256x256 pixels,\r\n        // and image will be 2x larger at each zoom level.\r\n        // https://openlayers.org/en/latest/examples/min-zoom.html\r\n\r\n        const containerAspectRatio = (this.mapElement)\r\n            ? (this.mapElement.clientHeight / this.mapElement.clientWidth) : 1;\r\n        const imageAspectRatio = this.props.imageHeight / this.props.imageWidth;\r\n        if (imageAspectRatio > containerAspectRatio) {\r\n            // Fit to width\r\n            return Math.LOG2E * Math.log(this.mapElement!.clientHeight / 256);\r\n        } else {\r\n            // Fit to height\r\n            return Math.LOG2E * Math.log(this.mapElement!.clientWidth / 256);\r\n        }\r\n    }\r\n\r\n    private handlePointerDown = (event: MapBrowserEvent) => {\r\n        if (!this.props.enableFeatureSelection) {\r\n            return;\r\n        }\r\n\r\n        this.countPointerDown += 1;\r\n        if (this.countPointerDown >= 2) {\r\n            this.setDragPanInteraction(true /*dragPanEnabled*/);\r\n            this.isSwiping = false;\r\n            return;\r\n        }\r\n\r\n        const eventPixel =  this.map.getEventPixel(event.originalEvent);\r\n\r\n        const isPointerOnTextFeature = this.map.hasFeatureAtPixel(\r\n            eventPixel,\r\n            this.textVectorLayerFilter);\r\n\r\n        if (isPointerOnTextFeature && this.props.handleTextFeatureSelect) {\r\n            this.map.forEachFeatureAtPixel(\r\n                eventPixel,\r\n                (feature) => {\r\n                    if (this.props.handleTextFeatureSelect) {\r\n                        this.props.handleTextFeatureSelect(feature, true /*isTaggle*/);\r\n                    }\r\n                },\r\n                this.textVectorLayerFilter);\r\n        }\r\n        this.setDragPanInteraction(!isPointerOnTextFeature /*dragPanEnabled*/);\r\n        this.isSwiping = isPointerOnTextFeature;\r\n    }\r\n\r\n    private handlePointerMoveOnTableIcon = (event: MapBrowserEvent) => {\r\n        if (this.props.handleTableToolTipChange) {\r\n            const eventPixel = this.map.getEventPixel(event.originalEvent);\r\n            const isPointerOnTableIconFeature = this.map.hasFeatureAtPixel(eventPixel,\r\n                                                                           this.tableIconBorderVectorLayerFilter);\r\n            if (isPointerOnTableIconFeature) {\r\n                const features = this.map.getFeaturesAtPixel( eventPixel, this.tableIconBorderVectorLayerFilter);\r\n                if (features.length > 0) {\r\n                    const feature = features[0];\r\n                    if (feature && this.props.hoveringFeature !== feature.get(\"id\")) {\r\n                        const geometry = feature.getGeometry();\r\n                        const coordinates = geometry.getCoordinates();\r\n                        if (coordinates && coordinates.length > 0) {\r\n                            const pixels = [];\r\n                            pixels.push(this.map.getPixelFromCoordinate(coordinates[0][0]));\r\n                            pixels.push(this.map.getPixelFromCoordinate(coordinates[0][1]));\r\n                            pixels.push(this.map.getPixelFromCoordinate(coordinates[0][2]));\r\n                            pixels.push(this.map.getPixelFromCoordinate(coordinates[0][3]));\r\n                            const flattenedLines = [].concat(...pixels);\r\n                            const xAxisValues = flattenedLines.filter((value, index) => index % 2 === 0);\r\n                            const yAxisValues = flattenedLines.filter((value, index) => index % 2 === 1);\r\n                            const left = Math.min(...xAxisValues);\r\n                            const top = Math.min(...yAxisValues);\r\n                            const right = Math.max(...xAxisValues);\r\n                            const bottom = Math.max(...yAxisValues);\r\n                            const width = right - left;\r\n                            const height = bottom - top;\r\n                            this.props.handleTableToolTipChange(\"block\", width + 2, height + 2, top + 43, left - 1,\r\n                                                                feature.get(\"rows\"), feature.get(\"columns\"),\r\n                                                                feature.get(\"id\"));\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (this.props.hoveringFeature !== null) {\r\n                    this.props.handleTableToolTipChange(\"none\", 0, 0, 0, 0, 0, 0, null);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private handlePointerMove = (event: MapBrowserEvent) => {\r\n        if (this.shouldIgnorePointerMove()) {\r\n            return;\r\n        }\r\n\r\n        // disable vertical scrolling for iOS Safari\r\n        event.preventDefault();\r\n\r\n        const eventPixel = this.map.getEventPixel(event.originalEvent);\r\n        this.map.forEachFeatureAtPixel(\r\n            eventPixel,\r\n            (feature) => {\r\n                if (this.props.handleTextFeatureSelect) {\r\n                    this.props.handleTextFeatureSelect(feature, false /*isTaggle*/);\r\n                }\r\n            },\r\n            this.textVectorLayerFilter);\r\n    }\r\n\r\n    private handlePointerUp = () => {\r\n        if (!this.props.enableFeatureSelection) {\r\n            return;\r\n        }\r\n\r\n        this.countPointerDown -= 1;\r\n        if (this.countPointerDown === 0) {\r\n            this.setDragPanInteraction(true /*dragPanEnabled*/);\r\n            this.isSwiping = false;\r\n            this.pointerMoveEventCount = 0;\r\n        }\r\n    }\r\n\r\n    private setDragPanInteraction = (dragPanEnabled: boolean) => {\r\n        this.map.getInteractions().forEach((interaction) => {\r\n            if (interaction instanceof DragPan) {\r\n                interaction.setActive(dragPanEnabled);\r\n            }\r\n        });\r\n    }\r\n\r\n    private shouldIgnorePointerMove = () => {\r\n        if (!this.props.enableFeatureSelection) {\r\n            return true;\r\n        }\r\n\r\n        if (!this.isSwiping) {\r\n            return true;\r\n        }\r\n\r\n        if (this.ignorePointerMoveEventCount > this.pointerMoveEventCount) {\r\n            ++this.pointerMoveEventCount;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport { CommandBar, ICommandBarItemProps } from \"office-ui-fabric-react/lib/CommandBar\";\r\nimport { ICustomizations, Customizer } from \"office-ui-fabric-react/lib/Utilities\";\r\nimport { getDarkGreyTheme } from \"../../../../common/themes\";\r\n\r\ninterface ICanvasCommandBarProps {\r\n    handleZoomIn: () => void;\r\n    handleZoomOut: () => void;\r\n    handleLayerChange: (layer: string) => void;\r\n    layers: any;\r\n}\r\n\r\nexport const CanvasCommandBar: React.FunctionComponent<ICanvasCommandBarProps> = (props) => {\r\n    const dark: ICustomizations = {\r\n        settings: {\r\n          theme: getDarkGreyTheme(),\r\n        },\r\n        scopedSettings: {},\r\n    };\r\n\r\n    const commandBarItems: ICommandBarItemProps[] = [\r\n        {\r\n          key: \"layers\",\r\n          text: \"Layers\",\r\n          iconProps: { iconName: \"MapLayers\" },\r\n          subMenuProps: {\r\n            items: [\r\n              {\r\n                key: \"table\",\r\n                text: \"Tables\",\r\n                canCheck: true,\r\n                iconProps: { iconName: \"Table\" },\r\n                isChecked: props.layers[\"tables\"],\r\n                onClick: () => props.handleLayerChange(\"tables\"),\r\n              },\r\n              {\r\n                key: \"text\",\r\n                text: \"Text\",\r\n                canCheck: true,\r\n                iconProps: { iconName: \"TextField\" },\r\n                isChecked: props.layers[\"text\"],\r\n                onClick: () => props.handleLayerChange(\"text\"),\r\n              },\r\n            ],\r\n          },\r\n        },\r\n    ];\r\n\r\n    const commandBarFarItems: ICommandBarItemProps[] = [\r\n        {\r\n            key: \"zoomOut\",\r\n            text: \"Zoom out\",\r\n            // This needs an ariaLabel since it's icon-only\r\n            ariaLabel: \"Zoom out\",\r\n            iconOnly: true,\r\n            iconProps: { iconName: \"ZoomOut\" },\r\n            onClick: () => props.handleZoomOut(),\r\n        },\r\n        {\r\n            key: \"zoomIn\",\r\n            text: \"Zoom in\",\r\n            // This needs an ariaLabel since it's icon-only\r\n            ariaLabel: \"Zoom in\",\r\n            iconOnly: true,\r\n            iconProps: { iconName: \"ZoomIn\" },\r\n            onClick: () => props.handleZoomIn(),\r\n        },\r\n    ];\r\n\r\n    return (\r\n        <Customizer {...dark}>\r\n            <CommandBar\r\n                items={commandBarItems}\r\n                farItems={commandBarFarItems}\r\n                ariaLabel=\"Use left and right arrow keys to navigate between commands\"\r\n            />\r\n        </Customizer>\r\n    );\r\n};\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { ReactElement } from \"react\";\r\nimport { Spinner, SpinnerSize } from \"office-ui-fabric-react/lib/Spinner\";\r\nimport { Label } from \"office-ui-fabric-react/lib/Label\";\r\nimport { IconButton } from \"office-ui-fabric-react/lib/Button\";\r\nimport {\r\n    EditorMode, IAssetMetadata,\r\n    IProject, IRegion, RegionType, AssetType, ILabelData, ILabel, ITag, IAsset, IFormRegion,\r\n} from \"../../../../models/applicationState\";\r\nimport CanvasHelpers from \"./canvasHelpers\";\r\nimport { AssetPreview } from \"../../common/assetPreview/assetPreview\";\r\nimport { ImageMap } from \"../../common/imageMap/imageMap\";\r\nimport \"./canvas.scss\";\r\nimport Style from \"ol/style/Style\";\r\nimport Icon from \"ol/style/Icon\";\r\nimport Point from \"ol/geom/Point\";\r\nimport Stroke from \"ol/style/Stroke\";\r\nimport Fill from \"ol/style/Fill\";\r\nimport { OCRService, OcrStatus } from \"../../../../services/ocrService\";\r\nimport { Feature } from \"ol\";\r\nimport { Extent } from \"ol/extent\";\r\nimport { KeyboardBinding } from \"../../common/keyboardBinding/keyboardBinding\";\r\nimport { KeyEventType } from \"../../common/keyboardManager/keyboardManager\";\r\nimport _ from \"lodash\";\r\nimport Alert from \"../../common/alert/alert\";\r\nimport * as pdfjsLib from \"pdfjs-dist\";\r\nimport Polygon from \"ol/geom/Polygon\";\r\nimport HtmlFileReader from \"../../../../common/htmlFileReader\";\r\nimport { parseTiffData, renderTiffToCanvas, loadImageToCanvas } from \"../../../../common/utils\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport { CanvasCommandBar } from \"./CanvasCommandBar\";\r\nimport { TooltipHost, ITooltipHostStyles } from \"office-ui-fabric-react\";\r\n\r\npdfjsLib.GlobalWorkerOptions.workerSrc = constants.pdfjsWorkerSrc(pdfjsLib.version);\r\nconst cMapUrl = constants.pdfjsCMapUrl(pdfjsLib.version);\r\n\r\nexport interface ICanvasProps extends React.Props<Canvas> {\r\n    selectedAsset: IAssetMetadata;\r\n    editorMode: EditorMode;\r\n    project: IProject;\r\n    lockedTags: string[];\r\n    hoveredLabel: ILabel;\r\n    children?: ReactElement<AssetPreview>;\r\n    onAssetMetadataChanged?: (assetMetadata: IAssetMetadata) => void;\r\n    onSelectedRegionsChanged?: (regions: IRegion[]) => void;\r\n    onCanvasRendered?: (canvas: HTMLCanvasElement) => void;\r\n    onRunningOCRStatusChanged?: (isRunning: boolean) => void;\r\n}\r\n\r\nexport interface ICanvasState {\r\n    currentAsset: IAssetMetadata;\r\n    imageUri: string;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    numPages: number;\r\n    currentPage: number;\r\n    ocr: any;\r\n    ocrForCurrentPage: any;\r\n    pdfFile: any;\r\n    tiffImages: any[];\r\n    isError: boolean;\r\n    errorTitle?: string;\r\n    errorMessage: string;\r\n    ocrStatus: OcrStatus;\r\n    layers: any;\r\n    tableIconTooltip: any;\r\n    hoveringFeature: string;\r\n}\r\n\r\ninterface IRegionOrder {\r\n    page: number;\r\n    order: number;\r\n}\r\n\r\nfunction hexToRgba(color: string, a: number) {\r\n    const hex = color.replace(\"#\", \"\");\r\n    let r = 255;\r\n    let g = 255;\r\n    let b = 255;\r\n    if (hex.length === 3) {\r\n        r = parseInt(hex.slice(0, 1).repeat(2), 16);\r\n        g = parseInt(hex.slice(1, 2).repeat(2), 16);\r\n        b = parseInt(hex.slice(2, 3).repeat(2), 16);\r\n    } else if (hex.length === 6) {\r\n        r = parseInt(hex.slice(0, 2), 16);\r\n        g = parseInt(hex.slice(2, 4), 16);\r\n        b = parseInt(hex.slice(4, 6), 16);\r\n    }\r\n\r\n    return `rgba(${r}, ${g}, ${b}, ${a})`;\r\n}\r\n\r\nexport default class Canvas extends React.Component<ICanvasProps, ICanvasState> {\r\n    public static defaultProps: ICanvasProps = {\r\n        editorMode: EditorMode.Select,\r\n        selectedAsset: null,\r\n        project: null,\r\n        lockedTags: [],\r\n        hoveredLabel: null,\r\n    };\r\n\r\n    public state: ICanvasState = {\r\n        currentAsset: this.props.selectedAsset,\r\n        imageUri: null,\r\n        imageWidth: 1024,\r\n        imageHeight: 768,\r\n        numPages: 1,\r\n        currentPage: 1,\r\n        ocr: null,\r\n        ocrForCurrentPage: {},\r\n        pdfFile: null,\r\n        tiffImages: [],\r\n        isError: false,\r\n        errorMessage: undefined,\r\n        ocrStatus: OcrStatus.done,\r\n        layers: {text: true, tables: true},\r\n        tableIconTooltip: { display: \"none\", width: 0, height: 0, top: 0, left: 0},\r\n        hoveringFeature: null,\r\n    };\r\n\r\n    private imageMap: ImageMap;\r\n\r\n    private ocrService: OCRService;\r\n\r\n    private selectedRegionIds: string[] = [];\r\n\r\n    private regionOrders: Array<Record<string, number>> = [];\r\n\r\n    private regionOrderById: string[][] = [];\r\n\r\n    private lastKeyBoardRegionId: string;\r\n\r\n    private applyTagFlag: boolean = false;\r\n\r\n    private pendingFlag: boolean = false;\r\n\r\n    public componentDidMount = async () => {\r\n        this.ocrService = new OCRService(this.props.project);\r\n        const asset = this.state.currentAsset.asset;\r\n        await this.loadImage();\r\n        await this.loadOcr();\r\n        this.loadLabelData(asset);\r\n    }\r\n\r\n    public componentDidUpdate = async (prevProps: Readonly<ICanvasProps>, prevState: Readonly<ICanvasState>) => {\r\n        // Handles asset changing\r\n        if (this.props.selectedAsset.asset.name !== prevProps.selectedAsset.asset.name ||\r\n            this.props.selectedAsset.asset.isRunningOCR !== prevProps.selectedAsset.asset.isRunningOCR) {\r\n            this.selectedRegionIds = [];\r\n            this.imageMap.removeAllFeatures();\r\n            this.setState({\r\n                currentAsset: this.props.selectedAsset,\r\n                ocr: null,\r\n                ocrForCurrentPage: {},\r\n                numPages: 1,\r\n                currentPage: 1,\r\n                pdfFile: null,\r\n                imageUri: null,\r\n                tiffImages: [],\r\n                layers: { tables : true, text: true },\r\n            }, async () => {\r\n                const asset = this.state.currentAsset.asset;\r\n                await this.loadImage();\r\n                await this.loadOcr();\r\n                this.loadLabelData(asset);\r\n            });\r\n        } else if (this.isLabelDataChanged(this.props, prevProps)) {\r\n            this.redrawFeatures(this.imageMap.getAllFeatures());\r\n            const newRegions = this.convertLabelDataToRegions(this.props.selectedAsset.labelData);\r\n            this.updateAssetRegions(newRegions);\r\n        }\r\n\r\n        if (this.props.hoveredLabel !== prevProps.hoveredLabel) {\r\n            this.imageMap.getAllFeatures().map(this.updateHighlightStatus);\r\n        }\r\n    }\r\n\r\n    public render = () => {\r\n        const hostStyles: Partial<ITooltipHostStyles> = {\r\n            root: {\r\n                position: \"absolute\",\r\n                top: this.state.tableIconTooltip.top,\r\n                left: this.state.tableIconTooltip.left,\r\n                width: this.state.tableIconTooltip.width,\r\n                height: this.state.tableIconTooltip.height,\r\n                display: this.state.tableIconTooltip.display,\r\n            },\r\n        };\r\n        return (\r\n            <div style={{ width: \"100%\", height: \"100%\" }}>\r\n                <KeyboardBinding\r\n                        displayName={\"Delete region\"}\r\n                        key={\"Delete\"}\r\n                        keyEventType={KeyEventType.KeyDown}\r\n                        accelerators={[\"Delete\", \"Backspace\", \"<\", \",\", \">\", \".\",\r\n                            \"{\", \"[\", \"}\", \"]\", \"+\", \"-\", \"/\", \"=\", \"_\", \"?\"]}\r\n                        handler={this.handleKeyDown}\r\n                />\r\n                <CanvasCommandBar\r\n                    handleLayerChange={this.handleLayerChange}\r\n                    handleZoomIn={this.handleCanvasZoomIn}\r\n                    handleZoomOut={this.handleCanvasZoomOut}\r\n                    layers={this.state.layers}\r\n                />\r\n                <ImageMap\r\n                    ref={(ref) => this.imageMap = ref}\r\n                    imageUri={this.state.imageUri}\r\n                    imageWidth={this.state.imageWidth}\r\n                    imageHeight={this.state.imageHeight}\r\n                    enableFeatureSelection={true}\r\n                    handleTextFeatureSelect={this.handleTextFeatureSelect}\r\n                    featureStyler={this.featureStyler}\r\n                    tableBorderFeatureStyler={this.tableBorderFeatureStyler}\r\n                    tableIconFeatureStyler={this.tableIconFeatureStyler}\r\n                    tableIconBorderFeatureStyler={this.tableIconBorderFeatureStyler}\r\n                    onMapReady={this.noOp}\r\n                    handleTableToolTipChange={this.handleTableToolTipChange}\r\n                    hoveringFeature={this.state.hoveringFeature}\r\n                />\r\n                <TooltipHost\r\n                    content={\"rows: \" + this.state.tableIconTooltip.rows +\r\n                             \" columns: \" + this.state.tableIconTooltip.columns}\r\n                    id=\"tableInfo\"\r\n                    styles={hostStyles}\r\n                >\r\n                    <div\r\n                        aria-describedby=\"tableInfo\"\r\n                        className=\"tooltip-container\"\r\n                        onClick={this.handleTableIconFeatureSelect}\r\n                    />\r\n                </TooltipHost>\r\n                { this.shouldShowPreviousPageButton() &&\r\n                    <IconButton\r\n                        className=\"toolbar-btn prev\"\r\n                        title=\"Previous\"\r\n                        iconProps={{iconName: \"ChevronLeft\"}}\r\n                        onClick={this.prevPage}\r\n                    />\r\n                }\r\n                { this.shouldShowNextPageButton() &&\r\n                    <IconButton\r\n                        className=\"toolbar-btn next\"\r\n                        title=\"Next\"\r\n                        onClick={this.nextPage}\r\n                        iconProps={{iconName: \"ChevronRight\"}}\r\n                    />\r\n                }\r\n                { this.shouldShowMultiPageIndicator() &&\r\n                    <p className=\"page-number\">\r\n                        Page {this.state.currentPage} of {this.state.numPages}\r\n                    </p>\r\n                }\r\n                { this.state.ocrStatus !== OcrStatus.done &&\r\n                    <div className=\"canvas-ocr-loading\">\r\n                        <div className=\"canvas-ocr-loading-spinner\">\r\n                            <Label className=\"p-0\" ></Label>\r\n                            <Spinner size={SpinnerSize.large} label=\"Running OCR...\" ariaLive=\"assertive\" labelPosition=\"right\"/>\r\n                        </div>\r\n                    </div>\r\n                }\r\n                <Alert\r\n                    show={this.state.isError}\r\n                    title={this.state.errorTitle || \"Error\"}\r\n                    message={this.state.errorMessage}\r\n                    onClose={() => this.setState({\r\n                        isError: false,\r\n                        errorTitle: undefined,\r\n                        errorMessage: undefined,\r\n                    })}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Toggles tag on all selected regions\r\n     * @param selectedTag Tag name\r\n     */\r\n    public applyTag = (tag: string) => {\r\n        const selectedRegions = this.getSelectedRegions();\r\n        const regionsEmpty = !selectedRegions || !selectedRegions.length;\r\n        if (!tag || regionsEmpty) {\r\n            return;\r\n        }\r\n\r\n        if (this.showMultiPageFieldWarningIfNecessary(tag, selectedRegions)) {\r\n            return;\r\n        }\r\n\r\n        const transformer: (tags: string[], tag: string) => string[] = CanvasHelpers.setSingleTag;\r\n        for (const selectedRegion of selectedRegions) {\r\n            selectedRegion.tags = transformer(selectedRegion.tags, tag);\r\n        }\r\n\r\n        this.updateRegions(selectedRegions);\r\n\r\n        this.selectedRegionIds = [];\r\n        if (this.props.onSelectedRegionsChanged) {\r\n            this.props.onSelectedRegionsChanged([]);\r\n        }\r\n\r\n        this.redrawFeatures(this.imageMap.getAllFeatures());\r\n        this.applyTagFlag = true;\r\n    }\r\n\r\n    private getSelectedRegions = (): IRegion[] => {\r\n        return this.state.currentAsset.regions.filter((r) => this.selectedRegionIds.find((id) => r.id === id));\r\n    }\r\n\r\n    private addRegions = (regions: IRegion[]) => {\r\n        this.addRegionsToAsset(regions);\r\n        this.addRegionsToImageMap(regions.filter((region) => region.pageNumber === this.state.currentPage));\r\n    }\r\n\r\n    private addRegionsToAsset = (regions: IRegion[]) => {\r\n        const regionsToBeKept = this.state.currentAsset.regions.filter((assetRegion) => {\r\n            return regions.findIndex((r) => r.id === assetRegion.id) === -1;\r\n        });\r\n        this.updateAssetRegions(regionsToBeKept.concat(regions));\r\n    }\r\n\r\n    private addRegionsToImageMap = (regions: IRegion[]) => {\r\n        if (this.imageMap == null) {\r\n            return;\r\n        }\r\n        const allFeatures = this.imageMap.getAllFeatures();\r\n        const regionsNotInFeatures = regions.filter((region) =>\r\n            allFeatures.findIndex((feature) => feature.get(\"id\") === region.id) === -1);\r\n        const imageExtent = this.imageMap.getImageExtent();\r\n        const featuresToAdd = regionsNotInFeatures.map((region) => this.convertRegionToFeature(region, imageExtent));\r\n        this.imageMap.addFeatures(featuresToAdd);\r\n    }\r\n\r\n    private convertRegionToFeature = (region: IRegion, imageExtent: Extent, isOcrProposal: boolean = false) => {\r\n        const coordinates = [];\r\n        const boundingBox = region.id.split(\",\").map(parseFloat);\r\n        const imageWidth = imageExtent[2] - imageExtent[0];\r\n        const imageHeight = imageExtent[3] - imageExtent[1];\r\n        for (let i = 0; i < boundingBox.length; i += 2) {\r\n            coordinates.push([\r\n                Math.round(boundingBox[i] * imageWidth),\r\n                Math.round((1 - boundingBox[i + 1]) * imageHeight),\r\n            ]);\r\n        }\r\n\r\n        const feature = new Feature({\r\n            geometry: new Polygon([coordinates]),\r\n        });\r\n        feature.setProperties({\r\n            id: region.id,\r\n            text: region.value,\r\n            highlighted: false,\r\n            isOcrProposal,\r\n        });\r\n        feature.setId(region.id);\r\n\r\n        return feature;\r\n    }\r\n\r\n    private deleteRegions = (regions: IRegion[]) => {\r\n        this.deleteRegionsFromSelectedRegionIds(regions);\r\n        this.deleteRegionsFromAsset(regions);\r\n        this.deleteRegionsFromImageMap(regions);\r\n    }\r\n\r\n    private deleteRegionsFromSelectedRegionIds = (regions: IRegion[]) => {\r\n        regions.forEach((region) => {\r\n            const regionIndex = this.getIndexOfSelectedRegionIndex(region.id);\r\n            if (regionIndex >= 0) {\r\n                this.selectedRegionIds.splice(regionIndex, 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    private deleteRegionsFromAsset = (regions: IRegion[]) => {\r\n        const filteredRegions = this.state.currentAsset.regions.filter((assetRegion) => {\r\n            return regions.findIndex((r) => r.id === assetRegion.id) === -1;\r\n        });\r\n        this.updateAssetRegions(filteredRegions);\r\n    }\r\n\r\n    private deleteRegionsFromImageMap = (regions: IRegion[]) => {\r\n        if (this.imageMap == null) {\r\n            return;\r\n        }\r\n\r\n        const allFeatures = this.imageMap.getAllFeatures();\r\n        const selectedFeatures = allFeatures\r\n            .filter((feature) => !feature.get(\"isOcrProposal\"))\r\n            .filter((feature) => regions.findIndex((region) => region.id === feature.get(\"id\")) !== -1);\r\n        selectedFeatures.map(this.imageMap.removeFeature);\r\n        this.redrawFeatures(this.imageMap.getAllFeatures());\r\n    }\r\n\r\n    /**\r\n     * Update regions within the current asset\r\n     * @param regions\r\n     * @param selectedRegions\r\n     */\r\n    private updateAssetRegions = (regions: IRegion[]) => {\r\n        const labelData = this.convertRegionsToLabelData(regions, this.state.currentAsset.asset.name);\r\n        const currentAsset: IAssetMetadata = {\r\n            ...this.state.currentAsset,\r\n            regions,\r\n            labelData,\r\n        };\r\n        this.setState({\r\n            currentAsset,\r\n        }, () => {\r\n            this.props.onAssetMetadataChanged(currentAsset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Method called when deleting a region from the editor\r\n     * @param {string} id the id of the deleted region\r\n     * @returns {void}\r\n     */\r\n    private onRegionDelete = (id: string) => {\r\n        // Remove from project\r\n        const currentRegions = this.state.currentAsset.regions;\r\n        const deletedRegionIndex = currentRegions.findIndex((region) => region.id === id);\r\n        currentRegions.splice(deletedRegionIndex, 1);\r\n\r\n        this.updateAssetRegions(currentRegions);\r\n    }\r\n\r\n    /**\r\n     * Method called when deleting a region from the editor\r\n     * @param {string} id the id of the selected region\r\n     * @param {boolean} multiSelect boolean whether region was selected with multi selection\r\n     * @returns {void}\r\n     */\r\n    private onRegionSelected = (id: string, multiSelect: boolean) => {\r\n        const selectedRegions = this.getSelectedRegions();\r\n        if (this.props.onSelectedRegionsChanged) {\r\n            this.props.onSelectedRegionsChanged(selectedRegions);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates regions in both Canvas Tools and the asset data store\r\n     * @param updates Regions to be updated\r\n     * @param updatedSelectedRegions Selected regions with any changes already applied\r\n     */\r\n    private updateRegions = (updates: IRegion[]) => {\r\n        const regions = this.state.currentAsset.regions;\r\n        const updatedRegions = [].concat(regions);\r\n        for (const update of updates) {\r\n            const region = regions.find((r) => r.id === update.id);\r\n            if (region) {\r\n                // skip\r\n            } else {\r\n                updatedRegions.push(update);\r\n            }\r\n        }\r\n\r\n        updatedRegions.sort(this.compareRegionOrder);\r\n        this.updateAssetRegions(updatedRegions);\r\n    }\r\n\r\n    private createBoundingBoxVectorFeature = (text, boundingBox, imageExtent, ocrExtent, page) => {\r\n        const coordinates: any[] = [];\r\n        const polygonPoints: number[] = [];\r\n        const imageWidth = imageExtent[2] - imageExtent[0];\r\n        const imageHeight = imageExtent[3] - imageExtent[1];\r\n        const ocrWidth = ocrExtent[2] - ocrExtent[0];\r\n        const ocrHeight = ocrExtent[3] - ocrExtent[1];\r\n\r\n        for (let i = 0; i < boundingBox.length; i += 2) {\r\n            // An array of numbers representing an extent: [minx, miny, maxx, maxy]\r\n            coordinates.push([\r\n                Math.round((boundingBox[i] / ocrWidth) * imageWidth),\r\n                Math.round((1 - (boundingBox[i + 1] / ocrHeight)) * imageHeight),\r\n            ]);\r\n\r\n            polygonPoints.push(boundingBox[i] / ocrWidth);\r\n            polygonPoints.push(boundingBox[i + 1] / ocrHeight);\r\n        }\r\n\r\n        const featureId = this.createRegionIdFromBoundingBox(polygonPoints, page);\r\n        const feature = new Feature({\r\n            geometry: new Polygon([coordinates]),\r\n        });\r\n        feature.setProperties({\r\n            id: featureId,\r\n            text,\r\n            boundingbox: boundingBox,\r\n            highlighted: false,\r\n            isOcrProposal: true,\r\n        });\r\n        feature.setId(featureId);\r\n\r\n        return feature;\r\n    }\r\n\r\n    private createBoundingBoxVectorTable = (boundingBox, imageExtent, ocrExtent, page, rows, columns) => {\r\n        const coordinates: any[] = [];\r\n        const polygonPoints: number[] = [];\r\n        const imageWidth = imageExtent[2] - imageExtent[0];\r\n        const imageHeight = imageExtent[3] - imageExtent[1];\r\n        const ocrWidth = ocrExtent[2] - ocrExtent[0];\r\n        const ocrHeight = ocrExtent[3] - ocrExtent[1];\r\n\r\n        for (let i = 0; i < boundingBox.length; i += 2) {\r\n            // An array of numbers representing an extent: [minx, miny, maxx, maxy]\r\n            coordinates.push([\r\n                Math.round((boundingBox[i] / ocrWidth) * imageWidth),\r\n                Math.round((1 - (boundingBox[i + 1] / ocrHeight)) * imageHeight),\r\n            ]);\r\n\r\n            polygonPoints.push(boundingBox[i] / ocrWidth);\r\n            polygonPoints.push(boundingBox[i + 1] / ocrHeight);\r\n        }\r\n        const tableID = this.createRegionIdFromBoundingBox(polygonPoints, page);\r\n        const tableFeatures = {};\r\n        tableFeatures[\"border\"] = new Feature({\r\n            geometry: new Polygon([coordinates]),\r\n            id: tableID,\r\n            state: \"rest\",\r\n            boundingbox: boundingBox,\r\n        });\r\n        tableFeatures[\"icon\"] = new Feature({\r\n            geometry: new Point([coordinates[0][0] - 6.5, coordinates[0][1] - 4.5]),\r\n            id: tableID,\r\n            state: \"rest\",\r\n        });\r\n\r\n        const iconTR = [coordinates[0][0] - 5, coordinates[0][1] ];\r\n        const iconTL = [iconTR[0] - 31.5, iconTR[1]];\r\n        const iconBL = [iconTR[0] , iconTR[1] - 29.5];\r\n        const iconBR = [iconTR[0] - 31.5, iconTR[1] - 29.5];\r\n\r\n        tableFeatures[\"iconBorder\"] = new Feature({\r\n            geometry: new Polygon([[iconTR, iconTL, iconBR, iconBL]]),\r\n            id: tableID,\r\n            rows,\r\n            columns,\r\n        });\r\n\r\n        tableFeatures[\"border\"].setId(tableID);\r\n        tableFeatures[\"icon\"].setId(tableID);\r\n        tableFeatures[\"iconBorder\"].setId(tableID);\r\n        return tableFeatures;\r\n    }\r\n\r\n    private tableIconBorderFeatureStyler = (feature) => {\r\n        return new Style({\r\n            stroke: new Stroke({\r\n                width: 0,\r\n                color: \"transparent\",\r\n            }),\r\n            fill: new Fill({\r\n                color: \"rgba(217, 217, 217, 0)\",\r\n            }),\r\n        });\r\n    }\r\n\r\n    private tableIconFeatureStyler = (feature, resolution) => {\r\n        if (feature.get(\"state\") === \"rest\") {\r\n            return new Style({\r\n                image: new Icon({\r\n                    opacity: 0.3,\r\n                    scale: this.imageMap.getResolutionForZoom(3) / resolution,\r\n                    anchor: [.95, 0.15],\r\n                    anchorXUnits: \"fraction\",\r\n                    anchorYUnits: \"fraction\",\r\n                    src: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAmCAYAAABZNrIjAAABhUlEQVRYR+1YQaqCUBQ9BYZOWkHQyEELSAJbQM7cQiMxmjTXkQtwEomjttAsF6AguoAGjQRX0CRRsI/yg/hlqV8w4b3xfe8ezn3nHN7rKYpy8zwP37o4jkNPkqSbaZrfihGSJHUQ5G63w2QyaZ3V0+mE1WqV43hi0rZt8DzfOkjHcTCfzzsMcr1eYzQatc5kGIbYbrevmWwd3QsA3VR3mXE/jiIT2WKxAEVRhUNIkgSWZSETQ7aq9qil7r/K03UdDMMUgrxer9hsNrgHRhkH+be6CcjfeRAmX13Mxu/k8XjEdDp9a5e+70MQhLxmuVxC0zTQNF24J4oiqKqK/X6f11Tt0U2fJIlTkwFi5nfiGld3ncgisVj3+UCyu0x2z2YzDIfDt2ZxuVzgum5eMx6PwbIs+v1+4Z40TXE+nxEEQV5TtQdJnJre/bTtickynwOPD3dRFCHLMgaDQSGmOI5hGAYOh0NeU7UHSRySOJ/+goiZlzHzqsprRd1NeVuT53Qncbrwsf8D9suXe5WWs/YAAAAASUVORK5CYII=\",\r\n                }),\r\n            });\r\n        } else {\r\n            return new Style({\r\n                image: new Icon({\r\n                    opacity: 1,\r\n                    scale: this.imageMap.getResolutionForZoom(3) / resolution,\r\n                    anchor: [.95, 0.15],\r\n                    anchorXUnits: \"fraction\",\r\n                    anchorYUnits: \"fraction\",\r\n                    src: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAmCAYAAABZNrIjAAABhUlEQVRYR+1YQaqCUBQ9BYZOWkHQyEELSAJbQM7cQiMxmjTXkQtwEomjttAsF6AguoAGjQRX0CRRsI/yg/hlqV8w4b3xfe8ezn3nHN7rKYpy8zwP37o4jkNPkqSbaZrfihGSJHUQ5G63w2QyaZ3V0+mE1WqV43hi0rZt8DzfOkjHcTCfzzsMcr1eYzQatc5kGIbYbrevmWwd3QsA3VR3mXE/jiIT2WKxAEVRhUNIkgSWZSETQ7aq9qil7r/K03UdDMMUgrxer9hsNrgHRhkH+be6CcjfeRAmX13Mxu/k8XjEdDp9a5e+70MQhLxmuVxC0zTQNF24J4oiqKqK/X6f11Tt0U2fJIlTkwFi5nfiGld3ncgisVj3+UCyu0x2z2YzDIfDt2ZxuVzgum5eMx6PwbIs+v1+4Z40TXE+nxEEQV5TtQdJnJre/bTtickynwOPD3dRFCHLMgaDQSGmOI5hGAYOh0NeU7UHSRySOJ/+goiZlzHzqsprRd1NeVuT53Qncbrwsf8D9suXe5WWs/YAAAAASUVORK5CYII=\",\r\n                }),\r\n            });\r\n        }\r\n    }\r\n\r\n    private tableBorderFeatureStyler = (feature, resolution) => {\r\n        if (feature.get(\"state\") === \"rest\") {\r\n            return new Style({\r\n                stroke: new Stroke({\r\n                    color: \"transparent\",\r\n                }),\r\n                fill: new Fill({\r\n                    color: \"transparent\",\r\n                }),\r\n            });\r\n        } else if (feature.get(\"state\") === \"hovering\") {\r\n            return new Style({\r\n                stroke: new Stroke({\r\n                    opacity: 0.75,\r\n                    color: \"black\",\r\n                    lineDash: [2, 6],\r\n                    width: 0.75,\r\n                }),\r\n                fill: new Fill({\r\n                    color: \"rgba(217, 217, 217, 0.1)\",\r\n                }),\r\n            });\r\n        } else {\r\n            return new Style({\r\n                stroke: new Stroke({\r\n                    color: \"black\",\r\n                    lineDash: [2, 6],\r\n                    width: 2,\r\n                }),\r\n                fill: new Fill({\r\n                    color: \"rgba(217, 217, 217, 0.1)\",\r\n                }),\r\n            });\r\n        }\r\n    }\r\n\r\n    private featureStyler = (feature) => {\r\n\r\n            const regionId = feature.get(\"id\");\r\n            const tag: ITag = this.getTagFromRegionId(regionId);\r\n            // Selected\r\n            if (this.isRegionSelected(regionId)) {\r\n                return new Style({\r\n                    stroke: new Stroke({\r\n                        color: \"#6eff40\",\r\n                        width: 1,\r\n                    }),\r\n                    fill: new Fill({\r\n                        color: \"rgba(110, 255, 80, 0.4)\",\r\n                    }),\r\n                });\r\n            } else if (tag != null) {\r\n                const highlighted = feature.get(\"highlighted\");\r\n                let color = \"rgba(255, 255, 255, 0)\";\r\n                if (highlighted) {\r\n                    color = hexToRgba(tag.color, 0.3);\r\n                }\r\n                // Already tagged\r\n                return new Style({\r\n                    stroke: new Stroke({\r\n                        color: tag.color,\r\n                        width: highlighted ? 4 : 2,\r\n                    }),\r\n                    fill: new Fill({\r\n                        color,\r\n                    }),\r\n                });\r\n            } else {\r\n                // Unselected\r\n                return new Style({\r\n                    stroke: new Stroke({\r\n                        color: \"#fffc7f\",\r\n                        width: 1,\r\n                    }),\r\n                    fill: new Fill({\r\n                        color: \"rgba(255, 252, 127, 0.2)\",\r\n                    }),\r\n                });\r\n            }\r\n\r\n    }\r\n\r\n    private setFeatureProperty = (feature, propertyName, propertyValue, forced: boolean = false) => {\r\n        if (forced || feature.get(propertyName) !== propertyValue) {\r\n            feature.set(propertyName, propertyValue);\r\n        }\r\n    }\r\n\r\n    private updateHighlightStatus = (feature: any): void => {\r\n        if (this.props.hoveredLabel) {\r\n            const label = this.props.hoveredLabel;\r\n            const id = feature.get(\"id\");\r\n            if (label.value.find((region) =>\r\n                id === this.createRegionIdFromBoundingBox(region.boundingBoxes[0], region.page))) {\r\n                this.setFeatureProperty(feature, \"highlighted\", true);\r\n            }\r\n        } else if (feature.get(\"highlighted\")) {\r\n            this.setFeatureProperty(feature, \"highlighted\", false);\r\n        }\r\n    }\r\n\r\n    private handleTextFeatureSelect = (feature: Feature, isToggle: boolean = true) => {\r\n        const regionId = feature.get(\"id\");\r\n        if (isToggle && this.isRegionSelected(regionId)) {\r\n            this.removeFromSelectedRegions(regionId);\r\n        } else {\r\n            const polygon = regionId.split(\",\").map(parseFloat);\r\n            this.addToSelectedRegions(regionId, feature.get(\"text\"), polygon);\r\n        }\r\n        this.redrawFeatures(this.imageMap.getAllFeatures());\r\n    }\r\n\r\n    private handleTableIconFeatureSelect = () => {\r\n        if (this.state.hoveringFeature != null) {\r\n            const tableState = this.imageMap.getTableBorderFeatureByID(this.state.hoveringFeature).get(\"state\");\r\n            if (tableState === \"hovering\") {\r\n                this.imageMap.getTableBorderFeatureByID(this.state.hoveringFeature).set(\"state\", \"selected\");\r\n                this.imageMap.getTableIconFeatureByID(this.state.hoveringFeature).set(\"state\", \"selected\");\r\n            } else {\r\n                this.imageMap.getTableBorderFeatureByID(this.state.hoveringFeature).set(\"state\", \"hovering\");\r\n                this.imageMap.getTableIconFeatureByID(this.state.hoveringFeature).set(\"state\", \"hovering\");\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeFromSelectedRegions = (regionId: string) => {\r\n        const iRegionId = this.getIndexOfSelectedRegionIndex(regionId);\r\n        if (iRegionId >= 0) {\r\n            const region = this.getSelectedRegions().find((r) => r.id === regionId);\r\n            if (region && region.tags && region.tags.length === 0 ) {\r\n                this.onRegionDelete(regionId);\r\n            }\r\n            this.selectedRegionIds.splice(iRegionId, 1);\r\n            if (this.props.onSelectedRegionsChanged) {\r\n                this.props.onSelectedRegionsChanged(this.getSelectedRegions());\r\n            }\r\n        }\r\n    }\r\n\r\n    private addToSelectedRegions = (regionId: string, text: string, polygon: number[]) => {\r\n        let selectedRegion;\r\n        if (this.isRegionSelected(regionId)) {\r\n            // skip if it's already existed in selected regions\r\n            return;\r\n        } else if (this.getIndexOfCurrentRegions(regionId) !== -1) {\r\n            selectedRegion = this.state.currentAsset.regions.find((region) => region.id === regionId);\r\n            // Explicitly set pageNumber in order to fix incorrect page number\r\n            selectedRegion.pageNumber = this.state.currentPage;\r\n\r\n        } else {\r\n            const regionBoundingBox = this.convertToRegionBoundingBox(polygon);\r\n            const regionPoints = this.convertToRegionPoints(polygon);\r\n            selectedRegion = {\r\n                id: regionId,\r\n                type: RegionType.Polygon,\r\n                tags: [],\r\n                boundingBox: regionBoundingBox,\r\n                points: regionPoints,\r\n                value: text,\r\n                pageNumber: this.state.currentPage,\r\n            };\r\n            this.addRegions([selectedRegion]);\r\n        }\r\n\r\n        this.selectedRegionIds.push(regionId);\r\n        this.onRegionSelected(regionId, false);\r\n    }\r\n\r\n    private isRegionSelected = (regionId: string) => {\r\n        return this.getIndexOfSelectedRegionIndex(regionId) !== -1;\r\n    }\r\n\r\n    private getIndexOfSelectedRegionIndex = (regionId: string) => {\r\n        return this.selectedRegionIds.findIndex((id) => id === regionId);\r\n    }\r\n\r\n    private getIndexOfCurrentRegions = (regionId: string) => {\r\n        return this.state.currentAsset.regions.findIndex((region) => region.id === regionId);\r\n    }\r\n\r\n    private getTagFromRegionId = (id: string): ITag => {\r\n        const iRegion = this.getIndexOfCurrentRegions(id);\r\n        if (iRegion >= 0) {\r\n            const tagName = this.state.currentAsset.regions[iRegion].tags[0];\r\n            return this.props.project.tags.find((tag) => tag.name === tagName);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private loadImage = async () => {\r\n        const asset = this.state.currentAsset.asset;\r\n        if (asset.type === AssetType.Image) {\r\n            const canvas = await loadImageToCanvas(asset.path);\r\n            this.setState({\r\n                imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n                imageWidth: canvas.width,\r\n                imageHeight: canvas.height,\r\n            });\r\n        } else if (asset.type === AssetType.TIFF) {\r\n            await this.loadTiffFile(asset);\r\n        } else if (asset.type === AssetType.PDF) {\r\n            await this.loadPdfFile(asset.id, asset.path);\r\n        }\r\n    }\r\n\r\n    private setOCRStatus = (ocrStatus: OcrStatus) => {\r\n        this.setState({ ocrStatus }, () => {\r\n            if (this.props.onRunningOCRStatusChanged) {\r\n                this.props.onRunningOCRStatusChanged(ocrStatus === OcrStatus.runningOCR);\r\n            }\r\n        });\r\n    }\r\n\r\n    private loadOcr = async () => {\r\n        const asset = this.state.currentAsset.asset;\r\n        if (asset.isRunningOCR) {\r\n            // Skip loading OCR this time since it's running. This will be triggered again once it's finished.\r\n            return;\r\n        }\r\n        try {\r\n            const ocr = await this.ocrService.getRecognizedText(asset.path, asset.name, this.setOCRStatus);\r\n            if (asset.id === this.state.currentAsset.asset.id) {\r\n                // since get OCR is async, we only set currentAsset's OCR\r\n                this.setState({\r\n                    ocr,\r\n                    ocrForCurrentPage: this.getOcrResultForCurrentPage(ocr),\r\n                }, () => {\r\n                    this.buildRegionOrders();\r\n                    this.drawOcr();\r\n                });\r\n            }\r\n        } catch (error) {\r\n            this.setState({\r\n                isError: true,\r\n                errorTitle: error.title,\r\n                errorMessage: error.message,\r\n            });\r\n        }\r\n    }\r\n\r\n    private loadTiffFile = async (asset: IAsset) => {\r\n        const assetArrayBuffer = await HtmlFileReader.getAssetArray(asset);\r\n        const tiffImages = parseTiffData(assetArrayBuffer);\r\n        this.loadTiffPage(tiffImages, this.state.currentPage);\r\n    }\r\n\r\n    private loadTiffPage = (tiffImages: any[], pageNumber: number) => {\r\n        const tiffImage = tiffImages[pageNumber - 1];\r\n        const canvas = renderTiffToCanvas(tiffImage);\r\n        this.setState({\r\n            imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n            imageWidth: tiffImage.width,\r\n            imageHeight: tiffImage.height,\r\n            numPages: tiffImages.length,\r\n            currentPage: pageNumber,\r\n            tiffImages,\r\n        });\r\n    }\r\n\r\n    private loadPdfFile = async (assetId, url) => {\r\n        try {\r\n            const pdf = await pdfjsLib.getDocument({url, cMapUrl, cMapPacked: true}).promise;\r\n            // Fetch current page\r\n            if (assetId === this.state.currentAsset.asset.id) {\r\n                await this.loadPdfPage(assetId, pdf, this.state.currentPage);\r\n            }\r\n        } catch (reason) {\r\n            // PDF loading error\r\n            console.error(reason);\r\n        }\r\n    }\r\n\r\n    private loadPdfPage = async (assetId, pdf, pageNumber) => {\r\n        const page = await pdf.getPage(pageNumber);\r\n        const defaultScale = 2;\r\n        const viewport = page.getViewport({ scale: defaultScale });\r\n\r\n        // Prepare canvas using PDF page dimensions\r\n        const canvas = document.createElement(\"canvas\");\r\n        const context = canvas.getContext(\"2d\");\r\n        canvas.height = viewport.height;\r\n        canvas.width = viewport.width;\r\n\r\n        // Render PDF page into canvas context\r\n        const renderContext = {\r\n            canvasContext: context,\r\n            viewport,\r\n        };\r\n\r\n        await page.render(renderContext).promise;\r\n        if (assetId === this.state.currentAsset.asset.id) {\r\n            this.setState({\r\n                imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n                imageWidth: canvas.width,\r\n                imageHeight: canvas.height,\r\n                numPages: pdf.numPages,\r\n                currentPage: pageNumber,\r\n                pdfFile: pdf,\r\n            });\r\n        }\r\n    }\r\n\r\n    private nextPage = async () => {\r\n        if ((this.state.pdfFile !== null || this.state.tiffImages.length !== 0)\r\n            && this.state.currentPage < this.state.numPages) {\r\n            await this.goToPage(this.state.currentPage + 1);\r\n        }\r\n    }\r\n\r\n    private prevPage = async () => {\r\n        if ((this.state.pdfFile !== null || this.state.tiffImages.length !== 0) && this.state.currentPage > 1) {\r\n            await this.goToPage(this.state.currentPage - 1);\r\n        }\r\n    }\r\n\r\n    private goToPage = async (targetPage: number) => {\r\n        if (targetPage < 1 || targetPage > this.state.numPages) {\r\n            // invalid page number, just return\r\n        }\r\n\r\n        // clean up selected regions in current page\r\n        const selectedRegions = this.getSelectedRegions();\r\n        this.deleteRegionsFromSelectedRegionIds(selectedRegions);\r\n\r\n        // remove regions without tag from asset\r\n        const selectedRegionsWithoutTag = selectedRegions.filter((region) => region.tags.length === 0);\r\n        this.deleteRegionsFromAsset(selectedRegionsWithoutTag);\r\n        this.deleteRegionsFromImageMap(selectedRegionsWithoutTag);\r\n\r\n        // switch image\r\n        await this.switchToTargetPage(targetPage);\r\n\r\n        // switch OCR\r\n        this.setState({\r\n            ocrForCurrentPage: this.getOcrResultForCurrentPage(this.state.ocr),\r\n        }, () => {\r\n            this.imageMap.removeAllFeatures();\r\n            this.drawOcr();\r\n            this.loadLabelData(this.state.currentAsset.asset);\r\n        });\r\n    }\r\n\r\n    private convertLabelDataToRegions = (labelData: ILabelData): IRegion[] => {\r\n        const regions = [];\r\n\r\n        if (labelData.labels) {\r\n            labelData.labels.forEach((label) => {\r\n                if (label.value) {\r\n                    label.value.forEach((formRegion) => {\r\n                        if (formRegion.boundingBoxes) {\r\n                            formRegion.boundingBoxes.forEach((boundingBox, boundingBoxIndex) => {\r\n                                const text = this.getBoundingBoxTextFromRegion(formRegion, boundingBoxIndex);\r\n                                regions.push(this.createRegion(boundingBox, text, label.label, formRegion.page));\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        return regions;\r\n    }\r\n\r\n    private convertRegionsToLabelData = (regions: IRegion[], assetName: string) => {\r\n        const labelData: ILabelData = {\r\n            document: decodeURIComponent(assetName).split(\"/\").pop(),\r\n            labels: [],\r\n        };\r\n\r\n        const fieldNames = Array.from(new Set(regions\r\n            .map((region) => region.tags[0])))\r\n            .filter((name) => name !== undefined);\r\n\r\n        fieldNames.forEach((fieldName) => {\r\n            const label: ILabel = {\r\n                    label: fieldName,\r\n                    key: null,\r\n                    value: [],\r\n            };\r\n\r\n            const regionsToConvert = regions.filter((region) => region.tags.indexOf(fieldName) !== -1);\r\n            regionsToConvert.forEach((region) => {\r\n                const boundingBox = region.id.split(\",\").map(parseFloat);\r\n                label.value.push({\r\n                    page: region.pageNumber,\r\n                    text: region.value,\r\n                    boundingBoxes: [boundingBox],\r\n                });\r\n            });\r\n\r\n            labelData.labels.push(label);\r\n        });\r\n\r\n        return labelData;\r\n    }\r\n\r\n    private convertToRegionBoundingBox = (polygon: number[]) => {\r\n        const xAxisValues = polygon.filter((value, index) => index % 2 === 0);\r\n        const yAxisValues = polygon.filter((value, index) => index % 2 === 1);\r\n        const left = Math.min(...xAxisValues);\r\n        const top = Math.min(...yAxisValues);\r\n        const right = Math.max(...xAxisValues);\r\n        const bottom = Math.max(...yAxisValues);\r\n\r\n        return {\r\n            height: bottom - top,\r\n            width: right - left,\r\n            left,\r\n            top,\r\n        };\r\n    }\r\n\r\n    private getTableBoundingBox = (lines: []) => {\r\n        const flattenedLines = [].concat(...lines);\r\n        const xAxisValues = flattenedLines.filter((value, index) => index % 2 === 0);\r\n        const yAxisValues = flattenedLines.filter((value, index) => index % 2 === 1);\r\n        const left = Math.min(...xAxisValues);\r\n        const top = Math.min(...yAxisValues);\r\n        const right = Math.max(...xAxisValues);\r\n        const bottom = Math.max(...yAxisValues);\r\n        return([left, top, right, top, right, bottom, left, bottom]);\r\n    }\r\n\r\n    private convertToRegionPoints = (polygon: number[]) => {\r\n        const points = [];\r\n        for (let i = 0; i < polygon.length; i += 2) {\r\n            points.push({x: polygon[i], y: polygon[i + 1]});\r\n        }\r\n        return points;\r\n    }\r\n\r\n    private handleKeyDown = (keyEvent) => {\r\n        switch (keyEvent.key) {\r\n            case \"Delete\":\r\n            case \"Backspace\":\r\n                this.deleteRegions(this.getSelectedRegions());\r\n                break;\r\n\r\n            case \"<\":\r\n            case \",\":\r\n                this.prevPage();\r\n                break;\r\n\r\n            case \">\":\r\n            case \".\":\r\n                this.nextPage();\r\n                break;\r\n\r\n            case \"}\":\r\n            case \"]\":\r\n                if (!this.pendingFlag) {\r\n                    this.pendingFlag = true;\r\n                    setTimeout(() => {\r\n                        this.getRegionWithKey(true);\r\n                        this.pendingFlag = false;\r\n                    }, 1);\r\n                }\r\n                break;\r\n\r\n            case \"{\":\r\n            case \"[\":\r\n                if (!this.pendingFlag) {\r\n                    this.pendingFlag = true;\r\n                    setTimeout(() => {\r\n                        this.getRegionWithKey(false);\r\n                        this.pendingFlag = false;\r\n                    }, 1);\r\n                }\r\n                break;\r\n\r\n            case \"+\":\r\n            case \"=\":\r\n                this.handleCanvasZoomIn();\r\n                break;\r\n\r\n            case \"-\":\r\n            case \"_\":\r\n                this.handleCanvasZoomOut();\r\n                break;\r\n\r\n            case \"/\":\r\n            case \"?\":\r\n                this.handleZoomReset();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleCanvasZoomIn = () => {\r\n        this.imageMap.zoomIn();\r\n    }\r\n\r\n    private handleCanvasZoomOut = () => {\r\n        this.imageMap.zoomOut();\r\n    }\r\n\r\n    private handleZoomReset = () => {\r\n        this.imageMap.resetZoom();\r\n    }\r\n\r\n    private getRegionWithKey = (keyFlag: boolean) => {\r\n        let lastSelectedId;\r\n        const selectedRegion = this.getSelectedRegions();\r\n        const currentPage = this.state.currentPage;\r\n        let nextRegionId;\r\n        if (!selectedRegion.length && !this.applyTagFlag) {\r\n            nextRegionId = this.regionOrderById[this.state.currentPage - 1][0];\r\n        } else if (!this.applyTagFlag) {\r\n            lastSelectedId = selectedRegion.find((r) =>\r\n                r.id === this.selectedRegionIds[this.selectedRegionIds.length - 1]).id;\r\n            this.deleteRegionsFromSelectedRegionIds(selectedRegion);\r\n            const removeList = this.state.currentAsset.regions.filter((r) => r.tags.length === 0);\r\n            this.deleteRegionsFromAsset(removeList);\r\n            if (keyFlag) {\r\n                nextRegionId = this.getNextIdByOrder(lastSelectedId, currentPage);\r\n            } else if (!keyFlag) {\r\n                nextRegionId = this.getPrevIdByOrder(lastSelectedId, currentPage);\r\n            }\r\n        } else if (this.applyTagFlag) {\r\n            lastSelectedId = this.lastKeyBoardRegionId;\r\n            if (keyFlag) {\r\n                nextRegionId = this.getNextIdByOrder(lastSelectedId, currentPage);\r\n            } else if (!keyFlag) {\r\n                nextRegionId = this.getPrevIdByOrder(lastSelectedId, currentPage);\r\n            }\r\n            this.applyTagFlag = false;\r\n        }\r\n        const allFeatures = this.imageMap.getAllFeatures();\r\n        const nextFeature = allFeatures.find((f) => f.get(\"id\") === (nextRegionId));\r\n        const polygon = nextRegionId.split(\",\").map(parseFloat);\r\n        this.addToSelectedRegions(nextRegionId, nextFeature.get(\"text\"), polygon);\r\n        this.redrawFeatures(allFeatures);\r\n        this.lastKeyBoardRegionId = nextRegionId;\r\n    }\r\n\r\n    private getOcrResultForCurrentPage = (ocr: any): any => {\r\n        if (!ocr || !this.state.imageUri) {\r\n            return {};\r\n        }\r\n\r\n        if (ocr.analyzeResult && ocr.analyzeResult.readResults) {\r\n            // OCR schema with analyzeResult/readResults property\r\n            const ocrResultsForCurrentPage = {};\r\n            if (ocr.analyzeResult.pageResults) {\r\n                ocrResultsForCurrentPage[\"pageResults\"] = ocr.analyzeResult.pageResults[this.state.currentPage - 1];\r\n            }\r\n            ocrResultsForCurrentPage[\"readResults\"] = ocr.analyzeResult.readResults[this.state.currentPage - 1];\r\n            return ocrResultsForCurrentPage;\r\n        }\r\n\r\n        return {};\r\n    }\r\n\r\n    private isLabelDataChanged = (newProps: ICanvasProps, prevProps: ICanvasProps): boolean => {\r\n        const newLabels = _.get(newProps, \"selectedAsset.labelData.labels\", []) as ILabel[];\r\n        const prevLabels = _.get(prevProps, \"selectedAsset.labelData.labels\", []) as ILabel[];\r\n\r\n        if (newLabels.length !== prevLabels.length) {\r\n            return true;\r\n        } else if (newLabels.length > 0) {\r\n            const newFieldNames = newLabels.map((label) => label.label);\r\n            const prevFieldNames = prevLabels.map((label) => label.label);\r\n            return !_.isEqual(newFieldNames.sort(), prevFieldNames.sort());\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private getBoundingBoxTextFromRegion = (formRegion: IFormRegion, boundingBoxIndex: number) => {\r\n        // get value from formRegion.text\r\n        const regionValues = formRegion.text.split(\" \");\r\n        if (regionValues && regionValues.length > boundingBoxIndex) {\r\n            return regionValues[boundingBoxIndex];\r\n        }\r\n\r\n        // cannot find any, return empty string.\r\n        return \"\";\r\n    }\r\n\r\n    private loadLabelData = (asset: IAsset) => {\r\n        if (asset.id === this.state.currentAsset.asset.id &&\r\n            this.state.currentAsset.labelData != null) {\r\n            const regionsFromLabelData = this.convertLabelDataToRegions(this.state.currentAsset.labelData);\r\n            if (regionsFromLabelData.length > 0) {\r\n                this.addRegions(regionsFromLabelData);\r\n            }\r\n        }\r\n    }\r\n\r\n    private showMultiPageFieldWarningIfNecessary = (tagName: string, regions: IRegion[]): boolean => {\r\n        const existedRegionsWithSameTag = this.state.currentAsset.regions.filter(\r\n            (region) => _.get(region, \"tags[0]\", \"\") === tagName);\r\n        const regionsWithSameTag = existedRegionsWithSameTag.concat(regions);\r\n        const pageCount = (new Set(regionsWithSameTag.map((region) => region.pageNumber))).size;\r\n        if (pageCount > 1) {\r\n            this.setState({\r\n                isError: true,\r\n                errorMessage: `Sorry, we don't support cross-page regions with the same tag.` +\r\n                    ` You have regions with tag \"${tagName}\" across ${pageCount} pages.`,\r\n            });\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private noOp = () => {\r\n        // no operation\r\n    }\r\n\r\n    private getRegionOrder = (regionId): IRegionOrder => {\r\n        let orderInfo: IRegionOrder = { page: 1, order: 0 };\r\n        this.regionOrders.some((regions, pageNumber) => {\r\n            const order = regions[regionId];\r\n            if (order !== undefined) {\r\n                orderInfo = { page: pageNumber + 1, order };\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n\r\n        return orderInfo;\r\n    }\r\n\r\n    private getNextIdByOrder = (id: string, currentPage: number) => {\r\n        const currentIdList = this.regionOrderById[currentPage - 1];\r\n        const currentIndex = currentIdList.indexOf(id);\r\n        let nextIndex;\r\n        if (currentIndex === currentIdList.length - 1) {\r\n            nextIndex = 0;\r\n        } else {\r\n            nextIndex = currentIndex + 1;\r\n        }\r\n        return currentIdList[nextIndex];\r\n    }\r\n\r\n    private getPrevIdByOrder = (id: string, currentPage: number) => {\r\n        const currentIdList = this.regionOrderById[currentPage - 1];\r\n        const currentIndex = currentIdList.indexOf(id);\r\n        let prevIndex;\r\n        if (currentIndex === 0) {\r\n            prevIndex = currentIdList.length - 1;\r\n        } else {\r\n            prevIndex = currentIndex - 1;\r\n        }\r\n        return currentIdList[prevIndex];\r\n    }\r\n\r\n    private compareRegionOrder = (r1, r2) => {\r\n        const order1 = this.getRegionOrder(r1.id);\r\n        const order2 = this.getRegionOrder(r2.id);\r\n\r\n        if (order1.page === order2.page) {\r\n            return order1.order > order2.order ? 1 : -1;\r\n        } else if (order1.page > order2.page) {\r\n            return 1;\r\n        } else {\r\n            return -1;\r\n        }\r\n    }\r\n\r\n    private buildRegionOrders = () => {\r\n        // Build order index here instead of building it during 'drawOcr' for two reasons.\r\n        // 1. Build order index for all pages at once. This allow us to support cross page\r\n        //    tagging if it's supported by FR service.\r\n        // 2. Avoid rebuilding order index when users switch back and forth between pages.\r\n        const ocrs = this.state.ocr;\r\n        const ocrReadResults = (ocrs.recognitionResults || (ocrs.analyzeResult && ocrs.analyzeResult.readResults));\r\n        const imageExtent = this.imageMap.getImageExtent();\r\n        ocrReadResults.map((ocr) => {\r\n            const ocrExtent = [0, 0, ocr.width, ocr.height];\r\n            this.regionOrders[ocr.page - 1] = {};\r\n            this.regionOrderById[ocr.page - 1] = [];\r\n            let order = 0;\r\n            if (ocr.lines) {\r\n                ocr.lines.forEach((line) => {\r\n                    if (line.words) {\r\n                        line.words.forEach((word) => {\r\n                            if (this.shouldDisplayOcrWord(word.text)) {\r\n                                const feature = this.createBoundingBoxVectorFeature(\r\n                                    word.text, word.boundingBox, imageExtent, ocrExtent, ocr.page);\r\n                                this.regionOrders[ocr.page - 1][feature.getId()] = order++;\r\n                                this.regionOrderById[ocr.page - 1].push(feature.getId());\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n\r\n            return ocr;\r\n        });\r\n    }\r\n\r\n    private drawOcr = () => {\r\n        const textFeatures = [];\r\n        const tableBorderFeatures = [];\r\n        const tableIconFeatures = [];\r\n        const tableIconBorderFeatures = [];\r\n        const ocrReadResults = this.state.ocrForCurrentPage[\"readResults\"];\r\n        const ocrPageResults = this.state.ocrForCurrentPage[\"pageResults\"];\r\n        const imageExtent = this.imageMap.getImageExtent();\r\n        const ocrExtent = [0, 0, ocrReadResults.width, ocrReadResults.height];\r\n        if (ocrReadResults.lines) {\r\n            ocrReadResults.lines.forEach((line) => {\r\n                if (line.words) {\r\n                    line.words.forEach((word) => {\r\n                        if (this.shouldDisplayOcrWord(word.text)) {\r\n                            textFeatures.push(this.createBoundingBoxVectorFeature(\r\n                                word.text, word.boundingBox, imageExtent, ocrExtent, ocrReadResults.page));\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        if (ocrPageResults && ocrPageResults.tables) {\r\n            ocrPageResults.tables.forEach((table) => {\r\n                if (table.cells && table.columns && table.rows) {\r\n                    const tableBoundingBox = this.getTableBoundingBox(table.cells.map((cell) => cell.boundingBox));\r\n                    const createdTableFeatures = this.createBoundingBoxVectorTable(\r\n                        tableBoundingBox,\r\n                        imageExtent,\r\n                        ocrExtent,\r\n                        ocrPageResults.page, table.rows, table.columns);\r\n                    tableBorderFeatures.push(createdTableFeatures[\"border\"]);\r\n                    tableIconFeatures.push(createdTableFeatures[\"icon\"]);\r\n                    tableIconBorderFeatures.push(createdTableFeatures[\"iconBorder\"]);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (tableBorderFeatures.length > 0 && tableBorderFeatures.length === tableIconFeatures.length\r\n            && tableBorderFeatures.length === tableIconBorderFeatures.length) {\r\n            this.imageMap.addTableBorderFeatures(tableBorderFeatures);\r\n            this.imageMap.addTableIconFeatures(tableIconFeatures);\r\n            this.imageMap.addTableIconBorderFeatures(tableIconBorderFeatures);\r\n        }\r\n        if (textFeatures.length > 0) {\r\n            this.imageMap.addFeatures(textFeatures);\r\n        }\r\n    }\r\n\r\n    private shouldDisplayOcrWord = (text: string) => {\r\n        const regex = new RegExp(/^[_]+$/);\r\n        return !text.match(regex);\r\n    }\r\n\r\n    private redrawFeatures = (features: Feature[]) => {\r\n        features.forEach((feature) => feature.changed());\r\n    }\r\n\r\n    private createRegion(boundingBox: number[], text: string, tagName: string, pangeNumber: number) {\r\n        const xAxisValues = boundingBox.filter((value, index) => index % 2 === 0);\r\n        const yAxisValues = boundingBox.filter((value, index) => index % 2 === 1);\r\n        const left = Math.min(...xAxisValues);\r\n        const top = Math.min(...yAxisValues);\r\n        const right = Math.max(...xAxisValues);\r\n        const bottom = Math.max(...yAxisValues);\r\n\r\n        const points = [];\r\n        for (let i = 0; i < boundingBox.length; i += 2) {\r\n            points.push({\r\n                x: boundingBox[i],\r\n                y: boundingBox[i + 1],\r\n            });\r\n        }\r\n\r\n        const newRegion = {\r\n            id: this.createRegionIdFromBoundingBox(boundingBox, pangeNumber),\r\n            type: RegionType.Polygon,\r\n            tags: [tagName],\r\n            boundingBox: {\r\n                height: bottom - top,\r\n                width: right - left,\r\n                left,\r\n                top,\r\n            },\r\n            points,\r\n            value: text,\r\n            pageNumber: pangeNumber,\r\n        };\r\n        return newRegion;\r\n    }\r\n\r\n    private switchToTargetPage = async (targetPage: number) => {\r\n        if (this.state.pdfFile !== null) {\r\n            await this.loadPdfPage(this.state.currentAsset.asset.id, this.state.pdfFile, targetPage);\r\n        } else if (this.state.tiffImages.length !== 0) {\r\n            this.loadTiffPage(this.state.tiffImages, targetPage);\r\n        }\r\n    }\r\n\r\n    private shouldShowPreviousPageButton = () => {\r\n        return (this.state.pdfFile !== null || this.state.tiffImages.length !== 0) && this.state.currentPage !== 1;\r\n    }\r\n\r\n    private shouldShowNextPageButton = () => {\r\n        return (this.state.pdfFile !== null || this.state.tiffImages.length !== 0)\r\n            && this.state.currentPage !== this.state.numPages;\r\n    }\r\n\r\n    private shouldShowMultiPageIndicator = () => {\r\n        return (this.state.pdfFile !== null || this.state.tiffImages.length !== 0) && this.state.numPages > 1;\r\n    }\r\n\r\n    private createRegionIdFromBoundingBox = (boundingBox: number[], page: number): string => {\r\n        return boundingBox.join(\",\") + \":\" + page;\r\n    }\r\n\r\n    private handleLayerChange = async (layer: string) => {\r\n        switch (layer) {\r\n            case \"text\":\r\n                this.imageMap.toggleTextFeatureVisibility();\r\n                break;\r\n            case \"tables\":\r\n                this.imageMap.toggleTableFeatureVisibility();\r\n                break;\r\n        }\r\n        const newLayers = Object.assign({}, this.state.layers);\r\n        newLayers[layer] = !newLayers[layer];\r\n        this.setState({\r\n            layers : newLayers,\r\n        });\r\n    }\r\n\r\n    private handleTableToolTipChange = async (display: string, width: number, height: number, top: number,\r\n                                              left: number, rows: number, columns: number, featureID: string) => {\r\n    if (featureID !== null && this.imageMap.getTableBorderFeatureByID(featureID).get(\"state\") !== \"selected\") {\r\n        this.imageMap.getTableBorderFeatureByID(featureID).set(\"state\", \"hovering\");\r\n        this.imageMap.getTableIconFeatureByID(featureID).set(\"state\", \"hovering\");\r\n    } else if (featureID === null && this.state.hoveringFeature &&\r\n               this.imageMap.getTableBorderFeatureByID(this.state.hoveringFeature).get(\"state\") !== \"selected\") {\r\n        this.imageMap.getTableBorderFeatureByID(this.state.hoveringFeature).set(\"state\", \"rest\");\r\n        this.imageMap.getTableIconFeatureByID(this.state.hoveringFeature).set(\"state\", \"rest\");\r\n    }\r\n    const newTableIconTooltip = {\r\n        display,\r\n            width,\r\n            height,\r\n            top,\r\n            left,\r\n            rows,\r\n            columns,\r\n        };\r\n    this.setState({\r\n            tableIconTooltip : newTableIconTooltip,\r\n            hoveringFeature: featureID,\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { AutoSizer, List } from \"react-virtualized\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport { IAsset, AssetState, ISize } from \"../../../../models/applicationState\";\r\nimport { AssetPreview } from \"../../common/assetPreview/assetPreview\";\r\nimport { strings } from \"../../../../common/strings\";\r\n\r\n/**\r\n * Properties for Editor Side Bar\r\n * @member assets - Array of assets to be previewed\r\n * @member onAssetSelected - Function to call when asset from side bar is selected\r\n * @member selectedAsset - Asset initially selected\r\n * @member thumbnailSize - The size of the asset thumbnails\r\n */\r\nexport interface IEditorSideBarProps {\r\n    assets: IAsset[];\r\n    onAssetSelected: (asset: IAsset) => void;\r\n    onBeforeAssetSelected?: () => boolean;\r\n    selectedAsset?: IAsset;\r\n    thumbnailSize?: ISize;\r\n}\r\n\r\n/**\r\n * State for Editor Side Bar\r\n * @member selectedAsset - Asset selected from side bar\r\n */\r\nexport interface IEditorSideBarState {\r\n    scrollToIndex: number;\r\n}\r\n\r\n/**\r\n * @name - Editor Side Bar\r\n * @description - Side bar for editor page\r\n */\r\nexport default class EditorSideBar extends React.Component<IEditorSideBarProps, IEditorSideBarState> {\r\n    public state: IEditorSideBarState = {\r\n        scrollToIndex: this.props.selectedAsset\r\n            ? this.props.assets\r\n                .findIndex((asset) => asset.id === this.props.selectedAsset.id)\r\n            : 0,\r\n    };\r\n\r\n    private listRef: React.RefObject<List> = React.createRef();\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"editor-page-sidebar-nav\">\r\n                <AutoSizer>\r\n                    {({ height, width }) => (\r\n                        <List\r\n                            ref={this.listRef}\r\n                            className=\"asset-list\"\r\n                            height={height}\r\n                            width={width}\r\n                            rowCount={this.props.assets.length}\r\n                            rowHeight={() => this.getRowHeight(width)}\r\n                            rowRenderer={this.rowRenderer}\r\n                            overscanRowCount={10}\r\n                            scrollToIndex={this.state.scrollToIndex}\r\n                        />\r\n                    )}\r\n                </AutoSizer>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: IEditorSideBarProps) {\r\n        if (prevProps.thumbnailSize !== this.props.thumbnailSize) {\r\n            this.listRef.current.recomputeRowHeights();\r\n        }\r\n\r\n        if (!prevProps.selectedAsset && !this.props.selectedAsset) {\r\n            return;\r\n        }\r\n\r\n        if ((!prevProps.selectedAsset && this.props.selectedAsset) ||\r\n            prevProps.selectedAsset.id !== this.props.selectedAsset.id) {\r\n            this.selectAsset(this.props.selectedAsset);\r\n        }\r\n    }\r\n\r\n    private getRowHeight = (width: number) => {\r\n        return width / (4 / 3) + 16;\r\n    }\r\n\r\n    private selectAsset = (selectedAsset: IAsset): void => {\r\n        const scrollToIndex = this.props.assets.findIndex((asset) => asset.id === selectedAsset.id);\r\n\r\n        this.setState({\r\n            scrollToIndex,\r\n        }, () => {\r\n            this.listRef.current.forceUpdateGrid();\r\n        });\r\n    }\r\n\r\n    private onAssetClicked = (asset: IAsset): void => {\r\n        if (this.props.onBeforeAssetSelected) {\r\n            if (!this.props.onBeforeAssetSelected()) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.selectAsset(asset);\r\n        this.props.onAssetSelected(asset);\r\n    }\r\n\r\n    private rowRenderer = ({ key, index, style }): JSX.Element => {\r\n        const asset = this.props.assets[index];\r\n        const selectedAsset = this.props.selectedAsset;\r\n\r\n        return (\r\n            <div key={asset.id} style={style} role=\"row\"\r\n                className={this.getAssetCssClassNames(asset, selectedAsset)}\r\n                onClick={() => this.onAssetClicked(asset)}>\r\n                <div className=\"asset-item-image\" role=\"gridcell\">\r\n                    {this.renderBadges(asset)}\r\n                    <AssetPreview asset={asset} />\r\n                </div>\r\n                <div className=\"asset-item-metadata\" role=\"rowheader\">\r\n                    <span className=\"asset-filename\" title={asset.name}>\r\n                        {asset.name.slice(asset.name.lastIndexOf(\"/\") + 1, asset.name.length)}\r\n                    </span>\r\n                    {asset.size &&\r\n                        <span>\r\n                            {asset.size.width} x {asset.size.height}\r\n                        </span>\r\n                    }\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderBadges = (asset: IAsset): JSX.Element => {\r\n        switch (asset.state) {\r\n            case AssetState.Tagged:\r\n                return (\r\n                    <span title={strings.editorPage.tagged}\r\n                        className=\"badge badge-tagged\">\r\n                        <FontIcon iconName=\"Tag\" />\r\n                    </span>\r\n                );\r\n            case AssetState.Visited:\r\n                return (\r\n                    <span title={strings.editorPage.visited}\r\n                        className=\"badge badge-visited\">\r\n                        <FontIcon iconName=\"View\" />\r\n                    </span>\r\n                );\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    private getAssetCssClassNames = (asset: IAsset, selectedAsset: IAsset = null): string => {\r\n        const cssClasses = [\"asset-item\"];\r\n        if (selectedAsset && selectedAsset.id === asset.id) {\r\n            cssClasses.push(\"selected\");\r\n        }\r\n\r\n        return cssClasses.join(\" \");\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport _ from \"lodash\";\r\nimport React, { RefObject } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport SplitPane from \"react-split-pane\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { PrimaryButton } from \"office-ui-fabric-react\";\r\nimport HtmlFileReader from \"../../../../common/htmlFileReader\";\r\nimport { strings } from \"../../../../common/strings\";\r\nimport {\r\n    AssetState, AssetType, EditorMode, IApplicationState,\r\n    IAppSettings, IAsset, IAssetMetadata, IProject, IRegion,\r\n    ISize, ITag,\r\n    ILabel,\r\n} from \"../../../../models/applicationState\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IProjectActions, * as projectActions from \"../../../../redux/actions/projectActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport { AssetPreview } from \"../../common/assetPreview/assetPreview\";\r\nimport { KeyboardBinding } from \"../../common/keyboardBinding/keyboardBinding\";\r\nimport { KeyEventType } from \"../../common/keyboardManager/keyboardManager\";\r\nimport { TagInput } from \"../../common/tagInput/tagInput\";\r\nimport { tagIndexKeys } from \"../../common/tagInput/tagIndexKeys\";\r\nimport Canvas from \"./canvas\";\r\nimport CanvasHelpers from \"./canvasHelpers\";\r\nimport \"./editorPage.scss\";\r\nimport EditorSideBar from \"./editorSideBar\";\r\nimport Alert from \"../../common/alert/alert\";\r\nimport Confirm from \"../../common/confirm/confirm\";\r\nimport { OCRService } from \"../../../../services/ocrService\";\r\nimport { throttle } from \"../../../../common/utils\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport PreventLeaving from \"../../common/preventLeaving/preventLeaving\";\r\nimport { Spinner, SpinnerSize } from \"office-ui-fabric-react/lib/Spinner\";\r\nimport { getPrimaryGreenTheme, getPrimaryRedTheme } from \"../../../../common/themes\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\n/**\r\n * Properties for Editor Page\r\n * @member project - Project being edited\r\n * @member recentProjects - Array of projects recently viewed/edited\r\n * @member actions - Project actions\r\n * @member applicationActions - Application setting actions\r\n */\r\nexport interface IEditorPageProps extends RouteComponentProps, React.Props<EditorPage> {\r\n    project: IProject;\r\n    recentProjects: IProject[];\r\n    appSettings: IAppSettings;\r\n    actions: IProjectActions;\r\n    applicationActions: IApplicationActions;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\n/**\r\n * State for Editor Page\r\n */\r\nexport interface IEditorPageState {\r\n    /** Array of assets in project */\r\n    assets: IAsset[];\r\n    /** The editor mode to set for canvas tools */\r\n    editorMode: EditorMode;\r\n    /** The selected asset for the primary editing experience */\r\n    selectedAsset?: IAssetMetadata;\r\n    /** Currently selected region on current asset */\r\n    selectedRegions?: IRegion[];\r\n    /** Most recently selected tag */\r\n    selectedTag: string;\r\n    /** Tags locked for region labeling */\r\n    lockedTags: string[];\r\n    /** Size of the asset thumbnails to display in the side bar */\r\n    thumbnailSize: ISize;\r\n    /**\r\n     * Whether or not the editor is in a valid state\r\n     * State is invalid when a region has not been tagged\r\n     */\r\n    isValid: boolean;\r\n    /** Whether the show invalid region warning alert should display */\r\n    showInvalidRegionWarning: boolean;\r\n    /** The currently hovered TagInputItemLabel */\r\n    hoveredLabel: ILabel;\r\n    /** Whether the task for loading all OCRs is running */\r\n    isRunningOCRs?: boolean;\r\n    /** Whether OCR is running in the main canvas */\r\n    isCanvasRunningOCR?: boolean;\r\n    isError?: boolean;\r\n    errorTitle?: string;\r\n    errorMessage?: string;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        recentProjects: state.recentProjects,\r\n        project: state.currentProject,\r\n        appSettings: state.appSettings,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(projectActions, dispatch),\r\n        applicationActions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n/**\r\n * @name - Editor Page\r\n * @description - Page for adding/editing/removing tags to assets\r\n */\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class EditorPage extends React.Component<IEditorPageProps, IEditorPageState> {\r\n    public state: IEditorPageState = {\r\n        selectedTag: null,\r\n        lockedTags: [],\r\n        assets: [],\r\n        editorMode: EditorMode.Select,\r\n        thumbnailSize: { width: 175, height: 155 },\r\n        isValid: true,\r\n        showInvalidRegionWarning: false,\r\n        hoveredLabel: null,\r\n    };\r\n\r\n    private tagInputRef: RefObject<TagInput>;\r\n\r\n    private loadingProjectAssets: boolean = false;\r\n    private canvas: RefObject<Canvas> = React.createRef();\r\n    private renameTagConfirm: React.RefObject<Confirm> = React.createRef();\r\n    private renameCanceled: () => void;\r\n    private deleteTagConfirm: React.RefObject<Confirm> = React.createRef();\r\n    private isUnmount: boolean = false;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.tagInputRef = React.createRef();\r\n    }\r\n\r\n    public async componentDidMount() {\r\n        window.addEventListener(\"focus\", this.onFocused);\r\n\r\n        this.isUnmount = false;\r\n        const projectId = this.props.match.params[\"projectId\"];\r\n        if (this.props.project) {\r\n            await this.loadProjectAssets();\r\n            this.props.appTitleActions.setTitle(this.props.project.name);\r\n        } else if (projectId) {\r\n            const project = this.props.recentProjects.find((project) => project.id === projectId);\r\n            await this.props.actions.loadProject(project);\r\n            this.props.appTitleActions.setTitle(project.name);\r\n        }\r\n        document.title = strings.editorPage.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public async componentDidUpdate(prevProps: Readonly<IEditorPageProps>) {\r\n        if (this.props.project && this.state.assets.length === 0) {\r\n            await this.loadProjectAssets();\r\n        }\r\n\r\n        if (this.props.project && prevProps.project && this.props.project.tags !== prevProps.project.tags) {\r\n            this.updateRootAssets();\r\n        }\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        this.isUnmount = true;\r\n        window.removeEventListener(\"focus\", this.onFocused);\r\n    }\r\n\r\n    public render() {\r\n        const { project } = this.props;\r\n        const { assets, selectedAsset, isRunningOCRs, isCanvasRunningOCR } = this.state;\r\n        const rootAssets = assets.filter((asset) => !asset.parent);\r\n\r\n        const labels = (selectedAsset &&\r\n            selectedAsset.labelData &&\r\n            selectedAsset.labelData.labels) || [];\r\n\r\n        const needRunOCRButton = assets.some((asset) => asset.state === AssetState.NotVisited);\r\n\r\n        if (!project) {\r\n            return (<div>Loading...</div>);\r\n        }\r\n\r\n        return (\r\n            <div className=\"editor-page\" id=\"pageEditor\">\r\n                {\r\n                    tagIndexKeys.map((index) =>\r\n                        (<KeyboardBinding\r\n                            displayName={strings.editorPage.tags.hotKey.apply}\r\n                            key={index}\r\n                            keyEventType={KeyEventType.KeyDown}\r\n                            accelerators={[`${index}`]}\r\n                            icon={\"fa-tag\"}\r\n                            handler={this.handleTagHotKey} />))\r\n                }\r\n                <SplitPane split=\"vertical\"\r\n                    defaultSize={this.state.thumbnailSize.width}\r\n                    minSize={175}\r\n                    maxSize={175}\r\n                    paneStyle={{ display: \"flex\" }}\r\n                    onChange={this.onSideBarResize}\r\n                    onDragFinished={this.onSideBarResizeComplete}>\r\n                    <div className=\"editor-page-sidebar bg-lighter-1\">\r\n                        {needRunOCRButton && <div>\r\n                            <PrimaryButton\r\n                                theme={getPrimaryGreenTheme()}\r\n                                className=\"editor-page-sidebar-run-ocr\"\r\n                                type=\"button\"\r\n                                onClick={this.loadAllOCRs}\r\n                                disabled={this.state.isRunningOCRs}>\r\n                                {this.state.isRunningOCRs ?\r\n                                    <div>\r\n                                        <Spinner\r\n                                            size={SpinnerSize.small}\r\n                                            label=\"Running OCR\"\r\n                                            ariaLive=\"off\"\r\n                                            labelPosition=\"right\"\r\n                                        />\r\n                                    </div> : \"Run OCR on all files\"\r\n                                }\r\n                            </PrimaryButton>\r\n                        </div>}\r\n                        <EditorSideBar\r\n                            assets={rootAssets}\r\n                            selectedAsset={selectedAsset ? selectedAsset.asset : null}\r\n                            onBeforeAssetSelected={this.onBeforeAssetSelected}\r\n                            onAssetSelected={this.selectAsset}\r\n                            thumbnailSize={this.state.thumbnailSize}\r\n                        />\r\n                    </div>\r\n                    <div className=\"editor-page-content\" onClick={this.onPageClick}>\r\n                        <div className=\"editor-page-content-main\" >\r\n                            <div className=\"editor-page-content-main-body\" onClick = {this.onPageContainerClick}>\r\n                                {selectedAsset &&\r\n                                    <Canvas\r\n                                        ref={this.canvas}\r\n                                        selectedAsset={this.state.selectedAsset}\r\n                                        onAssetMetadataChanged={this.onAssetMetadataChanged}\r\n                                        onCanvasRendered={this.onCanvasRendered}\r\n                                        onSelectedRegionsChanged={this.onSelectedRegionsChanged}\r\n                                        onRunningOCRStatusChanged={this.onCanvasRunningOCRStatusChanged}\r\n                                        editorMode={this.state.editorMode}\r\n                                        project={this.props.project}\r\n                                        lockedTags={this.state.lockedTags}\r\n                                        hoveredLabel={this.state.hoveredLabel}>\r\n                                        <AssetPreview\r\n                                            controlsEnabled={this.state.isValid}\r\n                                            onBeforeAssetChanged={this.onBeforeAssetSelected}\r\n                                            asset={this.state.selectedAsset.asset} />\r\n                                    </Canvas>\r\n                                }\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"editor-page-right-sidebar\">\r\n                            <TagInput\r\n                                tags={this.props.project.tags}\r\n                                lockedTags={this.state.lockedTags}\r\n                                selectedRegions={this.state.selectedRegions}\r\n                                labels={labels}\r\n                                onChange={this.onTagsChanged}\r\n                                onLockedTagsChange={this.onLockedTagsChanged}\r\n                                onTagClick={this.onTagClicked}\r\n                                onCtrlTagClick={this.onCtrlTagClicked}\r\n                                onTagRename={this.confirmTagRename}\r\n                                onTagDeleted={this.confirmTagDeleted}\r\n                                onLabelEnter={this.onLabelEnter}\r\n                                onLabelLeave={this.onLabelLeave}\r\n                                onTagChanged={this.onTagChanged}\r\n                                ref = {this.tagInputRef}\r\n                            />\r\n                        </div>\r\n                        <Confirm title={strings.editorPage.tags.rename.title}\r\n                            ref={this.renameTagConfirm}\r\n                            message={strings.editorPage.tags.rename.confirmation}\r\n                            confirmButtonTheme={getPrimaryRedTheme()}\r\n                            onCancel={this.onTagRenameCanceled}\r\n                            onConfirm={this.onTagRenamed} />\r\n                        <Confirm title={strings.editorPage.tags.delete.title}\r\n                            ref={this.deleteTagConfirm}\r\n                            message={strings.editorPage.tags.delete.confirmation}\r\n                            confirmButtonTheme={getPrimaryRedTheme()}\r\n                            onConfirm={this.onTagDeleted} />\r\n                    </div>\r\n                </SplitPane>\r\n                <Alert\r\n                    show={this.state.showInvalidRegionWarning}\r\n                    title={strings.editorPage.messages.enforceTaggedRegions.title}\r\n                    // tslint:disable-next-line:max-line-length\r\n                    message={strings.editorPage.messages.enforceTaggedRegions.description}\r\n                    onClose={() => this.setState({ showInvalidRegionWarning: false })}\r\n                />\r\n                <Alert\r\n                    show={this.state.isError}\r\n                    title={this.state.errorTitle || \"Error\"}\r\n                    message={this.state.errorMessage}\r\n                    onClose={() => this.setState({\r\n                        isError: false,\r\n                        errorTitle: undefined,\r\n                        errorMessage: undefined,\r\n                    })}\r\n                />\r\n                <PreventLeaving\r\n                    when={isRunningOCRs || isCanvasRunningOCR}\r\n                    message={\"An OCR operation is currently in progress, are you sure you want to leave?\"}\r\n                />\r\n                <SkipButton skipTo = \"pageEditor\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // call function from child\r\n    private onPageContainerClick = () => {\r\n        // workaround: tagInput will not lost focus with olmap,\r\n        // so we fire the blur event manually here\r\n        this.tagInputRef.current.triggerNewTagBlur();\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    private onPageClick = () => {\r\n    }\r\n\r\n    /**\r\n     * Called when the asset side bar is resized\r\n     * @param newWidth The new sidebar width\r\n     */\r\n    private onSideBarResize = (newWidth: number) => {\r\n        this.setState({\r\n            thumbnailSize: {\r\n                width: newWidth,\r\n                height: newWidth / (4 / 3),\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Called when the asset sidebar has been completed\r\n     */\r\n    private onSideBarResizeComplete = () => {\r\n        const appSettings = {\r\n            ...this.props.appSettings,\r\n            thumbnailSize: this.state.thumbnailSize,\r\n        };\r\n\r\n        this.props.applicationActions.saveAppSettings(appSettings);\r\n    }\r\n\r\n    /**\r\n     * Called when a tag from footer is clicked\r\n     * @param tag Tag clicked\r\n     */\r\n    private onTagClicked = (tag: ITag): void => {\r\n        this.setState({\r\n            selectedTag: tag.name,\r\n            lockedTags: [],\r\n        }, () => this.canvas.current.applyTag(tag.name));\r\n    }\r\n\r\n    /**\r\n     * Open confirm dialog for tag renaming\r\n     */\r\n    private confirmTagRename = (tag: ITag, newTag: ITag, cancelCallback: () => void): void => {\r\n        this.renameCanceled = cancelCallback;\r\n        this.renameTagConfirm.current.open(tag, newTag);\r\n    }\r\n\r\n    /**\r\n     * Renames tag in assets and project, and saves files\r\n     * @param tag Tag to be renamed\r\n     * @param newTag Tag with the new name\r\n     */\r\n    private onTagRenamed = async (tag: ITag, newTag: ITag): Promise<void> => {\r\n        this.renameCanceled = null;\r\n        const assetUpdates = await this.props.actions.updateProjectTag(this.props.project, tag, newTag);\r\n        const selectedAsset = assetUpdates.find((am) => am.asset.id === this.state.selectedAsset.asset.id);\r\n\r\n        if (selectedAsset) {\r\n            if (selectedAsset) {\r\n                this.setState({ selectedAsset });\r\n            }\r\n        }\r\n    }\r\n\r\n    private onTagRenameCanceled = () => {\r\n        if (this.renameCanceled) {\r\n            this.renameCanceled();\r\n            this.renameCanceled = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Open Confirm dialog for tag deletion\r\n     */\r\n    private confirmTagDeleted = (tagName: string): void => {\r\n        this.deleteTagConfirm.current.open(tagName);\r\n    }\r\n\r\n    /**\r\n     * Removes tag from assets and projects and saves files\r\n     * @param tagName Name of tag to be deleted\r\n     */\r\n    private onTagDeleted = async (tagName: string): Promise<void> => {\r\n        const assetUpdates = await this.props.actions.deleteProjectTag(this.props.project, tagName);\r\n\r\n        const selectedAsset = assetUpdates.find((am) => am.asset.id === this.state.selectedAsset.asset.id);\r\n        if (selectedAsset) {\r\n            this.setState({ selectedAsset });\r\n        }\r\n    }\r\n\r\n    private onCtrlTagClicked = (tag: ITag): void => {\r\n        const locked = this.state.lockedTags;\r\n        this.setState({\r\n            selectedTag: tag.name,\r\n            lockedTags: CanvasHelpers.toggleTag(locked, tag.name),\r\n        }, () => this.canvas.current.applyTag(tag.name));\r\n    }\r\n\r\n    private getTagFromKeyboardEvent = (event: KeyboardEvent): ITag => {\r\n        const index = tagIndexKeys.indexOf(event.key);\r\n        const tags = this.props.project.tags;\r\n        if (index >= 0 && index < tags.length) {\r\n            return tags[index];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Listens for {number key} and calls `onTagClicked` with tag corresponding to that number\r\n     * @param event KeyDown event\r\n     */\r\n    private handleTagHotKey = (event: KeyboardEvent): void => {\r\n        const tag = this.getTagFromKeyboardEvent(event);\r\n        if (tag) {\r\n            this.onTagClicked(tag);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns a value indicating whether the current asset is taggable\r\n     */\r\n    private isTaggableAssetType = (asset: IAsset): boolean => {\r\n        return asset.type !== AssetType.Unknown;\r\n    }\r\n\r\n    /**\r\n     * Raised when the selected asset has been changed.\r\n     * This can either be a parent or child asset\r\n     */\r\n    private onAssetMetadataChanged = async (assetMetadata: IAssetMetadata): Promise<void> => {\r\n        // Comment out below code as we allow regions without tags, it would make labeler's work easier.\r\n\r\n        const initialState = assetMetadata.asset.state;\r\n\r\n        // The root asset can either be the actual asset being edited (ex: VideoFrame) or the top level / root\r\n        // asset selected from the side bar (image/video).\r\n        const rootAsset = { ...(assetMetadata.asset.parent || assetMetadata.asset) };\r\n\r\n        if (this.isTaggableAssetType(assetMetadata.asset)) {\r\n            assetMetadata.asset.state = _.get(assetMetadata, \"labelData.labels.length\", 0) > 0 ?\r\n                AssetState.Tagged :\r\n                AssetState.Visited;\r\n        } else if (assetMetadata.asset.state === AssetState.NotVisited) {\r\n            assetMetadata.asset.state = AssetState.Visited;\r\n        }\r\n\r\n        // Update root asset if not already in the \"Tagged\" state\r\n        // This is primarily used in the case where a Video Frame is being edited.\r\n        // We want to ensure that in this case the root video asset state is accurately\r\n        // updated to match that state of the asset.\r\n        if (rootAsset.id === assetMetadata.asset.id) {\r\n            rootAsset.state = assetMetadata.asset.state;\r\n        } else {\r\n            const rootAssetMetadata = await this.props.actions.loadAssetMetadata(this.props.project, rootAsset);\r\n\r\n            if (rootAssetMetadata.asset.state !== AssetState.Tagged) {\r\n                rootAssetMetadata.asset.state = assetMetadata.asset.state;\r\n                await this.props.actions.saveAssetMetadata(this.props.project, rootAssetMetadata);\r\n            }\r\n\r\n            rootAsset.state = rootAssetMetadata.asset.state;\r\n        }\r\n\r\n        // Only update asset metadata if state changes or is different\r\n        if (initialState !== assetMetadata.asset.state || this.state.selectedAsset !== assetMetadata) {\r\n            await this.props.actions.saveAssetMetadata(this.props.project, assetMetadata);\r\n            if (this.props.project.lastVisitedAssetId === assetMetadata.asset.id) {\r\n                this.setState({selectedAsset: assetMetadata});\r\n            }\r\n        }\r\n\r\n        await this.props.actions.saveProject(this.props.project);\r\n\r\n        // Find and update the root asset in the internal state\r\n        // This forces the root assets that are displayed in the sidebar to\r\n        // accurately show their correct state (not-visited, visited or tagged)\r\n        const assets = [...this.state.assets];\r\n        const assetIndex = assets.findIndex((asset) => asset.id === rootAsset.id);\r\n        if (assetIndex > -1) {\r\n            assets[assetIndex] = {\r\n                ...rootAsset,\r\n            };\r\n        }\r\n\r\n        this.setState({ assets, isValid: true });\r\n\r\n        // Workaround for if component is unmounted\r\n        if (!this.isUnmount) {\r\n            this.props.appTitleActions.setTitle(`${this.props.project.name} - [ ${rootAsset.name} ]`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Raised when the asset binary has been painted onto the canvas tools rendering canvas\r\n     */\r\n    private onCanvasRendered = async (canvas: HTMLCanvasElement) => {\r\n        // When active learning auto-detect is enabled\r\n        // run predictions when asset changes\r\n    }\r\n\r\n    private onSelectedRegionsChanged = (selectedRegions: IRegion[]) => {\r\n        this.setState({ selectedRegions });\r\n    }\r\n\r\n    private onTagsChanged = async (tags) => {\r\n        const project = {\r\n            ...this.props.project,\r\n            tags,\r\n        };\r\n        await this.props.actions.saveProject(project);\r\n    }\r\n\r\n    private onLockedTagsChanged = (lockedTags: string[]) => {\r\n        this.setState({ lockedTags });\r\n    }\r\n\r\n    private onBeforeAssetSelected = (): boolean => {\r\n        if (!this.state.isValid) {\r\n            this.setState({ showInvalidRegionWarning: true });\r\n        }\r\n\r\n        return this.state.isValid;\r\n    }\r\n\r\n    private selectAsset = async (asset: IAsset): Promise<void> => {\r\n        // Nothing to do if we are already on the same asset.\r\n        if (this.state.selectedAsset && this.state.selectedAsset.asset.id === asset.id) {\r\n            return;\r\n        }\r\n\r\n        if (!this.state.isValid) {\r\n            this.setState({ showInvalidRegionWarning: true });\r\n            return;\r\n        }\r\n\r\n        const assetMetadata = await this.props.actions.loadAssetMetadata(this.props.project, asset);\r\n\r\n        try {\r\n            if (!assetMetadata.asset.size) {\r\n                const assetProps = await HtmlFileReader.readAssetAttributes(asset);\r\n                assetMetadata.asset.size = { width: assetProps.width, height: assetProps.height };\r\n            }\r\n        } catch (err) {\r\n            console.warn(\"Error computing asset size\");\r\n        }\r\n\r\n        this.setState({\r\n            selectedAsset: assetMetadata,\r\n        }, async () => {\r\n            await this.onAssetMetadataChanged(assetMetadata);\r\n        });\r\n    }\r\n\r\n    private loadProjectAssets = async (): Promise<void> => {\r\n        if (this.loadingProjectAssets) {\r\n            return;\r\n        }\r\n\r\n        this.loadingProjectAssets = true;\r\n\r\n        const rootAssets: IAsset[] = _(await this.props.actions.loadAssets(this.props.project))\r\n            .uniqBy((asset) => asset.id)\r\n            .value();\r\n\r\n        if (this.state.assets.length === rootAssets.length\r\n            && this.state.assets.map((asset) => asset.id).join(\",\") === rootAssets.map((asset) => asset.id).join(\",\")) {\r\n            this.loadingProjectAssets = false;\r\n            return;\r\n        }\r\n\r\n        const lastVisited = rootAssets.find((asset) => asset.id === this.props.project.lastVisitedAssetId);\r\n\r\n        this.setState({\r\n            assets: rootAssets,\r\n        }, async () => {\r\n            if (rootAssets.length > 0) {\r\n                await this.selectAsset(lastVisited ? lastVisited : rootAssets[0]);\r\n            }\r\n            this.loadingProjectAssets = false;\r\n        });\r\n    }\r\n\r\n    private loadAllOCRs = async () => {\r\n        if (this.state.isRunningOCRs) {\r\n            return;\r\n        }\r\n\r\n        const { project } = this.props;\r\n        const ocrService = new OCRService(project);\r\n        if (this.state.assets) {\r\n            this.setState({ isRunningOCRs: true });\r\n            try {\r\n                await throttle(\r\n                    constants.maxConcurrentServiceRequests,\r\n                    this.state.assets.filter((asset) => asset.state === AssetState.NotVisited).map((asset) => asset.id),\r\n                    async (assetId) => {\r\n                        // Get the latest version of asset.\r\n                        const asset = this.state.assets.find((asset) => asset.id === assetId);\r\n                        if (asset && asset.state === AssetState.NotVisited) {\r\n                            try {\r\n                                this.updateAssetState(asset.id, true);\r\n                                await ocrService.getRecognizedText(asset.path, asset.name);\r\n                                this.updateAssetState(asset.id, false, AssetState.Visited);\r\n                            } catch (err) {\r\n                                this.updateAssetState(asset.id, false);\r\n                                this.setState({\r\n                                    isError: true,\r\n                                    errorTitle: err.title,\r\n                                    errorMessage: err.message,\r\n                                });\r\n                            }\r\n                        }\r\n                });\r\n            } finally {\r\n                this.setState({ isRunningOCRs: false });\r\n            }\r\n        }\r\n    }\r\n\r\n    private updateAssetState = (id: string, isRunningOCR: boolean, assetState?: AssetState) => {\r\n        this.setState((state) => ({\r\n            assets: state.assets.map((asset) => {\r\n                if (asset.id === id) {\r\n                    const updatedAsset = { ...asset, isRunningOCR };\r\n                    if (assetState !== undefined && asset.state === AssetState.NotVisited) {\r\n                        updatedAsset.state = assetState;\r\n                    }\r\n                    return updatedAsset;\r\n                } else {\r\n                    return asset;\r\n                }\r\n            }),\r\n        }), () => {\r\n            if (this.state.selectedAsset && id === this.state.selectedAsset.asset.id) {\r\n                const asset = this.state.assets.find((asset) => asset.id === id);\r\n                if (asset) {\r\n                    this.setState({\r\n                        selectedAsset: { ...this.state.selectedAsset, asset: { ...asset } },\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Updates the root asset list from the project assets\r\n     */\r\n    private updateRootAssets = () => {\r\n        const updatedAssets = [...this.state.assets];\r\n        updatedAssets.forEach((asset) => {\r\n            const projectAsset = _.get(this.props, \"project.assets[asset.id]\", null);\r\n            if (projectAsset) {\r\n                asset.state = projectAsset.state;\r\n            }\r\n        });\r\n\r\n        this.setState({ assets: updatedAssets });\r\n    }\r\n\r\n    private onLabelEnter = (label: ILabel) => {\r\n        this.setState({hoveredLabel: label});\r\n    }\r\n\r\n    private onLabelLeave = (label: ILabel) => {\r\n        this.setState({hoveredLabel: null});\r\n    }\r\n\r\n    private onCanvasRunningOCRStatusChanged = (isCanvasRunningOCR: boolean) => {\r\n        this.setState({ isCanvasRunningOCR });\r\n    }\r\n\r\n    private onFocused = () => {\r\n        this.loadProjectAssets();\r\n    }\r\n\r\n    private onTagChanged = async (oldTag: ITag, newTag: ITag) => {\r\n        const assetUpdates = await this.props.actions.updateProjectTag(this.props.project, oldTag, newTag);\r\n        const selectedAsset = assetUpdates.find((am) => am.asset.id === this.state.selectedAsset.asset.id);\r\n\r\n        if (selectedAsset) {\r\n            if (selectedAsset) {\r\n                this.setState({\r\n                    selectedAsset,\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { ITag } from \"../../../../models/applicationState\";\r\nimport \"./predictResult.scss\";\r\nimport { getPrimaryGreenTheme } from \"../../../../common/themes\";\r\nimport { PrimaryButton } from \"office-ui-fabric-react\";\r\n\r\nexport interface IPredictResultProps {\r\n    predictions: { [key: string]: any };\r\n    analyzeResult: {};\r\n    page: number;\r\n    tags: ITag[];\r\n    downloadResultLabel: string;\r\n    onPredictionClick?: (item: any) => void;\r\n    onPredictionMouseEnter?: (item: any) => void;\r\n    onPredictionMouseLeave?: (item: any) => void;\r\n}\r\n\r\nexport interface IPredictResultState { }\r\n\r\nexport default class PredictResult extends React.Component<IPredictResultProps, IPredictResultState> {\r\n    public render() {\r\n        const { tags, predictions } = this.props;\r\n        const tagsDisplayOrder = tags.map((tag) => tag.name);\r\n        for (const name of Object.keys(predictions)) {\r\n            const prediction = predictions[name];\r\n            if (prediction != null) {\r\n                prediction.fieldName = name;\r\n                prediction.displayOrder = tagsDisplayOrder.indexOf(name);\r\n            }\r\n        }\r\n        // not sure if we decide to filter item by the page\r\n        const items = Object.values(predictions).filter(Boolean).sort((p1, p2) => p1.displayOrder - p2.displayOrder);\r\n\r\n        return (\r\n            <div>\r\n                <div className=\"prediction-header\">\r\n                    <h5 className=\"prediction-header-result\">Result:</h5>\r\n                    <PrimaryButton\r\n                        className=\"prediction-header-download\"\r\n                        theme={getPrimaryGreenTheme()}\r\n                        type=\"button\"\r\n                        title=\"Download JSON\"\r\n                        onClick={this.triggerDownload}>\r\n                        Download result (JSON)\r\n                    </PrimaryButton>\r\n                </div>\r\n                <div className=\"prediction-field-header\">\r\n                    <h6 className=\"prediction-field-header-field\"> Field </h6>\r\n                    <h6 className=\"prediction-field-header-confidence\"> Confidence </h6>\r\n                </div>\r\n                <div className=\"prediction-header-clear\"></div>\r\n\r\n                {items.map((item: any, key) => this.renderItem(item, key))}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderItem = (item: any, key: any) => {\r\n        const style: any = {\r\n            background: this.getTagColor(item.fieldName),\r\n        };\r\n        return (\r\n            <div key={key}\r\n                onClick={() => this.onPredictionClick(item)}\r\n                onMouseEnter={() => this.onPredictionMouseEnter(item)}\r\n                onMouseLeave={() => this.onPredictionMouseLeave(item)}>\r\n                <li className=\"predictiontag-item\" style={style}>\r\n                    <div className={\"predictiontag-color\"}>\r\n                        <span>P. {item.page}</span>\r\n                    </div>\r\n                    <div className={\"predictiontag-content\"}>\r\n                        {this.getPredictionTagContent(item)}\r\n                    </div>\r\n                </li>\r\n                <li className=\"predictiontag-item-label\">\r\n                    {item.text}\r\n                </li>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getTagColor = (name: string): string => {\r\n        const tag: ITag = this.props.tags.find((tag) => tag.name.toLocaleLowerCase() === name.toLocaleLowerCase());\r\n        if (tag) {\r\n            return tag.color;\r\n        }\r\n        return \"#999999\";\r\n    }\r\n\r\n    private getPredictionTagContent = (item: any) => {\r\n        return (\r\n            <div className={\"predictiontag-name-container\"}>\r\n                <div className=\"predictiontag-name-body\">\r\n                    {\r\n                        <span title={item.fieldName} className=\"predictiontag-name-text px-2\">\r\n                            {item.fieldName}\r\n                        </span>\r\n                    }\r\n                </div>\r\n                <div className={\"predictiontag-confidence\"}>\r\n                    <span>{this.toPercentage(item.confidence)}</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private triggerDownload = (): void => {\r\n        const fileURL = window.URL.createObjectURL(\r\n            new Blob([JSON.stringify(this.props.analyzeResult)]));\r\n        const fileLink = document.createElement(\"a\");\r\n        const fileBaseName = this.props.downloadResultLabel.split(\".\")[0];\r\n        const downloadFileName = \"Result-\" + fileBaseName + \".json\";\r\n\r\n        fileLink.href = fileURL;\r\n        fileLink.setAttribute(\"download\", downloadFileName);\r\n        document.body.appendChild(fileLink);\r\n        fileLink.click();\r\n    }\r\n\r\n    private toPercentage = (x: number): string => {\r\n        return (100 * x).toFixed(1) + \"%\";\r\n    }\r\n\r\n    private onPredictionClick = (prediction: any) => {\r\n        if (this.props.onPredictionClick) {\r\n            this.props.onPredictionClick(prediction);\r\n        }\r\n    }\r\n\r\n    private onPredictionMouseEnter = (prediction: any) => {\r\n        if (this.props.onPredictionMouseEnter) {\r\n            this.props.onPredictionMouseEnter(prediction);\r\n        }\r\n    }\r\n\r\n    private onPredictionMouseLeave = (prediction: any) => {\r\n        if (this.props.onPredictionMouseLeave) {\r\n            this.props.onPredictionMouseLeave(prediction);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { FontIcon, PrimaryButton, Spinner, SpinnerSize, IconButton} from \"office-ui-fabric-react\";\r\nimport IProjectActions, * as projectActions from \"../../../../redux/actions/projectActions\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport \"./predictPage.scss\";\r\nimport {\r\n    IApplicationState, IConnection, IProject, IAppSettings, AppError, ErrorCode,\r\n} from \"../../../../models/applicationState\";\r\nimport { ImageMap } from \"../../common/imageMap/imageMap\";\r\nimport Style from \"ol/style/Style\";\r\nimport Stroke from \"ol/style/Stroke\";\r\nimport Fill from \"ol/style/Fill\";\r\nimport PredictResult from \"./predictResult\";\r\nimport _ from \"lodash\";\r\nimport pdfjsLib from \"pdfjs-dist\";\r\nimport Alert from \"../../common/alert/alert\";\r\nimport url from \"url\";\r\nimport HtmlFileReader from \"../../../../common/htmlFileReader\";\r\nimport { Feature } from \"ol\";\r\nimport Polygon from \"ol/geom/Polygon\";\r\nimport { strings, interpolate } from \"../../../../common/strings\";\r\nimport PreventLeaving from \"../../common/preventLeaving/preventLeaving\";\r\nimport ServiceHelper from \"../../../../services/serviceHelper\";\r\nimport { parseTiffData, renderTiffToCanvas, loadImageToCanvas } from \"../../../../common/utils\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport { getPrimaryGreenTheme, getPrimaryWhiteTheme } from \"../../../../common/themes\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\nconst cMapUrl = constants.pdfjsCMapUrl(pdfjsLib.version);\r\n\r\nexport interface IPredictPageProps extends RouteComponentProps, React.Props<PredictPage> {\r\n    recentProjects: IProject[];\r\n    connections: IConnection[];\r\n    appSettings: IAppSettings;\r\n    project: IProject;\r\n    actions: IProjectActions;\r\n    applicationActions: IApplicationActions;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\nexport interface IPredictPageState {\r\n    analyzeResult: {};\r\n    fileLabel: string;\r\n    predictionLoaded: boolean;\r\n    currPage: number;\r\n    imageUri: string;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    shouldShowAlert: boolean;\r\n    alertTitle: string;\r\n    alertMessage: string;\r\n    fileChanged: boolean;\r\n    predictRun: boolean;\r\n    isPredicting: boolean;\r\n    file?: File;\r\n    highlightedField: string;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        recentProjects: state.recentProjects,\r\n        connections: state.connections,\r\n        appSettings: state.appSettings,\r\n        project: state.currentProject,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        actions: bindActionCreators(projectActions, dispatch),\r\n        applicationActions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class PredictPage extends React.Component<IPredictPageProps, IPredictPageState> {\r\n    public state: IPredictPageState = {\r\n        analyzeResult: {},\r\n        fileLabel: \"Browse for a file...\",\r\n        predictionLoaded: true,\r\n        currPage: undefined,\r\n        imageUri: null,\r\n        imageWidth: 0,\r\n        imageHeight: 0,\r\n        shouldShowAlert: false,\r\n        alertTitle: \"\",\r\n        alertMessage: \"\",\r\n        fileChanged: false,\r\n        predictRun: false,\r\n        isPredicting: false,\r\n        highlightedField: \"\",\r\n    };\r\n\r\n    private fileInput: React.RefObject<HTMLInputElement> = React.createRef();\r\n    private currPdf: any;\r\n    private tiffImages: any[];\r\n    private imageMap: ImageMap;\r\n\r\n    public async componentDidMount() {\r\n        const projectId = this.props.match.params[\"projectId\"];\r\n        if (projectId) {\r\n            const project = this.props.recentProjects.find((project) => project.id === projectId);\r\n            await this.props.actions.loadProject(project);\r\n            this.props.appTitleActions.setTitle(project.name);\r\n        }\r\n        document.title = strings.predict.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public componentDidUpdate(prevProps, prevState) {\r\n        if (this.state.file) {\r\n            if (this.state.fileChanged) {\r\n                this.currPdf = null;\r\n                this.tiffImages = [];\r\n                this.loadFile(this.state.file);\r\n                this.setState({ fileChanged: false });\r\n            } else if (prevState.currPage !== this.state.currPage) {\r\n                if (this.currPdf !== null) {\r\n                    this.loadPdfPage(this.currPdf, this.state.currPage);\r\n                } else if (this.tiffImages.length !== 0) {\r\n                    this.loadTiffPage(this.tiffImages, this.state.currPage);\r\n                }\r\n            } else if (this.getOcrFromAnalyzeResult(this.state.analyzeResult).length > 0 &&\r\n                prevState.imageUri !== this.state.imageUri) {\r\n                this.imageMap.removeAllFeatures();\r\n                this.drawPredictionResult();\r\n            }\r\n\r\n            if (prevState.highlightedField !== this.state.highlightedField) {\r\n                this.setPredictedFieldHighlightStatus(this.state.highlightedField);\r\n            }\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const browseFileDisabled: boolean = !this.state.predictionLoaded;\r\n        const predictDisabled: boolean = !this.state.predictionLoaded || !this.state.file;\r\n        const predictions = this.getPredictionsFromAnalyzeResult(this.state.analyzeResult);\r\n\r\n        return (\r\n            <div className=\"predict\" id=\"pagePredict\">\r\n                <div className=\"predict-main\">\r\n                    {this.state.file && this.state.imageUri && this.renderImageMap()}\r\n                    {this.renderPrevPageButton()}\r\n                    {this.renderNextPageButton()}\r\n                </div>\r\n                <div className=\"predict-sidebar bg-lighter-1\">\r\n                    <div className=\"condensed-list\">\r\n                        <h6 className=\"condensed-list-header bg-darker-2 p-2 flex-center\">\r\n                            <FontIcon iconName=\"Insights\" />\r\n                            <span className=\"condensed-list-title\">Predict</span>\r\n                        </h6>\r\n                        <div className=\"p-3\">\r\n                            <h5>{strings.predict.uploadFile}</h5>\r\n                                <div style={{display: \"flex\", marginBottom: \"25px\"}}>\r\n                                    <input\r\n                                        aria-hidden=\"true\"\r\n                                        type=\"file\"\r\n                                        accept=\"application/pdf, image/jpeg, image/png, image/tiff\"\r\n                                        id=\"hiddenInputFile\"\r\n                                        ref={this.fileInput}\r\n                                        onChange={this.handleFileChange}\r\n                                        disabled={browseFileDisabled} />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        id=\"inputPredictFile\"\r\n                                        style = {{cursor: (browseFileDisabled ? \"default\" : \"pointer\")}}\r\n                                        onClick={this.handleDummyInputClick}\r\n                                        readOnly={true}\r\n                                        className=\"dummyInputFile\"\r\n                                        aria-label={strings.predict.uploadFile}\r\n                                        value={this.state.fileLabel}/>\r\n                                    <div className=\"rlMargin10\">\r\n                                        <PrimaryButton\r\n                                            theme={getPrimaryGreenTheme()}\r\n                                            text=\"Browse\"\r\n                                            allowDisabledFocus\r\n                                            disabled={browseFileDisabled}\r\n                                            autoFocus={true}\r\n                                            onClick={this.handleDummyInputClick}\r\n                                        />\r\n                                    </div>\r\n                                    <PrimaryButton\r\n                                        theme={getPrimaryWhiteTheme()}\r\n                                        text=\"Predict\"\r\n                                        aria-label={!this.state.predictionLoaded ? strings.predict.inProgress : \"\"}\r\n                                        allowDisabledFocus\r\n                                        disabled={predictDisabled}\r\n                                        onClick={this.handleClick}\r\n                                    />\r\n                                </div>\r\n                            {!this.state.predictionLoaded &&\r\n                                <div className=\"loading-container\">\r\n                                    <Spinner\r\n                                        label={strings.predict.inProgress}\r\n                                        ariaLive=\"assertive\"\r\n                                        labelPosition=\"right\"\r\n                                        size={SpinnerSize.large}\r\n                                    />\r\n                                </div>\r\n                            }\r\n                            {Object.keys(predictions).length > 0 &&\r\n                                <PredictResult\r\n                                    predictions={predictions}\r\n                                    analyzeResult={this.state.analyzeResult}\r\n                                    page={this.state.currPage}\r\n                                    tags={this.props.project.tags}\r\n                                    downloadResultLabel={this.state.fileLabel}\r\n                                    onPredictionClick={this.onPredictionClick}\r\n                                    onPredictionMouseEnter={this.onPredictionMouseEnter}\r\n                                    onPredictionMouseLeave={this.onPredictionMouseLeave}\r\n                                />\r\n                            }\r\n                            {\r\n                                (Object.keys(predictions).length === 0 && this.state.predictRun) &&\r\n                                <div>\r\n                                    No field can be extracted.\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <Alert\r\n                    show={this.state.shouldShowAlert}\r\n                    title={this.state.alertTitle}\r\n                    message={this.state.alertMessage}\r\n                    onClose={() => this.setState({\r\n                        shouldShowAlert: false,\r\n                        alertTitle: \"\",\r\n                        alertMessage: \"\",\r\n                        predictionLoaded: true,\r\n                    })}\r\n                />\r\n                <PreventLeaving\r\n                    when={this.state.isPredicting}\r\n                    message={\"A prediction operation is currently in progress, are you sure you want to leave?\"}\r\n                />\r\n                <SkipButton skipTo=\"pagePredict\">{strings.common.skipToMainContent}</SkipButton>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private handleDummyInputClick = () => {\r\n        document.getElementById(\"hiddenInputFile\").click();\r\n    }\r\n\r\n    private renderPrevPageButton = () => {\r\n        if (!_.get(this, \"fileInput.current.files[0]\", null)) {\r\n            return <div></div>;\r\n        }\r\n        const prevPage = () => {\r\n            this.setState((prevState) => ({\r\n                currPage: Math.max(1, prevState.currPage - 1),\r\n            }));\r\n        };\r\n\r\n        if (this.state.currPage > 1) {\r\n            return (\r\n                <IconButton\r\n                    className=\"toolbar-btn prev\"\r\n                    title=\"Previous\"\r\n                    iconProps={{iconName: \"ChevronLeft\"}}\r\n                    onClick={prevPage}\r\n                />\r\n            );\r\n        } else {\r\n            return <div></div>;\r\n        }\r\n    }\r\n\r\n    private renderNextPageButton = () => {\r\n        if (!_.get(this, \"fileInput.current.files[0]\", null)) {\r\n            return <div></div>;\r\n        }\r\n\r\n        const numPages = this.getPageCount();\r\n        const nextPage = () => {\r\n            this.setState((prevState) => ({\r\n                currPage: Math.min(prevState.currPage + 1, numPages),\r\n            }));\r\n        };\r\n\r\n        if (this.state.currPage < numPages) {\r\n            return (\r\n                <IconButton\r\n                    className=\"toolbar-btn next\"\r\n                    title=\"Next\"\r\n                    onClick={nextPage}\r\n                    iconProps={{iconName: \"ChevronRight\"}}\r\n                />\r\n            );\r\n        } else {\r\n            return <div></div>;\r\n        }\r\n    }\r\n\r\n    private renderImageMap = () => {\r\n        return (\r\n            <ImageMap\r\n                ref={(ref) => this.imageMap = ref}\r\n                imageUri={this.state.imageUri || \"\"}\r\n                imageWidth={this.state.imageWidth}\r\n                imageHeight={this.state.imageHeight}\r\n\r\n                featureStyler={this.featureStyler}\r\n                onMapReady={this.noOp}\r\n            />\r\n        );\r\n    }\r\n\r\n    private handleFileChange = () => {\r\n        if (this.fileInput.current.value !== \"\") {\r\n            const fileName = this.fileInput.current.value.split(\"\\\\\").pop();\r\n            if (fileName !== \"\") {\r\n                this.setState({\r\n                    fileLabel: fileName,\r\n                    currPage: 1,\r\n                    analyzeResult: {},\r\n                    fileChanged: true,\r\n                    file: this.fileInput.current.files[0],\r\n                    predictRun: false,\r\n                }, () => {\r\n                    if (this.imageMap) {\r\n                        this.imageMap.removeAllFeatures();\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleClick = () => {\r\n        this.setState({ predictionLoaded: false, isPredicting: true });\r\n        this.getPrediction()\r\n            .then((result) => {\r\n                this.setState({\r\n                    analyzeResult: result,\r\n                    predictionLoaded: true,\r\n                    predictRun: true,\r\n                    isPredicting: false,\r\n                }, () => {\r\n                    this.drawPredictionResult();\r\n                });\r\n            }).catch((error) => {\r\n                let alertMessage = \"\";\r\n                if (error.response) {\r\n                    alertMessage = error.response.data;\r\n                } else if (error.errorCode === ErrorCode.PredictWithoutTrainForbidden) {\r\n                    alertMessage = strings.errors.predictWithoutTrainForbidden.message;\r\n                } else if (error.errorCode === ErrorCode.ModelNotFound) {\r\n                    alertMessage = error.message;\r\n                } else {\r\n                    alertMessage = interpolate(strings.errors.endpointConnectionError.message, { endpoint: \"form recognizer backend URL\" });\r\n                }\r\n                this.setState({\r\n                    shouldShowAlert: true,\r\n                    alertTitle: \"Prediction Failed\",\r\n                    alertMessage,\r\n                    isPredicting: false,\r\n                });\r\n            });\r\n    }\r\n\r\n    private getPageCount() {\r\n        if (this.currPdf !== null) {\r\n            return _.get(this.currPdf, \"numPages\", 1);\r\n        } else if (this.tiffImages.length !== 0) {\r\n            return this.tiffImages.length;\r\n        }\r\n\r\n        return 1;\r\n    }\r\n\r\n    private async getPrediction(): Promise<any> {\r\n        const modelID = _.get(this.props.project, \"trainRecord.modelInfo.modelId\");\r\n        if (!modelID) {\r\n            throw new AppError(\r\n                ErrorCode.PredictWithoutTrainForbidden,\r\n                strings.errors.predictWithoutTrainForbidden.message,\r\n                strings.errors.predictWithoutTrainForbidden.title);\r\n        }\r\n        const endpointURL = url.resolve(\r\n            this.props.project.apiUriBase,\r\n            `${constants.apiModelsPath}/${modelID}/analyze?includeTextDetails=true`,\r\n        );\r\n        const headers = { \"Content-Type\": this.state.file.type, \"cache-control\": \"no-cache\" };\r\n        let response;\r\n        try {\r\n            response = await ServiceHelper.postWithAutoRetry(\r\n                endpointURL, this.state.file, { headers }, this.props.project.apiKey as string);\r\n        } catch (err) {\r\n            ServiceHelper.handleServiceError(err);\r\n        }\r\n\r\n        const operationLocation = response.headers[\"operation-location\"];\r\n\r\n        // Make the second REST API call and get the response.\r\n        return this.poll(() =>\r\n            ServiceHelper.getWithAutoRetry(\r\n                operationLocation, { headers }, this.props.project.apiKey as string), 120000, 500);\r\n    }\r\n\r\n    private loadFile = (file: File) => {\r\n        if (!file) {\r\n            // no file\r\n            return;\r\n        }\r\n\r\n        // determine how to load file based on MIME type of the file\r\n        // https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types\r\n        switch (file.type) {\r\n            case \"image/jpeg\":\r\n            case \"image/png\":\r\n                this.loadImageFile(file);\r\n                break;\r\n\r\n            case \"image/tiff\":\r\n                this.loadTiffFile(file);\r\n                break;\r\n\r\n            case \"application/pdf\":\r\n                this.loadPdfFile(file);\r\n                break;\r\n\r\n            default:\r\n                // un-supported file type\r\n                this.setState({\r\n                    imageUri: \"\",\r\n                    shouldShowAlert: true,\r\n                    alertTitle: \"Not supported file type\",\r\n                    alertMessage: \"Sorry, we currently only support JPG/PNG/PDF files.\",\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    private loadImageFile = async (file: File) => {\r\n        const imageUri = this.createObjectURL(file);\r\n        const canvas = await loadImageToCanvas(imageUri);\r\n        this.setState({\r\n            currPage: 1,\r\n            imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n            imageWidth: canvas.width,\r\n            imageHeight: canvas.height,\r\n        });\r\n    }\r\n\r\n    private loadTiffFile = async (file) => {\r\n        const fileArrayBuffer = await HtmlFileReader.readFileAsArrayBuffer(file);\r\n        this.tiffImages = parseTiffData(fileArrayBuffer);\r\n        this.loadTiffPage(this.tiffImages, this.state.currPage);\r\n    }\r\n\r\n    private loadTiffPage = (tiffImages: any[], pageNumber: number) => {\r\n        const tiffImage = tiffImages[pageNumber - 1];\r\n        const canvas = renderTiffToCanvas(tiffImage);\r\n        this.setState({\r\n            currPage: pageNumber,\r\n            imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n            imageWidth: tiffImage.width,\r\n            imageHeight: tiffImage.height,\r\n        });\r\n    }\r\n\r\n    private loadPdfFile = (file) => {\r\n        const fileReader: FileReader = new FileReader();\r\n\r\n        fileReader.onload = (e: any) => {\r\n            const typedArray = new Uint8Array(e.target.result);\r\n            const loadingTask = pdfjsLib.getDocument({data: typedArray, cMapUrl, cMapPacked: true});\r\n            loadingTask.promise.then((pdf) => {\r\n                this.currPdf = pdf;\r\n                this.loadPdfPage(pdf, this.state.currPage);\r\n            }, (reason) => {\r\n                this.setState({\r\n                    shouldShowAlert: true,\r\n                    alertTitle: \"Failed loading PDF\",\r\n                    alertMessage: reason.toString(),\r\n                });\r\n            });\r\n        };\r\n\r\n        fileReader.readAsArrayBuffer(file);\r\n    }\r\n\r\n    private loadPdfPage = async (pdf, pageNumber) => {\r\n        const page = await pdf.getPage(pageNumber);\r\n        const defaultScale = 2;\r\n        const viewport = page.getViewport({ scale: defaultScale });\r\n\r\n        // Prepare canvas using PDF page dimensions\r\n        const canvas = document.createElement(\"canvas\");\r\n        const context = canvas.getContext(\"2d\");\r\n        canvas.height = viewport.height;\r\n        canvas.width = viewport.width;\r\n\r\n        // Render PDF page into canvas context\r\n        const renderContext = {\r\n            canvasContext: context,\r\n            viewport,\r\n        };\r\n\r\n        const renderTask = page.render(renderContext);\r\n        await renderTask.promise;\r\n        this.setState({\r\n            currPage: pageNumber,\r\n            imageUri: canvas.toDataURL(constants.convertedImageFormat, constants.convertedImageQuality),\r\n            imageWidth: canvas.width,\r\n            imageHeight: canvas.height,\r\n        });\r\n    }\r\n\r\n    private createBoundingBoxVectorFeature = (text, boundingBox, imageExtent, ocrExtent) => {\r\n        const coordinates: number[][] = [];\r\n\r\n        // extent is int[4] to represent image dimentions: [left, bottom, right, top]\r\n        const imageWidth = imageExtent[2] - imageExtent[0];\r\n        const imageHeight = imageExtent[3] - imageExtent[1];\r\n        const ocrWidth = ocrExtent[2] - ocrExtent[0];\r\n        const ocrHeight = ocrExtent[3] - ocrExtent[1];\r\n\r\n        for (let i = 0; i < boundingBox.length; i += 2) {\r\n            coordinates.push([\r\n                Math.round((boundingBox[i] / ocrWidth) * imageWidth),\r\n                Math.round((1 - (boundingBox[i + 1] / ocrHeight)) * imageHeight),\r\n            ]);\r\n        }\r\n\r\n        const feature = new Feature({\r\n            geometry: new Polygon([coordinates]),\r\n        });\r\n        const tag = this.props.project.tags.find((tag) => tag.name.toLocaleLowerCase() === text.toLocaleLowerCase());\r\n        const isHighlighted = (text.toLocaleLowerCase() === this.state.highlightedField.toLocaleLowerCase());\r\n        feature.setProperties({\r\n            color: _.get(tag, \"color\", \"#333333\"),\r\n            fieldName: text,\r\n            isHighlighted,\r\n        });\r\n\r\n        return feature;\r\n    }\r\n\r\n    private featureStyler = (feature) => {\r\n        return new Style({\r\n            stroke: new Stroke({\r\n                color: feature.get(\"color\"),\r\n                width: feature.get(\"isHighlighted\") ? 4 : 2,\r\n            }),\r\n            fill: new Fill({\r\n                color: \"rgba(255, 255, 255, 0)\",\r\n            }),\r\n        });\r\n    }\r\n\r\n    private drawPredictionResult = (): void => {\r\n        const features = [];\r\n        const imageExtent = [0, 0, this.state.imageWidth, this.state.imageHeight];\r\n        const ocrForCurrentPage: any = this.getOcrFromAnalyzeResult(this.state.analyzeResult)[this.state.currPage - 1];\r\n        const ocrExtent = [0, 0, ocrForCurrentPage.width, ocrForCurrentPage.height];\r\n        const predictions = this.getPredictionsFromAnalyzeResult(this.state.analyzeResult);\r\n\r\n        for (const fieldName of Object.keys(predictions)) {\r\n            const field = predictions[fieldName];\r\n            if (_.get(field, \"page\", null) === this.state.currPage) {\r\n                const text = fieldName;\r\n                const boundingbox = _.get(field, \"boundingBox\", []);\r\n                const feature = this.createBoundingBoxVectorFeature(text, boundingbox, imageExtent, ocrExtent);\r\n                features.push(feature);\r\n            }\r\n        }\r\n        this.imageMap.addFeatures(features);\r\n    }\r\n\r\n    /**\r\n     * Poll function to repeatly check if request succeeded\r\n     * @param func - function that will be called repeatly\r\n     * @param timeout - timeout\r\n     * @param interval - interval\r\n     */\r\n    private poll = (func, timeout, interval): Promise<any> => {\r\n        const endTime = Number(new Date()) + (timeout || 10000);\r\n        interval = interval || 100;\r\n\r\n        const checkSucceeded = (resolve, reject) => {\r\n            const ajax = func();\r\n            ajax.then((response) => {\r\n                if (response.data.status.toLowerCase() === constants.statusCodeSucceeded) {\r\n                    resolve(response.data);\r\n                } else if (response.data.status.toLowerCase() === constants.statusCodeFailed) {\r\n                    reject(_.get(\r\n                        response,\r\n                        \"data.analyzeResult.errors[0].errorMessage\",\r\n                        \"Generic error during prediction\"));\r\n                } else if (Number(new Date()) < endTime) {\r\n                    // If the request isn't succeeded and the timeout hasn't elapsed, go again\r\n                    setTimeout(checkSucceeded, interval, resolve, reject);\r\n                } else {\r\n                    // Didn't succeeded after too much time, reject\r\n                    reject(\"Timed out, please try other file.\");\r\n                }\r\n            });\r\n        };\r\n\r\n        return new Promise(checkSucceeded);\r\n    }\r\n\r\n    private getPredictionsFromAnalyzeResult(analyzeResult: any) {\r\n        return _.get(analyzeResult, \"analyzeResult.documentResults[0].fields\", {});\r\n    }\r\n\r\n    private getOcrFromAnalyzeResult(analyzeResult: any) {\r\n        return _.get(analyzeResult, \"analyzeResult.readResults\", []);\r\n    }\r\n\r\n    private createObjectURL = (object: File) => {\r\n        // generate a URL for the object\r\n        return (window.URL) ? window.URL.createObjectURL(object) : \"\";\r\n    }\r\n\r\n    private noOp = () => {\r\n        // no operation\r\n    }\r\n\r\n    private onPredictionClick = (predictedItem: any) => {\r\n        const targetPage = predictedItem.page;\r\n        if (Number.isInteger(targetPage) && targetPage !== this.state.currPage) {\r\n            this.setState({\r\n                currPage: targetPage,\r\n                highlightedField: predictedItem.fieldName,\r\n            });\r\n        }\r\n    }\r\n\r\n    private onPredictionMouseEnter = (predictedItem: any) => {\r\n        this.setState({\r\n            highlightedField: predictedItem.fieldName,\r\n        });\r\n    }\r\n\r\n    private onPredictionMouseLeave = (predictedItem: any) => {\r\n        this.setState({\r\n            highlightedField: \"\",\r\n        });\r\n    }\r\n\r\n    private setPredictedFieldHighlightStatus = (highlightedField: string) => {\r\n        const features = this.imageMap.getAllFeatures();\r\n        for (const feature of features) {\r\n            if (feature.get(\"fieldName\").toLocaleLowerCase() === highlightedField.toLocaleLowerCase()) {\r\n                feature.set(\"isHighlighted\", true);\r\n            } else {\r\n                feature.set(\"isHighlighted\", false);\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nexport enum ProjectSettingAction {\r\n    Create,\r\n    Update,\r\n    Other,\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { IConnection } from \"../../../../models/applicationState\";\r\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\r\nimport { DefaultButton } from \"office-ui-fabric-react\";\r\nimport { getPrimaryGreyTheme } from \"../../../../common/themes\";\r\n\r\n/**\r\n * Properties for Connection Picker\r\n * @member id - ID for HTML select element\r\n * @member value - Selected value of picker\r\n * @member connections - Array of connections for choosing\r\n * @member onChange - Function to call on change of selection\r\n */\r\nexport interface IConnectionPickerProps extends RouteComponentProps {\r\n    id?: string;\r\n    value: any;\r\n    connections: IConnection[];\r\n    onChange: (value) => void;\r\n}\r\n\r\n/**\r\n * State for Connection Picker\r\n * @member value - Selected value\r\n */\r\nexport interface IConnectionPickerState {\r\n    value: any;\r\n}\r\n\r\n/**\r\n * @name - Connection Picker\r\n * @description - Enhanced dropdown for selecting a Connection\r\n */\r\nexport class ConnectionPicker extends React.Component<IConnectionPickerProps, IConnectionPickerState> {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n        this.state = {\r\n            value: this.props.value,\r\n        };\r\n\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    public componentDidUpdate(prevProps) {\r\n        if (prevProps.value !== this.props.value) {\r\n            this.setState({\r\n                value: this.props.value || null,\r\n            });\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const { id, connections } = this.props;\r\n        const selectedValue = this.state.value ? this.state.value.id : \"\";\r\n\r\n        return (\r\n            <div className=\"input-group\">\r\n                <select id={id} value={selectedValue} onChange={this.onChange}\r\n                    required className=\"form-control\">\r\n                    <option>Select Connection</option>\r\n                    {connections.map((connection) =>\r\n                        <option\r\n                            className=\"connection-option\"\r\n                            key={connection.id}\r\n                            value={connection.id}>{connection.name}\r\n                        </option>)\r\n                    }\r\n                </select>\r\n                <div className=\"input-group-append\">\r\n                    <DefaultButton\r\n                        className=\"connection-picker-button\"\r\n                        theme={getPrimaryGreyTheme()}\r\n                        type=\"button\"\r\n                        onClick={this.createConnection}>\r\n                        Add Connection\r\n                    </DefaultButton>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private onChange = (e) => {\r\n        const selectedConnection = this.props.connections\r\n            .find((connection) => connection.id === e.target.value) || {};\r\n\r\n        this.setState({\r\n            value: selectedConnection,\r\n        }, () => this.props.onChange(selectedConnection));\r\n    }\r\n\r\n    private createConnection = () => {\r\n        this.props.history.push(\"/connections/create\");\r\n    }\r\n}\r\n\r\nexport const ConnectionPickerWithRouter =\r\n    withRouter<IConnectionPickerProps, React.ComponentType<IConnectionPickerProps>>(ConnectionPicker);\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React, { SyntheticEvent } from \"react\";\r\nimport { ISecurityToken } from \"../../../../models/applicationState\";\r\n\r\n/**\r\n * Security Token Picker Properties\r\n * @member id - The id to bind to the input element\r\n * @member value - The value to bind to the input element\r\n * @member securityTokens - The list of security tokens to display\r\n * @member onChange - The event handler to call when the input value changes\r\n */\r\nexport interface ISecurityTokenPickerProps {\r\n    id?: string;\r\n    value: string;\r\n    securityTokens: ISecurityToken[];\r\n    onChange: (value: string) => void;\r\n}\r\n\r\n/**\r\n * Security Token Picker\r\n * @description - Used to display a list of security tokens\r\n */\r\nexport class SecurityTokenPicker extends React.Component<ISecurityTokenPickerProps> {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <select id={this.props.id}\r\n                className=\"form-control\"\r\n                value={this.props.value}\r\n                onChange={this.onChange}>\r\n                <option value=\"\">Generate New Security Token</option>\r\n                {this.props.securityTokens.map((item) => <option key={item.key} value={item.name}>{item.name}</option>)}\r\n            </select>\r\n        );\r\n    }\r\n\r\n    private onChange(e: SyntheticEvent) {\r\n        const inputElement = e.target as HTMLSelectElement;\r\n        this.props.onChange(inputElement.value ? inputElement.value : undefined);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport Form, { FormValidation, ISubmitEvent, IChangeEvent, Widget } from \"react-jsonschema-form\";\r\nimport { addLocValues, strings } from \"../../../../common/strings\";\r\nimport { IConnection, IProject, IAppSettings } from \"../../../../models/applicationState\";\r\nimport { StorageProviderFactory } from \"../../../../providers/storage/storageProviderFactory\";\r\nimport { ConnectionPickerWithRouter } from \"../../common/connectionPicker/connectionPicker\";\r\nimport { CustomField } from \"../../common/customField/customField\";\r\nimport CustomFieldTemplate from \"../../common/customField/customFieldTemplate\";\r\nimport { ISecurityTokenPickerProps, SecurityTokenPicker } from \"../../common/securityTokenPicker/securityTokenPicker\";\r\nimport \"vott-react/dist/css/tagsInput.css\";\r\nimport { IConnectionProviderPickerProps } from \"../../common/connectionProviderPicker/connectionProviderPicker\";\r\nimport { ProjectSettingAction } from \"./projectSettingAction\";\r\nimport { ProtectedInput } from \"../../common/protectedInput/protectedInput\";\r\nimport { PrimaryButton } from \"office-ui-fabric-react\";\r\nimport { getPrimaryGreenTheme, getPrimaryGreyTheme } from \"../../../../common/themes\";\r\n\r\n// tslint:disable-next-line:no-var-requires\r\nconst newFormSchema = addLocValues(require(\"./newProjectForm.json\"));\r\n// tslint:disable-next-line:no-var-requires\r\nconst editFormSchema = addLocValues(require(\"./editProjectForm.json\"));\r\n// tslint:disable-next-line:no-var-requires\r\nconst uiSchema = addLocValues(require(\"./projectForm.ui.json\"));\r\n\r\n/**\r\n * Required properties for Project Settings form\r\n * @member project - Current project to fill form\r\n * @member connections - Array of connections to use in project\r\n * @member onSubmit - Function to call on form submission\r\n * @member onCancel - Function to call on form cancellation\r\n */\r\nexport interface IProjectFormProps extends React.Props<ProjectForm> {\r\n    project: IProject;\r\n    connections: IConnection[];\r\n    appSettings: IAppSettings;\r\n    action: ProjectSettingAction;\r\n    onSubmit: (project: IProject) => void;\r\n    onChange?: (project: IProject) => void;\r\n    onCancel?: () => void;\r\n}\r\n\r\n/**\r\n * Project Form State\r\n * @member classNames - Class names for HTML form element\r\n * @member formData - data containing details of project\r\n * @member formSchema - json schema of form\r\n * @member uiSchema - json UI schema of form\r\n */\r\nexport interface IProjectFormState {\r\n    classNames: string[];\r\n    formData: IProject;\r\n    formSchema: any;\r\n    uiSchema: any;\r\n}\r\n\r\n/**\r\n * @name - Project Form\r\n * @description - Form for editing or creating VoTT projects\r\n */\r\nexport default class ProjectForm extends React.Component<IProjectFormProps, IProjectFormState> {\r\n    private widgets = {\r\n        protectedInput: (ProtectedInput as any) as Widget,\r\n    };\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            classNames: [\"needs-validation\"],\r\n            uiSchema: { ...uiSchema },\r\n            formSchema: {},\r\n            formData: {\r\n                ...this.props.project,\r\n            },\r\n        };\r\n\r\n        this.onFormSubmit = this.onFormSubmit.bind(this);\r\n        this.onFormCancel = this.onFormCancel.bind(this);\r\n        this.onFormValidate = this.onFormValidate.bind(this);\r\n    }\r\n    /**\r\n     * Updates state if project from properties has changed\r\n     * @param prevProps - previously set properties\r\n     */\r\n    public componentDidUpdate(prevProps: IProjectFormProps) {\r\n        if (prevProps.project !== this.props.project) {\r\n            this.setState({\r\n                formData: { ...this.props.project },\r\n            });\r\n        }\r\n        if (prevProps.action !== this.props.action) {\r\n            switch (this.props.action) {\r\n                case ProjectSettingAction.Create:\r\n                    this.setState({formSchema: newFormSchema});\r\n                    break;\r\n                case ProjectSettingAction.Update:\r\n                    this.setState({formSchema: editFormSchema});\r\n                    break;\r\n                default:\r\n                    this.setState({ formSchema: {}});\r\n            }\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <Form\r\n                className={this.state.classNames.join(\" \")}\r\n                showErrorList={false}\r\n                liveValidate={true}\r\n                noHtml5Validate={true}\r\n                FieldTemplate={CustomFieldTemplate}\r\n                validate={this.onFormValidate}\r\n                fields={this.fields()}\r\n                widgets={this.widgets}\r\n                schema={this.state.formSchema}\r\n                uiSchema={this.state.uiSchema}\r\n                formData={this.state.formData}\r\n                onChange={this.onFormChange}\r\n                onSubmit={this.onFormSubmit}>\r\n                <div>\r\n                    <PrimaryButton\r\n                        theme={getPrimaryGreenTheme()}\r\n                        className=\"mr-2\"\r\n                        type=\"submit\">\r\n                        {strings.projectSettings.save}\r\n                    </PrimaryButton>\r\n                    <PrimaryButton\r\n                        theme={getPrimaryGreyTheme()}\r\n                        type=\"button\"\r\n                        onClick={this.onFormCancel}>\r\n                        {strings.common.cancel}\r\n                    </PrimaryButton>\r\n                </div>\r\n            </Form>\r\n        );\r\n    }\r\n\r\n    private fields() {\r\n        return {\r\n            securityToken: CustomField<ISecurityTokenPickerProps>(SecurityTokenPicker, (props) => ({\r\n                id: props.idSchema.$id,\r\n                schema: props.schema,\r\n                value: props.formData,\r\n                securityTokens: this.props.appSettings.securityTokens,\r\n                onChange: props.onChange,\r\n            })),\r\n            sourceConnection: CustomField<IConnectionProviderPickerProps>(ConnectionPickerWithRouter, (props) => {\r\n                return {\r\n                    id: props.idSchema.$id,\r\n                    value: props.formData,\r\n                    connections: this.props.connections,\r\n                    onChange: props.onChange,\r\n                };\r\n            }),\r\n            targetConnection: CustomField<IConnectionProviderPickerProps>(ConnectionPickerWithRouter, (props) => {\r\n                const targetConnections = this.props.connections\r\n                    .filter((connection) => StorageProviderFactory.isRegistered(connection.providerType));\r\n\r\n                return {\r\n                    id: props.idSchema.$id,\r\n                    value: props.formData,\r\n                    connections: targetConnections,\r\n                    onChange: props.onChange,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    private onFormValidate(project: IProject, errors: FormValidation) {\r\n        if (this.props.action === ProjectSettingAction.Create &&\r\n            project.sourceConnection &&\r\n            Object.keys(project.sourceConnection).length === 0) {\r\n            errors.sourceConnection.addError(\"is a required property\");\r\n        }\r\n\r\n        if (this.state.classNames.indexOf(\"was-validated\") === -1) {\r\n            this.setState({\r\n                classNames: [...this.state.classNames, \"was-validated\"],\r\n            });\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    private onFormChange = (changeEvent: IChangeEvent<IProject>) => {\r\n        if (this.props.onChange) {\r\n            this.props.onChange(changeEvent.formData);\r\n        }\r\n    }\r\n\r\n    private onFormSubmit(args: ISubmitEvent<IProject>) {\r\n        const project: IProject = {\r\n            ...args.formData,\r\n            sourceConnection: args.formData.sourceConnection,\r\n            folderPath: this.normalizeFolderPath(args.formData.folderPath),\r\n        };\r\n        project.name = project.name.replace(/\\s+/g, \" \").trim();\r\n        this.props.onSubmit(project);\r\n    }\r\n\r\n    private onFormCancel() {\r\n        if (this.props.onCancel) {\r\n            this.props.onCancel();\r\n        }\r\n    }\r\n\r\n    private normalizeFolderPath(folderPath: string) {\r\n        // trim space\r\n        let normalizePath = folderPath ? folderPath.trim() : \"\";\r\n\r\n        // trim left slash\r\n        while (normalizePath.length > 0 && normalizePath.indexOf(\"/\") === 0) {\r\n            normalizePath = normalizePath.substr(1, normalizePath.length - 1);\r\n        }\r\n\r\n        // trim right slash\r\n        while (normalizePath.length > 0 && normalizePath.lastIndexOf(\"/\") === normalizePath.length - 1) {\r\n            normalizePath = normalizePath.substr(0, normalizePath.length - 1);\r\n        }\r\n\r\n        return normalizePath;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { Redirect } from \"react-router\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { RouteComponentProps } from \"react-router-dom\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport ProjectForm from \"./projectForm\";\r\nimport { constants } from \"../../../../common/constants\";\r\nimport { strings, interpolate } from \"../../../../common/strings\";\r\nimport IProjectActions, * as projectActions from \"../../../../redux/actions/projectActions\";\r\nimport { IApplicationState, IProject, IConnection, IAppSettings } from \"../../../../models/applicationState\";\r\nimport IApplicationActions, * as applicationActions from \"../../../../redux/actions/applicationActions\";\r\nimport IAppTitleActions, * as appTitleActions from \"../../../../redux/actions/appTitleActions\";\r\nimport { toast } from \"react-toastify\";\r\nimport \"./projectSettingsPage.scss\";\r\nimport { ProjectSettingAction } from \"./projectSettingAction\";\r\nimport ProjectService from \"../../../../services/projectService\";\r\nimport { getStorageItem, setStorageItem, removeStorageItem } from \"../../../../redux/middleware/localStorage\";\r\nimport { SkipButton } from \"../../shell/skipButton\";\r\n\r\n/**\r\n * Properties for Project Settings Page\r\n * @member project - Project being edited\r\n * @member recentProjects - Array of projects recently viewed/edited\r\n * @member actions - Project actions\r\n * @member connections - Array of connections available for projects\r\n * @member appSettings - Application settings\r\n * @member appTitleActions - Application title actions\r\n */\r\nexport interface IProjectSettingsPageProps extends RouteComponentProps, React.Props<ProjectSettingsPage> {\r\n    project: IProject;\r\n    recentProjects: IProject[];\r\n    projectActions: IProjectActions;\r\n    applicationActions: IApplicationActions;\r\n    connections: IConnection[];\r\n    appSettings: IAppSettings;\r\n    appTitleActions: IAppTitleActions;\r\n}\r\n\r\nexport interface IProjectSettingsPageState {\r\n    project: IProject;\r\n    action: ProjectSettingAction;\r\n    isError: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: IApplicationState) {\r\n    return {\r\n        project: state.currentProject,\r\n        connections: state.connections,\r\n        recentProjects: state.recentProjects,\r\n        appSettings: state.appSettings,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        projectActions: bindActionCreators(projectActions, dispatch),\r\n        applicationActions: bindActionCreators(applicationActions, dispatch),\r\n        appTitleActions: bindActionCreators(appTitleActions, dispatch),\r\n    };\r\n}\r\n\r\n/**\r\n * @name - Project Settings Page\r\n * @description - Page for adding/editing/removing projects\r\n */\r\n@connect(mapStateToProps, mapDispatchToProps)\r\nexport default class ProjectSettingsPage extends React.Component<IProjectSettingsPageProps, IProjectSettingsPageState> {\r\n    public state: IProjectSettingsPageState = {\r\n        project: this.props.project,\r\n        action: null,\r\n        isError: false,\r\n    };\r\n\r\n    public async componentDidMount() {\r\n        const projectId = this.props.match.params[\"projectId\"];\r\n        try {\r\n            const action = this.getProjectSettingAction(projectId);\r\n            switch (action) {\r\n                case ProjectSettingAction.Create:\r\n                    this.newProjectSetting();\r\n                    this.setState({ action });\r\n                    break;\r\n                case ProjectSettingAction.Update:\r\n                    if (!this.props.project) {\r\n                        await this.loadProjectSetting(projectId);\r\n                    }\r\n                    this.setState({ action });\r\n                    break;\r\n                default:\r\n                    throw Error(\"Your action is neither new nor edit a project setting. Please check if you are loading the project correctly\");\r\n            }\r\n        } catch (error) {\r\n            this.setState({ isError: true });\r\n            alert(error);\r\n        }\r\n\r\n        this.props.appTitleActions.setTitle(strings.projectSettings.title);\r\n        document.title = strings.projectSettings.title + \" - \" + strings.appName;\r\n    }\r\n\r\n    public componentDidUpdate(prevProps: Readonly<IProjectSettingsPageProps>) {\r\n        if (prevProps.project !== this.props.project) {\r\n            this.setState({ project: this.props.project });\r\n        }\r\n    }\r\n\r\n    // Hide ProjectMetrics for private-preview\r\n    public render() {\r\n        return (\r\n            <div className=\"project-settings-page\" id=\"pageProjectSettings\">\r\n                <div className=\"project-settings-page-settings m-3\">\r\n                    <h3 className=\"flex-center\">\r\n                        <FontIcon iconName=\"DocumentManagement\" />\r\n                        <span className=\"px-2\">\r\n                            {strings.projectSettings.title}\r\n                        </span>\r\n                    </h3>\r\n                    <div className=\"m-3\">\r\n                        <ProjectForm\r\n                            project={this.state.project}\r\n                            connections={this.props.connections}\r\n                            appSettings={this.props.appSettings}\r\n                            onChange={this.onFormChange}\r\n                            onSubmit={this.onFormSubmit}\r\n                            onCancel={this.onFormCancel}\r\n                            action={this.state.action} />\r\n                    </div>\r\n                </div>\r\n                <SkipButton skipTo=\"pageProjectSettings\">{strings.common.skipToMainContent}</SkipButton>\r\n                {this.state.isError &&\r\n                    <Redirect to=\"/\" />\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getProjectSettingAction = (projectId: string): ProjectSettingAction => {\r\n        if (this.props.match.url === \"/projects/create\") {\r\n            return ProjectSettingAction.Create;\r\n        } else if (projectId) {\r\n            return ProjectSettingAction.Update;\r\n        } else {\r\n            return ProjectSettingAction.Other;\r\n        }\r\n    }\r\n\r\n    private newProjectSetting = (): void => {\r\n        const projectJson = getStorageItem(constants.projectFormTempKey);\r\n        if (projectJson) {\r\n            this.setState({ project: JSON.parse(projectJson) });\r\n        }\r\n    }\r\n\r\n    private loadProjectSetting = async (projectId: string) => {\r\n        const projectToLoad = this.props.recentProjects.find((project) => project.id === projectId);\r\n        if (projectToLoad) {\r\n            await this.props.applicationActions.ensureSecurityToken(projectToLoad);\r\n            await this.props.projectActions.loadProject(projectToLoad);\r\n        } else {\r\n            throw Error(\"There might be something wrong. We cannot find any project given the project ID.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When the project form is changed verifies if the project contains enough information\r\n     * to persist into temp local storage to support better new project flow when\r\n     * creating new connections inline\r\n     */\r\n    private onFormChange = (project: IProject) => {\r\n        if (this.isPartialProject(project)) {\r\n            setStorageItem(constants.projectFormTempKey, JSON.stringify(project));\r\n        }\r\n    }\r\n\r\n    private onFormSubmit = async (project: IProject) => {\r\n        const isNew = !(!!project.id);\r\n\r\n        if (await this.isValidProjectName(project, isNew)) {\r\n            toast.error(interpolate(strings.projectSettings.messages.projectExisted, { project }));\r\n            return;\r\n        }\r\n\r\n        await this.deleteOldProjectWhenRenamed(project, isNew);\r\n        await this.props.applicationActions.ensureSecurityToken(project);\r\n        await this.props.projectActions.saveProject(project);\r\n        removeStorageItem(constants.projectFormTempKey);\r\n\r\n        toast.success(interpolate(strings.projectSettings.messages.saveSuccess, { project }));\r\n\r\n        if (isNew) {\r\n            this.props.history.push(`/projects/${this.props.project.id}/edit`);\r\n        } else {\r\n            this.props.history.goBack();\r\n        }\r\n    }\r\n\r\n    private onFormCancel = () => {\r\n        removeStorageItem(constants.projectFormTempKey);\r\n        this.props.history.goBack();\r\n    }\r\n\r\n    /**\r\n     * Checks whether a project is partially populated\r\n     */\r\n    private isPartialProject = (project: IProject): boolean => {\r\n        return project && !(!!project.id) &&\r\n            (\r\n                !!project.name\r\n                || !!project.description\r\n                || (project.sourceConnection && Object.keys(project.sourceConnection).length > 0)\r\n                || (project.tags && project.tags.length > 0)\r\n            );\r\n    }\r\n\r\n    private deleteOldProjectWhenRenamed = async (project: IProject, isNew: boolean) => {\r\n        const isProjectRenamed = (this.props.project !== null && this.props.project.name !== project.name);\r\n        if (!isNew && isProjectRenamed) {\r\n            await this.props.projectActions.deleteProject(this.props.project);\r\n        }\r\n    }\r\n\r\n    private isValidProjectName = async (project: IProject, isNew: boolean) => {\r\n        const isProjectRenamed = (this.props.project !== null && this.props.project.name !== project.name);\r\n        const projectService = new ProjectService();\r\n        return (isNew || isProjectRenamed) && await projectService.isProjectNameAlreadyUsed(project);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { Switch, Route } from \"react-router-dom\";\r\nimport HomePage from \"../pages/homepage/homePage\";\r\nimport AppSettingsPage from \"../pages/appSettings/appSettingsPage\";\r\nimport TrainPage from \"../pages/train/trainPage\";\r\nimport ConnectionPage from \"../pages/connections/connectionsPage\";\r\nimport EditorPage from \"../pages/editorPage/editorPage\";\r\nimport PredictPage from \"../pages/predict/predictPage\";\r\nimport ProjectSettingsPage from \"../pages/projectSettings/projectSettingsPage\";\r\n\r\n/**\r\n * @name - Main Content Router\r\n * @description - Controls main content pane based on route\r\n */\r\nexport function MainContentRouter() {\r\n    return (\r\n        <div className=\"app-content text-light\">\r\n            <Switch>\r\n                <Route path=\"/\" exact component={HomePage} />\r\n                <Route path=\"/settings\" component={AppSettingsPage} />\r\n                <Route path=\"/connections/:connectionId\" component={ConnectionPage} />\r\n                <Route path=\"/connections\" exact component={ConnectionPage} />\r\n                <Route path=\"/projects/:projectId/edit\" component={EditorPage} />\r\n                <Route path=\"/projects/create\" component={ProjectSettingsPage} />\r\n                <Route path=\"/projects/:projectId/train\" component={TrainPage} />\r\n                <Route path=\"/projects/:projectId/predict\" component={PredictPage} />\r\n                <Route path=\"/projects/:projectId/settings\" component={ProjectSettingsPage} />\r\n                <Route component={HomePage} />\r\n            </Switch>\r\n        </div>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport Guard from \"./guard\";\r\nimport { IProject, ISecurityToken, IProviderOptions, ISecureString } from \"../models/applicationState\";\r\nimport { encryptObject, decryptObject, encrypt, decrypt } from \"./crypto\";\r\nimport UTIF from \"utif\";\r\nimport HtmlFileReader from \"./htmlFileReader\";\r\n\r\n/**\r\n * Generates a random integer in provided range\r\n * @param min Lower bound of random number generation - INCLUSIVE\r\n * @param max Upper bound of random number generation - EXCLUSIVE\r\n */\r\nexport function randomIntInRange(min: number, max: number) {\r\n    if (min > max) {\r\n        throw new Error(`min (${min}) can't be bigger than max (${max})`);\r\n    }\r\n\r\n    if (min === max) {\r\n        return min;\r\n    }\r\n\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n\r\n    return Math.floor(Math.random() * (max - min)) + min; // The maximum is exclusive and the minimum is inclusive\r\n}\r\n\r\n/**\r\n * Common key codes used throughout application\r\n */\r\nexport const KeyCodes = {\r\n    comma: 188,\r\n    enter: 13,\r\n    backspace: 8,\r\n    ctrl: 17,\r\n    shift: 16,\r\n    tab: 9,\r\n};\r\n\r\n/**\r\n * Generates a query string from the key/values of a JSON object\r\n * @param object The json object\r\n * @returns A value representing a URL compatible query string\r\n */\r\nexport function createQueryString(object: any): string {\r\n    Guard.null(object);\r\n\r\n    const parts: any[] = [];\r\n\r\n    for (const key of Object.getOwnPropertyNames(object)) {\r\n        parts.push(`${key}=${encodeURIComponent(object[key])}`);\r\n    }\r\n\r\n    return parts.join(\"&\");\r\n}\r\n\r\nexport function encodeFileURI(path: string, additionalEncodings?: boolean): string {\r\n    // encodeURI() will not encode: ~!@#$&*()=:/,;?+'\r\n    // extend it to support all of these except # and ?\r\n    // all other non encoded characters are implicitly supported with no reason to encoding them\r\n    const matchString = /(#|\\?)/g;\r\n    const encodings = {\r\n        // eslint-disable-next-line\r\n        \"\\#\": \"%23\",\r\n        // eslint-disable-next-line\r\n        \"\\?\": \"%3F\",\r\n    };\r\n    const encodedURI = `file:${encodeURI(normalizeSlashes(path))}`;\r\n    if (additionalEncodings) {\r\n        return encodedURI.replace(matchString, (match) => encodings[match]);\r\n    }\r\n    return encodedURI;\r\n}\r\n\r\nexport function normalizeSlashes(path: string): string {\r\n    return path.replace(/\\\\/g, \"/\");\r\n}\r\n\r\n/**\r\n * Encrypts sensitive settings for the specified project and returns the result\r\n * @param project The project to encrypt\r\n * @param securityToken The security token used to encrypt the project\r\n */\r\nexport async function encryptProject(project: IProject, securityToken: ISecurityToken) {\r\n    const encrypted: IProject = {\r\n        ...project,\r\n        sourceConnection: { ...project.sourceConnection },\r\n    };\r\n\r\n    encrypted.sourceConnection.providerOptions =\r\n        await encryptProviderOptions(project.sourceConnection.providerOptions, securityToken.key);\r\n\r\n    encrypted.apiKey = await encryptString(project.apiKey, securityToken.key);\r\n\r\n    return encrypted;\r\n}\r\n\r\n/**\r\n * Decrypts sensitive settings for the specified project and return the result\r\n * @param project The project to decrypt\r\n * @param securityToken The security token used to decrypt the project\r\n */\r\nexport async function decryptProject(project: IProject, securityToken: ISecurityToken) {\r\n    const decrypted: IProject = {\r\n        ...project,\r\n        sourceConnection: { ...project.sourceConnection },\r\n    };\r\n\r\n    decrypted.sourceConnection.providerOptions =\r\n        await decryptProviderOptions(decrypted.sourceConnection.providerOptions, securityToken.key);\r\n\r\n    decrypted.apiKey = await decryptString(project.apiKey, securityToken.key);\r\n\r\n    return decrypted;\r\n}\r\n\r\nasync function encryptProviderOptions(providerOptions: IProviderOptions | ISecureString, secret: string) {\r\n    if (!providerOptions) {\r\n        return null;\r\n    }\r\n\r\n    if (providerOptions.encrypted) {\r\n        return providerOptions as ISecureString;\r\n    }\r\n\r\n    return {\r\n        encrypted: await encryptObject(providerOptions, secret),\r\n    } as ISecureString;\r\n}\r\n\r\nasync function decryptProviderOptions<T = IProviderOptions>(\r\n    providerOptions: IProviderOptions | ISecureString,\r\n    secret: string) {\r\n    const secureString = providerOptions as ISecureString;\r\n    if (!(secureString && secureString.encrypted)) {\r\n        return providerOptions as T;\r\n    }\r\n\r\n    return await decryptObject(providerOptions.encrypted, secret) as T;\r\n}\r\n\r\nasync function encryptString(str: string | ISecureString, secret: string) {\r\n    if (!str) {\r\n        return undefined;\r\n    }\r\n\r\n    const secureString = str as ISecureString;\r\n    if (secureString && secureString.encrypted) {\r\n        return secureString;\r\n    }\r\n\r\n    return {\r\n        encrypted: await encrypt(str as string, secret),\r\n    } as ISecureString;\r\n}\r\n\r\nasync function decryptString(str: string | ISecureString, secret) {\r\n    const secureString = str as ISecureString;\r\n    if (!(secureString && secureString.encrypted)) {\r\n        return str as string;\r\n    }\r\n\r\n    return await decrypt(secureString.encrypted, secret) as string;\r\n}\r\n\r\nexport async function throttle<T>(max: number, arr: T[], worker: (payload: T) => Promise<any>) {\r\n    const allPromises: Array<Promise<any>> = [];\r\n    const runningPromises: Array<Promise<any>> = [];\r\n    let i = 0;\r\n    while (i < arr.length) {\r\n        const payload = arr[i];\r\n        i++;\r\n        const promise = worker(payload);\r\n        promise.then((result) => {\r\n            runningPromises.splice(runningPromises.indexOf(promise), 1);\r\n            return result;\r\n        }).catch((err) => {\r\n            runningPromises.splice(runningPromises.indexOf(promise), 1);\r\n            throw err;\r\n        });\r\n        runningPromises.push(promise);\r\n        allPromises.push(promise);\r\n\r\n        if (runningPromises.length >= max) {\r\n            // Wait until any one task is finished (resolved or rejected).\r\n            await Promise.race(runningPromises).catch();\r\n        }\r\n    }\r\n\r\n    return Promise.all(allPromises);\r\n}\r\n\r\nexport function delay(ms: number) {\r\n    return new Promise((resolve) => {\r\n        setTimeout(() => {\r\n            resolve();\r\n        }, ms);\r\n    });\r\n}\r\n\r\nexport function parseTiffData(tiffData: ArrayBuffer): any[] {\r\n    const tiffImages = UTIF.decode(tiffData);\r\n    for (const tiffImage of tiffImages) {\r\n        UTIF.decodeImage(tiffData, tiffImage);\r\n    }\r\n\r\n    return tiffImages;\r\n}\r\n\r\nexport function renderTiffToCanvas(tiffImage): HTMLCanvasElement {\r\n    const rgbData = new Uint8ClampedArray(UTIF.toRGBA8(tiffImage).buffer);\r\n    const imageData = new ImageData(rgbData, tiffImage.width, tiffImage.height);\r\n    const canvas = document.createElement(\"canvas\");\r\n    const context = canvas.getContext(\"2d\");\r\n    canvas.height = tiffImage.height;\r\n    canvas.width = tiffImage.width;\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    return canvas;\r\n}\r\n\r\nexport async function loadImageToCanvas(imageUrl: string): Promise<HTMLCanvasElement> {\r\n    return new Promise((resolve, reject) => {\r\n        const img: HTMLImageElement = document.createElement(\"img\");\r\n        img.onload = async () => {\r\n            const orientation = await HtmlFileReader.readImageOrientation(img);\r\n            const rotatedImage = renderRotatedImageToCanvas(img, orientation);\r\n            resolve(rotatedImage);\r\n        };\r\n        img.crossOrigin = \"anonymous\";\r\n        img.onerror = reject;\r\n        img.src = imageUrl;\r\n    });\r\n}\r\n\r\nexport function renderRotatedImageToCanvas(image: HTMLImageElement, orientation: number): HTMLCanvasElement {\r\n    const width = image.width;\r\n    const height = image.height;\r\n\r\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\");\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    if (orientation > 4) {\r\n        canvas.width = height;\r\n        canvas.height = width;\r\n    }\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    switch (orientation) {\r\n        case 2:\r\n            // horizontal flip\r\n            ctx.translate(width, 0);\r\n            ctx.scale(-1, 1);\r\n            break;\r\n\r\n        case 3:\r\n            // 180° rotate left\r\n            ctx.translate(width, height);\r\n            ctx.rotate(Math.PI);\r\n            break;\r\n\r\n        case 4:\r\n            // vertical flip\r\n            ctx.translate(0, height);\r\n            ctx.scale(1, -1);\r\n            break;\r\n\r\n        case 5:\r\n            // vertical flip + 90 rotate right\r\n            ctx.rotate(0.5 * Math.PI);\r\n            ctx.scale(1, -1);\r\n            break;\r\n\r\n        case 6:\r\n            // 90° rotate right\r\n            ctx.rotate(0.5 * Math.PI);\r\n            ctx.translate(0, -height);\r\n            break;\r\n\r\n        case 7:\r\n            // horizontal flip + 90 rotate right\r\n            ctx.rotate(0.5 * Math.PI);\r\n            ctx.translate(width, -height);\r\n            ctx.scale(-1, 1);\r\n            break;\r\n\r\n        case 8:\r\n            // 90° rotate left\r\n            ctx.rotate(-0.5 * Math.PI);\r\n            ctx.translate(-width, 0);\r\n            break;\r\n    }\r\n    ctx.drawImage(image, 0, 0, width, height);\r\n    return canvas;\r\n}\r\n\r\nexport function joinPath(seperator: string, ...paths: string[]) {\r\n    const leadingSeperator = (paths && paths[0] && paths[0][0] === seperator) ? seperator : \"\";\r\n    const joined = paths.join(seperator);\r\n    const parts = joined.split(seperator);\r\n    const normalized = parts.filter((p) => p && p.trim() !== \"\").join(seperator);\r\n    return leadingSeperator + normalized;\r\n}\r\n\r\nexport function patch<T, K extends keyof T>(data: T[], diff: T[], key: K, properties: K[]): T[] {\r\n    return data.map((item) => {\r\n        const change = diff.find((i) => i[key] === item[key]);\r\n        if (change) {\r\n            const update = {...item};\r\n            properties.forEach((p) => update[p] = change[p]);\r\n            return update;\r\n        }\r\n        return item;\r\n    });\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\n/**\r\n * Link able to be enabled/disabled\r\n * @param param0 - {\r\n *      to: \"link for item\"\r\n *      disabled: true if link is disabled\r\n *      props: {\r\n *          title: Title of item,\r\n *          children: Child items to include in span\r\n *      }\r\n * }\r\n */\r\nexport default function ConditionalNavLink({ to, disabled, ...props }) {\r\n    if (disabled) {\r\n        return (<span className=\"disabled\" title={props.title}>{props.children}</span>);\r\n    } else {\r\n        return (<NavLink title={props.title} to={to} role=\"button\">{props.children}</NavLink>);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport { FontIcon } from \"office-ui-fabric-react\";\r\nimport ConditionalNavLink from \"../common/conditionalNavLink/conditionalNavLink\";\r\nimport { strings } from \"../../../common/strings\";\r\n\r\n/**\r\n * Side bar that remains visible throughout app experience\r\n * Contains links to editor, settings, export, etc.\r\n * @param param0 - {\r\n *      project - IProject\r\n * }\r\n */\r\nexport function Sidebar({ project }) {\r\n    const projectId = project ? project.id : null;\r\n\r\n    return (\r\n        <div className=\"bg-lighter-2 app-sidebar\" id=\"appSidebar\">\r\n            <ul>\r\n                <li>\r\n                    <NavLink title={\"Home\"} to={`/`} exact role=\"button\">\r\n                        <FontIcon iconName=\"Home\" />\r\n                    </NavLink>\r\n                </li>\r\n                <li>\r\n                    <ConditionalNavLink disabled={!projectId}\r\n                        title={strings.tags.editor}\r\n                        to={`/projects/${projectId}/edit`}>\r\n                        <FontIcon iconName=\"Tag\" />\r\n                    </ConditionalNavLink>\r\n                </li>\r\n               <li>\r\n                    <ConditionalNavLink disabled={!projectId}\r\n                        title={strings.train.title}\r\n                        to={`/projects/${projectId}/train`}>\r\n                        <FontIcon iconName=\"MachineLearning\" />\r\n                    </ConditionalNavLink>\r\n                </li>\r\n                <li>\r\n                    <ConditionalNavLink disabled={!projectId}\r\n                        title={`Predict`}\r\n                        to={`/projects/${projectId}/predict`}>\r\n                        <FontIcon iconName=\"Insights\" />\r\n                    </ConditionalNavLink>\r\n                </li>\r\n                <li>\r\n                    <ConditionalNavLink disabled={!projectId}\r\n                        title={strings.projectSettings.title}\r\n                        to={`/projects/${projectId}/settings`}>\r\n                        <FontIcon iconName=\"DocumentManagement\" />\r\n                    </ConditionalNavLink>\r\n                </li>\r\n                <li>\r\n                    <NavLink title={strings.connections.title} to={`/connections`} role=\"button\">\r\n                        <FontIcon iconName=\"Plug\" />\r\n                    </NavLink>\r\n                </li>\r\n            </ul>\r\n            <div className=\"app-sidebar-fill\"></div>\r\n            <ul>\r\n                <li>\r\n                    <NavLink title={strings.appSettings.title} to={`/settings`} role=\"button\">\r\n                        <FontIcon iconName=\"Settings\" />\r\n                    </NavLink>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    );\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { ITrainRecordProps } from \"../react/components/pages/train/trainRecord\";\r\n\r\n/**\r\n * @name - Application State\r\n * @description - Defines the root level application state\r\n * @member appSettings - Application wide settings\r\n * @member connections - Global list of connections available to application\r\n * @member recentProjects - List of recently used projects\r\n * @member currentProject - The active project being edited\r\n * @member appError - error in the app if any\r\n */\r\nexport interface IApplicationState {\r\n    appSettings: IAppSettings;\r\n    connections: IConnection[];\r\n    recentProjects: IProject[];\r\n    currentProject: IProject;\r\n    appError?: IAppError;\r\n    appTitle?: string;\r\n}\r\n\r\n/**\r\n * @name - Application Error\r\n * @description - Defines error detail\r\n * @member title - title of the error to display\r\n * @member message - message of the error to display\r\n * @member errorCode - error category\r\n */\r\nexport interface IAppError {\r\n    errorCode: ErrorCode;\r\n    message: any;\r\n    title?: string;\r\n}\r\n\r\n/**\r\n * Enum of supported error codes\r\n */\r\nexport enum ErrorCode {\r\n    // Note that the value of the enum is in camelCase while\r\n    // the enum key is in Pascal casing\r\n    Unknown = \"unknown\",\r\n    GenericRenderError = \"genericRenderError\",\r\n    ProjectInvalidJson = \"projectInvalidJson\",\r\n    ProjectInvalidSecurityToken = \"projectInvalidSecurityToken\",\r\n    ProjectDuplicateName = \"projectDuplicateName\",\r\n    SecurityTokenNotFound = \"securityTokenNotFound\",\r\n    OverloadedKeyBinding = \"overloadedKeyBinding\",\r\n    BlobContainerIONotFound = \"blobContainerIONotFound\",\r\n    BlobContainerIOForbidden = \"blobContainerIOForbidden\",\r\n    PredictWithoutTrainForbidden = \"predictWithoutTrainForbidden\",\r\n    ModelNotFound = \"modelNotFound\",\r\n    ModelCountLimitExceeded = \"modelCountLimitExceeded\",\r\n    HttpStatusUnauthorized = \"unauthorized\",\r\n    HttpStatusNotFound = \"notFound\",\r\n    HttpStatusTooManyRequests = \"tooManyRequests\",\r\n}\r\n\r\n/**\r\n * Base application error\r\n */\r\nexport class AppError extends Error implements IAppError {\r\n    public errorCode: ErrorCode;\r\n    public message: string;\r\n    public title?: string;\r\n\r\n    constructor(errorCode: ErrorCode, message: string, title: string = null) {\r\n        super(message);\r\n        this.errorCode = errorCode;\r\n        this.message = message;\r\n        this.title = title;\r\n    }\r\n}\r\n\r\n/**\r\n * @name - Provider Options\r\n * @description - Property map of key values used within a export / asset / storage provider\r\n */\r\nexport interface IProviderOptions {\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * @name - Application settings\r\n * @description - Defines the root level configuration options for the application\r\n * @member devToolsEnabled - Whether dev tools are current open and enabled\r\n * @member securityTokens - Token used to encrypt sensitive project settings\r\n */\r\nexport interface IAppSettings {\r\n    securityTokens: ISecurityToken[];\r\n    thumbnailSize?: ISize;\r\n}\r\n\r\n/**\r\n * @name - Project\r\n * @description - Defines the structure of a tagging project\r\n * @member id - Unique identifier\r\n * @member name - User defined name\r\n * @member securityToken - The Base64 encoded token used to encrypt sensitive project data\r\n * @member description - User defined description\r\n * @member tags - User defined list of tags\r\n * @member targetConnection - Full source connection details\r\n * @member assets - Map of assets within a project\r\n */\r\nexport interface IProject {\r\n    id: string;\r\n    name: string;\r\n    version: string;\r\n    securityToken: string;\r\n    description?: string;\r\n    tags: ITag[];\r\n    sourceConnection: IConnection;\r\n    assets?: { [index: string]: IAsset };\r\n    lastVisitedAssetId?: string;\r\n    apiUriBase: string;\r\n    apiKey?: string | ISecureString;\r\n    folderPath: string;\r\n    trainRecord: ITrainRecordProps;\r\n}\r\n\r\n/**\r\n * @name - FileInfo\r\n * @description - Defines the file information and content for V1 projects\r\n * @member content - The content of a file (JSON string)\r\n * @member file - The File object point to the V1 project file\r\n */\r\nexport interface IFileInfo {\r\n    content: string | ArrayBuffer;\r\n    file: File;\r\n}\r\n\r\n/**\r\n * @name - Tag\r\n * @description - Defines the structure of a tag\r\n * @member name - User defined name\r\n * @member color - User editable color associated to tag\r\n */\r\nexport interface ITag {\r\n    name: string;\r\n    color: string;\r\n    type: FieldType;\r\n    format: FieldFormat;\r\n}\r\n\r\n/**\r\n * @enum LOCAL - Local storage type\r\n * @enum CLOUD - Cloud storage type\r\n * @enum OTHER - Any other storage type\r\n */\r\nexport enum StorageType {\r\n    Local = \"local\",\r\n    Cloud = \"cloud\",\r\n    Other = \"other\",\r\n}\r\n\r\n/**\r\n * @name - Connection\r\n * @description - Defines a reusable data source definition for projects\r\n * @member id - Unique identifier for connection\r\n * @member name - User defined name\r\n * @member description - User defined short description\r\n * @member providerType - The underlying storage type (Local File System, Azure Blob Storage, etc)\r\n * @member providerOptions - Provider specific options used to connect to the data source\r\n */\r\nexport interface IConnection {\r\n    id: string;\r\n    name: string;\r\n    description?: string;\r\n    providerType: string;\r\n    providerOptions: IProviderOptions | ISecureString;\r\n}\r\n\r\n/**\r\n * @name - Asset\r\n * @description - Defines an asset within a project\r\n * @member id - Unique identifier for asset\r\n * @member type - Type of asset (Image, Video, etc)\r\n * @member name - Generated name for asset\r\n * @member path - Relative path to asset within the underlying data source\r\n * @member size - Size / dimensions of asset\r\n * @member format - The asset format (jpg, png, mp4, etc)\r\n */\r\nexport interface IAsset {\r\n    id: string;\r\n    type: AssetType;\r\n    state: AssetState;\r\n    name: string;\r\n    path: string;\r\n    size: ISize;\r\n    format?: string;\r\n    timestamp?: number;\r\n    parent?: IAsset;\r\n    predicted?: boolean;\r\n    ocr?: any;\r\n    isRunningOCR?: boolean;\r\n}\r\n\r\n/**\r\n * @name - Asset Metadata\r\n * @description - Format to store asset metadata for each asset within a project\r\n * @member asset - References an asset within the project\r\n * @member regions - The list of regions drawn on the asset\r\n */\r\nexport interface IAssetMetadata {\r\n    asset: IAsset;\r\n    regions: IRegion[];\r\n    version: string;\r\n    labelData: ILabelData;\r\n}\r\n\r\n/**\r\n * @name - Size\r\n * @description - Defines the size and/or diminsion for an asset\r\n * @member width - The actual width of an asset\r\n * @member height - The actual height of an asset\r\n */\r\nexport interface ISize {\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\n/**\r\n * @name - Region\r\n * @description - Defines a region within an asset\r\n * @member id - Unique identifier for this region\r\n * @member type - Defines the type of region\r\n * @member tags - Defines a list of tags applied to a region\r\n * @member points - Defines a list of points that define a region\r\n */\r\nexport interface IRegion {\r\n    id: string;\r\n    type: RegionType;\r\n    tags: string[];\r\n    points?: IPoint[];\r\n    boundingBox?: IBoundingBox;\r\n    value?: string;\r\n    pageNumber: number;\r\n}\r\n\r\n/**\r\n * @name - ILabelData\r\n * @description - Defines a label data correspond to an asset\r\n */\r\nexport interface ILabelData {\r\n    document: string;\r\n    labels: ILabel[];\r\n}\r\n\r\n/**\r\n * @name - ILabel\r\n * @description - Defines a label\r\n */\r\nexport interface ILabel {\r\n    label: string;\r\n    key?: IFormRegion[];\r\n    value: IFormRegion[];\r\n}\r\n\r\n/**\r\n * @name - IFormRegion\r\n * @description - Defines a region which consumed by FormRecognizer\r\n */\r\nexport interface IFormRegion {\r\n    page: number;\r\n    text: string;\r\n    boundingBoxes: [number[]];\r\n}\r\n\r\n/**\r\n * @name - Bounding Box\r\n * @description - Defines the tag usage within a bounding box region\r\n * @member left - Defines the left x boundary for the start of the bounding box\r\n * @member top - Defines the top y boundary for the start of the boudning box\r\n * @member width - Defines the width of the bounding box\r\n * @member height - Defines the height of the bounding box\r\n */\r\nexport interface IBoundingBox {\r\n    left: number;\r\n    top: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\n/**\r\n * @name - Point\r\n * @description - Defines a point / coordinate within a region\r\n * @member x - The x value relative to the asset\r\n * @member y - The y value relative to the asset\r\n */\r\nexport interface IPoint {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\n/**\r\n * @name - Asset Type\r\n * @description - Defines the type of asset within a project\r\n * @member Image - Specifies an asset as an image\r\n * @member PDF - Specifies an asset as a PDF\r\n * @member TIFF - Specifies an asset as a TIFF image\r\n */\r\nexport enum AssetType {\r\n    Unknown = 0,\r\n    Image = 1,\r\n    PDF = 5,\r\n    TIFF = 6,\r\n}\r\n\r\n/**\r\n * @name - Asset State\r\n * @description - Defines the state of the asset with regard to the tagging process\r\n * @member NotVisited - Specifies as asset that has not yet been visited or tagged\r\n * @member Visited - Specifies an asset has been visited, but not yet tagged\r\n * @member Tagged - Specifies an asset has been visited and tagged\r\n */\r\nexport enum AssetState {\r\n    NotVisited = 0,\r\n    Visited = 1,\r\n    Tagged = 2,\r\n}\r\n\r\n/**\r\n * @name - Region Type\r\n * @description - Defines the region type within the asset metadata\r\n * @member Square - Specifies a region as a square\r\n * @member Rectangle - Specifies a region as a rectangle\r\n * @member Polygon - Specifies a region as a multi-point polygon\r\n */\r\nexport enum RegionType {\r\n    Polyline = \"POLYLINE\",\r\n    Point = \"POINT\",\r\n    Rectangle = \"RECTANGLE\",\r\n    Polygon = \"POLYGON\",\r\n    Square = \"SQUARE\",\r\n}\r\n\r\nexport enum EditorMode {\r\n    Rectangle = \"RECT\",\r\n    Polygon = \"POLYGON\",\r\n    Polyline = \"POLYLINE\",\r\n    Point = \"POINT\",\r\n    Select = \"SELECT\",\r\n    CopyRect = \"COPYRECT\",\r\n    None = \"NONE\",\r\n}\r\n\r\nexport interface ISecureString {\r\n    encrypted: string;\r\n}\r\n\r\nexport interface ISecurityToken {\r\n    name: string;\r\n    key: string;\r\n}\r\n\r\nexport enum FieldType {\r\n    String = \"string\",\r\n    Number = \"number\",\r\n    Date = \"date\",\r\n    Time = \"time\",\r\n    Integer = \"integer\",\r\n}\r\n\r\nexport enum FieldFormat {\r\n    NotSpecified = \"not-specified\",\r\n    Currency = \"currency\",\r\n    Decimal = \"decimal\",\r\n    DecimalCommaSeparated = \"decimal-comma-seperated\",\r\n    NoWhiteSpaces = \"no-whitespaces\",\r\n    Alphanumeric = \"alphanumeric\",\r\n    DMY = \"dmy\",\r\n    MDY = \"mdy\",\r\n    YMD = \"ymd\",\r\n}\r\n\r\nexport interface IField {\r\n    fieldKey: string;\r\n    fieldType: FieldType;\r\n    fieldFormat: FieldFormat;\r\n}\r\n\r\nexport interface IFieldInfo {\r\n    fields: IField[];\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { Action } from \"redux\";\r\nimport { ActionTypes } from \"./actionTypes\";\r\nimport {\r\n    ISaveAppSettingsAction,\r\n    IEnsureSecurityTokenAction,\r\n} from \"./applicationActions\";\r\nimport {\r\n    ILoadConnectionAction,\r\n    ISaveConnectionAction,\r\n    IDeleteConnectionAction,\r\n} from \"./connectionActions\";\r\nimport {\r\n    ILoadProjectAction,\r\n    ICloseProjectAction,\r\n    ISaveProjectAction,\r\n    ILoadProjectAssetsAction,\r\n    ISaveAssetMetadataAction,\r\n    ILoadAssetMetadataAction,\r\n    IDeleteProjectAction,\r\n} from \"./projectActions\";\r\nimport {\r\n    IShowAppErrorAction,\r\n    IClearErrorAction,\r\n} from \"./appErrorActions\";\r\nimport { ISetTitleAction } from \"./appTitleActions\";\r\n\r\n/**\r\n * Data payload dispatched from the action and delivered to reducer\r\n */\r\nexport interface IPayloadAction<TType, TPayload> extends Action<TType> {\r\n    payload: TPayload;\r\n}\r\n\r\n/**\r\n * Creates action and validates type of action type name\r\n * @param type Name for action being created\r\n */\r\n// tslint:disable-next-line:max-line-length\r\nexport function createAction<TAction extends Action<TAction[\"type\"]>>(type: TAction[\"type\"]): () => Action<TAction[\"type\"]> {\r\n    return () => ({\r\n        type,\r\n    });\r\n}\r\n\r\n/**\r\n * Create action with payload\r\n * @param type Name for action being created\r\n */\r\n// tslint:disable-next-line:max-line-length\r\nexport function createPayloadAction<TAction extends IPayloadAction<TAction[\"type\"], TAction[\"payload\"]>>(type: TAction[\"type\"]): (payload: TAction[\"payload\"]) => IPayloadAction<TAction[\"type\"], TAction[\"payload\"]> {\r\n    return (payload: TAction[\"payload\"]) => ({\r\n        type,\r\n        payload,\r\n    });\r\n}\r\n\r\n/**\r\n * Catch-all for unregistered actions\r\n */\r\nexport interface IOtherAction extends Action<string> {\r\n    type: ActionTypes.ANY_OTHER_ACTION;\r\n}\r\n\r\n/**\r\n * Helper instance of catch-all\r\n */\r\nexport const anyOtherAction = createAction<IOtherAction>(ActionTypes.ANY_OTHER_ACTION);\r\n\r\n/**\r\n * Used by reducers to type-check all actions\r\n */\r\nexport type AnyAction = IOtherAction |\r\n    ISaveAppSettingsAction |\r\n    IEnsureSecurityTokenAction |\r\n    ISaveConnectionAction |\r\n    IDeleteConnectionAction |\r\n    ILoadConnectionAction |\r\n    ISaveConnectionAction |\r\n    IDeleteConnectionAction |\r\n    ILoadProjectAction |\r\n    ICloseProjectAction |\r\n    ISaveProjectAction |\r\n    IDeleteProjectAction |\r\n    ILoadProjectAssetsAction |\r\n    ISaveAssetMetadataAction |\r\n    ILoadAssetMetadataAction |\r\n    IShowAppErrorAction |\r\n    IClearErrorAction |\r\n    ISetTitleAction;\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport { IAssetProvider, IAssetProviderRegistrationOptions } from \"./assetProviderFactory\";\r\nimport Guard from \"../../common/guard\";\r\nimport { IConnection, StorageType } from \"../../models/applicationState\";\r\nimport getHostProcess, { HostProcessType } from \"../../common/hostProcess\";\r\n\r\n/**\r\n * Interface for all VoTT Storage Providers\r\n * @member storageType - Type of Storage (local, cloud)\r\n * @member readText - Read text from path\r\n * @member readBinary - Read Buffer from path\r\n * @member deleteFile - Delete file from path\r\n * @member writeText - Write text to file at path\r\n * @member writeBinary - Write buffer to file at path\r\n * @member listFiles - List files in container within storage provider\r\n * @member listContainers - List containers in storage provider\r\n * @member createContainer - Create container within storage provider\r\n * @member deleteContainer - Delete a container from a storage provider\r\n */\r\nexport interface IStorageProvider extends IAssetProvider {\r\n\r\n    storageType: StorageType;\r\n\r\n    readText(filePath: string, ignoreNotFound?: boolean): Promise<string>;\r\n    readBinary(filePath: string): Promise<Buffer>;\r\n    deleteFile(filePath: string, ignoreNotFound?: boolean, ignoreForbidden?: boolean): Promise<void>;\r\n\r\n    writeText(filePath: string, contents: string): Promise<void>;\r\n    writeBinary(filePath: string, contents: Buffer): Promise<void>;\r\n\r\n    listFiles(folderPath?: string, ext?: string): Promise<string[]>;\r\n    listContainers(folderPath?: string): Promise<string[]>;\r\n\r\n    createContainer(folderPath: string): Promise<void>;\r\n    deleteContainer(folderPath: string): Promise<void>;\r\n}\r\n\r\n/**\r\n * Interface for registration options of Storage Providers\r\n * @member factory - Function to instantiate storage provider\r\n */\r\nexport interface IStorageProviderRegistrationOptions extends IAssetProviderRegistrationOptions {\r\n    factory: (options?: any) => IStorageProvider;\r\n}\r\n\r\n/**\r\n * @name - Storage Provider Factory\r\n * @description - Creates instance of Storage Providers based on request provider type\r\n */\r\nexport class StorageProviderFactory {\r\n    /**\r\n     * @returns - Dictionary of registered Storage Providers\r\n     */\r\n    public static get providers() {\r\n        return { ...StorageProviderFactory.providerRegistry };\r\n    }\r\n\r\n    /**\r\n     * Register a Storage Provider based on options\r\n     * @param options - Storage Provider options\r\n     */\r\n    public static register(options: IStorageProviderRegistrationOptions);\r\n    /**\r\n     * Register Storage Provider based on name and a factory\r\n     * @param name - Name of Storage Provider\r\n     * @param factory - Function that instantiates Storage Provider\r\n     */\r\n    public static register(name: string, factory: (options?: any) => IStorageProvider);\r\n    /**\r\n     * Register Storage Provider based on name and a factory\r\n     * @param name - Name of Storage Provider\r\n     * @param factory - Function that instantiates Storage Provider\r\n     */\r\n    public static register(nameOrOptions: any, factory?: (options?: any) => IStorageProvider) {\r\n        Guard.null(nameOrOptions);\r\n\r\n        let options: IStorageProviderRegistrationOptions = nameOrOptions as IStorageProviderRegistrationOptions;\r\n\r\n        if (typeof (nameOrOptions) === \"string\") {\r\n            Guard.null(factory);\r\n\r\n            options = {\r\n                name: nameOrOptions,\r\n                displayName: nameOrOptions,\r\n                factory,\r\n            };\r\n        }\r\n\r\n        if (!options.platformSupport) {\r\n            options.platformSupport = HostProcessType.All;\r\n        }\r\n\r\n        if ((options.platformSupport & getHostProcess().type) === 0) {\r\n            return;\r\n        }\r\n\r\n        StorageProviderFactory.providerRegistry[options.name] = options;\r\n    }\r\n\r\n    /**\r\n     * Create Storage Provider from provider type and options specified in connection\r\n     * @param connection Connection for a Storage Provider\r\n     */\r\n    public static createFromConnection(connection: IConnection) {\r\n        return this.create(connection.providerType, connection.providerOptions);\r\n    }\r\n\r\n    /**\r\n     * Create Storage Provider from registered Storage Provider name and options\r\n     * @param name - Name of Storage Provider\r\n     * @param options - Options for Storage Provider\r\n     */\r\n    public static create(name: string, options?: any): IStorageProvider {\r\n        Guard.empty(name);\r\n\r\n        const registrationOptions = StorageProviderFactory.providerRegistry[name];\r\n        if (!registrationOptions) {\r\n            throw new Error(`No storage provider has been registered with name '${name}'`);\r\n        }\r\n\r\n        return registrationOptions.factory(options);\r\n    }\r\n\r\n    /**\r\n     * Indicates whether or not a Storage Provider has been registered\r\n     * @param providerType - Name of Storage Provider\r\n     */\r\n    public static isRegistered(providerType: string): boolean {\r\n        return this.providers[providerType] !== undefined;\r\n    }\r\n\r\n    private static providerRegistry: { [id: string]: IStorageProviderRegistrationOptions } = {};\r\n}\r\n","var map = {\n\t\"./azureBlobStorage.json\": 918,\n\t\"./azureBlobStorage.ui.json\": 498\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 917;","var map = {\n\t\"./azureBlobStorage.ui.json\": 498\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 919;","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\nimport React from \"react\";\r\n\r\nexport interface ISkipButtonProps {\r\n    skipTo: string;\r\n}\r\n\r\nexport class SkipButton extends React.Component<ISkipButtonProps> {\r\n\r\n    constructor(props: ISkipButtonProps) {\r\n        super(props);\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <div className=\"skip-button\">\r\n                <a href=\"#\" onClick={this.skipToId}>{this.props.children}</a>\r\n            </div>);\r\n    }\r\n\r\n    private skipToId = (event: React.MouseEvent<HTMLAnchorElement>) => {\r\n        event.preventDefault();\r\n        const element = document.getElementById(this.props.skipTo);\r\n        if (!element) {\r\n            return;\r\n        }\r\n\r\n        element.focus();\r\n        if (element === document.activeElement) {\r\n            return;\r\n        }\r\n\r\n        const items = element.querySelectorAll(\"*\");\r\n        // items has no Symbol.iterator\r\n        // tslint:disable-next-line:prefer-for-of\r\n        for (let i = 0; i < items.length; ++i) {\r\n            const item = items[i] as HTMLElement;\r\n            item.focus();\r\n            if (item === document.activeElement) {\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":""}